# Модуль для сбора и копирования иерархии файлов

## Обзор

Этот модуль предназначен для рекурсивного обхода директории `src/utils`, сбора иерархии файлов с определенными расширениями и копирования их в директорию `prod`. Он также создает JSON-файл с иерархией собранных файлов.

## Подробнее

Модуль используется для сбора структуры файлов в директории `src/utils` и их копирования в директорию `prod`. Это может быть полезно для создания структуры проекта для продакшн-окружения или для других целей, где требуется копия файлов с сохранением их иерархии.

## Функции

### `collect_and_copy_files`

**Назначение**: Рекурсивно обходит указанную директорию, собирает иерархию файлов и копирует файлы с определенными расширениями в целевую директорию.

**Параметры**:

-   `directory` (Path): Путь к директории, которую нужно обойти.
-   `target_directory` (Path): Путь к целевой директории, в которую будут скопированы файлы.

**Возвращает**:

-   `dict`: Словарь, представляющий иерархию файлов, где ключи - имена файлов и папок.

**Как работает функция**:

1.  Инициализирует пустой словарь `hierarchy` для хранения иерархии файлов.
2.  Перебирает все элементы (файлы и поддиректории) в заданной директории.
3.  Если элемент является директорией:
    *   Проверяет, не является ли имя директории одним из исключенных (`profiles`, `__pycache__`, `_experiments`) и не начинается ли с `___`, а также не содержит ли символ `*`.
    *   Если директория не исключена, рекурсивно вызывает `collect_and_copy_files` для этой директории и сохраняет результат в словаре `hierarchy` под ключом имени директории.
4.  Если элемент является файлом:
    *   Проверяет, имеет ли файл одно из разрешенных расширений (`.py`, `.json`, `.md`, `.dot`, `.mer`), не начинается ли его имя с `___`, и не содержит ли символ `*`, `(`, или `)`.
    *   Если файл соответствует условиям, добавляет его имя в словарь `hierarchy` со значением `None`.
    *   Формирует путь к файлу в целевой директории.
    *   Создает родительские директории для целевого файла, если они не существуют.
    *   Копирует файл в целевую директорию с сохранением метаданных.
5.  Возвращает словарь `hierarchy`.

```python
def collect_and_copy_files(directory: Path, target_directory: Path) -> dict:
    """
    Рекурсивно обходит указанную директорию, собирает иерархию файлов и копирует файлы с определенными расширениями в целевую директорию.

    Args:
        directory (Path): Путь к директории, которую нужно обойти.
        target_directory (Path): Путь к целевой директории, в которую будут скопированы файлы.

    Returns:
        dict: Словарь, представляющий иерархию файлов, где ключи - имена файлов и папок.
    """
    ...
```

### `main`

**Назначение**: Определяет исходную и целевую директории, вызывает функцию `collect_and_copy_files` для сбора и копирования файлов, и сохраняет иерархию файлов в JSON-файл.

**Как работает функция**:

1.  Определяет исходную директорию `src_directory` как `src/utils` относительно корневой директории проекта.
2.  Определяет целевую директорию `project_structure_directory` как `prod` внутри `src_directory`.
3.  Вызывает функцию `collect_and_copy_files` для сбора иерархии файлов и их копирования в целевую директорию.
4.  Определяет путь к файлу `file_hierarchy.json` внутри `project_structure_directory`, в который будет сохранена иерархия.
5.  Сохраняет иерархию файлов в JSON-файл с использованием функции `j_dumps`.

```python
def main():
    """
    Определяет исходную и целевую директории, вызывает функцию `collect_and_copy_files` для сбора и копирования файлов,
    и сохраняет иерархию файлов в JSON-файл.
    """
    ...
```

## Запуск

```python
if __name__ == "__main__":
    main()
```

При запуске этого скрипта будет вызвана функция `main`, которая соберет иерархию файлов из директории `src/utils`, скопирует их в директорию `prod`, и сохранит иерархию в файл `file_hierarchy.json`.

## Примеры

### Пример структуры директории

Предположим, что структура директории `src/utils` выглядит следующим образом:

```
src/utils/
├── file1.py
├── file2.json
├── subdir1/
│   ├── file3.py
│   └── file4.md
└── subdir2/
    └── file5.dot
```

После выполнения скрипта, в директории `prod` будет создана следующая структура:

```
prod/
├── file1.py
├── file2.json
├── subdir1/
│   ├── file3.py
│   └── file4.md
└── subdir2/
    └── file5.dot
```

И файл `file_hierarchy.json` будет содержать JSON-представление этой структуры.

### Содержимое `file_hierarchy.json`

```json
{
    "file1.py": null,
    "file2.json": null,
    "subdir1": {
        "file3.py": null,
        "file4.md": null
    },
    "subdir2": {
        "file5.dot": null
    }
}
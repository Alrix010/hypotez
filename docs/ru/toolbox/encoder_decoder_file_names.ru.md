# Модуль кодирования и декодирования имен файлов

## Обзор

Модуль `encoder_decoder_file_names.ru.md` предоставляет функциональность для кодирования полных путей файлов в короткие идентификаторы и декодирования этих идентификаторов обратно в полные пути. Это полезно для сокращения длины путей файлов, которые могут быть длинными и неудобными для хранения или передачи.

## Подробней

Модуль использует базу данных SQLite для хранения соответствий между полными путями файлов и их короткими идентификаторами. Для генерации коротких идентификаторов используется алгоритм MD5. Для логирования используется модуль `src.logger.logger`.

## Классы

### `PathEncoderDecoder`

**Описание**: Класс предоставляет методы для кодирования и декодирования путей файлов.

**Наследует**: Нет

**Атрибуты**:

- `db_name` (str): Имя базы данных SQLite. По умолчанию `'path_mapping.db'`.

**Методы**:

- `__init__`: Инициализирует экземпляр класса, устанавливает имя базы данных и создает таблицу `path_mapping`, если она не существует.
- `_create_table`: Создает таблицу `path_mapping` в базе данных, если она не существует.
- `encode`: Кодирует полный путь файла в короткий идентификатор (8 символов от MD5-хэша).
- `decode`: Декодирует короткий идентификатор в полный путь файла.
- `clear_mapping`: Очищает все записи в базе данных.

**Принцип работы**:

1.  При инициализации класса `PathEncoderDecoder` устанавливается соединение с базой данных SQLite. Если база данных не существует, она будет создана.
2.  Метод `_create_table` создает таблицу `path_mapping` в базе данных, если она еще не существует. Эта таблица содержит два столбца: `id` (короткий идентификатор) и `file_path` (полный путь к файлу).
3.  Метод `encode` принимает полный путь к файлу в качестве входных данных. Он генерирует MD5-хэш из этого пути, берет первые 8 символов хэша и добавляет префикс `id-`. Полученный короткий идентификатор и полный путь к файлу сохраняются в таблице `path_mapping`.
4.  Метод `decode` принимает короткий идентификатор в качестве входных данных. Он ищет соответствующий полный путь к файлу в таблице `path_mapping`. Если соответствие найдено, метод возвращает полный путь к файлу. В противном случае метод возвращает `None`.
5.  Метод `clear_mapping` удаляет все записи из таблицы `path_mapping`.

## Методы класса

### `__init__(self, db_name: str = 'path_mapping.db')`

```python
def __init__(self, db_name: str = 'path_mapping.db'):
    """ Инициализирует экземпляр класса PathEncoderDecoder.

    Args:
        db_name (str, optional): Имя базы данных SQLite. По умолчанию 'path_mapping.db'.

    Raises:
        sqlite3.Error: Если возникает ошибка при подключении к базе данных.
    """
    ...
```

**Назначение**: Инициализирует экземпляр класса `PathEncoderDecoder`.

**Параметры**:

- `db_name` (str): Имя базы данных SQLite. По умолчанию `'path_mapping.db'`.

**Возвращает**: Нет

**Вызывает исключения**:

- `sqlite3.Error`: Если возникает ошибка при подключении к базе данных.

**Как работает функция**:

- Устанавливает атрибут `db_name` экземпляра класса.
- Пытается установить соединение с базой данных SQLite, используя имя базы данных, указанное в `db_name`.
- Вызывает метод `_create_table` для создания таблицы `path_mapping`, если она еще не существует.
- Если при подключении к базе данных возникает ошибка, она перехватывается, логируется с использованием `logger.error`, и затем вызывается исключение `sqlite3.Error`.

**Примеры**:

```python
encoder_decoder = PathEncoderDecoder()
encoder_decoder = PathEncoderDecoder(db_name='my_db.db')
```

### `_create_table(self)`

```python
def _create_table(self):
    """ Создает таблицу path_mapping в базе данных, если она не существует.

    Raises:
        sqlite3.Error: Если возникает ошибка при создании таблицы.
    """
    ...
```

**Назначение**: Создает таблицу `path_mapping` в базе данных, если она не существует.

**Параметры**: Нет

**Возвращает**: Нет

**Вызывает исключения**:

- `sqlite3.Error`: Если возникает ошибка при создании таблицы.

**Как работает функция**:

- Пытается выполнить SQL-запрос для создания таблицы `path_mapping` в базе данных, если она не существует. Таблица содержит два столбца: `id` (TEXT PRIMARY KEY) и `file_path` (TEXT NOT NULL).
- Если при создании таблицы возникает ошибка, она перехватывается, логируется с использованием `logger.error`, и затем вызывается исключение `sqlite3.Error`.

**Примеры**:

```python
encoder_decoder = PathEncoderDecoder()
encoder_decoder._create_table()
```

### `encode(self, file_path: str) -> str`

```python
def encode(self, file_path: str) -> str:
    """ Кодирует полный путь файла в короткий идентификатор (8 символов от MD5-хэша).

    Args:
        file_path (str): Полный путь к файлу.

    Returns:
        str: Короткий идентификатор.

    Raises:
        sqlite3.Error: Если возникает ошибка при выполнении SQL-запроса.
    """
    ...
```

**Назначение**: Кодирует полный путь файла в короткий идентификатор (8 символов от MD5-хэша).

**Параметры**:

- `file_path` (str): Полный путь к файлу.

**Возвращает**:

- `str`: Короткий идентификатор.

**Вызывает исключения**:

- `sqlite3.Error`: Если возникает ошибка при выполнении SQL-запроса.

**Как работает функция**:

1.  Вычисляет MD5-хэш из переданного `file_path`.
2.  Берет первые 8 символов хэша и добавляет к ним префикс `'id-'`, формируя короткий идентификатор (`short_id`).
3.  Пытается выполнить SQL-запрос для вставки `short_id` и `file_path` в таблицу `path_mapping`.
4.  Если при выполнении SQL-запроса возникает ошибка, она перехватывается, логируется с использованием `logger.error`, и затем вызывается исключение `sqlite3.Error`.
5.  Возвращает `short_id`.

**Примеры**:

```python
encoder_decoder = PathEncoderDecoder()
encoded_path = encoder_decoder.encode('src/my_folder/my_file.txt')
print(encoded_path)  # Вывод: id-9f8e7d6c (пример)
```

### `decode(self, short_id: str) -> Optional[str]`

```python
def decode(self, short_id: str) -> Optional[str]:
    """ Декодирует короткий идентификатор в полный путь файла.

    Args:
        short_id (str): Короткий идентификатор.

    Returns:
        Optional[str]: Полный путь к файлу или None, если идентификатор не найден.

    Raises:
        sqlite3.Error: Если возникает ошибка при выполнении SQL-запроса.
    """
    ...
```

**Назначение**: Декодирует короткий идентификатор в полный путь файла.

**Параметры**:

- `short_id` (str): Короткий идентификатор.

**Возвращает**:

- `Optional[str]`: Полный путь к файлу или `None`, если идентификатор не найден.

**Вызывает исключения**:

- `sqlite3.Error`: Если возникает ошибка при выполнении SQL-запроса.

**Как работает функция**:

1.  Выполняет SQL-запрос для поиска `file_path` в таблице `path_mapping` по заданному `short_id`.
2.  Если `short_id` найден в базе данных, возвращает соответствующий `file_path`.
3.  Если `short_id` не найден, возвращает `None`.
4.  Если при выполнении SQL-запроса возникает ошибка, она перехватывается, логируется с использованием `logger.error`, и затем вызывается исключение `sqlite3.Error`.

**Примеры**:

```python
encoder_decoder = PathEncoderDecoder()
decoded_path = encoder_decoder.decode('id-9f8e7d6c')
print(decoded_path)  # Вывод: src/my_folder/my_file.txt
```

### `clear_mapping(self)`

```python
def clear_mapping(self):
    """ Очищает все записи в базе данных.

    Raises:
        sqlite3.Error: Если возникает ошибка при выполнении SQL-запроса.
    """
    ...
```

**Назначение**: Очищает все записи в базе данных.

**Параметры**: Нет

**Возвращает**: Нет

**Вызывает исключения**:

- `sqlite3.Error`: Если возникает ошибка при выполнении SQL-запроса.

**Как работает функция**:

- Выполняет SQL-запрос для удаления всех записей из таблицы `path_mapping`.
- Если при выполнении SQL-запроса возникает ошибка, она перехватывается, логируется с использованием `logger.error`, и затем вызывается исключение `sqlite3.Error`.

**Примеры**:

```python
encoder_decoder = PathEncoderDecoder()
encoder_decoder.clear_mapping()
```

## Переменные

- `db_name` (str): Имя базы данных SQLite.
- `short_id` (str): Короткий идентификатор, полученный из MD5-хэша.
- `file_path` (str): Полный путь к файлу.
- `conn` (sqlite3.Connection): Объект подключения к базе данных SQLite.
- `cursor` (sqlite3.Cursor): Объект курсора для выполнения SQL-запросов.
- `result` (sqlite3.Row): Результат выполнения SQL-запроса.

## Цепочка взаимосвязей с другими частями проекта

- Модуль `PathEncoderDecoder` использует `src.logger.logger` для логирования, что позволяет интегрировать его в общую систему логирования проекта.
- Он может использоваться другими модулями для кодирования и декодирования путей файлов, например, для хранения или передачи путей в более компактном виде.
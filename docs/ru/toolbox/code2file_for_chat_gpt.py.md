# Модуль `dev_utils.code2file_for_chat_gpt`

## Обзор

Модуль предназначен для рекурсивного чтения и обработки текстовых файлов (в основном Python) в указанном каталоге. Собранное содержимое сохраняется в один или несколько выходных файлов, при этом поддерживается удаление docstrings и ограничение на максимальный размер файла.

## Подробнее

Этот модуль полезен для подготовки данных из исходного кода для обработки большими языковыми моделями, такими как ChatGPT. Он позволяет очищать код от избыточной информации (например, docstrings) и разбивать большие объемы кода на более мелкие части для удобства обработки.

## Классы

В данном модуле классы отсутствуют.

## Функции

### `clean_html`

```python
def clean_html(content: str) -> str:
    """ Удаляет HTML-теги из содержимого.

    Args:
        content (str): HTML-содержимое для очистки.

    Returns:
        str: Содержимое без HTML-тегов.

    Пример:
        >>> clean_html('<p>Hello, World!</p>')
        'Hello, World!'
    """
    ...
```

**Назначение**: Удаление HTML-тегов из входной строки.

**Параметры**:
- `content` (str): Строка, содержащая HTML-контент.

**Возвращает**:
- `str`: Строка без HTML-тегов.

**Как работает функция**:
- Использует библиотеку `BeautifulSoup` для парсинга HTML.
- Извлекает текст из HTML-документа, удаляя все теги.

**Примеры**:
```python
>>> clean_html('<p>Hello, World!</p>')
'Hello, World!'
```

### `remove_docstrings`

```python
def remove_docstrings(content: str) -> str:
    """ Удаляет все блоки с тройными кавычками `"""` и `'''` из текста.

    Args:
        content (str): Текстовое содержимое, из которого нужно удалить блоки с тройными кавычками.

    Returns:
        str: Текст без блоков с тройными кавычками.

    Пример:
        >>> remove_docstrings('\'\'\'def foo():\n    \"\"\"This is a docstring\"\"\"\\n    pass\'\'\')
        'def foo():\\n    pass'
    """
    ...
```

**Назначение**: Удаление docstrings (многострочных комментариев) из текста.

**Параметры**:
- `content` (str): Строка, из которой нужно удалить docstrings.

**Возвращает**:
- `str`: Строка без docstrings.

**Как работает функция**:
- Использует регулярные выражения (`re` модуль) для поиска и удаления блоков, заключенных в тройные кавычки (`"""` и `'''`).

**Примеры**:
```python
>>> remove_docstrings('\'\'\'def foo():\n    \"\"\"This is a docstring\"\"\"\\n    pass\'\'\')
'def foo():\\n    pass'
```

### `delete_directory_contents`

```python
def delete_directory_contents(directory: Path) -> None:
    """ Рекурсивно удаляет все содержимое указанной директории.

    Args:
        directory (Path): Путь к директории, содержимое которой нужно удалить.

    Returns:
        None

    Пример:
        >>> delete_directory_contents(Path('../tmp/chat_gpt/aliexpress'))
    """
    ...
```

**Назначение**: Рекурсивное удаление содержимого директории.

**Параметры**:
- `directory` (Path): Объект `Path`, представляющий директорию для удаления содержимого.

**Возвращает**:
- `None`

**Как работает функция**:
- Рекурсивно перебирает все элементы в указанной директории.
- Если элемент является директорией, вызывает саму себя для удаления содержимого этой директории, а затем пытается удалить саму директорию.
- Если элемент является файлом, пытается удалить его.
- Логгирует каждую операцию удаления с использованием `logger`.
- Обрабатывает исключения `OSError` при удалении файлов и директорий, логируя ошибки.

**Примеры**:
```python
>>> delete_directory_contents(Path('../tmp/chat_gpt/aliexpress'))
```

### `read_text_files`

```python
def read_text_files(
    directory: str, output_file: str, remove_docs: bool = False, max_chars: int = 2000
) -> None:
    """ Читает все указанные Python файлы в каталоге и сохраняет объединенный текст в несколько файлов,
    если размер содержания превышает 2000 символов.

    Args:
        directory (str): Каталог для поиска файлов.
        output_file (str): Базовое имя файла для сохранения объединенного текста.
        remove_docs (bool): Если `True`, удаляет блоки с тройными кавычками из текста. По умолчанию `False`.
        max_chars (int): Максимальное количество символов для каждого файла. По умолчанию 2000.

    Returns:
        None

    Пример:
        >>> read_text_files('src', 'output.txt', remove_docs=True)
    """
    ...
```

**Назначение**: Чтение текстовых файлов из директории и запись их содержимого в один или несколько выходных файлов, с возможностью удаления docstrings и ограничения размера выходных файлов.

**Параметры**:
- `directory` (str): Путь к директории, в которой находятся файлы для чтения.
- `output_file` (str): Путь к выходному файлу, в который будет записано объединенное содержимое. Если содержимое превышает `max_chars`, будут созданы дополнительные файлы с суффиксами.
- `remove_docs` (bool): Флаг, указывающий, нужно ли удалять docstrings из содержимого файлов. По умолчанию `False`.
- `max_chars` (int): Максимальное количество символов в одном выходном файле. Если общее количество символов превышает это значение, содержимое будет разбито на несколько файлов. По умолчанию 2000.

**Как работает функция**:

1.  **Инициализация**:
    *   Определяет пути для выходных файлов и создает директорию для них, если она не существует.
    *   Инициализирует счетчики и переменные для управления созданием нескольких файлов, если это необходимо.
2.  **Обход директории**:
    *   Использует `os.walk` для рекурсивного обхода указанной директории.
    *   Для каждой поддиректории проверяет, не входит ли она в список исключений (`EXCLUDE_DIRS`) или не начинается ли с символа "_". Если условие выполняется, вызывается функция `delete_directory_contents` для удаления содержимого этой директории.
3.  **Обработка файлов**:
    *   Для каждого файла проверяет, является ли он Python-файлом (имеет расширение ".py").
    *   Открывает файл, читает его содержимое и, если указано, удаляет docstrings с помощью функции `remove_docstrings`.
    *   Если файл пустой, выводит предупреждение в лог и переходит к следующему файлу.
    *   Проверяет, не превысит ли добавление содержимого текущего файла лимит `max_chars` для текущего выходного файла. Если превысит, закрывает текущий выходной файл, создает новый и сбрасывает счетчик символов.
    *   Записывает содержимое файла в текущий выходной файл, добавляя разделитель "--- {filename} ---" между файлами.
    *   Обновляет счетчик символов.
    *   Логгирует информацию об обрабатываемых файлах и создании новых выходных файлов.
4.  **Обработка ошибок**:
    *   Обрабатывает исключения `OSError`, `IOError` и `ValueError`, которые могут возникнуть при чтении или записи файлов, и записывает информацию об ошибках в лог.

**Примеры**:

```python
>>> read_text_files('src', 'output.txt', remove_docs=True)
```

В данном примере функция прочитает все Python-файлы из директории `src`, удалит из них docstrings и запишет объединенное содержимое в файл `output.txt`. Если общий размер содержимого превысит 2000 символов, будут созданы дополнительные файлы `output_1.txt`, `output_2.txt` и т.д.

## Переменные модуля

-   `MODE` (str): Указывает режим работы приложения (в данном случае, 'development').
-   `EXCLUDE_DIRS` (list): Список директорий, которые исключаются из обработки (например, "__pycache__", ".git").
-   `EXCLUDE_EXTENSIONS` (list): Список расширений файлов, которые исключаются из обработки (например, ".pyc", ".pyo").

## Запуск модуля

В секции `if __name__ == "__main__":` выполняется следующий код:

1.  Определяются переменные `directory_to_search` и `output_file_path`, которые указывают на директорию с исходным кодом и путь к выходному файлу соответственно.
2.  Создается директория для выходного файла, если она не существует.
3.  Создается пустой выходной файл, если он не существует.
4.  Вызывается функция `read_text_files` с параметрами `directory_to_search`, `output_file_path` и `remove_docs=True` для обработки файлов и записи результатов.
# Модуль для кодирования и декодирования путей файлов с использованием базы данных SQLite
## Обзор

Модуль предоставляет класс `PathEncoderDecoder`, который используется для кодирования и декодирования путей файлов. Кодирование выполняется с использованием хэширования, а соответствия между исходными путями и их короткими идентификаторами хранятся в базе данных SQLite. Это может быть полезно для сокращения длины путей файлов, сохранения их в более компактном виде или для маскировки исходных путей.

## Подробнее

Класс `PathEncoderDecoder` позволяет инициализировать базу данных, сохранять и извлекать пути файлов, кодировать их в короткие идентификаторы и декодировать обратно. Использование базы данных SQLite обеспечивает надежное и постоянное хранение соответствий между путями и идентификаторами.

## Классы

### `PathEncoderDecoder`

**Описание**: Класс для кодирования и декодирования путей с использованием хэширования и хранения данных в SQLite базе данных.

**Атрибуты**:
- `db_path` (str): Путь к SQLite базе данных для хранения таблицы соответствий.

**Методы**:
- `__init__(db_path: str = 'path_mapping.db')`: Инициализация класса.
- `_initialize_database()`: Инициализация базы данных, создание таблицы, если она отсутствует.
- `_save_to_database(short_id: str, file_path: str)`: Сохраняет хэш и путь в базу данных.
- `_fetch_from_database(short_id: str) -> Optional[str]`: Извлекает путь из базы данных по короткому идентификатору.
- `encode(file_path: str) -> str`: Кодирует путь в короткий идентификатор.
- `decode(short_id: str) -> Optional[str]`: Декодирует короткий идентификатор обратно в путь.
- `clear_mapping()`: Очищает таблицу соответствий.

#### `__init__(db_path: str = 'path_mapping.db')`

**Назначение**: Инициализация класса `PathEncoderDecoder`.

**Параметры**:
- `db_path` (str): Путь к SQLite базе данных для хранения таблицы соответствий. По умолчанию 'path_mapping.db'.

**Как работает функция**:
- Функция инициализирует класс `PathEncoderDecoder`, устанавливая путь к базе данных и вызывая метод `_initialize_database()` для создания таблицы, если она еще не существует.

#### `_initialize_database()`

**Назначение**: Инициализация базы данных, создание таблицы `path_mapping`, если она отсутствует.

**Как работает функция**:
- Функция устанавливает соединение с базой данных SQLite, используя путь, указанный в `self.db_path`.
- Создает таблицу `path_mapping` с двумя столбцами: `id` (TEXT PRIMARY KEY) и `file_path` (TEXT NOT NULL), если она еще не существует.
- Фиксирует изменения и закрывает соединение.

#### `_save_to_database(short_id: str, file_path: str)`

**Назначение**: Сохраняет короткий идентификатор и путь к файлу в базу данных.

**Параметры**:
- `short_id` (str): Уникальный идентификатор пути.
- `file_path` (str): Полный путь к файлу.

**Как работает функция**:
- Функция устанавливает соединение с базой данных SQLite.
- Выполняет SQL-запрос для вставки `short_id` и `file_path` в таблицу `path_mapping`. Если `short_id` уже существует, запись не добавляется благодаря `INSERT OR IGNORE`.
- Фиксирует изменения и закрывает соединение.

#### `_fetch_from_database(short_id: str) -> Optional[str]`

**Назначение**: Извлекает путь к файлу из базы данных по короткому идентификатору.

**Параметры**:
- `short_id` (str): Уникальный идентификатор пути.

**Возвращает**:
- `Optional[str]`: Полный путь файла или `None`, если идентификатор не найден.

**Как работает функция**:
- Функция устанавливает соединение с базой данных SQLite.
- Выполняет SQL-запрос для выбора `file_path` из таблицы `path_mapping` по заданному `short_id`.
- Возвращает путь к файлу, если запись найдена, иначе возвращает `None`.

#### `encode(file_path: str) -> str`

**Назначение**: Кодирует путь к файлу в короткий идентификатор.

**Параметры**:
- `file_path` (str): Полный путь файла.

**Возвращает**:
- `str`: Короткий идентификатор.

**Как работает функция**:
- Функция генерирует MD5 хэш из пути файла, используя кодировку UTF-8, и берет первые 8 символов хэша.
- Формирует короткий идентификатор, добавляя префикс 'id-' к хэшу.
- Сохраняет короткий идентификатор и путь к файлу в базу данных, используя метод `_save_to_database`.
- Возвращает короткий идентификатор.

#### `decode(short_id: str) -> Optional[str]`

**Назначение**: Декодирует короткий идентификатор обратно в путь к файлу.

**Параметры**:
- `short_id` (str): Короткий идентификатор.

**Возвращает**:
- `Optional[str]`: Полный путь файла или `None`, если идентификатор не найден.

**Как работает функция**:
- Функция вызывает метод `_fetch_from_database` для извлечения пути к файлу из базы данных по заданному `short_id`.
- Возвращает путь к файлу, если он найден, иначе возвращает `None`.

#### `clear_mapping()`

**Назначение**: Очищает таблицу соответствий в базе данных.

**Как работает функция**:
- Функция устанавливает соединение с базой данных SQLite.
- Выполняет SQL-запрос для удаления всех записей из таблицы `path_mapping`.
- Фиксирует изменения и закрывает соединение.

## Пример использования

В блоке `if __name__ == '__main__':` показан пример использования класса `PathEncoderDecoder`.

- Создается экземпляр класса `PathEncoderDecoder`.
- Задается исходный путь `original_path`.
- Путь кодируется с использованием метода `encode`.
- Кодированный путь выводится на экран.
- Затем кодированный путь декодируется обратно в исходный путь с использованием метода `decode`.
- Декодированный путь выводится на экран.
- В конце закомментирована строка, которая очищает таблицу соответствий в базе данных.

```python
    encoder_decoder = PathEncoderDecoder()

    # Кодирование пути
    original_path = 'src/same_folder/same_sub_folder/same-file.ext'
    encoded = encoder_decoder.encode(original_path)
    print(f'Кодированный путь: {encoded}')

    # Декодирование пути
    decoded = encoder_decoder.decode(encoded)
    print(f'Декодированный путь: {decoded}')

    # Очистка таблицы соответствий
    # encoder_decoder.clear_mapping()
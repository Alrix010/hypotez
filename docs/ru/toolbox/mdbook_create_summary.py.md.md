# `mdbook_create_summary.py`

## Обзор

Модуль `mdbook_create_summary.py` предназначен для автоматического создания или обновления файла `SUMMARY.md` в проектах, использующих `mdbook` для генерации документации. Он рекурсивно обходит указанную директорию в поисках `.md` файлов и формирует структуру оглавления в файле `SUMMARY.md`, отражающую структуру директорий.

## Подробней

Модуль облегчает поддержку актуального списка глав и разделов в документации `mdbook`, автоматизируя процесс создания и обновления файла `SUMMARY.md` на основе структуры файлов `.md` в указанной директории. Это особенно полезно в больших проектах, где ручное обновление файла `SUMMARY.md` может быть трудоемким и подверженным ошибкам.

## Классы

В данном модуле классы отсутствуют.

## Функции

### `make_summary`

```python
def make_summary(src_dir: Path = src_path, summary_file: Path = summary_path) -> None:
    """ Функция рекурсивно обходит указанную директорию в поисках `.md` файлов и создает на их основе файл `SUMMARY.md`.

    Args:
        src_dir (Path): Путь к директории с исходными `.md` файлами. По умолчанию используется значение `src_path`.
        summary_file (Path): Путь для сохранения файла `SUMMARY.md`. По умолчанию используется значение `summary_path`.

    Returns:
        None: Функция ничего не возвращает.

    Raises:
        FileNotFoundError: Если директория `src_dir` не существует.
        PermissionError: Если нет прав на чтение директории `src_dir` или запись файла `summary_file`.
        OSError: В случае других ошибок файловой системы.
    """
    ...
```

**Назначение**: Функция `make_summary` создает или перезаписывает файл `SUMMARY.md` на основе структуры каталогов и файлов `.md`, найденных в указанной исходной директории.

**Параметры**:
- `src_dir` (Path): Путь к директории, содержащей исходные `.md` файлы. Значение по умолчанию берется из переменной `src_path`.
- `summary_file` (Path): Путь к файлу `SUMMARY.md`, который будет создан или перезаписан. Значение по умолчанию берется из переменной `summary_path`.

**Возвращает**:
- `None`: Функция не возвращает значения.

**Вызывает исключения**:
- `FileNotFoundError`: Если указанная директория `src_dir` не существует.
- `PermissionError`: Если у пользователя нет прав на чтение директории `src_dir` или на запись файла `summary_file`.
- `OSError`: В случае возникновения других ошибок при работе с файловой системой.

**Как работает функция**:

1.  **Проверяет наличие файла `SUMMARY.md`**: Если файл существует, он будет перезаписан. Если файла не существует, он будет создан.
2.  **Открывает файл `SUMMARY.md` для записи**: Файл открывается в режиме записи с кодировкой UTF-8.
3.  **Записывает заголовок "# Summary"**: В начало файла записывается заголовок, указывающий на то, что это файл оглавления.
4.  **Рекурсивно обходит директорию `src_dir`**: Функция `_process_directory` вызывается для рекурсивного обхода директории `src_dir` и обработки каждого найденного `.md` файла.

    ### `_process_directory`

    ```python
    def _process_directory(dir_path: Path, summary_file, indent_level: int = 0):
        """ Рекурсивно обрабатывает директорию, добавляя ссылки на .md файлы в файл SUMMARY.md.
        Args:
            dir_path (Path): Путь к текущей обрабатываемой директории.
            summary_file: Открытый файл SUMMARY.md для записи.
            indent_level (int): Уровень вложенности для формирования отступов в SUMMARY.md.
        Returns:
            None
        Raises:
            OSError: При ошибках доступа к файлам или директориям.
        """
        ...
    ```

    **Назначение**: Рекурсивная функция для обхода директорий и добавления информации о `.md` файлах в файл `SUMMARY.md`.

    **Параметры**:
    - `dir_path` (Path): Путь к текущей обрабатываемой директории.
    - `summary_file`: Открытый файл `SUMMARY.md` для записи.
    - `indent_level` (int): Уровень вложенности для формирования отступов в `SUMMARY.md`.

    **Возвращает**:
    - `None`: Функция ничего не возвращает.

    **Вызывает исключения**:
    - `OSError`: В случае ошибок доступа к файлам или директориям.

    **Как работает функция**:

    1.  **Получает список файлов и поддиректорий**: Использует `os.listdir` для получения списка содержимого текущей директории.
    2.  **Фильтрует `.md` файлы**: Итерируется по содержимому директории, проверяя, является ли элемент файлом с расширением `.md`.
    3.  **Исключает `SUMMARY.md`**: Пропускает файл `SUMMARY.md`, чтобы избежать рекурсивной ссылки на сам себя.
    4.  **Формирует относительный путь и название главы**: Для каждого `.md` файла формируется относительный путь относительно `src_dir` и название главы на основе имени файла.
    5.  **Определяет уровень вложенности**: Уровень вложенности определяется количеством поддиректорий в относительном пути.
    6.  **Записывает главу в файл `SUMMARY.md` с учетом отступов**: В файл `SUMMARY.md` записывается строка, содержащая отступы (в зависимости от уровня вложенности), название главы и ссылку на файл.
    7.  **Рекурсивно вызывает себя для поддиректорий**: Для каждой поддиректории вызывается функция `_process_directory` для обработки ее содержимого.

5.  **Выводит сообщение об успешном создании/перезаписи файла**: После завершения обхода всех файлов и директорий выводится сообщение об успешном создании или перезаписи файла `SUMMARY.md`.

**Примеры**:

Создание файла `SUMMARY.md` в указанной директории:

```python
from pathlib import Path
from src import gs  # Предполагается, что gs инициализирован где-то еще

# Пример пути (предполагается, что gs.path.root определен)
example_src_path = Path(gs.path.root / 'docs' / 'example')
example_summary_file = example_src_path / 'SUMMARY.md'

# Создаем директорию и несколько файлов для примера
example_src_path.mkdir(parents=True, exist_ok=True)
(example_src_path / 'file1.md').write_text('# File 1')
(example_src_path / 'subdir').mkdir(exist_ok=True)
(example_src_path / 'subdir' / 'file2.md').write_text('# File 2')

# Вызываем функцию для создания SUMMARY.md
make_summary(example_src_path, example_summary_file)

# Теперь в example_summary_file будет сгенерированный SUMMARY.md
```

После выполнения этого примера в `example_summary_file` будет создан файл со следующим содержимым:

```
# Summary

- [File1](file1.md)
- [File2](subdir/file2.md)
```

## Параметры

- `src_path` (Path): Объект `Path`, представляющий путь к директории, содержащей исходные `.md` файлы. Этот путь формируется на основе корневого пути, полученного из `gs.path.root`, и константных составляющих (`'docs'`, `'gemini'`, `'consultant'`, `'ru'`, `'src'`).
- `summary_path` (Path): Объект `Path`, представляющий путь к файлу `SUMMARY.md`, который будет создан или перезаписан. Он формируется путем добавления имени файла `SUMMARY.md` к `src_path`.

```python
src_path: Path = Path(gs.path.root / 'docs' / 'gemini' / 'consultant' / 'ru' / 'src')
summary_path: Path = Path(src_path / 'SUMMARY.md')
```
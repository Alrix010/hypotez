# Модуль для работы с HTML
## Обзор

Модуль `src.utils.convertors.html` предоставляет утилиты для преобразования HTML. Он содержит функции для преобразования HTML в escape-последовательности, escape-последовательностей в HTML, HTML в словари и HTML в объекты SimpleNamespace. Также включает функции для конвертации HTML в PDF и DOCX форматы.

## Подробнее

Этот модуль предоставляет набор инструментов для работы с HTML, включая преобразование в различные форматы и структуры данных. Он использует сторонние библиотеки, такие как `xhtml2pdf` и `weasyprint`, для генерации PDF-файлов из HTML, а также `LibreOffice` для конвертации в DOCX.

## Классы

### `HTMLToDictParser`

**Описание**:
Внутренний класс, используемый функцией `html2dict` для парсинга HTML и извлечения данных в словарь.

**Наследует**:
`html.parser.HTMLParser`

**Методы**:
- `__init__(self)`: Инициализирует экземпляр класса, подготавливает хранилище для результатов парсинга.
- `handle_starttag(self, tag, attrs)`: Обрабатывает открытие HTML-тега, сохраняя текущий тег.
- `handle_endtag(self, tag)`: Обрабатывает закрытие HTML-тега, сбрасывая текущий тег.
- `handle_data(self, data)`: Обрабатывает текстовые данные внутри HTML-тегов, добавляя их в словарь результатов.

## Функции

### `html2escape`

**Назначение**: Преобразует HTML в escape-последовательности.

**Параметры**:
- `input_str` (str): HTML-код для преобразования.

**Возвращает**:
- `str`: HTML, преобразованный в escape-последовательности.

**Как работает функция**:
Функция вызывает метод `StringFormatter.escape_html_tags` для преобразования HTML-кода в escape-последовательности.

**Примеры**:

```python
html = "<p>Hello, world!</p>"
result = html2escape(html)
print(result)
# Вывод: &lt;p&gt;Hello, world!&lt;/p&gt;
```

### `escape2html`

**Назначение**: Преобразует escape-последовательности в HTML.

**Параметры**:
- `input_str` (str): Строка с escape-последовательностями.

**Возвращает**:
- `str`: Escape-последовательности, преобразованные в HTML.

**Как работает функция**:
Функция вызывает метод `StringFormatter.unescape_html_tags` для преобразования escape-последовательностей обратно в HTML.

**Примеры**:

```python
escaped = "&lt;p&gt;Hello, world!&lt;/p&gt;"
result = escape2html(escaped)
print(result)
# Вывод: <p>Hello, world!</p>
```

### `html2dict`

**Назначение**: Преобразует HTML в словарь, где теги являются ключами, а содержимое - значениями.

**Параметры**:
- `html_str` (str): HTML-строка для преобразования.

**Возвращает**:
- `dict`: Словарь с HTML-тегами в качестве ключей и их содержимым в качестве значений.

**Внутренние функции**:
- `HTMLToDictParser`:
    - **Назначение**: Внутренний класс, используемый для парсинга HTML и извлечения данных в словарь.
    - **Методы**:
        - `__init__(self)`: Инициализирует экземпляр класса, подготавливает хранилище для результатов парсинга.
        - `handle_starttag(self, tag, attrs)`: Обрабатывает открытие HTML-тега, сохраняя текущий тег.
        - `handle_endtag(self, tag)`: Обрабатывает закрытие HTML-тега, сбрасывая текущий тег.
        - `handle_data(self, data)`: Обрабатывает текстовые данные внутри HTML-тегов, добавляя их в словарь результатов.

**Как работает функция**:
Функция использует класс `HTMLToDictParser` для парсинга HTML-строки и извлечения тегов и их содержимого. Результаты сохраняются в словарь, который возвращается функцией.

**Примеры**:

```python
html = "<p>Hello</p><a href='link'>World</a>"
result = html2dict(html)
print(result)
# Вывод: {'p': 'Hello', 'a': 'World'}
```

### `html2ns`

**Назначение**: Преобразует HTML в объект `SimpleNamespace`, где теги являются атрибутами, а содержимое - значениями.

**Параметры**:
- `html_str` (str): HTML-строка для преобразования.

**Возвращает**:
- `SimpleNamespace`: Объект `SimpleNamespace` с HTML-тегами в качестве атрибутов и их содержимым в качестве значений.

**Как работает функция**:
Функция вызывает функцию `html2dict` для преобразования HTML в словарь, а затем создает объект `SimpleNamespace` на основе этого словаря.

**Примеры**:

```python
html = "<p>Hello</p><a href='link'>World</a>"
result = html2ns(html)
print(result.p)
# Вывод: Hello
print(result.a)
# Вывод: World
```

### `html2pdf`

**Назначение**: Преобразует HTML-контент в PDF-файл, используя библиотеку `WeasyPrint`.

**Параметры**:
- `html_str` (str): HTML-контент в виде строки.
- `pdf_file` (str | Path): Путь к выходному PDF-файлу.

**Возвращает**:
- `bool | None`: Возвращает `True`, если генерация PDF прошла успешно, `None` в случае ошибки.

**Как работает функция**:
Функция использует библиотеку `WeasyPrint` для преобразования HTML-строки в PDF-файл. В случае возникновения ошибки логирует её и возвращает `None`.

**Примеры**:

```python
html = "<p>Hello, world!</p>"
result = html2pdf(html, "output.pdf")
if result:
    print("PDF created successfully")
```

### `html_to_docx`

**Назначение**: Преобразует HTML-файл в Word-документ, используя LibreOffice.

**Параметры**:
- `html_file` (str): Путь к входному HTML-файлу в виде строки.
- `output_docx` (Path | str): Путь к выходному DOCX-файлу.

**Возвращает**:
- `bool`: `True`, если преобразование прошло успешно, `False` в противном случае.

**Как работает функция**:
Функция использует `subprocess` для выполнения команды LibreOffice в headless-режиме, преобразуя HTML-файл в DOCX-файл. Проверяет наличие ошибок в процессе конвертации и возвращает соответствующий результат.

**Вызывает исключения**:
- `subprocess.CalledProcessError`: Если LibreOffice не смог преобразовать HTML-файл.
- `FileNotFoundError`: Если исполняемый файл LibreOffice (soffice) не найден.
- `Exception`: При возникновении неожиданной ошибки во время конвертации.

**Примеры**:

```python
html_file = "input.html"
output_docx = "output.docx"
result = html_to_docx(html_file, output_docx)
if result:
    print("DOCX created successfully")
```
# Модуль для работы с SMTP

## Обзор

Модуль `smtp.py` предоставляет интерфейс для отправки и получения электронных писем с использованием протоколов SMTP и IMAP. Он включает функции для отправки электронных писем через SMTP-сервер и получения электронных писем через IMAP-сервер.

## Подробнее

Модуль содержит функции для отправки и получения электронных писем, а также настройки подключения к серверам SMTP и IMAP. Важно отметить, что учетные данные для подключения не должны быть жестко закодированы в файле, а должны передаваться через переменные окружения для повышения безопасности.

## Классы

В данном модуле классы отсутствуют.

## Функции

### `send`

```python
def send(subject: str = '', body: str = '', to: str = 'one.last.bit@gmail.com') -> bool:
    """Отправляет электронное письмо. Возвращает `True` в случае успеха, `False` в противном случае. Логирует ошибки."""
```

**Назначение**:
Функция `send` отправляет электронное письмо с заданными темой, телом и получателем.

**Параметры**:
- `subject` (str, optional): Тема электронного письма. По умолчанию ''.
- `body` (str, optional): Тело электронного письма. По умолчанию ''.
- `to` (str, optional): Адрес электронной почты получателя. По умолчанию 'one.last.bit@gmail.com'.

**Возвращает**:
- `bool`: `True`, если отправка письма прошла успешно, `False` в противном случае.

**Вызывает исключения**:
- `smtplib.SMTPException`: Возникает при ошибках, связанных с SMTP-сервером, включая ошибки подключения, аутентификации и отправки.

**Как работает функция**:
1. Функция создает SMTP-соединение с использованием параметров из словаря `_connection`.
2. Выполняет рукопожатие с сервером (`smtp.ehlo()`) и включает шифрование TLS (`smtp.starttls()`).
3. Выполняет вход в учетную запись, используя имя пользователя и пароль из `_connection`.
4. Создает объект `MIMEText` с телом письма, устанавливает тему, отправителя и получателя.
5. Отправляет письмо и закрывает SMTP-соединение.
6. В случае возникновения ошибки логирует ее и возвращает `False`.

**Примеры**:

```python
from src.utils.smtp import send

# Отправка простого письма
result = send(subject='Привет', body='Это тестовое письмо.', to='user@example.com')
print(f'Результат отправки: {result}')

# Отправка письма с использованием параметров по умолчанию
result = send()
print(f'Результат отправки: {result}')
```

### `receive`

```python
def receive(imap_server: str, user: str, password: str, folder: str = 'inbox') -> Optional[List[Dict[str, str]]]:
    """Извлекает электронные письма. Возвращает список словарей с данными писем в случае успеха, `None` в противном случае. Логирует ошибки."""
```

**Назначение**:
Функция `receive` извлекает электронные письма из указанного почтового ящика на IMAP-сервере.

**Параметры**:
- `imap_server` (str): Адрес IMAP-сервера.
- `user` (str): Имя пользователя для входа в почтовый ящик.
- `password` (str): Пароль для входа в почтовый ящик.
- `folder` (str, optional): Название папки для извлечения писем. По умолчанию 'inbox'.

**Возвращает**:
- `Optional[List[Dict[str, str]]]`: Список словарей, где каждый словарь содержит информацию об одном письме (тема, отправитель, тело). Возвращает `None` в случае ошибки.

**Вызывает исключения**:
- `imaplib.IMAP4.error`: Возникает при ошибках, связанных с IMAP-сервером, включая ошибки подключения, аутентификации и поиска писем.

**Как работает функция**:
1. Функция устанавливает SSL-соединение с IMAP-сервером.
2. Выполняет вход в почтовый ящик, используя имя пользователя и пароль.
3. Выбирает указанную папку (по умолчанию 'inbox').
4. Выполняет поиск всех писем в выбранной папке.
5. Для каждого найденного письма извлекает его содержимое (тему, отправителя, тело).
6. Добавляет информацию о письме в список `emails`.
7. Закрывает соединение с почтовым ящиком и выходит из учетной записи.
8. Возвращает список словарей с данными писем.
9. В случае возникновения ошибки логирует ее и возвращает `None`.

**Примеры**:

```python
from src.utils.smtp import receive

# Получение писем из почтового ящика
emails = receive(imap_server='imap.example.com', user='user@example.com', password='password', folder='INBOX')
if emails:
    for email in emails:
        print(f'Тема: {email["subject"]}')
        print(f'Отправитель: {email["from"]}')
        print(f'Тело: {email["body"][:100]}...')  # Выводим только первые 100 символов тела письма
else:
    print('Не удалось получить письма.')
```
```python
from src.utils.smtp import receive

# Пример получения почты с некорректными параметрами
emails = receive(imap_server='imap.example.com', user='user@example.com', password='wrong_password', folder='INBOX')

if emails is None:
    print("Не удалось получить письма. Проверьте параметры подключения и учетные данные.")
```
```
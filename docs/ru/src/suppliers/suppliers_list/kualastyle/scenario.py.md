# Модуль `scenario.py` для сбора товаров с Kualastyle

## Обзор

Модуль предназначен для сбора информации о товарах с сайта поставщика Kualastyle через веб-драйвер. Он выполняет следующие задачи:

- Сбор списка категорий товаров с сайта.
- Сбор списка товаров в каждой категории.
- Передача URL страниц товаров в функцию `grab_product_page()` для обработки информации о товарах и передачи её классу `Product`.

## Подробней

Этот модуль является частью системы сбора данных о товарах от различных поставщиков. Каждый поставщик имеет свой уникальный сценарий, и этот модуль реализует сценарий для Kualastyle.

**Основные функции модуля:**

1.  **`get_list_categories_from_site()`**: Собирает список категорий товаров с сайта поставщика.
2.  **`get_list_products_in_category()`**: Собирает список товаров в указанной категории.
3.  **`paginator()`**: Осуществляет навигацию по страницам категорий.

## Функции

### `get_list_products_in_category`

```python
def get_list_products_in_category (s: Supplier) -> list[str, str, None]:
    """ Функция извлекает список URL товаров со страницы категории
    Если надо пролистстать страницы категорий - листает

    Args:
        s (Supplier): Объект поставщика (Supplier).

    Returns:
        list[str, str, None]: Список URL товаров или None.
    """
```

**Назначение**:
Функция `get_list_products_in_category` предназначена для извлечения списка URL товаров со страницы категории. Если требуется, осуществляет пролистывание страниц категорий.

**Параметры**:

*   `s` (Supplier): Объект поставщика, содержащий информацию о текущем поставщике, включая драйвер и локаторы.

**Возвращает**:

*   `list[str, str, None]`: Список URL товаров, найденных на странице категории. Возвращает `None`, если список товаров не найден.

**Как работает функция**:

1.  Извлекает драйвер (`d`) и локаторы (`l`) из объекта поставщика `s`.
2.  Ожидает 1 секунду, чтобы страница успела загрузиться.
3.  Выполняет закрытие всплывающего баннера, используя локатор `'close_banner'` из `s.locators['product']`.
4.  Прокручивает страницу вниз для загрузки динамического контента.
5.  Извлекает список ссылок на товары (`list_products_in_category`), используя локатор `'product_links'` из `l`.
6.  Проверяет, найдены ли ссылки на товары. Если нет, записывает предупреждение в лог и возвращает `None`.
7.  Организует пагинацию по страницам категории, пока текущий URL не станет равен предыдущему, с использованием функции `paginator`.
8.  Добавляет новые ссылки на товары в `list_products_in_category` при каждой итерации пагинации.
9.  Преобразует `list_products_in_category` в список, если это строка.
10. Записывает отладочное сообщение в лог с количеством найденных товаров в категории.
11. Возвращает список URL товаров.

```python
    d:Driver = s.driver
    l: dict = s.locators['category']
```

`d`: Инстанс драйвера, используемый для управления браузером и взаимодействия с веб-страницей.
`l`:  Словарь локаторов элементов веб-страницы, специфичных для текущей категории.

```python
    d.execute_locator (s.locators ['product']['close_banner'] )
```
Выполняет действие (например, клик) на элементе, определённом локатором `close_banner`. Это может использоваться для закрытия всплывающих окон или баннеров, которые мешают сбору данных.

```python
    list_products_in_category: List = d.execute_locator(l['product_links'])
```
Извлекает список веб-элементов, соответствующих локатору `product_links`, который должен указывать на ссылки товаров на странице категории.

```python
    while d.current_url != d.previous_url:
        if paginator(d,l,list_products_in_category):
            list_products_in_category.append(d.execute_locator(l['product_links']))
        else:
            break
```
Осуществляет пагинацию по страницам категории до тех пор, пока текущий URL страницы не изменится. На каждой итерации вызывает функцию `paginator` для перехода на следующую страницу и добавляет новые ссылки на товары в список.

**Примеры**:

```python
# Пример вызова функции
supplier = Supplier(...)  # Инициализация объекта Supplier
list_of_products = get_list_products_in_category(supplier)
if list_of_products:
    for product_url in list_of_products:
        print(product_url)
```

### `paginator`

```python
def paginator(d:Driver, locator: dict, list_products_in_category: list):
    """ Листалка """
```

**Назначение**:
Функция `paginator` предназначена для навигации по страницам категорий с использованием драйвера и локаторов.

**Параметры**:

*   `d` (Driver): Объект драйвера, используемый для управления браузером.
*   `locator` (dict): Словарь локаторов элементов веб-страницы, специфичных для пагинации.
*   `list_products_in_category` (list): Список ссылок на товары в текущей категории.

**Возвращает**:

*   `True`: Если пагинация прошла успешно.
*   `None`: Если пагинация не удалась.

**Как работает функция**:

1.  Выполняет клик на элементе, соответствующем локатору `'<-'` в разделе `'pagination'` словаря `locator`.
2.  Проверяет, был ли получен ответ от клика и не является ли он пустым списком. Если ответ отсутствует или является пустым списком, возвращает `None`.
3.  Если клик выполнен успешно, возвращает `True`.

```python
    response = d.execute_locator(locator['pagination']['<-'])
```

Выполняет клик на элементе, который соответствует кнопке "назад" или "предыдущая страница" в пагинации. Локатор `'pagination']['<-'` указывает на этот элемент.

```python
   if not response or (isinstance(response, list) and len(response) == 0): 
        ...
        return
```
Проверяет, был ли получен какой-либо ответ после попытки клика на кнопку пагинации. Если ответ отсутствует или является пустым списком, это означает, что переход на следующую страницу не удался, и функция возвращает `None`.

**Примеры**:

```python
# Пример вызова функции
driver = Driver(...)  # Инициализация объекта Driver
locator = {...}  # Словарь с локаторами
products = ['товар1', 'товар2']
if paginator(driver, locator, products):
    print('Пагинация выполнена успешно')
else:
    print('Пагинация не удалась')
```

### `get_list_categories_from_site`

```python
def get_list_categories_from_site(s):
    """ сборщик актуальных категорий с сайта """
```

**Назначение**:
Функция `get_list_categories_from_site` предназначена для сбора актуальных категорий с сайта.

**Параметры**:

*   `s`: Объект поставщика, содержащий информацию о текущем поставщике.

**Как работает функция**:

*   Функция выполняет сбор актуальных категорий с сайта, используя объект поставщика `s`. (Более подробное описание отсутствует в предоставленном коде).

**Примеры**:

```python
# Пример вызова функции
supplier = Supplier(...)  # Инициализация объекта Supplier
get_list_categories_from_site(supplier)
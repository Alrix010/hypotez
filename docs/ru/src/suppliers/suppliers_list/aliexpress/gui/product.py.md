# Модуль `product.py`

## Обзор

Модуль `product.py` предоставляет графический интерфейс для редактирования информации о товарах, полученных с AliExpress. Он включает в себя функциональность для открытия файлов JSON с данными о товарах, отображения этих данных в удобном для пользователя виде и подготовки товаров к дальнейшей обработке с использованием функциональности `AliCampaignEditor`.

## Подробнее

Модуль создает виджет `ProductEditor`, который позволяет пользователю загружать данные о товаре из JSON-файла, отображать основные детали товара, такие как заголовок и описание, и запускать процесс подготовки товара с использованием `AliCampaignEditor`. `ProductEditor` использует библиотеку PyQt6 для создания графического интерфейса и асинхронные слоты для неблокирующей подготовки товара.

## Классы

### `ProductEditor`

**Описание**: Класс `ProductEditor` представляет собой виджет для редактирования информации о товарах.

**Наследует**: `QtWidgets.QWidget`

**Атрибуты**:

- `data` (SimpleNamespace): Пространство имен для хранения данных о товаре.
- `language` (str): Язык интерфейса (по умолчанию "EN").
- `currency` (str): Валюта (по умолчанию "USD").
- `file_path` (str): Путь к файлу с данными о товаре.
- `editor` (AliCampaignEditor): Экземпляр редактора кампаний AliCampaignEditor.
- `main_app` (MainApp): Ссылка на экземпляр главного приложения.
- `open_button` (QtWidgets.QPushButton): Кнопка для открытия файла JSON.
- `file_name_label` (QtWidgets.QLabel): Метка для отображения имени выбранного файла.
- `prepare_button` (QtWidgets.QPushButton): Кнопка для запуска процесса подготовки товара.

**Принцип работы**:

1.  При инициализации создается и настраивается пользовательский интерфейс (кнопки, метки и т. д.).
2.  Пользователь может открыть файл JSON с данными о товаре.
3.  После загрузки файла отображаются основные детали товара (заголовок, описание).
4.  Пользователь может запустить процесс подготовки товара, который выполняется асинхронно.

**Методы**:

- `__init__(self, parent=None, main_app=None)`: Инициализирует виджет `ProductEditor`.
- `setup_ui(self)`: Создает и настраивает пользовательский интерфейс.
- `setup_connections(self)`: Устанавливает соединения между сигналами и слотами.
- `open_file(self)`: Открывает диалоговое окно для выбора JSON-файла и загружает его.
- `load_file(self, file_path)`: Загружает JSON-файл и отображает данные о товаре.
- `create_widgets(self, data)`: Создает виджеты для отображения данных о товаре.
- `prepare_product_async(self)`: Асинхронно подготавливает товар.

## Методы класса

### `__init__`

```python
def __init__(self, parent=None, main_app=None):
    """ Initialize the ProductEditor widget """
```

**Назначение**: Инициализация виджета `ProductEditor`.

**Параметры**:

- `parent` (QtWidgets.QWidget, optional): Родительский виджет. По умолчанию `None`.
- `main_app` (MainApp, optional): Экземпляр главного приложения. По умолчанию `None`.

**Как работает функция**:

Вызывает конструктор родительского класса `QtWidgets.QWidget`, сохраняет ссылку на экземпляр главного приложения и вызывает методы `setup_ui` и `setup_connections` для настройки интерфейса и соединений.

### `setup_ui`

```python
def setup_ui(self):
    """ Setup the user interface """
```

**Назначение**: Настройка пользовательского интерфейса.

**Как работает функция**:

Устанавливает заголовок окна, определяет размеры окна, создает и добавляет кнопки "Open JSON File" и "Prepare Product", а также метку для отображения имени выбранного файла. Кнопка "Open JSON File" соединена со слотом `open_file`, кнопка "Prepare Product" соединена со слотом `prepare_product_async`. Размещает созданные элементы управления в вертикальном макете.

### `setup_connections`

```python
def setup_connections(self):
    """ Setup signal-slot connections """
```

**Назначение**: Установка соединений между сигналами и слотами.

**Как работает функция**:

В текущей реализации функция пуста и не выполняет никаких действий. Предполагается, что в будущем здесь будут устанавливаться дополнительные соединения между сигналами и слотами виджета.

### `open_file`

```python
def open_file(self):
    """ Open a file dialog to select and load a JSON file """
```

**Назначение**: Открытие диалогового окна для выбора JSON-файла и его последующая загрузка.

**Как работает функция**:

Открывает диалоговое окно выбора файла, фильтруя файлы JSON. Если файл выбран, вызывает метод `load_file` для загрузки содержимого файла.

### `load_file`

```python
def load_file(self, file_path):
    """ Load a JSON file """
```

**Назначение**: Загрузка JSON-файла.

**Параметры**:

- `file_path` (str): Путь к JSON-файлу.

**Как работает функция**:

Загружает JSON-файл, используя `j_loads_ns` из модуля `src.utils.jjson`, сохраняет путь к файлу и создает экземпляр `AliCampaignEditor`. В случае ошибки отображает критическое сообщение об ошибке.

### `create_widgets`

```python
def create_widgets(self, data):
    """ Create widgets based on the data loaded from the JSON file """
```

**Назначение**: Создание виджетов на основе данных, загруженных из JSON-файла.

**Параметры**:

- `data` (SimpleNamespace): Данные о товаре.

**Как работает функция**:

Удаляет все предыдущие виджеты (кроме кнопок "Open JSON File", "Prepare Product" и метки имени файла), создает метку с заголовком товара и метку с деталями товара, добавляет их в макет.

### `prepare_product_async`

```python
@asyncSlot()
async def prepare_product_async(self):
    """ Asynchronously prepare the product """
```

**Назначение**: Асинхронная подготовка товара.

**Как работает функция**:

Вызывает метод `prepare_product` экземпляра `AliCampaignEditor` для асинхронной подготовки товара. В случае успеха отображает информационное сообщение, в случае ошибки - критическое сообщение об ошибке.

## Параметры класса

- `data`: Пространство имен для хранения данных о товаре.
- `language`: Язык интерфейса (по умолчанию "EN").
- `currency`: Валюта (по умолчанию "USD").
- `file_path`: Путь к файлу с данными о товаре.
- `editor`: Экземпляр редактора кампаний `AliCampaignEditor`.

## Примеры

Пример создания экземпляра класса `ProductEditor`:

```python
from PyQt6 import QtWidgets
from src.suppliers.suppliers_list.aliexpress.gui.product import ProductEditor

app = QtWidgets.QApplication([])
product_editor = ProductEditor()
product_editor.show()
app.exec()
# Модуль: Сокращение партнерских ссылок AliExpress через веб-браузер

## Обзор

Этот модуль предназначен для автоматического сокращения партнерских ссылок AliExpress с использованием веб-браузера. Он предоставляет функцию для генерации коротких ссылок, которые можно использовать для продвижения товаров.

## Подробнее

Модуль использует веб-драйвер для взаимодействия с сайтом AliExpress и выполнения действий, необходимых для получения сокращенной партнерской ссылки. Он загружает локаторы элементов веб-страницы из JSON-файла и использует их для автоматизации процесса.

## Классы

В данном модуле классы отсутствуют.

## Функции

### `get_short_affiliate_link`

```python
def get_short_affiliate_link(d: Driver, url: str) -> str:
    """
    Функция генерирует сокращенную партнерскую ссылку на основе предоставленного URL.

    Args:
        d (Driver): Экземпляр веб-драйвера для управления браузером.
        url (str): Полный URL, который необходимо сократить.

    Returns:
        str: Сокращенный URL.

    Raises:
        ValueError: Если не удалось получить короткий URL или если короткий URL ведет на страницу ошибки.

    
    1. Вводит предоставленный URL в текстовое поле на странице.
    2. Нажимает кнопку для получения сокращенной ссылки.
    3. Ожидает обновления страницы.
    4. Извлекает сокращенную ссылку из соответствующего элемента на странице.
    5. Открывает новую вкладку с сокращенной ссылкой.
    6. Проверяет, не ведет ли короткая ссылка на страницу ошибки.
    7. Закрывает новую вкладку и переключается обратно на основную вкладку.
    8. Возвращает сокращенную ссылку.

    Внутренние функции:
        Отсутствуют.

    Примеры:
        >>> from src.webdriver.driver import Driver
        >>> from src.webdriver.chrome import Chrome
        >>> driver = Driver(Chrome)
        >>> url = "https://aliexpress.com/item/1234567890.html"
        >>> short_url = get_short_affiliate_link(driver, url)
        >>> print(short_url)
        "https://s.click.aliexpress.com/e/_DeFghij"
    """
```

**Параметры**:

-   `d` (Driver): Экземпляр веб-драйвера. Используется для управления браузером и взаимодействия с веб-страницами.
-   `url` (str): Полный URL, который требуется сократить.

**Возвращает**:

-   `str`: Сокращенный URL.

**Вызывает исключения**:

-   `ValueError`: Возникает, если не удалось получить короткий URL или если короткий URL ведет на страницу ошибки. В этом случае, также логируется ошибка с помощью `logger.error`.

**Принцип работы**:

1.  **Ввод URL**: Вводит предоставленный URL в поле ввода, используя локатор `locator.textarea_target_url`.
2.  **Нажатие кнопки**: Нажимает кнопку для получения короткой ссылки, используя локатор `locator.button_get_tracking_link`.
3.  **Ожидание**: Ожидает 1 секунду, чтобы страница обновилась.
4.  **Извлечение короткой ссылки**: Извлекает сокращенную ссылку из элемента на странице, используя локатор `locator.textarea_short_link`.
5.  **Сохранение идентификатора основной вкладки**: Сохраняет идентификатор основной вкладки в переменной `main_tab`.
6.  **Проверка длины короткой ссылки**: Проверяет, что длина полученной короткой ссылки больше 0.
7.  **Открытие новой вкладки**: Открывает новую вкладку с сокращенной ссылкой с помощью JavaScript.
8.  **Переключение на новую вкладку**: Переключается на новую вкладку, используя `d.switch_to.window(d.window_handles[-1])`.
9.  **Проверка URL на ошибки**: Проверяет, начинается ли текущий URL с `https://error.taobao.com`. Если да, то логирует ошибку, закрывает вкладку и переключается обратно на основную вкладку.
10. **Закрытие новой вкладки**: Закрывает новую вкладку и переключается обратно на основную вкладку.
11. **Возврат короткой ссылки**: Возвращает сокращенную ссылку.

**Примеры**:

```python
from src.webdriver.driver import Driver
from src.webdriver.chrome import Chrome

# Создание инстанса драйвера (пример с Chrome)
driver = Driver(Chrome)
url = "https://aliexpress.com/item/1234567890.html"
short_url = get_short_affiliate_link(driver, url)
print(short_url)
# Вывод: "https://s.click.aliexpress.com/e/_DeFghij"
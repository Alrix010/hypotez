# Модуль `main.py`

## Обзор

Модуль `main.py` предоставляет главный интерфейс приложения для управления рекламными кампаниями AliExpress. Он включает в себя функциональность для редактирования JSON, управления кампаниями, редактирования продуктов и категорий. Модуль использует библиотеку PyQt6 для создания графического интерфейса и qasync для асинхронных операций.

## Подробней

Этот модуль является отправной точкой для запуска графического интерфейса приложения. Он создает главное окно с вкладками для различных функций, таких как редактирование JSON-файлов, управление кампаниями, редактирование информации о продуктах и категориях. Модуль также включает в себя меню с опциями для работы с файлами и редактирования.

## Классы

### `MainApp`

**Описание**: Главный класс приложения, наследующийся от `QtWidgets.QMainWindow`. Отвечает за создание и управление главным окном приложения с вкладками.

**Наследует**: `QtWidgets.QMainWindow`

**Атрибуты**:
- `tab_widget` (QtWidgets.QTabWidget): Виджет для отображения вкладок.
- `tab1` (QtWidgets.QWidget): Виджет для первой вкладки (JSON Editor).
- `promotion_app` (CampaignEditor): Экземпляр класса `CampaignEditor` для управления JSON.
- `tab2` (QtWidgets.QWidget): Виджет для второй вкладки (Campaign Editor).
- `campaign_editor_app` (CategoryEditor): Экземпляр класса `CategoryEditor` для редактирования категорий кампаний.
- `tab3` (QtWidgets.QWidget): Виджет для третьей вкладки (Product Editor).
- `product_editor_app` (ProductEditor): Экземпляр класса `ProductEditor` для редактирования продуктов.

**Методы**:
- `__init__(self)`: Инициализирует главное окно приложения, создает вкладки и добавляет их в виджет вкладок.
- `create_menubar(self)`: Создает меню с опциями для работы с файлами и редактирования.
- `open_file(self)`: Открывает диалоговое окно для выбора и загрузки JSON-файла.
- `save_file(self)`: Сохраняет текущий файл.
- `exit_application(self)`: Закрывает приложение.
- `copy(self)`: Копирует выбранный текст в буфер обмена.
- `paste(self)`: Вставляет текст из буфера обмена.
- `load_file(self, campaign_file)`: Загружает JSON-файл.

**Принцип работы**:
Класс `MainApp` создает главное окно приложения с использованием PyQt6. Он инициализирует виджет вкладок и добавляет три вкладки: "JSON Editor", "Campaign Editor" и "Product Editor". Для каждой вкладки создается соответствующий виджет редактора (например, `CampaignEditor`, `CategoryEditor` и `ProductEditor`). Также класс создает меню с опциями для работы с файлами (открытие, сохранение, выход) и редактирования (копирование, вставка).

### Методы класса

#### `__init__`

```python
def __init__(self):
    """
    Инициализирует главное окно приложения с вкладками.
    """
    ...
```

**Назначение**: Инициализирует главное окно приложения, устанавливает заголовок окна, размеры и создает виджеты вкладок.

#### `create_menubar`

```python
def create_menubar(self):
    """
    Создает меню с опциями для работы с файлами и редактирования.
    """
    ...
```

**Назначение**: Создает меню с опциями "File" (Open, Save, Exit) и "Edit" (Copy, Paste).

#### `open_file`

```python
def open_file(self):
    """
    Открывает диалоговое окно для выбора и загрузки JSON-файла.
    """
    ...
```

**Назначение**: Открывает диалоговое окно выбора файла, позволяя пользователю выбрать JSON-файл для загрузки. Если файл выбран, он загружается в редактор JSON.

#### `save_file`

```python
def save_file(self):
    """
    Сохраняет текущий файл.
    """
    ...
```

**Назначение**: Сохраняет текущий файл в зависимости от активной вкладки. Если активна вкладка "JSON Editor", сохраняются изменения кампании. Если активна вкладка "Product Editor", сохраняется продукт.

#### `exit_application`

```python
def exit_application(self):
    """
    Закрывает приложение.
    """
    ...
```

**Назначение**: Закрывает главное окно приложения, завершая работу приложения.

#### `copy`

```python
def copy(self):
    """
    Копирует выбранный текст в буфер обмена.
    """
    ...
```

**Назначение**: Копирует выбранный текст из виджета в фокусе (если это текстовый виджет) в буфер обмена.

#### `paste`

```python
def paste(self):
    """
    Вставляет текст из буфера обмена.
    """
    ...
```

**Назначение**: Вставляет текст из буфера обмена в виджет в фокусе (если это текстовый виджет).

#### `load_file`

```python
def load_file(self, campaign_file):
    """
    Загружает JSON-файл.
    """
    ...
```

**Назначение**: Загружает JSON-файл, используя метод `load_file` экземпляра `CampaignEditor` (`self.promotion_app`). В случае ошибки выводит сообщение об ошибке.

### Параметры класса

- `tab_widget` (QtWidgets.QTabWidget): Виджет для отображения вкладок.
- `tab1` (QtWidgets.QWidget): Виджет для первой вкладки (JSON Editor).
- `promotion_app` (CampaignEditor): Экземпляр класса `CampaignEditor` для управления JSON.
- `tab2` (QtWidgets.QWidget): Виджет для второй вкладки (Campaign Editor).
- `campaign_editor_app` (CategoryEditor): Экземпляр класса `CategoryEditor` для редактирования категорий кампаний.
- `tab3` (QtWidgets.QWidget): Виджет для третьей вкладки (Product Editor).
- `product_editor_app` (ProductEditor): Экземпляр класса `ProductEditor` для редактирования продуктов.

**Примеры**:

```python
# Создание экземпляра класса MainApp
main_app = MainApp()
main_app.show()
```

## Функции

### `main`

```python
def main():
    """
    Инициализирует и запускает приложение.
    """
    ...
```

**Назначение**: Инициализирует и запускает графическое приложение. Создает экземпляр `QApplication`, устанавливает цикл событий для асинхронных операций, создает главное окно приложения (`MainApp`) и отображает его.

**Как работает функция**:

1. Создает экземпляр `QApplication`.
2. Создает цикл событий `QEventLoop` для асинхронных операций и устанавливает его как текущий цикл событий.
3. Создает экземпляр `MainApp`.
4. Отображает главное окно приложения.
5. Запускает цикл событий, чтобы приложение оставалось активным и реагировало на действия пользователя.

**Примеры**:

```python
if __name__ == "__main__":
    main()
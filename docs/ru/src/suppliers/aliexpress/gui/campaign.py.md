# Модуль для редактирования кампаний AliExpress

## Обзор

Модуль предоставляет графический интерфейс для редактирования кампаний AliExpress. Он позволяет загружать JSON-файлы с данными о кампаниях, отображать и изменять их параметры, а также подготавливать кампании к запуску.

## Подробнее

Этот модуль является частью проекта `hypotez` и предназначен для упрощения процесса создания и редактирования рекламных кампаний на платформе AliExpress. Он использует библиотеку `PyQt6` для создания графического интерфейса и предоставляет пользователю возможность интерактивного взаимодействия с данными кампании.

## Классы

### `CampaignEditor`

**Описание**: Класс `CampaignEditor` представляет собой виджет для редактирования кампаний. Он позволяет загружать, отображать и изменять данные кампании, а также подготавливать кампании к использованию.

**Наследует**: `QtWidgets.QWidget`

**Атрибуты**:

-   `data` (SimpleNamespace): Данные кампании, загруженные из JSON-файла.
-   `current_campaign_file` (str): Путь к текущему загруженному файлу кампании.
-   `editor` (AliCampaignEditor): Экземпляр класса `AliCampaignEditor` для подготовки кампании.
-   `main_app`: Ссылка на главный экземпляр приложения.
-   `open_button`: Кнопка для открытия файла.
-   `file_name_label`: Отображает имя выбранного файла.
-   `prepare_button`: Кнопка для подготовки кампании.
-   `scroll_area`: Область с возможностью прокрутки.
-   `scroll_content_widget`: Виджет содержимого для области прокрутки.
-   `layout`: Менеджер расположения элементов интерфейса.
-    `title_input`: Поле ввода заголовка кампании.
-    `description_input`: Поле ввода описания кампании.
-    `promotion_name_input`: Поле ввода названия промоакции.

**Принцип работы**:

Класс `CampaignEditor` создает графический интерфейс, который позволяет пользователю загружать JSON-файлы с данными о кампаниях, отображать и изменять их параметры, такие как заголовок, описание и название промоакции. После загрузки файла данные отображаются в соответствующих полях ввода, и пользователь может вносить изменения. Класс также предоставляет кнопку для подготовки кампании к запуску, при нажатии на которую вызывается метод `prepare` класса `AliCampaignEditor`.

**Методы**:

-   `__init__(self, parent=None, main_app=None)`: Инициализирует виджет `CampaignEditor`.
-   `setup_ui(self)`: Настраивает пользовательский интерфейс виджета.
-   `setup_connections(self)`: Устанавливает соединения между сигналами и слотами.
-   `open_file(self)`: Открывает диалоговое окно для выбора JSON-файла кампании.
-   `load_file(self, campaign_file)`: Загружает JSON-файл кампании.
-   `create_widgets(self, data)`: Создает виджеты на основе данных, загруженных из JSON-файла.
-   `prepare_campaign(self)`: Асинхронно подготавливает кампанию.

## Методы класса

### `__init__`

```python
def __init__(self, parent=None, main_app=None):
    """Инициализирует виджет CampaignEditor.

    Args:
        parent (QtWidgets.QWidget, optional): Родительский виджет. По умолчанию None.
        main_app (MainApp, optional): Экземпляр главного приложения. По умолчанию None.
    """
    ...
```

**Назначение**: Инициализирует виджет `CampaignEditor`, сохраняет ссылку на главный экземпляр приложения, настраивает пользовательский интерфейс и устанавливает соединения между сигналами и слотами.

**Параметры**:

-   `parent` (QtWidgets.QWidget, optional): Родительский виджет. По умолчанию `None`.
-   `main_app`: Ссылка на главный экземпляр приложения.

**Возвращает**: Ничего.

**Как работает функция**:

1.  Вызывает конструктор родительского класса `QtWidgets.QWidget`.
2.  Сохраняет ссылку на главный экземпляр приложения в атрибуте `self.main_app`.
3.  Вызывает метод `setup_ui` для настройки пользовательского интерфейса.
4.  Вызывает метод `setup_connections` для установки соединений между сигналами и слотами.

**Примеры**:

```python
campaign_editor = CampaignEditor(main_app=main_app_instance)
```

### `setup_ui`

```python
def setup_ui(self):
    """Настраивает пользовательский интерфейс."""
    ...
```

**Назначение**: Настраивает пользовательский интерфейс виджета, включая создание кнопок, текстовых полей и других элементов управления, а также их размещение на форме.

**Параметры**: Отсутствуют.

**Возвращает**: Ничего.

**Как работает функция**:

1.  Устанавливает заголовок окна.
2.  Устанавливает размеры окна.
3.  Создает область прокрутки (`QScrollArea`) и виджет содержимого для нее (`QWidget`).
4.  Создает менеджер расположения элементов интерфейса (`QGridLayout`) для виджета содержимого области прокрутки.
5.  Определяет компоненты пользовательского интерфейса, такие как кнопки "Open JSON File" и "Prepare Campaign", а также метку для отображения имени файла.
6.  Добавляет компоненты в менеджер расположения.
7.  Добавляет область прокрутки в основной менеджер расположения виджета.
8.  Устанавливает основной менеджер расположения для виджета.

**Примеры**:

```python
campaign_editor.setup_ui()
```

### `setup_connections`

```python
def setup_connections(self):
    """Настраивает соединения сигнал-слот."""
    ...
```

**Назначение**: Устанавливает соединения между сигналами и слотами для обеспечения взаимодействия между элементами пользовательского интерфейса и логикой приложения.

**Параметры**: Отсутствуют.

**Возвращает**: Ничего.

**Как работает функция**: В данном примере функция пуста, что означает отсутствие каких-либо соединений между сигналами и слотами.

**Примеры**:

```python
campaign_editor.setup_connections()
```

### `open_file`

```python
def open_file(self):
    """Открывает диалоговое окно для выбора JSON-файла."""
    ...
```

**Назначение**: Открывает диалоговое окно выбора файла, позволяя пользователю выбрать JSON-файл с данными кампании.

**Параметры**: Отсутствуют.

**Возвращает**: Ничего.

**Как работает функция**:

1.  Открывает диалоговое окно выбора файла с помощью `QFileDialog.getOpenFileName`.
2.  Устанавливает фильтр на отображение только JSON-файлов.
3.  Если файл выбран, вызывает метод `load_file` для загрузки содержимого файла.

**Примеры**:

```python
campaign_editor.open_file()
```

### `load_file`

```python
def load_file(self, campaign_file):
    """Загружает JSON-файл."""
    ...
```

**Назначение**: Загружает JSON-файл с данными кампании, отображает имя файла в метке и создает виджеты для отображения и редактирования данных.

**Параметры**:

-   `campaign_file` (str): Путь к JSON-файлу.

**Возвращает**: Ничего.

**Как работает функция**:

1.  Пытается загрузить JSON-файл с использованием `j_loads_ns`.
2.  Сохраняет путь к файлу в атрибуте `self.current_campaign_file`.
3.  Отображает имя файла в метке `self.file_name_label`.
4.  Вызывает метод `create_widgets` для создания виджетов на основе загруженных данных.
5.  Создает экземпляр класса `AliCampaignEditor` для подготовки кампании.
6.  Обрабатывает возможные исключения при загрузке файла и отображает сообщение об ошибке.

**Примеры**:

```python
campaign_editor.load_file("path/to/campaign.json")
```

### `create_widgets`

```python
def create_widgets(self, data):
    """Создает виджеты на основе загруженных данных."""
    ...
```

**Назначение**: Создает виджеты для отображения и редактирования данных кампании на основе данных, загруженных из JSON-файла.

**Параметры**:

-   `data` (SimpleNamespace): Данные кампании.

**Возвращает**: Ничего.

**Как работает функция**:

1.  Получает ссылку на менеджер расположения элементов интерфейса (`self.layout`).
2.  Удаляет все предыдущие виджеты, кроме кнопок "Open JSON File" и "Prepare Campaign" и метки имени файла.
3.  Создает текстовые поля (`QLineEdit`) для заголовка, описания и названия промоакции.
4.  Добавляет метки и текстовые поля в менеджер расположения.
5.  Устанавливает фиксированные размеры для текстовых полей.

**Примеры**:

```python
campaign_editor.create_widgets(campaign_data)
```

### `prepare_campaign`

```python
@asyncSlot()
async def prepare_campaign(self):
    """Асинхронно подготавливает кампанию."""
    ...
```

**Назначение**: Асинхронно подготавливает кампанию к запуску с использованием экземпляра класса `AliCampaignEditor`.

**Параметры**: Отсутствуют.

**Возвращает**: Ничего.

**Как работает функция**:

1.  Проверяет, существует ли экземпляр `AliCampaignEditor`.
2.  Вызывает асинхронный метод `prepare` экземпляра `AliCampaignEditor` для подготовки кампании.
3.  Отображает сообщение об успешной подготовке кампании.
4.  Обрабатывает возможные исключения при подготовке кампании и отображает сообщение об ошибке.

**Примеры**:

```python
await campaign_editor.prepare_campaign()
```
# Модуль для редактирования товаров в графическом интерфейсе

## Обзор

Модуль `product.py` предоставляет графический интерфейс для редактирования информации о товарах, получаемой от поставщика AliExpress. Он включает в себя функциональность открытия JSON-файлов с данными о товарах, отображения этих данных в удобном для пользователя формате, а также подготовки товара к дальнейшей обработке с использованием класса `AliCampaignEditor`.

## Подробней

Модуль содержит класс `ProductEditor`, который является виджетом PyQt6. Он позволяет пользователю загружать JSON-файлы с информацией о продуктах AliExpress, отображает основные детали продукта, такие как название и описание, и предоставляет возможность подготовить продукт к дальнейшей обработке. Класс использует `AliCampaignEditor` для выполнения операций подготовки продукта.

## Классы

### `ProductEditor`

**Описание**: Класс `ProductEditor` представляет собой виджет для редактирования информации о товарах. Он предоставляет пользовательский интерфейс для загрузки JSON-файлов с данными о товарах, отображения этих данных и подготовки продукта к дальнейшей обработке.

**Наследует**: `QtWidgets.QWidget`

**Атрибуты**:

-   `data` (SimpleNamespace): Пространство имен для хранения данных о товаре.
-   `language` (str): Язык, используемый в редакторе (по умолчанию 'EN').
-   `currency` (str): Валюта, используемая в редакторе (по умолчанию 'USD').
-   `file_path` (str): Путь к файлу с данными о товаре.
-   `editor` (AliCampaignEditor): Экземпляр класса `AliCampaignEditor` для подготовки товара.
-   `main_app` (MainApp): Ссылка на главный экземпляр приложения.

**Методы**:

-   `__init__(self, parent=None, main_app=None)`: Инициализирует виджет `ProductEditor`.
-   `setup_ui(self)`: Настраивает пользовательский интерфейс виджета.
-   `setup_connections(self)`: Устанавливает соединения между сигналами и слотами.
-   `open_file(self)`: Открывает диалоговое окно для выбора JSON-файла и загружает его.
-   `load_file(self, file_path)`: Загружает JSON-файл и создает виджеты на основе данных.
-   `create_widgets(self, data)`: Создает виджеты для отображения данных о товаре.
-   `prepare_product_async(self)`: Асинхронно подготавливает продукт.

### `__init__`

```python
def __init__(self, parent=None, main_app=None):
    """ Инициализирует виджет ProductEditor 
    Args:
        parent (QWidget, optional): Родительский виджет. По умолчанию None.
        main_app (MainApp, optional): Экземпляр главного приложения. По умолчанию None.
    """
```

**Назначение**: Инициализирует виджет `ProductEditor`, сохраняет ссылку на главный экземпляр приложения, настраивает пользовательский интерфейс и устанавливает соединения.

**Параметры**:

-   `parent` (QWidget, optional): Родительский виджет. По умолчанию `None`.
-   `main_app` (MainApp, optional): Экземпляр главного приложения. По умолчанию `None`.

**Как работает функция**:
Сохраняет переданный экземпляр `main_app` в атрибут `self.main_app` для будущего использования.
Вызывает методы `setup_ui()` и `setup_connections()` для настройки интерфейса и установки связей между сигналами и слотами.

**Примеры**:

```python
editor = ProductEditor(main_app=main_app_instance)
```

### `setup_ui`

```python
def setup_ui(self):
    """ Настраивает пользовательский интерфейс """
    ...
```

**Назначение**: Настраивает пользовательский интерфейс виджета, включая установку заголовка окна, размеров и добавление кнопок и меток.

**Как работает функция**:

1.  Устанавливает заголовок окна как "Product Editor".
2.  Устанавливает размеры окна как 1800x800 пикселей.
3.  Создает кнопки "Open JSON File" и "Prepare Product", а также метку "No file selected".
4.  Устанавливает обработчики событий для кнопок `open_button` и `prepare_button` на методы `open_file` и `prepare_product_async` соответственно.
5.  Добавляет виджеты в вертикальный макет.

**Примеры**:

```python
self.setup_ui()
```

### `setup_connections`

```python
def setup_connections(self):
    """ Устанавливает соединения между сигналами и слотами """
    ...
```

**Назначение**: Устанавливает соединения между сигналами и слотами для обработки событий пользовательского интерфейса.

**Как работает функция**:
В текущей реализации функция пуста, что означает отсутствие каких-либо установленных соединений между сигналами и слотами.

**Примеры**:

```python
self.setup_connections()
```

### `open_file`

```python
def open_file(self):
    """ Открывает диалоговое окно для выбора JSON-файла и загружает его """
    ...
```

**Назначение**: Открывает диалоговое окно для выбора JSON-файла и загружает его содержимое.

**Как работает функция**:

1.  Вызывает `QFileDialog.getOpenFileName` для отображения диалогового окна открытия файла.
2.  Устанавливает фильтр для отображения только JSON-файлов.
3.  Если файл выбран, вызывает метод `load_file` для загрузки файла.
4.  Если файл не выбран, функция завершается.

**Примеры**:

```python
self.open_file()
```

### `load_file`

```python
def load_file(self, file_path):
    """ Загружает JSON-файл """
    ...
```

**Назначение**: Загружает JSON-файл, путь к которому указан в `file_path`.

**Параметры**:

-   `file_path` (str): Путь к JSON-файлу.

**Как работает функция**:

1.  Использует `j_loads_ns` для загрузки JSON-файла в пространство имен `self.data`.
2.  Сохраняет путь к файлу в `self.file_path`.
3.  Устанавливает текст метки `self.file_name_label` с именем выбранного файла.
4.  Создает экземпляр `AliCampaignEditor` с указанием пути к файлу.
5.  Вызывает метод `create_widgets` для создания виджетов на основе загруженных данных.
6.  В случае возникновения исключения, отображает сообщение об ошибке.

**Примеры**:

```python
self.load_file("path/to/file.json")
```

### `create_widgets`

```python
 def create_widgets(self, data):
    """ Создает виджеты на основе данных, загруженных из JSON-файла """
    ...
```

**Назначение**: Создает виджеты для отображения данных о товаре, загруженных из JSON-файла.

**Параметры**:

-   `data` (SimpleNamespace): Пространство имен с данными о товаре.

**Как работает функция**:

1.  Получает макет (`layout`) текущего виджета.
2.  Удаляет все предыдущие виджеты из макета, за исключением кнопок `open_button` и `prepare_button` и метки `file_name_label`.
3.  Создает метку `title_label` с названием товара из `data.title` и добавляет её в макет.
4.  Создает метку `product_details_label` с деталями товара из `data.details` и добавляет её в макет.

**Примеры**:

```python
self.create_widgets(self.data)
```

### `prepare_product_async`

```python
@asyncSlot()
async def prepare_product_async(self):
    """ Асинхронно подготавливает продукт """
    ...
```

**Назначение**: Асинхронно подготавливает продукт с использованием `AliCampaignEditor`.

**Как работает функция**:

1.  Проверяет, инициализирован ли `self.editor`.
2.  Вызывает метод `prepare_product` у `self.editor` асинхронно.
3.  Отображает сообщение об успехе или ошибке в зависимости от результата.

**Примеры**:

```python
await self.prepare_product_async()
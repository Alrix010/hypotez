# Модуль `src.suppliers.aliexpress.category`

## Обзор

Модуль предназначен для управления категориями товаров на сайте AliExpress. Он содержит функции для сбора URL товаров со страниц категорий, обновления информации о категориях в файлах сценариев, а также класс `DBAdaptor` для взаимодействия с базой данных категорий.

## Подробнее

Модуль обеспечивает автоматизацию работы с категориями AliExpress, включая извлечение данных о товарах и поддержание актуальности информации о категориях в локальных файлах сценариев. Взаимодействует с веб-драйвером для навигации по сайту и с базой данных для хранения и обновления информации о категориях.

## Классы

### `DBAdaptor`

**Описание**: Класс предоставляет методы для выполнения основных операций с базой данных категорий AliExpress, таких как выборка, вставка, обновление и удаление записей.

**Атрибуты**:
- Отсутствуют.

**Методы**:
- `select(cat_id: int = None, parent_id: int = None, project_cat_id: int = None)`: Выбирает записи из таблицы `AliexpressCategory` на основе заданных критериев.
- `insert()`: Вставляет новую запись в таблицу `AliexpressCategory` с заданными полями.
- `update()`: Обновляет существующую запись в таблице `AliexpressCategory` на основе `hypotez_id_value`.
- `delete()`: Удаляет запись из таблицы `AliexpressCategory` на основе `hypotez_id_value`.

#### `DBAdaptor.select`

```python
def select(cat_id: int = None, parent_id: int = None, project_cat_id: int = None)
```

**Назначение**: Выбирает записи из таблицы `AliexpressCategory` на основе заданных критериев.

**Параметры**:
- `cat_id` (int, optional): ID категории. По умолчанию `None`.
- `parent_id` (int, optional): ID родительской категории. По умолчанию `None`.
- `project_cat_id` (int, optional): ID категории проекта. По умолчанию `None`.

**Возвращает**:
- `None`: Результат операции выводится в консоль.

**Примеры**:

```python
db_adaptor = DBAdaptor()
db_adaptor.select(parent_id=123)
```

#### `DBAdaptor.insert`

```python
def insert()
```

**Назначение**: Вставляет новую запись в таблицу `AliexpressCategory` с заданными полями.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- `None`: Результат операции сохраняется в базе данных.

**Примеры**:

```python
db_adaptor = DBAdaptor()
db_adaptor.insert()
```

#### `DBAdaptor.update`

```python
def update()
```

**Назначение**: Обновляет существующую запись в таблице `AliexpressCategory` на основе `hypotez_id_value`.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- `None`: Результат операции сохраняется в базе данных.

**Примеры**:

```python
db_adaptor = DBAdaptor()
db_adaptor.update()
```

#### `DBAdaptor.delete`

```python
def delete()
```

**Назначение**: Удаляет запись из таблицы `AliexpressCategory` на основе `hypotez_id_value`.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- `None`: Результат операции выполняется в базе данных.

**Примеры**:

```python
db_adaptor = DBAdaptor()
db_adaptor.delete()
```

## Функции

### `get_list_products_in_category`

```python
def get_list_products_in_category(s) -> list[str, str]
```

**Назначение**: Считывает URL товаров со страницы категории, перелистывая страницы при необходимости.

**Параметры**:
- `s`: Экземпляр класса `Supplier`, содержащий информацию о поставщике и драйвер веб-браузера.

**Возвращает**:
- `list[str, str]`: Список URL товаров, найденных на странице категории.

**Как работает функция**:
1. Вызывает функцию `get_prod_urls_from_pagination(s)` для сбора URL товаров.
2. Возвращает полученный список URL.

**Примеры**:
```python
# Пример вызова функции
supplier = Supplier(...)
product_urls = get_list_products_in_category(supplier)
print(product_urls)
```

### `get_prod_urls_from_pagination`

```python
def get_prod_urls_from_pagination(s) -> list[str]
```

**Назначение**: Собирает ссылки на товары со страницы категории с перелистыванием страниц.

**Параметры**:
- `s`: Экземпляр класса `Supplier`, содержащий информацию о поставщике и драйвер веб-браузера.

**Возвращает**:
- `list[str]`: Список URL товаров, найденных на страницах категории.

**Как работает функция**:
1. Извлекает драйвер веб-браузера и локаторы из объекта `Supplier`.
2. Инициализирует пустой список `list_products_in_category` для хранения URL товаров.
3. Извлекает URL товаров с текущей страницы категории с помощью `_d.execute_locator(_l)` и добавляет их в `list_products_in_category`.
4. Переходит на следующую страницу категории, если это возможно, с помощью `_d.execute_locator(s.locators['category']['pagination']['->'])`.
5. Повторяет шаги 3 и 4, пока не будет достигнута последняя страница категории.
6. Возвращает список собранных URL товаров.

**Примеры**:
```python
# Пример вызова функции
supplier = Supplier(...)
product_urls = get_prod_urls_from_pagination(supplier)
print(product_urls)
```

### `update_categories_in_scenario_file`

```python
def update_categories_in_scenario_file(s, scenario_filename: str) -> bool
```

**Назначение**: Проверяет изменения категорий на сайте и обновляет информацию о категориях в файле сценария.

**Параметры**:
- `s`: Экземпляр класса `Supplier`.
- `scenario_filename` (str): Имя файла сценария.

**Возвращает**:
- `bool`: `True`, если обновление выполнено успешно.

**Как работает функция**:
1. Загружает файл сценария из JSON.
2. Получает список категорий с сайта.
3. Обновляет идентификаторы категорий в файле сценария.
4. Получает категории из JSON файла магазина AliExpress.
5. Сравнивает списки идентификаторов категорий в файле и на сайте.
6. Добавляет новые категории из сайта в файл, если они отсутствуют.
7. Отключает удаленные категории в файле, если они больше не существуют на сайте.
8. Отправляет уведомления о добавленных и удаленных категориях.
9. Возвращает `True` после завершения процесса.

**Внутренние функции**:
- `_update_all_ids_in_file()`: Обновляет список идентификаторов категорий в файле сценария.

**Примеры**:
```python
# Пример вызова функции
supplier = Supplier(...)
scenario_file = "example_scenario.json"
update_result = update_categories_in_scenario_file(supplier, scenario_file)
print(update_result)
```

### `get_list_categories_from_site`

```python
def get_list_categories_from_site(s, scenario_file, brand='')
```

**Назначение**: Извлекает список категорий с сайта на основе данных из файла сценария.

**Параметры**:
- `s`: Экземпляр класса `Supplier`, содержащий информацию о поставщике и драйвер веб-браузера.
- `scenario_file`: Имя файла сценария, содержащего URL магазина и другие настройки.
- `brand` (str, optional): Необязательный параметр для указания бренда. По умолчанию ''.

**Как работает функция**:
1. Извлекает драйвер веб-браузера из объекта `Supplier`.
2. Загружает JSON-конфигурацию из указанного файла сценария.
3. Открывает страницу категорий магазина, указанную в конфигурации.
4. Выполняет дальнейшие действия по извлечению категорий (код не предоставлен, указано `...`).

**Примеры**:
```python
# Пример вызова функции
supplier = Supplier(...)
scenario_file = "example_scenario.json"
get_list_categories_from_site(supplier, scenario_file)
```
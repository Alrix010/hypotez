# Модуль: Сокращение партнерских ссылок AliExpress через веб-браузер

## Обзор

Модуль предназначен для автоматического сокращения партнерских ссылок AliExpress с использованием веб-драйвера. Он предоставляет функцию для генерации коротких ссылок на основе полных URL, используя интерфейс веб-сайта AliExpress.

## Подробней

Этот модуль автоматизирует процесс получения коротких партнерских ссылок AliExpress. Он использует веб-драйвер для взаимодействия с веб-сайтом AliExpress, ввода полных URL, нажатия на кнопки для генерации коротких ссылок и извлечения полученных коротких URL. Модуль также обрабатывает возможные ошибки, такие как некорректные URL, и логирует их.

## Функции

### `get_short_affiliate_link`

```python
def get_short_affiliate_link(d:Driver, url: str) -> str:
    """ Script for generating a shortened affiliate link
    @param url `str`: Full URL
    @returns `str`: Shortened URL
    """
    ...
```

**Назначение**: Генерирует сокращенную партнерскую ссылку на основе предоставленного URL, используя веб-драйвер для взаимодействия с AliExpress.

**Параметры**:

-   `d` (`Driver`): Экземпляр веб-драйвера, используемый для автоматизации взаимодействия с веб-сайтом.
-   `url` (`str`): Полный URL, для которого требуется получить сокращенную партнерскую ссылку.

**Возвращает**:

-   `str`: Сокращенный URL или None, если не удалось получить сокращенный URL.

**Как работает функция**:

1.  Вводит предоставленный URL в текстовое поле на веб-странице AliExpress. Для этого используется `d.execute_locator(locator.textarea_target_url, url)`, где `locator.textarea_target_url` - это локатор текстового поля.
2.  Нажимает на кнопку для генерации партнерской ссылки. Для этого используется `d.execute_locator(locator.button_get_tracking_link)`, где `locator.button_get_tracking_link` - это локатор кнопки.
3.  Ожидает 1 секунду, чтобы страница обновилась и короткая ссылка была сгенерирована.
4.  Извлекает короткую ссылку из соответствующего элемента на странице. Для этого используется `short_url = d.execute_locator(locator.textarea_short_link)[0]`, где `locator.textarea_short_link` - это локатор элемента с короткой ссылкой.
5.  Сохраняет идентификатор текущей вкладки браузера в переменную `main_tab`.
6.  Проверяет, была ли получена короткая ссылка. Если длина полученной ссылки меньше 1 символа, это считается ошибкой. В случае ошибки:

    *   Записывает сообщение об ошибке в лог с использованием `logger.error(f"Не удалось получить короткий URL от {url}")`.
7.  Открывает новую вкладку в браузере с полученной короткой ссылкой, используя JavaScript: `d.execute_script(f"window.open('{short_url}');")`.
8.  Переключается на новую вкладку, используя `d.switch_to.window(d.window_handles[-1])`.
9.  Проверяет, начинается ли URL текущей страницы с `https://error.taobao.com`. Если это так, значит, короткая ссылка ведет на страницу ошибки:

    *   Записывает сообщение об ошибке в лог с использованием `logger.error(f"Неправильный URL: {d.current_url}")`.
    *   Закрывает текущую вкладку с ошибкой с помощью `d.close()`.
    *   Переключается обратно на основную вкладку, используя `d.switch_to.window(main_tab)`.
10. Закрывает новую вкладку с короткой ссылкой с помощью `d.close()`.
11. Переключается обратно на основную вкладку, используя `d.switch_to.window(main_tab)`.
12. Возвращает полученную короткую ссылку.

**Примеры**:

```python
from src.webdriver.driver import Driver, Chrome
from src.suppliers.aliexpress.scenarios.affiliate_links_shortener_scenario import get_short_affiliate_link

# Пример использования функции get_short_affiliate_link
driver = Driver(Chrome)
url = "https://www.aliexpress.com/item/10050000000000.html"
short_url = get_short_affiliate_link(driver, url)
print(f"Короткая ссылка: {short_url}")
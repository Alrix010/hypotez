# Модуль `src.suppliers.supplier`

## Обзор

Модуль `src.suppliers.supplier` содержит базовый класс `Supplier`, предназначенный для унификации взаимодействия с различными поставщиками. Он предоставляет абстракцию для запуска сценариев сбора данных, управления локаторами элементов страницы и взаимодействия с веб-драйвером.

## Подробнее

Этот модуль является ключевым компонентом системы, обеспечивающим гибкость и расширяемость при работе с разными поставщиками данных. Он позволяет загружать специфичные для поставщика модули и управлять сценариями сбора данных.

## Классы

### `Supplier(BaseModel)`

**Описание**: Класс `Supplier` выполняет сценарии для различных поставщиков.

**Наследует**: `BaseModel` из библиотеки `pydantic`, что обеспечивает автоматическую валидацию данных и управление настройками.

**Атрибуты**:

- `supplier_id` (Optional[int]): Идентификатор поставщика. По умолчанию `None`.
- `supplier_prefix` (str): Префикс поставщика (обязательный параметр).
- `locale` (str): Код локали в формате ISO 639-1. По умолчанию 'en'.
- `price_rule` (Optional[str]): Правило расчета цен. По умолчанию `None`.
- `related_modules` (Optional[ModuleType]): Функции, относящиеся к каждому поставщику.
- `scenario_files` (List[str]): Список файлов сценариев для выполнения.
- `current_scenario` (Dict[str, Any]): Текущий исполняемый сценарий.
- `locators` (List[SimpleNamespace]): Локаторы для элементов страницы.
- `driver` (Optional['Driver']): Веб-драйвер.

**Принцип работы**:

Класс `Supplier` предназначен для централизованного управления взаимодействием с поставщиками данных. При инициализации он загружает специфичные для поставщика параметры и модули, что позволяет адаптировать процессы сбора данных под конкретного поставщика. Валидация данных осуществляется с помощью `pydantic`, что обеспечивает надежность и консистентность конфигурации. Класс также предоставляет методы для выполнения сценариев и входа на сайт поставщика.

**Методы**:

- `__init__(self, **data)`: Инициализация поставщика, загрузка конфигурации.
- `_payload(self) -> bool`: Загрузка параметров поставщика с использованием `j_loads_ns`.
- `login(self) -> bool`: Выполняет вход на сайт поставщика.
- `run_scenario_files(self, scenario_files: Optional[str | List[str]] = None) -> bool`: Выполнение одного или нескольких файлов сценариев.
- `run_scenarios(self, scenarios: dict | List[dict]) -> bool`: Выполнение списка или одного сценария.

### `Config`
**Описание**: Вспомогательный класс для конфигурации модели `Supplier`.

**Наследует**: Нет явного наследования.

**Атрибуты**:
- `arbitrary_types_allowed` (bool): Разрешает произвольные типы данных для модели.

### `check_supplier_prefix(cls, value: str) -> str`
**Описание**: Валидатор для атрибута `supplier_prefix`, проверяет, что префикс поставщика не является пустым.

**Параметры**:
- `cls`: Ссылка на класс.
- `value` (str): Значение префикса поставщика.

**Возвращает**:
- `str`: Значение префикса, если оно не пустое.

**Вызывает исключения**:
- `ValueError`: Если префикс поставщика пуст.

## Методы класса

### `__init__(self, **data)`

**Назначение**: Инициализация объекта `Supplier`.

**Параметры**:
- `**data`: Произвольные аргументы, передаваемые при инициализации объекта.

**Как работает функция**:
- Вызывает конструктор базового класса `BaseModel` для инициализации атрибутов модели.
- Вызывает метод `_payload()` для загрузки параметров поставщика.
- В случае неуспешной загрузки параметров (`_payload()` возвращает `False`), выбрасывает исключение `DefaultSettingsException`.

**Примеры**:
```python
from src.suppliers.supplier import Supplier
try:
    supplier = Supplier(supplier_prefix='example', locale='ru')
except Exception as ex:
    print(f"Ошибка инициализации поставщика: {ex}")
```

### `_payload(self) -> bool`

**Назначение**: Загрузка параметров поставщика.

**Параметры**:
- `self`: Ссылка на экземпляр класса `Supplier`.

**Возвращает**:
- `bool`: `True`, если загрузка параметров прошла успешно, `False` в противном случае.

**Как работает функция**:
1. Логирует начало процесса загрузки параметров для указанного поставщика.
2. Импортирует модуль, связанный с конкретным поставщиком, используя `importlib`. Имя модуля формируется как `src.suppliers.suppliers_list.{self.supplier_prefix}`.
3. Устанавливает импортированный модуль как атрибут `related_modules` объекта `Supplier`.
4. В случае, если модуль не найден (`ModuleNotFoundError`), логирует ошибку и возвращает `False`.
5. Обрабатывает возможные исключения при импорте модуля, логирует ошибку и возвращает `False`.

**Примеры**:
```python
from src.suppliers.supplier import Supplier
supplier = Supplier(supplier_prefix='ozon', locale='ru')
if supplier._payload():
    print("Параметры поставщика успешно загружены.")
else:
    print("Не удалось загрузить параметры поставщика.")
```

### `login(self) -> bool`

**Назначение**: Выполняет вход на сайт поставщика.

**Параметры**:
- `self`: Ссылка на экземпляр класса `Supplier`.

**Возвращает**:
- `bool`: `True`, если вход выполнен успешно, `False` в противном случае.

**Как работает функция**:
- Вызывает функцию `login` из модуля `related_modules`, передавая ей текущий объект `Supplier`.
- Возвращает результат выполнения функции `login`.

**Примеры**:
```python
from src.suppliers.supplier import Supplier
supplier = Supplier(supplier_prefix='amazon', locale='en')
supplier._payload()
if supplier.login():
    print("Вход на сайт поставщика выполнен успешно.")
else:
    print("Не удалось выполнить вход на сайт поставщика.")
```

### `run_scenario_files(self, scenario_files: Optional[str | List[str]] = None) -> bool`

**Назначение**: Выполняет сценарии, указанные в файлах.

**Параметры**:
- `self`: Ссылка на экземпляр класса `Supplier`.
- `scenario_files` (Optional[str | List[str]]): Список файлов сценариев для выполнения. Если `None`, используется `self.scenario_files`.

**Возвращает**:
- `bool`: `True`, если все сценарии выполнены успешно, `False` в противном случае.

**Как работает функция**:
1. Если `scenario_files` не указан, использует `self.scenario_files`.
2. Вызывает функцию `run_scenario_files` из модуля `src.suppliers.scenario.scenario_executor`, передавая ей текущий объект `Supplier` и список файлов сценариев.
3. Возвращает результат выполнения функции `run_scenario_files`.

**Примеры**:
```python
from src.suppliers.supplier import Supplier
supplier = Supplier(supplier_prefix='wb', locale='ru', scenario_files=['scenario1.json', 'scenario2.json'])
supplier._payload()
if supplier.run_scenario_files():
    print("Сценарии из файлов успешно выполнены.")
else:
    print("Не удалось выполнить сценарии из файлов.")
```

### `run_scenarios(self, scenarios: dict | List[dict]) -> bool`

**Назначение**: Выполняет переданные сценарии.

**Параметры**:
- `self`: Ссылка на экземпляр класса `Supplier`.
- `scenarios` (dict | List[dict]): Сценарий или список сценариев для выполнения.

**Возвращает**:
- `bool`: `True`, если сценарии выполнены успешно, `False` в противном случае.

**Как работает функция**:
- Вызывает функцию `run_scenarios` из модуля `src.suppliers.scenario.scenario_executor`, передавая ей текущий объект `Supplier` и сценарии.
- Возвращает результат выполнения функции `run_scenarios`.

**Примеры**:
```python
from src.suppliers.supplier import Supplier
supplier = Supplier(supplier_prefix='wb', locale='ru')
supplier._payload()
scenarios = [{'name': 'scenario1', 'steps': []}, {'name': 'scenario2', 'steps': []}]
if supplier.run_scenarios(scenarios):
    print("Сценарии успешно выполнены.")
else:
    print("Не удалось выполнить сценарии.")
```
# Модуль `supplier`

## Обзор

Модуль `supplier` содержит класс `Supplier`, который является базовым классом для работы с поставщиками. Он обеспечивает абстракцию и унифицированный интерфейс для взаимодействия с различными поставщиками, позволяя запускать сценарии сбора данных, управлять локаторами элементов страницы и взаимодействовать с веб-драйвером.

## Подробнее

Этот модуль является ключевым компонентом системы, предназначенным для управления и выполнения сценариев, связанных с конкретными поставщиками. Он загружает необходимые модули поставщика, выполняет вход на сайт поставщика и запускает сценарии сбора данных.

## Классы

### `Supplier`

**Описание**: Класс `Supplier` предназначен для выполнения сценариев для различных поставщиков. Он содержит информацию о поставщике, такую как идентификатор, префикс, локаль, правило расчета цен, а также связанные модули, файлы сценариев, текущий сценарий, локаторы и веб-драйвер.

**Атрибуты**:

- `supplier_id` (Optional[int]): Идентификатор поставщика.
- `supplier_prefix` (str): Префикс поставщика.
- `locale` (str): Код локали в формате ISO 639-1.
- `price_rule` (Optional[str]): Правило расчета цен.
- `related_modules` (Optional[ModuleType]): Функции, относящиеся к каждому поставщику.
- `scenario_files` (List[str]): Список файлов сценариев для выполнения.
- `current_scenario` (Dict[str, Any]): Текущий исполняемый сценарий.
- `locators` (Dict[str, Any]): Локаторы для элементов страницы.
- `driver` (Optional[Driver]): Веб-драйвер.

**Методы**:

- `__init__(self, **data)`: Инициализирует объект поставщика, загружает его конфигурацию и проверяет наличие необходимых параметров.
- `_payload(self) -> bool`: Загружает параметры поставщика, включая связанные модули.
- `login(self) -> bool`: Выполняет вход на сайт поставщика.
- `run_scenario_files(self, scenario_files: Optional[str  |  List[str]] = None) -> bool`: Выполняет один или несколько файлов сценариев.
- `run_scenarios(self, scenarios: dict  |  List[dict]) -> bool`: Выполняет список или один сценарий.

**Принцип работы**:

1.  При инициализации класса `Supplier` вызывается метод `__init__`, который загружает конфигурацию поставщика и проверяет наличие необходимых параметров.
2.  Метод `_payload` загружает параметры поставщика, включая связанные модули, используя функцию `importlib.import_module`.
3.  Метод `login` выполняет вход на сайт поставщика, вызывая функцию `login` из связанного модуля поставщика.
4.  Методы `run_scenario_files` и `run_scenarios` выполняют сценарии, определенные в файлах или переданные в виде списка или одного сценария, используя функции `run_scenario_files` и `run_scenarios` соответственно.

## Методы класса

### `__init__`

```python
def __init__(self, **data):
    """Инициализация поставщика, загрузка конфигурации.
    """
```

**Назначение**: Инициализирует экземпляр класса `Supplier`. При инициализации вызывается конструктор родительского класса `BaseModel` и метод `_payload` для загрузки параметров поставщика.

**Параметры**:

- `**data`: Произвольные аргументы, передаваемые в конструктор класса.

**Вызывает исключения**:

- `DefaultSettingsException`: Если не удается загрузить параметры поставщика.

**Как работает функция**:

- Вызывает конструктор базового класса `BaseModel` для инициализации атрибутов модели.
- Вызывает метод `_payload` для загрузки параметров поставщика.
- Если метод `_payload` возвращает `False`, выбрасывается исключение `DefaultSettingsException`.

**Примеры**:

```python
from src.suppliers.supplier import Supplier

try:
    supplier = Supplier(supplier_prefix='example', locale='ru')
    print(f"Поставщик {supplier.supplier_prefix} успешно инициализирован.")
except Exception as ex:
    print(f"Ошибка инициализации поставщика: {ex}")
```

### `_payload`

```python
def _payload(self) -> bool:
    """Загрузка параметров поставщика с использованием `j_loads_ns`.
    """
```

**Назначение**: Загружает параметры поставщика, включая связанные модули.

**Возвращает**:

- `bool`: `True`, если загрузка выполнена успешно, иначе `False`.

**Как работает функция**:

1.  Логирует информацию о начале загрузки настроек для поставщика.
2.  Пытается импортировать модуль, связанный с поставщиком, используя `importlib.import_module`.
3.  Если модуль успешно импортирован, он присваивается атрибуту `related_modules` экземпляра класса.
4.  Если модуль не найден, логируется ошибка и возвращается `False`.

**Примеры**:

```python
from src.suppliers.supplier import Supplier

supplier = Supplier(supplier_prefix='example', locale='ru')
if supplier._payload():
    print(f"Параметры поставщика {supplier.supplier_prefix} успешно загружены.")
else:
    print(f"Не удалось загрузить параметры поставщика {supplier.supplier_prefix}.")
```

### `login`

```python
def login(self) -> bool:
    """Выполняет вход на сайт поставщика.
    """
```

**Назначение**: Выполняет вход на сайт поставщика, вызывая соответствующую функцию из связанного модуля поставщика.

**Возвращает**:

- `bool`: `True`, если вход выполнен успешно, иначе `False`.

**Как работает функция**:

- Вызывает функцию `login` из связанного модуля поставщика (`self.related_modules`).
- Возвращает результат выполнения этой функции.

**Примеры**:

```python
from src.suppliers.supplier import Supplier

supplier = Supplier(supplier_prefix='example', locale='ru')
supplier._payload()  # Необходимо загрузить related_modules
if supplier.login():
    print(f"Вход на сайт поставщика {supplier.supplier_prefix} выполнен успешно.")
else:
    print(f"Не удалось выполнить вход на сайт поставщика {supplier.supplier_prefix}.")
```

### `run_scenario_files`

```python
def run_scenario_files(self, scenario_files: Optional[str  |  List[str]] = None) -> bool:
    """Выполнение одного или нескольких файлов сценариев.
    """
```

**Назначение**: Выполняет сценарии, определенные в одном или нескольких файлах.

**Параметры**:

- `scenario_files` (Optional[str  |  List[str]]): Список файлов сценариев для выполнения. Если не указан, используется `self.scenario_files`.

**Возвращает**:

- `bool`: `True`, если все сценарии успешно выполнены, иначе `False`.

**Как работает функция**:

1.  Если `scenario_files` не указан, используется `self.scenario_files`.
2.  Вызывает функцию `run_scenario_files` из модуля `src.scenario` для выполнения сценариев.
3.  Возвращает результат выполнения этой функции.

**Примеры**:

```python
from src.suppliers.supplier import Supplier

supplier = Supplier(supplier_prefix='example', locale='ru', scenario_files=['scenario1.json', 'scenario2.json'])
if supplier.run_scenario_files():
    print(f"Сценарии из файлов успешно выполнены для поставщика {supplier.supplier_prefix}.")
else:
    print(f"Не удалось выполнить сценарии из файлов для поставщика {supplier.supplier_prefix}.")
```

### `run_scenarios`

```python
def run_scenarios(self, scenarios: dict  |  List[dict]) -> bool:
    """Выполнение списка или одного сценария.
    """
```

**Назначение**: Выполняет один или несколько сценариев, переданных в виде списка или одного словаря.

**Параметры**:

- `scenarios` (dict  |  List[dict]): Сценарий или список сценариев для выполнения.

**Возвращает**:

- `bool`: `True`, если сценарий успешно выполнен, иначе `False`.

**Как работает функция**:

- Вызывает функцию `run_scenarios` из модуля `src.scenario` для выполнения сценариев.
- Возвращает результат выполнения этой функции.

**Примеры**:

```python
from src.suppliers.supplier import Supplier

supplier = Supplier(supplier_prefix='example', locale='ru')
scenarios = [{'name': 'scenario1', 'steps': []}, {'name': 'scenario2', 'steps': []}]
if supplier.run_scenarios(scenarios):
    print(f"Сценарии успешно выполнены для поставщика {supplier.supplier_prefix}.")
else:
    print(f"Не удалось выполнить сценарии для поставщика {supplier.supplier_prefix}.")
```

## Параметры класса

- `supplier_id` (Optional[int]): Уникальный идентификатор поставщика в системе. Может быть `None`, если идентификатор не задан.
- `supplier_prefix` (str): Префикс, идентифицирующий поставщика. Используется для загрузки связанных модулей и других операций. Обязательный параметр.
- `locale` (str): Локаль, используемая для работы с поставщиком. Определяет язык и региональные настройки. По умолчанию 'en'.
- `price_rule` (Optional[str]): Правило расчета цен, применяемое к продуктам поставщика. Может быть `None`, если правило не задано.
- `related_modules` (Optional[ModuleType]): Модули, связанные с поставщиком. Содержат специфичную для поставщика логику. Может быть `None`, если модули не загружены.
- `scenario_files` (List[str]): Список файлов сценариев, определяющих последовательность действий для сбора данных с сайта поставщика.
- `current_scenario` (Dict[str, Any]): Текущий выполняемый сценарий. Содержит информацию о текущем состоянии выполнения сценария.
- `locators` (Dict[str, Any]): Локаторы элементов на страницах сайта поставщика. Используются для поиска и взаимодействия с элементами.
- `driver` (Optional[Driver]): Экземпляр веб-драйвера, используемый для взаимодействия с сайтом поставщика. Может быть `None`, если драйвер не инициализирован.
# Документация модуля `keepass`

## Обзор

Данный модуль предназначен для работы с базой данных KeePass, в которой хранятся зашифрованные учетные данные и настройки приложения. Он использует библиотеку `pykeepass` для доступа к файлу базы данных и обеспечивает централизованное хранение и управление различными API-ключами, паролями и другими конфиденциальными данными.

## Подробнее

Модуль реализует паттерн "синглтон" для класса `ProgramSettings`, что гарантирует наличие единственного экземпляра настроек для всего приложения. Это позволяет избежать конфликтов и обеспечивает согласованный доступ к учетным данным из любой части программы.

Основная задача модуля - безопасное извлечение и предоставление доступа к учетным данным, хранящимся в базе данных KeePass, для различных сервисов и API, таких как AliExpress, OpenAI, Gemini, Telegram, Discord, PrestaShop, SMTP, Facebook и Google API.

## Классы

### `ProgramSettings`

**Описание**: Класс `ProgramSettings` является синглтоном и предназначен для хранения и управления настройками и учетными данными, извлеченными из базы данных KeePass. Он обеспечивает централизованный доступ к этим данным через статический экземпляр класса.

**Наследует**: Данный класс не наследует другие классы.

**Атрибуты**:

-   `credentials` (SimpleNamespace): Объект, содержащий учетные данные для различных сервисов и API.

**Методы**:

-   `get_instance()`: Статический метод, возвращающий единственный экземпляр класса `ProgramSettings`.
-   `_open_kp()`: Метод, отвечающий за открытие файла базы данных KeePass.
-   `_load_credentials()`: Метод, вызывающий методы загрузки учетных данных для каждой категории.
-   `_load_aliexpress()`: Метод, загружающий учетные данные для AliExpress.
-   `_load_openai()`: Метод, загружающий учетные данные для OpenAI.
-   `_load_gemini()`: Метод, загружающий учетные данные для Gemini.
-   `_load_telegram()`: Метод, загружающий учетные данные для Telegram.
-   `_load_discord()`: Метод, загружающий учетные данные для Discord.
-   `_load_prestashop()`: Метод, загружающий учетные данные для PrestaShop.
-   `_load_smtp()`: Метод, загружающий учетные данные для SMTP.
-   `_load_facebook()`: Метод, загружающий учетные данные для Facebook.
-   `_load_gapi()`: Метод, загружающий учетные данные для Google API.

**Принцип работы**:

Класс `ProgramSettings` использует паттерн синглтон, чтобы гарантировать, что только один экземпляр класса существует во всем приложении. Это достигается за счет использования статического атрибута `_instance`, который хранит ссылку на единственный экземпляр класса. Метод `get_instance()` возвращает этот экземпляр, создавая его, если он еще не существует.

При инициализации класса `ProgramSettings` вызываются методы для открытия базы данных KeePass (`_open_kp()`) и загрузки учетных данных для различных сервисов (`_load_credentials()`). Эти методы извлекают данные из базы данных KeePass и сохраняют их в атрибуте `credentials` в виде объектов `SimpleNamespace`.

## Методы класса

### `get_instance`

```python
@staticmethod
def get_instance() -> "ProgramSettings":
    """Возвращает единственный экземпляр класса ProgramSettings.

    Returns:
        ProgramSettings: Единственный экземпляр класса.
    """
```

**Назначение**: Возвращает единственный экземпляр класса `ProgramSettings`, создавая его при необходимости.

**Параметры**: Нет параметров.

**Возвращает**:

-   `ProgramSettings`: Единственный экземпляр класса `ProgramSettings`.

### `_open_kp`

```python
def _open_kp(self) -> None:
    """Открывает базу данных KeePass.

    Пытается прочитать пароль из файла password.txt, если он существует,
    или запрашивает пароль у пользователя через консоль.
    При неудачной попытке открытия, метод повторяет попытку несколько раз.
    Если все попытки неудачны, программа завершает работу.
    """
```

**Назначение**: Открывает базу данных KeePass, используя пароль, полученный из файла или введенный пользователем.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Пытается прочитать пароль из файла `password.txt`.
2.  Если файл не существует или пароль не удалось прочитать, запрашивает ввод пароля у пользователя через консоль.
3.  Пытается открыть базу данных KeePass, используя полученный пароль.
4.  В случае неудачи повторяет попытку несколько раз.
5.  Если все попытки неудачны, завершает программу.

### `_load_credentials`

```python
def _load_credentials(self) -> None:
    """Загружает учетные данные из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для различных сервисов из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Вызывает методы `_load_aliexpress()`, `_load_openai()`, `_load_gemini()`, `_load_telegram()`, `_load_discord()`, `_load_prestashop()`, `_load_smtp()` и `_load_facebook()` для загрузки учетных данных для соответствующих сервисов.

### `_load_aliexpress`

```python
def _load_aliexpress(self) -> None:
    """Загружает учетные данные для AliExpress из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для AliExpress из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Ищет группу `suppliers/aliexpress/api` в базе данных KeePass.
2.  Извлекает `api_key`, `secret`, `tracking_id`, `email` из кастомных свойств записи и `password` из пароля записи.
3.  Сохраняет эти данные в `ProgramSettings.credentials.aliexpress` в виде атрибутов `api_key`, `secret`, `tracking_id`, `email` и `password`.

### `_load_openai`

```python
def _load_openai(self) -> None:
    """Загружает учетные данные для OpenAI из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для OpenAI из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Ищет группу `openai` в базе данных KeePass.
2.  Извлекает `api_key`, `project_api` из кастомных свойств записи. Имя записи становится именем атрибута `ProgramSettings.credentials.openai`.
3.  Из группы `openai/assistants` извлекаются `assistant_id` из кастомных свойств записи. Имя записи становится именем атрибута `ProgramSettings.credentials.openai.assistant_id`.

### `_load_gemini`

```python
def _load_gemini(self) -> None:
    """Загружает учетные данные для Gemini из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для Gemini из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Ищет группу `gemini` в базе данных KeePass.
2.  Извлекает `api_key` из кастомных свойств записи. Имя записи становится именем атрибута `ProgramSettings.credentials.gemini`.

### `_load_telegram`

```python
def _load_telegram(self) -> None:
    """Загружает учетные данные для Telegram из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для Telegram из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Ищет группу `telegram` в базе данных KeePass.
2.  Извлекает `token` из кастомных свойств записи. Имя записи становится именем атрибута `ProgramSettings.credentials.telegram`.

### `_load_discord`

```python
def _load_discord(self) -> None:
    """Загружает учетные данные для Discord из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для Discord из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Ищет группу `discord` в базе данных KeePass.
2.  Извлекает `application_id`, `public_key` и `bot_token` из кастомных свойств записи.
3.  Сохраняет эти данные в `ProgramSettings.credentials.discord` в виде атрибутов `application_id`, `public_key` и `bot_token`.

### `_load_prestashop`

```python
def _load_prestashop(self) -> None:
    """Загружает учетные данные для PrestaShop из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для PrestaShop из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Ищет группу `prestashop/clients` в базе данных KeePass.
2.  Извлекает `api_key`, `api_domain`, `db_server`, `db_user`, `db_password` из кастомных свойств каждой записи.
3.  Каждый набор данных добавляется как объект `SimpleNamespace` в список `ProgramSettings.credentials.presta.client`.
4.  Ищет группу `prestashop/translation`.
5.  Извлекает `server`, `port`, `database`, `user`, `password` из кастомных свойств первой записи.
6.  Сохраняет эти данные в `ProgramSettings.credentials.presta.translations`.

### `_load_smtp`

```python
def _load_smtp(self) -> None:
    """Загружает учетные данные для SMTP из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для SMTP из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Ищет группу `smtp` в базе данных KeePass.
2.  Извлекает `server`, `port`, `user` и `password` из кастомных свойств каждой записи.
3.  Каждый набор данных добавляется как объект `SimpleNamespace` в список `ProgramSettings.credentials.smtp`.

### `_load_facebook`

```python
def _load_facebook(self) -> None:
    """Загружает учетные данные для Facebook из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для Facebook из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Ищет группу `facebook` в базе данных KeePass.
2.  Извлекает `app_id`, `app_secret` и `access_token` из кастомных свойств каждой записи.
3.  Каждый набор данных добавляется как объект `SimpleNamespace` в список `ProgramSettings.credentials.facebook`.

### `_load_gapi`

```python
 def _load_gapi(self) -> None:
    """Загружает учетные данные для Google API из базы данных KeePass."""
```

**Назначение**: Загружает учетные данные для Google API из базы данных KeePass.

**Параметры**: Нет параметров.

**Возвращает**: Нет возвращаемого значения.

**Как работает функция**:

1.  Ищет группу `google/gapi` в базе данных KeePass.
2.  Извлекает `api_key` из кастомных свойств записи.
3.  Сохраняет этот данные в `ProgramSettings.credentials.gapi` по ключу `api_key`.
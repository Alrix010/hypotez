# Модуль `main.py` для OpenAI Trainer

## Обзор

Этот модуль предоставляет главное окно приложения `AssistantMainWindow`, которое позволяет пользователю взаимодействовать с различными сервисами Google и моделями искусственного интеллекта, такими как ChatGPT, Gemini и Claude, через интерфейс PyQt6. Приложение может быть свернуто в системный трей.

## Подробней

Модуль `main.py` является отправной точкой для графического интерфейса пользователя (GUI) приложения OpenAI Trainer. Он создает главное окно приложения, которое включает в себя:

-   Верхнюю панель с кнопками для ввода URL, загрузки URL, сворачивания в трей, открытия на весь экран и закрытия окна.
-   Виджет браузера для отображения веб-страниц.
-   Системный трей для минимизации приложения в фоновом режиме.
-   Меню для выбора сервисов Google и моделей ИИ.

Приложение использует PyQt6 для создания GUI и `QWebEngineView` для отображения веб-страниц.

## Классы

### `AssistantMainWindow`

**Описание**: Главное окно приложения, которое содержит все элементы интерфейса и логику работы.

**Наследует**: `QMainWindow`

**Атрибуты**:

-   `profile` (QWebEngineProfile): Профиль браузера, используемый для `QWebEngineView`.
-   `browser` (QWebEngineView): Виджет для отображения веб-страниц.
-   `title_bar` (QWidget): Виджет верхней панели.
-   `url_input` (QLineEdit): Поле для ввода URL.
-   `load_button` (QPushButton): Кнопка для загрузки URL.
-   `minimize_button` (QPushButton): Кнопка для сворачивания в трей.
-   `fullscreen_button` (QPushButton): Кнопка для открытия на весь экран.
-   `close_button` (QPushButton): Кнопка для закрытия окна.
-   `tray_icon` (QSystemTrayIcon): Иконка в системном трее.
-   `url_menu` (QMenu): Меню для выбора URL сервисов Google.
-   `model_menu` (QMenu): Меню для выбора моделей ИИ.
-   `url_button` (QPushButton): Кнопка для открытия меню URL.
-   `model_button` (QPushButton): Кнопка для открытия меню выбора модели.

**Принцип работы**:

1.  Инициализация главного окна:
    *   Установка флагов окна для управления поведением (запрет максимизации).
    *   Определение размеров окна на основе размеров экрана.
    *   Запрос выбора браузера по умолчанию у пользователя.
    *   Создание профиля браузера на основе выбора пользователя.
    *   Инициализация виджета браузера `QWebEngineView` с использованием профиля.
    *   Создание и настройка верхней панели с кнопками и полем ввода URL.
    *   Создание и настройка системного трея с контекстным меню.
    *   Создание и настройка меню для выбора URL сервисов Google и моделей ИИ.
2.  Обработка событий:
    *   Загрузка URL при нажатии кнопки "Загрузить" или клавиши Enter в поле ввода URL.
    *   Сворачивание окна в трей при нажатии кнопки "Свернуть в трей" или закрытии окна через "X".
    *   Открытие окна на весь экран при нажатии кнопки "Открыть на весь экран".
    *   Выход из приложения при выборе пункта "Выход" в контекстном меню трея.

## Методы класса

### `__init__`

```python
def __init__(self):
    """Инициализация главного окна приложения.

    Инициализирует все элементы интерфейса и устанавливает их начальные значения.
    """
    ...
```

**Назначение**: Инициализирует главное окно приложения, устанавливает размеры, запрашивает выбор браузера, создает профиль браузера, создает виджеты и устанавливает связи между сигналами и слотами.

**Параметры**:

*   `self` (AssistantMainWindow): Экземпляр класса `AssistantMainWindow`.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   `SystemExit`: Если выбранный браузер не поддерживается.

**Внутренние функции**: Отсутствуют.

**Как работает функция**:

1.  Вызывает конструктор базового класса `QMainWindow`.
2.  Устанавливает флаги окна, чтобы убрать кнопку максимизации.
3.  Вычисляет размеры окна как 3/4 от размеров экрана и устанавливает геометрию окна.
4.  Вызывает метод `ask_for_browser()` для запроса выбора браузера по умолчанию.
5.  Определяет путь к профилю выбранного браузера.
6.  Создает экземпляр `QWebEngineProfile` с путем к профилю браузера.
7.  Создает экземпляр `QWebEngineView` и устанавливает страницу по умолчанию из профиля.
8.  Создает виджет верхней панели `QWidget` и устанавливает фиксированную высоту и стиль.
9.  Создает поле ввода URL `QLineEdit`, устанавливает текст-заполнитель и подключает сигнал `returnPressed` к методу `load_url()`.
10. Создает кнопку "Загрузить" `QPushButton` и подключает сигнал `clicked` к методу `load_url()`.
11. Создает кнопку "Свернуть в трей" `QPushButton`, устанавливает иконку и подсказку, и подключает сигнал `clicked` к методу `hide_to_tray()`.
12. Создает кнопку "Открыть на весь экран" `QPushButton`, устанавливает иконку и подсказку, и подключает сигнал `clicked` к методу `showFullScreen()`.
13. Создает кнопку "Закрыть" `QPushButton`, устанавливает иконку и подсказку, и подключает сигнал `clicked` к методу `hide_to_tray()`.
14. Создает горизонтальный `QHBoxLayout` для верхней панели и добавляет виджеты.
15. Создает основной вертикальный `QVBoxLayout` для окна и добавляет верхнюю панель и виджет браузера.
16. Создает центральный виджет `QWidget` и устанавливает основной layout.
17. Создает иконку системного трея `QSystemTrayIcon` и устанавливает иконку.
18. Создает контекстное меню для иконки в трее `QMenu` и добавляет действия "Восстановить" и "Выход".
19. Подключает сигналы `triggered` действий "Восстановить" и "Выход" к соответствующим методам.
20. Устанавливает контекстное меню для иконки в трее и показывает иконку.
21. Создает меню "Сервисы Google" `QMenu` и добавляет действия для различных сервисов Google.
22. Подключает сигналы `triggered` действий к методу `load_url()` с соответствующими URL.
23. Создает меню "Выбор модели" `QMenu` и добавляет действия для различных моделей ИИ.
24. Подключает сигналы `triggered` действий к методу `load_url()` с соответствующими URL.
25. Создает кнопки для открытия меню "Сервисы Google" и "Выбор модели" и устанавливает меню.
26. Добавляет кнопки для открытия меню на верхнюю панель.

**Примеры**:

```python
window = AssistantMainWindow()
window.show()
```

### `ask_for_browser`

```python
def ask_for_browser(self):
    """Запрашивает у пользователя выбор браузера по умолчанию.

    Returns:
        str: Выбор пользователя или None, если пользователь не сделал выбор.
    """
    ...
```

**Назначение**: Запрашивает у пользователя выбор браузера по умолчанию из списка доступных вариантов.

**Параметры**:

*   `self` (AssistantMainWindow): Экземпляр класса `AssistantMainWindow`.

**Возвращает**:

*   `str`: Выбор пользователя (Chrome, Firefox или Edge) или `None`, если пользователь не сделал выбор.

**Вызывает исключения**:

*   Нет.

**Внутренние функции**: Отсутствуют.

**Как работает функция**:

1.  Определяет список доступных браузеров `choices`.
2.  Использует `QMessageBox.getItem()` для отображения диалогового окна с вариантами выбора.
3.  Если пользователь выбрал браузер и нажал "OK", возвращает выбор пользователя.
4.  В противном случае возвращает `None`.

**Примеры**:

```python
browser_choice = self.ask_for_browser()
if browser_choice == 'Chrome':
    print("Выбран Chrome")
```

### `load_url`

```python
def load_url(self, url: str = None):
    """Загружает URL в виджет браузера.

    Args:
        url (str, optional): URL для загрузки. Если не указан, используется URL из поля ввода.
    """
    ...
```

**Назначение**: Загружает указанный URL в виджет браузера `QWebEngineView`.

**Параметры**:

*   `self` (AssistantMainWindow): Экземпляр класса `AssistantMainWindow`.
*   `url` (str, optional): URL для загрузки. Если не указан, URL берется из поля ввода `url_input`. По умолчанию `None`.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   Нет.

**Внутренние функции**: Отсутствуют.

**Как работает функция**:

1.  Если `url` не указан, получает URL из поля ввода `url_input`.
2.  Если URL не пустой, проверяет, начинается ли он с "http".
3.  Если URL не начинается с "http", добавляет "http://" в начало URL.
4.  Создает объект `QUrl` из URL и устанавливает его в виджет браузера `browser` с помощью метода `setUrl()`.

**Примеры**:

```python
self.load_url("https://www.google.com")  # Загрузка URL напрямую
self.load_url()  # Загрузка URL из поля ввода
```

### `hide_to_tray`

```python
def hide_to_tray(self):
    """Скрывает окно приложения в системный трей."""
    ...
```

**Назначение**: Скрывает главное окно приложения и оставляет иконку в системном трее.

**Параметры**:

*   `self` (AssistantMainWindow): Экземпляр класса `AssistantMainWindow`.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   Нет.

**Внутренние функции**: Отсутствуют.

**Как работает функция**:

1.  Вызывает метод `hide()` для скрытия главного окна.

**Примеры**:

```python
self.hide_to_tray()
```

### `quit_app`

```python
def quit_app(self):
    """Выходит из приложения."""
    ...
```

**Назначение**: Завершает работу приложения.

**Параметры**:

*   `self` (AssistantMainWindow): Экземпляр класса `AssistantMainWindow`.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   Нет.

**Внутренние функции**: Отсутствуют.

**Как работает функция**:

1.  Скрывает иконку из системного трея с помощью `self.tray_icon.hide()`.
2.  Завершает работу приложения с помощью `QApplication.quit()`.

**Примеры**:

```python
self.quit_app()
```

### `closeEvent`

```python
def closeEvent(self, event):
    """Обработчик события закрытия окна.

    Args:
        event: Событие закрытия окна.
    """
    ...
```

**Назначение**: Переопределяет обработчик события закрытия окна, чтобы вместо закрытия окна скрывать его в системный трей.

**Параметры**:

*   `self` (AssistantMainWindow): Экземпляр класса `AssistantMainWindow`.
*   `event`: Событие закрытия окна.

**Возвращает**:

*   `None`

**Вызывает исключения**:

*   Нет.

**Внутренние функции**: Отсутствуют.

**Как работает функция**:

1.  Игнорирует событие закрытия окна с помощью `event.ignore()`.
2.  Вызывает метод `hide_to_tray()` для скрытия окна в системный трей.

**Примеры**:

```python
# Пример использования (не требуется вызывать напрямую, вызывается автоматически при закрытии окна)
```

## Запуск приложения

При запуске модуля `main.py` создается экземпляр класса `QApplication`, создается и отображается главное окно `AssistantMainWindow`, и запускается цикл обработки событий приложения.
```python
if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setQuitOnLastWindowClosed(False)  # Чтобы приложение оставалось в трее

    window = AssistantMainWindow()
    window.show()

    sys.exit(app.exec())
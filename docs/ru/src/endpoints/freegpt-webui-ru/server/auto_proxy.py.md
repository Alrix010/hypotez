# Модуль для автоматического обновления прокси-серверов

## Обзор

Модуль предназначен для автоматического получения и тестирования списка прокси-серверов, а также для поддержания списка рабочих прокси-серверов в актуальном состоянии. Это позволяет использовать прокси для запросов, обходя ограничения доступа и обеспечивая анонимность.

## Подробней

Данный модуль является частью проекта `hypotez` и отвечает за автоматическое получение, тестирование и обновление списка рабочих прокси-серверов. Он использует библиотеку `requests` для получения списка прокси с веб-сайта, а также многопоточность для быстрой проверки работоспособности каждого прокси. Список рабочих прокси хранится в глобальной переменной `working_proxies` и может быть использован другими модулями проекта для выполнения запросов через прокси.
Модуль состоит из нескольких функций, которые выполняют следующие задачи:

- Получение списка прокси-серверов из внешнего источника.
- Тестирование каждого прокси-сервера на работоспособность.
- Добавление рабочих прокси-серверов в глобальный список.
- Удаление нерабочих прокси-серверов из глобального списка.
- Обновление списка рабочих прокси-серверов через заданный интервал времени.
- Получение случайного рабочего прокси-сервера из списка.

## Функции

### `fetch_proxies`

```python
def fetch_proxies() -> list:
    """Получает список прокси-серверов с веб-сайта proxyscrape.com.

    Returns:
        list: Список прокси-серверов в формате "IP:Port".
    """
```

**Назначение**: Получает список прокси-серверов с веб-сайта `www.proxy-list.download`.

**Параметры**:
- Нет.

**Возвращает**:
- `list`: Список прокси-серверов в формате "IP:Port". Если запрос не удался, возвращает пустой список.

**Как работает функция**:

1.  Функция отправляет GET-запрос на URL `https://www.proxy-list.download/api/v1/get?type=http`.
2.  Если статус код ответа равен 200, функция разделяет текст ответа по символам `\r\n` и возвращает полученный список, удаляя последний элемент.
3.  Если статус код ответа не равен 200, функция выводит сообщение об ошибке и возвращает пустой список.

```
A: Отправка GET-запроса на URL
|
B: Проверка статус кода ответа
|
C: Разделение текста ответа и возврат списка прокси или возврат пустого списка
```

**Примеры**:

```python
proxies = fetch_proxies()
if proxies:
    print(f"Получено {len(proxies)} прокси-серверов.")
else:
    print("Не удалось получить список прокси-серверов.")
```

### `test_proxy`

```python
def test_proxy(proxy: str, prompt: str, timeout: int):
    """Проверяет работоспособность заданного прокси-сервера с использованием заданного запроса и времени ожидания.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
        prompt (str): Тестовый запрос для проверки.
        timeout (int): Максимальное время ожидания в секундах.
    """
```

**Назначение**: Проверяет работоспособность прокси-сервера, отправляя тестовый запрос.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".
- `prompt` (str): Тестовый запрос для проверки.
- `timeout` (int): Максимальное время ожидания в секундах.

**Как работает функция**:

1.  Функция измеряет время выполнения тестового запроса.
2.  Если время выполнения запроса меньше заданного таймаута, функция выводит сообщение об успешной проверке прокси и добавляет его в список рабочих прокси.
3.  Если во время выполнения запроса возникает исключение, функция игнорирует его.

```
A: Измерение времени выполнения тестового запроса
|
B: Проверка времени выполнения запроса на соответствие таймауту
|
C: Добавление прокси в список рабочих прокси или игнорирование исключения
```

**Примеры**:

```python
test_proxy("127.0.0.1:8080", "Test", 5)
```

### `add_working_proxy`

```python
def add_working_proxy(proxy: str):
    """Добавляет рабочий прокси-сервер в глобальный список working_proxies.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
    """
```

**Назначение**: Добавляет прокси-сервер в глобальный список рабочих прокси-серверов.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:

1.  Функция добавляет прокси в глобальный список `working_proxies`.

```
A: Добавление прокси в глобальный список working_proxies
```

**Примеры**:

```python
add_working_proxy("127.0.0.1:8080")
```

### `remove_proxy`

```python
def remove_proxy(proxy: str):
    """Удаляет прокси-сервер из глобального списка working_proxies.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
    """
```

**Назначение**: Удаляет прокси-сервер из глобального списка рабочих прокси-серверов.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:

1.  Функция проверяет, присутствует ли прокси в глобальном списке `working_proxies`.
2.  Если прокси присутствует, функция удаляет его из списка.

```
A: Проверка наличия прокси в глобальном списке working_proxies
|
B: Удаление прокси из списка, если он присутствует
```

**Примеры**:

```python
remove_proxy("127.0.0.1:8080")
```

### `get_working_proxies`

```python
def get_working_proxies(prompt: str, timeout: int = 5):
    """Получает и тестирует прокси-серверы, добавляя рабочие прокси в глобальный список working_proxies.

    Args:
        prompt (str): Тестовый запрос для проверки.
        timeout (int, optional): Максимальное время ожидания в секундах. По умолчанию 5.
    """
```

**Назначение**: Получает список прокси-серверов и тестирует их, добавляя рабочие прокси в глобальный список `working_proxies`.

**Параметры**:
- `prompt` (str): Тестовый запрос для проверки.
- `timeout` (int, optional): Максимальное время ожидания в секундах. По умолчанию 5.

**Как работает функция**:

1.  Функция получает список прокси-серверов с помощью функции `fetch_proxies`.
2.  Для каждого прокси-сервера создается отдельный поток, который выполняет функцию `test_proxy` для проверки работоспособности прокси.
3.  Функция ожидает завершения всех потоков.

```
A: Получение списка прокси-серверов
|
B: Создание потоков для тестирования каждого прокси-сервера
|
C: Ожидание завершения всех потоков
```

**Примеры**:

```python
get_working_proxies("What is the capital of France?", timeout=10)
```

### `update_working_proxies`

```python
def update_working_proxies():
    """Непрерывно обновляет глобальный список working_proxies рабочими прокси-серверами."""
```

**Назначение**: Непрерывно обновляет глобальный список `working_proxies` рабочими прокси-серверами.

**Как работает функция**:

1.  Функция запускается в бесконечном цикле.
2.  На каждой итерации цикла функция очищает глобальный список `working_proxies`.
3.  Функция получает и тестирует прокси-серверы с помощью функции `get_working_proxies`.
4.  Функция выводит сообщение об обновлении прокси.
5.  Функция ожидает 30 минут (1800 секунд) перед следующей итерацией цикла.

```
A: Очистка глобального списка working_proxies
|
B: Получение и тестирование прокси-серверов
|
C: Ожидание 30 минут
```

**Примеры**:

```python
# Запуск обновления прокси в отдельном потоке
import threading
thread = threading.Thread(target=update_working_proxies)
thread.start()
```

### `get_random_proxy`

```python
def get_random_proxy() -> str:
    """Получает случайный рабочий прокси-сервер из глобального списка working_proxies.

    Returns:
        str: Случайный рабочий прокси-сервер в формате "IP:Port".
    """
```

**Назначение**: Получает случайный рабочий прокси-сервер из глобального списка `working_proxies`.

**Параметры**:
- Нет.

**Возвращает**:
- `str`: Случайный рабочий прокси-сервер в формате "IP:Port".

**Как работает функция**:

1.  Функция возвращает случайный элемент из глобального списка `working_proxies`.

```
A: Возврат случайного элемента из глобального списка working_proxies
```

**Примеры**:

```python
proxy = get_random_proxy()
if proxy:
    print(f"Случайный прокси: {proxy}")
else:
    print("Список рабочих прокси пуст.")
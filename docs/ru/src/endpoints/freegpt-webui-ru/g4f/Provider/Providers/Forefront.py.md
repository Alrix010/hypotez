# Модуль для работы с провайдером Forefront
## Обзор

Модуль предоставляет функциональность для взаимодействия с Forefront в качестве поставщика услуг для g4f. Он включает в себя функцию для создания завершений (completions) на основе предоставленной модели и списка сообщений. Модуль также определяет параметры, такие как URL, поддерживаемые модели, поддержку потоковой передачи и необходимость аутентификации.

## Подробней

Этот модуль предназначен для интеграции с Forefront, предоставляя интерфейс для создания запросов к модели gpt-3.5-turbo. Он использует библиотеку `requests` для отправки POST-запросов и обрабатывает потоковый ответ для генерации текста.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """ Функция создает завершение (completion) на основе предоставленной модели и списка сообщений, используя API Forefront.
    
    Args:
        model (str): Имя модели, которую нужно использовать.
        messages (list): Список сообщений, используемых в качестве контекста для создания завершения.
        stream (bool): Флаг, указывающий, следует ли использовать потоковую передачу.
        **kwargs: Дополнительные аргументы.

    Returns:
        Generator[str, None, None]: Генератор токенов из потокового ответа.

    Raises:
        Exception: Если возникает ошибка при отправке запроса или обработке ответа.

    Example:
        >>> messages = [{'content': 'Hello, how are you?'}]
        >>> for token in _create_completion(model='gpt-3.5-turbo', messages=messages, stream=True):
        ...     print(token, end='')
        I am doing well, thank you for asking!
    """
```

**Как работает функция**:

1.  **Подготовка данных**: Функция принимает модель, список сообщений и флаг потоковой передачи в качестве входных данных. Она формирует JSON-объект `json_data`, который включает в себя текст последнего сообщения, а также дополнительные параметры, такие как `action`, `id`, `parentId`, `workspaceId`, `messagePersona`, `model` и `messages`.
2.  **Отправка POST-запроса**: Функция отправляет POST-запрос к адресу `'https://streaming.tenant-forefront-default.knative.chi.coreweave.com/free-chat'` с использованием библиотеки `requests`. Параметр `stream=True` указывает на использование потоковой передачи.
3.  **Обработка потокового ответа**: Функция итерируется по строкам потокового ответа, полученного от сервера. Для каждой строки проверяется наличие подстроки `b'delta'`.
4.  **Извлечение и передача токенов**: Если `b'delta'` присутствует в строке, строка декодируется, разделяется по `'data: '`, преобразуется из JSON-формата и извлекается значение по ключу `'delta'`. Затем этот токен передается через `yield`, что делает функцию генератором.

```
                                     Начало
                                        ↓
        ┌───────────────────────────────────────────────────────────────┐
        │  Подготовка данных: Формирование json_data на основе аргументов  │
        └───────────────────────────────────────────────────────────────┘
                                        ↓
        ┌───────────────────────────────────────────────────────────────┐
        │  Отправка POST-запроса к 'https://streaming.tenant-forefront-default.knative.chi.coreweave.com/free-chat'  │
        │  с параметром stream=True                                     │
        └───────────────────────────────────────────────────────────────┘
                                        ↓
        ┌───────────────────────────────────────────────────────────────┐
        │  Итерация по строкам потокового ответа                        │
        └───────────────────────────────────────────────────────────────┘
                                        ↓
        ┌───────────────────────────────────────────────────────────────┐
        │  Проверка наличия b'delta' в строке                           │
        └───────────────────────────────────────────────────────────────┘
                                        ↓
                       ┌───────────────────YES───────────────────┐
        ┌───────────────V───────────────────────────────────────┐──────────────NO───────┐
        │  Декодирование, разделение и извлечение значения 'delta'  │
        └───────────────┬───────────────────────────────────────┘
                        │
        ┌───────────────V───────────────────────────────────────┐
        │  Передача токена через yield                           │
        └───────────────┬───────────────────────────────────────┘
                        │
                       Выход (генератор)
```

**Примеры**:

```python
messages = [{'content': 'Hello, how are you?'}]
generator = _create_completion(model='gpt-3.5-turbo', messages=messages, stream=True)
for token in generator:
    print(token, end='')
```

### `params`

```python
params = f'g4f.Providers.{os.path.basename(__file__)[:-3]} supports: ' + \
    '(%s)' % ', '.join([f"{name}: {get_type_hints(_create_completion)[name].__name__}" for name in _create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]])
```

**Назначение**: Строка `params` содержит информацию о поддержке параметров функцией `_create_completion`.

**Как работает**:

1.  **Извлечение имени файла**: `os.path.basename(__file__)[:-3]` извлекает имя текущего файла модуля, удаляя последние три символа (расширение `.py`).
2.  **Получение аннотаций типов**: `get_type_hints(_create_completion)` получает словарь, содержащий аннотации типов для параметров функции `_create_completion`.
3.  **Формирование списка параметров**: `_create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]` извлекает имена параметров функции `_create_completion`. Затем формируется строка, содержащая имена параметров и их типы.
4.  **Объединение строки**: Строка `params` формируется путем объединения информации об имени файла и параметрах функции.

**Примеры**:

Строка `params` может иметь вид:

```
'g4f.Providers.Forefront supports: (model: str, messages: list, stream: bool)'
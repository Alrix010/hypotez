# Модуль `Bard.py`

## Обзор

Модуль `Bard.py` предназначен для взаимодействия с моделью Google Bard. Он использует cookies браузера для аутентификации, формирует запросы к API Bard и возвращает сгенерированный контент.

## Подробней

Модуль предоставляет функцию `_create_completion`, которая принимает текстовый запрос и возвращает ответ от модели Bard. Он использует библиотеку `browser_cookie3` для получения cookies аутентификации из браузера Chrome, формирует POST-запрос к API Bard и обрабатывает полученный ответ.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """Функция отправляет запрос к Google Bard и возвращает сгенерированный ответ.

    Args:
        model (str): Название используемой модели.
        messages (list): Список сообщений для формирования запроса.
                          Каждое сообщение должно содержать ключи 'role' и 'content'.
        stream (bool): Флаг, указывающий, нужно ли использовать потоковый режим.
        **kwargs: Дополнительные аргументы, такие как proxy.

    Returns:
        generator: Генератор, выдающий части ответа от модели Bard.

    Raises:
        Exception: Если возникает ошибка при взаимодействии с API Bard.

    Принцип работы:
    - Извлекает cookie '__Secure-1PSID' из браузера Chrome для аутентификации.
    - Форматирует список сообщений в строку для отправки в запросе.
    - Определяет, использовать ли прокси.
    - Инициализирует переменные `snlm0e`, `conversation_id`, `response_id` и `choice_id`.
    - Создает сессию requests для отправки запросов.
    - Устанавливает заголовки запроса, включая cookie и User-Agent.
    - Извлекает значение `SNlM0e` из ответа на GET-запрос к главной странице Bard, если оно еще не определено.
    - Формирует параметры запроса, включая случайный `_reqid`.
    - Формирует данные запроса в формате JSON, включая отформатированный запрос (`prompt`) и идентификаторы контекста.
    - Отправляет POST-запрос к API Bard с использованием сформированных данных и параметров.
    - Обрабатывает ответ, извлекая данные чата из JSON.
    - Генерирует части ответа, если данные чата присутствуют, иначе генерирует сообщение об ошибке.

    Внутренние функции:
        Функция не содержит внутренних функций.

    Примеры:
        messages = [
            {'role': 'user', 'content': 'Напиши короткий стих о весне.'},
        ]
        for response_part in _create_completion(model='Palm2', messages=messages, stream=False):
            print(response_part)
    """
```
## Переменные

- `url (str)`: URL-адрес сервиса Google Bard (`https://bard.google.com`).
- `model (list)`: Список поддерживаемых моделей (`['Palm2']`).
- `supports_stream (bool)`: Флаг, указывающий на поддержку потокового режима (в данном случае `False`).
- `needs_auth (bool)`: Флаг, указывающий на необходимость аутентификации (в данном случае `True`).
- `params (str)`: Строка, содержащая информацию о поддержке параметров функцией `_create_completion`.

## Параметры

- `model`: Название используемой модели.
- `messages`: Список сообщений для формирования запроса.
- `stream`: Флаг, указывающий, нужно ли использовать потоковый режим.
- `**kwargs`: Дополнительные аргументы, такие как `proxy`.
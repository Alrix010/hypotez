# Модуль GetGpt для G4F Provider

## Обзор

Модуль `GetGpt.py` является частью проекта `hypotez` и предоставляет функциональность для взаимодействия с моделью `gpt-3.5-turbo` через API `chat.getgpt.world`. Он включает в себя функции для шифрования данных, отправки запросов и обработки ответов в потоковом режиме.

## Подробней

Этот модуль предназначен для обеспечения связи с API `chat.getgpt.world`, который предоставляет доступ к модели `gpt-3.5-turbo`. Модуль использует шифрование AES для защиты данных, отправляемых в запросах. Он также поддерживает потоковую передачу данных, что позволяет получать ответы от сервера частями, улучшая отзывчивость.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """Создает запрос к API для получения завершения текста.

    Args:
        model (str): Идентификатор используемой модели.
        messages (list): Список сообщений для отправки в запросе.
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
        **kwargs: Дополнительные параметры запроса (frequency_penalty, max_tokens, presence_penalty, temperature, top_p).

    Returns:
        Generator[str, None, None]: Генератор, выдающий части завершенного текста.

    Как работает функция:
    1. Определяет внутреннюю функцию `encrypt` для шифрования данных.
    2. Определяет внутреннюю функцию `pad_data` для дополнения данных до размера блока AES.
    3. Формирует заголовки запроса.
    4. Создает JSON-данные запроса, включая параметры модели, сообщения и UUID.
    5. Шифрует JSON-данные с использованием функции `encrypt`.
    6. Отправляет POST-запрос к API `chat.getgpt.world/api/chat/stream` с зашифрованными данными.
    7. Итерируется по строкам ответа, декодирует JSON и извлекает содержимое, выдавая его как часть завершенного текста.

    Внутренние функции:

    ### `encrypt`
    ```python
    def encrypt(e):
        """Шифрует предоставленные данные с использованием AES.

        Args:
            e (str): Данные для шифрования.

        Returns:
            str: Зашифрованные данные в шестнадцатеричном формате, дополненные случайными векторами инициализации.

        Как работает функция:
        1. Генерирует случайные векторы инициализации `t` и `n`.
        2. Преобразует входные данные `e` в байты.
        3. Создает объект шифра AES в режиме CBC с использованием `t` в качестве ключа и `n` в качестве вектора инициализации.
        4. Дополняет данные с использованием функции `pad_data`.
        5. Шифрует дополненные данные.
        6. Возвращает зашифрованные данные в шестнадцатеричном формате, объединенные с векторами инициализации.
        """
    ```

    ### `pad_data`
    ```python
    def pad_data(data: bytes) -> bytes:
        """Дополняет данные до размера блока AES.

        Args:
            data (bytes): Данные для дополнения.

        Returns:
            bytes: Дополненные данные.

        Как работает функция:
        1. Вычисляет размер дополнения, необходимого для достижения размера блока AES.
        2. Создает байтовую строку, содержащую символы дополнения, каждый из которых представляет размер дополнения.
        3. Добавляет строку дополнения к данным.
        4. Возвращает дополненные данные.
        """
    ```

    ```mermaid
    graph TD
        A[Создание заголовков запроса] --> B(Создание JSON данных);
        B --> C{Шифрование JSON данных};
        C --> D[Отправка POST запроса к API];
        D --> E{Обработка ответа};
        E --> F{Извлечение и выдача содержимого};
    ```

    Примеры:

    ```python
    # Пример использования (необходимо настроить окружение)
    # messages = [{"role": "user", "content": "Hello, how are you?"}]
    # for chunk in _create_completion(model='gpt-3.5-turbo', messages=messages, stream=True):
    #     print(chunk, end='')
    ```
    """
```

### `params`

```python
params = f'g4f.Providers.{os.path.basename(__file__)[:-3]} supports: ' + \
    '(%s)' % ', '.join(
        [f'{name}: {get_type_hints(_create_completion)[name].__name__}' for name in _create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]])
```

Строка `params` формирует строку, содержащую информацию о поддерживаемых параметрах функции `_create_completion`.

**Как работает**:

1.  Определяет базовое имя файла текущего модуля, удаляя расширение `.py`.
2.  Формирует строку, включающую имя провайдера (`g4f.Providers.<имя_файла>`) и список поддерживаемых параметров.
3.  Для каждого параметра функции `_create_completion` извлекает его имя и тип, используя `get_type_hints`.
4.  Объединяет имена и типы параметров в строку, разделенную запятыми.

## Переменные

### `url`

```python
url = 'https://chat.getgpt.world/'
```

`url` (str): URL-адрес API `chat.getgpt.world`.

### `model`

```python
model = ['gpt-3.5-turbo']
```

`model` (list): Список поддерживаемых моделей (в данном случае, только `gpt-3.5-turbo`).

### `supports_stream`

```python
supports_stream = True
```

`supports_stream` (bool): Флаг, указывающий, поддерживает ли провайдер потоковую передачу данных.

### `needs_auth`

```python
needs_auth = False
```

`needs_auth` (bool): Флаг, указывающий, требуется ли аутентификация для использования провайдера.
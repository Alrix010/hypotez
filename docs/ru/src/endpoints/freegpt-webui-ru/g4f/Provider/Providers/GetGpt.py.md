# Модуль `GetGpt.py`

## Обзор

Модуль `GetGpt.py` предоставляет функциональность для взаимодействия с сервисом `chat.getgpt.world` с использованием модели `gpt-3.5-turbo`. Он включает в себя функции для шифрования данных, отправки запросов и получения ответов в потоковом режиме. Модуль предназначен для использования в проекте `hypotez` для обеспечения взаимодействия с указанным сервисом.

## Подробней

Модуль содержит функции для шифрования данных перед отправкой на сервер `chat.getgpt.world`, а также для обработки потоковых ответов, возвращаемых сервером. Он использует библиотеку `requests` для отправки HTTP-запросов и библиотеку `Crypto` для шифрования данных.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """
    Функция создает запрос к сервису chat.getgpt.world и возвращает ответ в потоковом режиме.

    Args:
        model (str): Идентификатор модели, используемой для генерации текста.
        messages (list): Список сообщений, отправляемых в запросе.
        stream (bool): Флаг, указывающий, следует ли возвращать ответ в потоковом режиме.
        **kwargs: Дополнительные параметры запроса.

    Returns:
        Generator[str, None, None]: Генератор, возвращающий части ответа от сервера.

    Raises:
        requests.exceptions.RequestException: В случае ошибки при отправке запроса.

    Внутренние функции:
        encrypt(e: str) -> str: Шифрует входную строку `e` с использованием AES-шифрования.
        pad_data(data: bytes) -> bytes: Дополняет данные до размера блока AES.

    Как работает функция:
    - Функция принимает модель, список сообщений и флаг потоковой передачи в качестве входных данных.
    - Внутри функция определяет две внутренние функции: `encrypt` и `pad_data`.
    - `encrypt` шифрует входную строку с использованием AES-шифрования.
    - `pad_data` дополняет данные до размера блока AES.
    - Функция создает заголовки, включая тип контента, реферер и строку пользовательского агента.
    - Функция создает полезную нагрузку данных, включая сообщения, параметры частоты, максимальные токены, модель, штрафы за присутствие, температуру, верхний p и идентификатор UUID.
    - Функция отправляет POST-запрос в конечную точку потока чата с зашифрованными данными.
    - Функция перебирает строки ответа и извлекает содержимое из каждой строки.
    - Функция создает генератор, который возвращает части ответа с сервера.
    """
```

#### Внутренняя функция `encrypt`

```python
def encrypt(e: str) -> str:
        """
        Шифрует строку с использованием AES-шифрования.

        Args:
            e (str): Строка для шифрования.

        Returns:
            str: Зашифрованная строка в шестнадцатеричном формате.

        Как работает функция:
            - Генерирует случайные значения для ключа `t` и инициализирующего вектора `n`.
            - Создает шифр AES в режиме CBC, используя ключ `t` и инициализирующий вектор `n`.
            - Дополняет входные данные до размера блока AES с помощью функции `pad_data`.
            - Шифрует дополненные данные с использованием шифра AES.
            - Возвращает зашифрованный текст, ключ и инициализирующий вектор в шестнадцатеричном формате.
        """
```

#### Внутренняя функция `pad_data`

```python
def pad_data(data: bytes) -> bytes:
    """
    Дополняет данные до размера блока AES.

    Args:
        data (bytes): Данные для дополнения.

    Returns:
        bytes: Дополненные данные.

    Как работает функция:
        - Определяет размер блока AES.
        - Вычисляет размер дополнения, необходимого для достижения размера блока.
        - Создает байтовую строку, содержащую размер дополнения, повторенный нужное количество раз.
        - Добавляет дополнение к данным.
        - Возвращает дополненные данные.
    """
```

**Пример использования**:

```python
messages = [{"role": "user", "content": "Hello, how are you?"}]
for chunk in _create_completion(model="gpt-3.5-turbo", messages=messages, stream=True):
    print(chunk, end="")
```

## Переменные

### `url`

```python
url = 'https://chat.getgpt.world/'
```

URL-адрес сервиса, с которым происходит взаимодействие.

### `model`

```python
model = ['gpt-3.5-turbo']
```

Список поддерживаемых моделей. В данном случае, только `gpt-3.5-turbo`.

### `supports_stream`

```python
supports_stream = True
```

Флаг, указывающий, что провайдер поддерживает потоковый режим.

### `needs_auth`

```python
needs_auth = False
```

Флаг, указывающий, требуется ли аутентификация для доступа к провайдеру.

### `params`

```python
params = f'g4f.Providers.{os.path.basename(__file__)[:-3]} supports: ' + \
    '(%s)' % ', '.join(\
        [f'{name}: {get_type_hints(_create_completion)[name].__name__}' for name in _create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]])
```

Строка, содержащая информацию о поддерживаемых параметрах функции `_create_completion`.
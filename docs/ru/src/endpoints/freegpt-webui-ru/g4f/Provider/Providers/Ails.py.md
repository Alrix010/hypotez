# Документация модуля `Ails.py`

## Обзор

Модуль предоставляет реализацию провайдера Ails для взаимодействия с AI-сервисом `ai.ls`. Он включает в себя функции для создания запросов к API, форматирования данных и обработки ответов. Модуль поддерживает потоковую передачу данных и требует настройки авторизации.

## Подробней

Модуль содержит функции для взаимодействия с AI-сервисом `ai.ls`. Он включает в себя функции для создания запросов к API, форматирования данных и обработки ответов. В частности, модуль использует хеширование для обеспечения безопасности запросов, форматирует временные метки и создает JSON-данные для отправки.

## Классы

### `Utils`

**Описание**: Класс `Utils` содержит статические методы для выполнения различных вспомогательных операций, таких как хеширование данных и форматирование временных меток.

#### Методы класса

#### `hash`

```python
def hash(json_data: Dict[str, str]) -> sha256:
    """
    Функция вычисляет SHA256-хеш на основе предоставленных JSON-данных.

    Args:
        json_data (Dict[str, str]): Словарь, содержащий данные для хеширования.

    Returns:
        sha256: SHA256-хеш, представленный в виде шестнадцатеричной строки.
    """
    ...
```

**Назначение**: Вычисляет SHA256-хеш на основе предоставленных JSON-данных.

**Параметры**:
- `json_data` (Dict[str, str]): Словарь, содержащий данные для хеширования. Ожидается наличие ключей `t` и `m`.

**Возвращает**:
- `sha256`: SHA256-хеш, представленный в виде шестнадцатеричной строки.

**Как работает функция**:
Функция принимает словарь `json_data`, содержащий данные для хеширования. Извлекает значения по ключам `t` (timestamp) и `m` (message). Формирует строку `base_string`, объединяя извлеченные значения с фиксированной строкой и длиной сообщения. Затем вычисляет SHA256-хеш от полученной строки `base_string` с использованием секретного ключа `secretKey`.

#### `format_timestamp`

```python
def format_timestamp(timestamp: int) -> str:
    """
    Функция форматирует временную метку, изменяя последнее число в зависимости от его четности.

    Args:
        timestamp (int): Временная метка для форматирования.

    Returns:
        str: Отформатированная временная метка в виде строки.
    """
    ...
```

**Назначение**: Форматирует временную метку, изменяя последнее число в зависимости от его четности.

**Параметры**:
- `timestamp` (int): Временная метка для форматирования.

**Возвращает**:
- `str`: Отформатированная временная метка в виде строки.

**Как работает функция**:
Функция принимает целое число `timestamp` в качестве аргумента. Вычисляет остаток от деления `timestamp` на 10, чтобы получить последнее число `n`. Если `n` четное, к нему прибавляется 1, иначе `r` остается равным `n`. В конце функция вычитает `n` из исходной временной метки и добавляет `r`, преобразуя результат в строку.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, temperature: float = 0.6, stream: bool = False, **kwargs):
    """
    Функция создает запрос к API для получения завершения текста.

    Args:
        model (str): Идентификатор модели для использования.
        messages (list): Список сообщений для отправки в запросе.
        temperature (float, optional): Температура для контроля случайности ответов. По умолчанию 0.6.
        stream (bool, optional): Флаг, указывающий на необходимость потоковой передачи данных. По умолчанию False.
        **kwargs: Дополнительные параметры.

    Returns:
        Generator[str, None, None]: Генератор токенов завершения текста.
    """
    ...
```

**Назначение**: Создает запрос к API для получения завершения текста.

**Параметры**:
- `model` (str): Идентификатор модели для использования.
- `messages` (list): Список сообщений для отправки в запросе.
- `temperature` (float, optional): Температура для контроля случайности ответов. По умолчанию 0.6.
- `stream` (bool, optional): Флаг, указывающий на необходимость потоковой передачи данных. По умолчанию `False`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `Generator[str, None, None]`: Генератор токенов завершения текста.

**Как работает функция**:
Функция `_create_completion` создает запрос к API `api.caipacity.com` для получения завершения текста. Она настраивает заголовки запроса, включая авторизацию, идентификатор клиента и тип контента. Формирует параметры запроса, включая флаг полной передачи данных. Генерирует временную метку и подпись с использованием методов класса `Utils`. Создает JSON-данные, объединяя параметры модели, температуру, флаг потоковой передачи данных, сообщения и подпись. Отправляет POST-запрос к API с настроенными заголовками и данными. Итерируется по ответу, извлекая и преобразуя токены завершения текста, после чего возвращает их через генератор.

## Переменные

- `url` (str): URL-адрес AI-сервиса (`https://ai.ls`).
- `model` (str): Идентификатор используемой модели (`gpt-3.5-turbo`).
- `supports_stream` (bool): Флаг, указывающий на поддержку потоковой передачи данных (True).
- `needs_auth` (bool): Флаг, указывающий на необходимость авторизации (False).
- `params` (str): Строка, содержащая информацию о поддерживаемых параметрах функции `_create_completion`.
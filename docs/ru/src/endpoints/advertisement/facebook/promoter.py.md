# Модуль `promoter.py`

## Обзор

Модуль `promoter.py` предназначен для автоматизации процесса продвижения товаров и событий в группах Facebook. Он содержит классы и функции, необходимые для публикации рекламных материалов в различных группах, учитывая языковые и валютные предпочтения, а также избегая повторной публикации одних и тех же материалов.

## Подробнее

Модуль `promoter.py` предоставляет функциональность для продвижения товаров и событий в группах Facebook с использованием WebDriver. Он включает в себя функции для получения URL создания события, класс `FacebookPromoter` для управления процессом продвижения, а также методы для логирования ошибок, обновления данных о продвижении и обработки групп. Модуль также содержит функции для проверки временных интервалов между публикациями и валидации данных группы.

## Классы

### `FacebookPromoter`

**Описание**: Класс `FacebookPromoter` предназначен для продвижения товаров и событий AliExpress в группах Facebook.

**Атрибуты**:
- `d` (Driver): Экземпляр WebDriver для автоматизации браузера.
- `group_file_paths` (str | Path): Пути к файлам, содержащим данные о группах.
- `no_video` (bool): Флаг, указывающий на необходимость отключения видео в постах.
- `promoter` (str): Имя промоутера.

**Методы**:
- `__init__`: Инициализирует промоутер для групп Facebook.
- `promote`: Продвигает категорию или событие в группе Facebook.
- `log_promotion_error`: Логирует ошибку продвижения для категории или события.
- `update_group_promotion_data`: Обновляет данные о продвижении группы новой информацией.
- `process_groups`: Обрабатывает все группы для текущей кампании или продвижения события.
- `get_category_item`: Получает элемент категории для продвижения на основе кампании и промоутера.
- `check_interval`: Проверяет, достаточно ли времени прошло для продвижения этой группы.
- `validate_group`: Проверяет корректность данных группы.

### `__init__`

```python
def __init__(self, d: Driver, promoter: str, group_file_paths: Optional[list[str | Path] | str | Path] = None, no_video: bool = False):
    """ Инициализирует промоутер для Facebook групп.

    Args:
        d (Driver): WebDriver instance for browser automation.
        promoter (str): Имя промоутера.
        group_file_paths (list[str | Path] | str | Path): Список путей к файлам, содержащим данные о группах.
        no_video (bool, optional): Флаг для отключения видео в постах. По умолчанию `False`.
    """
    ...
```

**Назначение**: Инициализация экземпляра класса `FacebookPromoter`.

**Параметры**:
- `d` (Driver): Экземпляр WebDriver для управления браузером.
- `promoter` (str): Имя промоутера.
- `group_file_paths` (Optional[list[str | Path] | str | Path], optional): Список путей к файлам групп или путь к одному файлу. По умолчанию `None`.
- `no_video` (bool, optional): Флаг, указывающий, следует ли отключать видео в рекламных постах. По умолчанию `False`.

**Как работает функция**:
- Функция инициализирует класс `FacebookPromoter`, присваивая значения переданным аргументам. Если `group_file_paths` не указан, то вызывается функция `get_filenames` для получения списка файлов из директории `facebook/groups` в Google Drive. Также инициализируется спиннер для визуализации процесса.

### `promote`

```python
def promote(self, group: SimpleNamespace, item: SimpleNamespace, is_event: bool = False, language: str = None, currency: str = None) -> bool:
    """Продвигает категорию или событие в группе Facebook.

    Args:
        group (SimpleNamespace): Объект, содержащий данные о группе Facebook.
        item (SimpleNamespace): Объект, содержащий данные о продвигаемом товаре или событии.
        is_event (bool, optional): Флаг, указывающий, является ли продвигаемый объект событием. По умолчанию `False`.
        language (str, optional): Язык продвижения. По умолчанию `None`.
        currency (str, optional): Валюта продвижения. По умолчанию `None`.

    Returns:
        bool: `True`, если продвижение прошло успешно, `False` в противном случае.
    """
    ...
```

**Назначение**: Продвижение категории или события в указанной группе Facebook.

**Параметры**:
- `group` (SimpleNamespace): Объект, содержащий информацию о группе Facebook.
- `item` (SimpleNamespace): Объект, содержащий информацию о продвигаемом товаре или событии.
- `is_event` (bool, optional): Флаг, указывающий, является ли продвигаемый объект событием. По умолчанию `False`.
- `language` (str, optional): Язык, на котором нужно продвигать объект. По умолчанию `None`.
- `currency` (str, optional): Валюта, в которой нужно продвигать объект. По умолчанию `None`.

**Как работает функция**:
- Функция проверяет соответствие языка и валюты группы заданным параметрам. Если язык или валюта указаны и не совпадают с языком и валютой группы, функция завершается. Затем, в зависимости от того, является ли продвигаемый объект событием или товаром, вызываются соответствующие функции (`post_event` или `post_message`). Если продвижение прошло успешно, вызывается функция `update_group_promotion_data` для обновления информации о группе.

### `log_promotion_error`

```python
def log_promotion_error(self, is_event: bool, item_name: str):
    """Логирует ошибку продвижения для категории или события.

    Args:
        is_event (bool): Флаг, указывающий, является ли продвигаемый объект событием.
        item_name (str): Название продвигаемого товара или события.
    """
    ...
```

**Назначение**: Логирование ошибок, возникающих в процессе продвижения.

**Параметры**:
- `is_event` (bool): Указывает, является ли продвигаемый элемент событием.
- `item_name` (str): Имя продвигаемого элемента.

**Как работает функция**:
- Функция использует модуль `logger` для записи отладочного сообщения об ошибке, произошедшей во время продвижения.

### `update_group_promotion_data`

```python
def update_group_promotion_data(self, group: SimpleNamespace, item_name: str, is_event: bool = False):
    """Обновляет данные о продвижении группы новой информацией.

    Args:
        group (SimpleNamespace): Объект, содержащий данные о группе Facebook.
        item_name (str): Название продвигаемого товара или события.
        is_event (bool, optional): Флаг, указывающий, является ли продвигаемый объект событием. По умолчанию `False`.
    """
    ...
```

**Назначение**: Обновление информации о продвижении в данных группы.

**Параметры**:
- `group` (SimpleNamespace): Объект группы, содержащий информацию о группе Facebook.
- `item_name` (str): Имя продвигаемого товара или события.
- `is_event` (bool, optional): Флаг, указывающий, является ли продвигаемый объект событием. По умолчанию `False`.

**Как работает функция**:
- Функция обновляет информацию о последнем времени продвижения, а также добавляет название продвигаемого товара или события в список продвинутых категорий или событий группы.

### `process_groups`

```python
def process_groups(self, campaign_name: str = None, events: list[SimpleNamespace] = None, is_event: bool = False, group_file_paths: list[str] = None, group_categories_to_adv: list[str] = ['sales'], language: str = None, currency: str = None):
    """Обрабатывает все группы для текущей кампании или продвижения события.

    Args:
        campaign_name (str, optional): Название кампании. По умолчанию `None`.
        events (list[SimpleNamespace], optional): Список событий для продвижения. По умолчанию `None`.
        is_event (bool, optional): Флаг, указывающий, является ли продвижение событием. По умолчанию `False`.
        group_file_paths (list[str], optional): Список путей к файлам групп. По умолчанию `None`.
        group_categories_to_adv (list[str], optional): Список категорий групп для продвижения. По умолчанию `['sales']`.
        language (str, optional): Язык продвижения. По умолчанию `None`.
        currency (str, optional): Валюта продвижения. По умолчанию `None`.
    """
    ...
```

**Назначение**: Обработка групп для продвижения кампании или событий.

**Параметры**:
- `campaign_name` (str, optional): Название кампании. По умолчанию `None`.
- `events` (list[SimpleNamespace], optional): Список событий для продвижения. По умолчанию `None`.
- `is_event` (bool, optional): Флаг, указывающий, является ли продвижение событием. По умолчанию `False`.
- `group_file_paths` (list[str], optional): Список путей к файлам с информацией о группах. По умолчанию `None`.
- `group_categories_to_adv` (list[str], optional): Список категорий групп для продвижения. По умолчанию `['sales']`.
- `language` (str, optional): Язык продвижения. По умолчанию `None`.
- `currency` (str, optional): Валюта продвижения. По умолчанию `None`.

**Как работает функция**:
- Функция итерируется по файлам групп, загружает информацию о группах, проверяет интервалы между продвижениями, категории групп и статус. Затем выбирает элемент для продвижения (категорию или событие) и выполняет продвижение в группе. После успешного продвижения обновляет данные группы и засыпает на случайное время.

### `get_category_item`

```python
def get_category_item(self, campaign_name: str, group: SimpleNamespace, language: str, currency: str) -> SimpleNamespace:
    """Получает элемент категории для продвижения на основе кампании и промоутера.

    Args:
        campaign_name (str): Название кампании.
        group (SimpleNamespace): Объект, содержащий данные о группе Facebook.
        language (str): Язык продвижения.
        currency (str): Валюта продвижения.

    Returns:
        SimpleNamespace: Объект, содержащий информацию о категории для продвижения.
    """
    ...
```

**Назначение**: Получение элемента категории для продвижения.

**Параметры**:
- `campaign_name` (str): Название кампании.
- `group` (SimpleNamespace): Объект группы, содержащий информацию о группе Facebook.
- `language` (str): Язык продвижения.
- `currency` (str): Валюта продвижения.

**Как работает функция**:
- Функция определяет промоутера и, в зависимости от его значения, выбирает категорию для продвижения. Если промоутер - "aliexpress", вызываются методы класса `AliCampaignEditor` для получения информации о категории и товарах. В противном случае загружается информация о категориях из JSON-файла и выбирается случайная категория для продвижения.

### `check_interval`

```python
def check_interval(self, group: SimpleNamespace) -> bool:
    """Проверяет, достаточно ли времени прошло для продвижения этой группы.

    Args:
        group (SimpleNamespace): Объект, содержащий данные о группе Facebook.

    Returns:
        bool: `True`, если достаточно времени прошло для продвижения группы, `False` в противном случае.
    """
    ...
```

**Назначение**: Проверка интервала времени между продвижениями в группе.

**Параметры**:
- `group` (SimpleNamespace): Объект группы, содержащий информацию о группе Facebook.

**Как работает функция**:
- Функция проверяет, прошло ли достаточно времени с момента последнего продвижения в группе. Если времени прошло недостаточно, возвращается `False`, иначе `True`.

### `validate_group`

```python
def validate_group(self, group: SimpleNamespace) -> bool:
    """Проверяет корректность данных группы.

    Args:
        group (SimpleNamespace): Объект, содержащий данные о группе Facebook.

    Returns:
        bool: `True`, если данные группы корректны, `False` в противном случае.
    """
    ...
```

**Назначение**: Валидация данных группы.

**Параметры**:
- `group` (SimpleNamespace): Объект группы, содержащий информацию о группе Facebook.

**Как работает функция**:
- Функция проверяет наличие необходимых атрибутов (`group_url` и `group_categories`) в объекте группы и возвращает `True`, если они присутствуют, иначе `False`.

## Функции

### `get_event_url`

```python
def get_event_url(group_url: str) -> str:
    """
    Возвращает измененный URL для создания события на Facebook, заменяя `group_id` значением из входного URL.

    Args:
        group_url (str): URL группы Facebook, содержащий `group_id`.

    Returns:
        str: Измененный URL для создания события.
    """
    ...
```

**Назначение**: Формирование URL для создания события в группе Facebook.

**Параметры**:
- `group_url` (str): URL группы Facebook.

**Как работает функция**:
- Функция извлекает `group_id` из URL группы, формирует базовый URL для создания события и добавляет параметры запроса, включая `group_id`. Возвращает полученный URL.
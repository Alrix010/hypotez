# Модуль `ToolBox_n_networks.py`

## Обзор

Модуль содержит класс `neural_networks`, который предоставляет методы для взаимодействия с различными нейронными сетями, такими как FLUX.1-schnell, mistral-large-2407 и gpt-4o-mini. 
Модуль предоставляет защищённые методы для отправки запросов к API этих сетей и обработки ответов.

## Подробней

Этот модуль является частью проекта `hypotez` и предназначен для интеграции с различными нейронными сетями. Он предоставляет удобный интерфейс для отправки запросов к этим сетям и получения результатов. В основном используется для генерации изображений и обработки текстовых запросов.

## Классы

### `neural_networks`

**Описание**: Класс для взаимодействия с различными нейронными сетями.

**Атрибуты**:
- Отсутствуют явные атрибуты, но используются переменные окружения для авторизации в API.

**Методы**:
- `_FLUX_schnell`: Защищённый метод для отправки запросов к нейронной сети FLUX.1-schnell.
- `__mistral_large_2407`: Защищённый метод для отправки запросов к модели mistral-large-2407.
- `_free_gpt_4o_mini`: Защищённый метод для отправки запросов к модели gpt-4o-mini.

### Методы класса

#### `_FLUX_schnell`

```python
def _FLUX_schnell(self, prompt: str, size: list[int, int], seed: int, num_inference_steps: int) -> str|None:
    """
    Отправляет запрос к нейронной сети FLUX.1-schnell для генерации изображения.

    Args:
        prompt (str): Текстовое описание желаемого изображения.
        size (list[int, int]): Размеры изображения в формате [ширина, высота].
        seed (int): Зерно для генерации случайного изображения.
        num_inference_steps (int): Количество шагов для генерации изображения.

    Returns:
        str | None: Объект `Image` в случае успешной генерации, иначе `None`.

    Raises:
        requests.exceptions.RequestException: Если возникает ошибка при отправке запроса.

    Как работает функция:
    - Формирует полезную нагрузку (payload) с параметрами запроса.
    - Отправляет POST-запрос к API FLUX.1-schnell, используя токен авторизации из переменных окружения `HF_TOKEN{i}`.
    - Если запрос успешен (статус код 200), открывает полученное изображение и возвращает его.
    - Пытается отправить запрос несколько раз (до 6 раз), используя разные токены авторизации, если первый запрос не удался.
    - Если ни один из запросов не удался, возвращает None.

    Примеры:
        >>> nn = neural_networks()
        >>> image = nn._FLUX_schnell("A cat", [512, 512], 123, 50)
        >>> if image:
        ...     image.save("cat.png")
    """
    ...
```

#### `__mistral_large_2407`

```python
def __mistral_large_2407(self, prompt: list[dict[str, str]]) -> tuple[str, int, int]|str:
    """
    Отправляет запрос к модели mistral-large-2407 для получения текстового ответа.

    Args:
        prompt (list[dict[str, str]]): Список сообщений для отправки модели.

    Returns:
        tuple[str, int, int] | str: Кортеж, содержащий ответ модели, количество использованных токенов для prompt и completion, в случае успеха.
                                     Возвращает строку с JSON в случае ошибки.

    Raises:
        requests.exceptions.RequestException: Если возникает ошибка при отправке запроса.

    Как работает функция:
    - Формирует полезную нагрузку (payload) с сообщениями для модели.
    - Отправляет POST-запрос к API mistral-large-2407, используя токен авторизации из переменной окружения `MISTRAL_TOKEN`.
    - Преобразует текст ответа в JSON.
    - Возвращает ответ модели, количество использованных токенов для prompt и completion.

    Примеры:
        >>> nn = neural_networks()
        >>> prompt = [{"role": "user", "content": "Hello, how are you?"}]
        >>> response, prompt_tokens, completion_tokens = nn.__mistral_large_2407(prompt)
        >>> print(response)
        >>> print(prompt_tokens, completion_tokens)
    """
    ...
```

#### `_free_gpt_4o_mini`

```python
def _free_gpt_4o_mini(self, prompt: list[dict[str, str]]) -> tuple[str, int, int]|str:
    """
    Отправляет запрос к модели gpt-4o-mini для получения текстового ответа.

    Args:
        prompt (list[dict[str, str]]): Список сообщений для отправки модели.

    Returns:
        tuple[str, int, int] | str: Кортеж, содержащий ответ модели, количество использованных токенов для prompt и completion, в случае успеха.
                                     Возвращает результат `__mistral_large_2407(prompt)` в случае ошибки.

    Raises:
        requests.exceptions.RequestException: Если возникает ошибка при отправке запроса.

    Как работает функция:
    - Формирует полезную нагрузку (payload) с сообщениями для модели.
    - Отправляет POST-запрос к API gpt-4o-mini, используя токен авторизации из переменных окружения `GIT_TOKEN{i}`.
    - Если запрос успешен (статус код 200), преобразует текст ответа в JSON и возвращает ответ модели, количество использованных токенов для prompt и completion.
    - Пытается отправить запрос несколько раз (до 6 раз), используя разные токены авторизации, если первый запрос не удался.
    - Если ни один из запросов не удался, вызывает `__mistral_large_2407(prompt)` и возвращает результат.

    Примеры:
        >>> nn = neural_networks()
        >>> prompt = [{"role": "user", "content": "Translate 'Hello' to Russian"}]
        >>> response, prompt_tokens, completion_tokens = nn._free_gpt_4o_mini(prompt)
        >>> print(response)
    """
    ...
```
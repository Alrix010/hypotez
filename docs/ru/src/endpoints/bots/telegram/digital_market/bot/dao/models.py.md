# Модуль для определения моделей базы данных Telegram-бота цифрового рынка
======================================================================

Модуль содержит определения классов, представляющих таблицы базы данных для Telegram-бота цифрового рынка.
Он использует SQLAlchemy ORM для определения структуры таблиц, связей между ними и типов данных.

## Обзор

Этот модуль определяет модели базы данных, используемые Telegram-ботом цифрового рынка. Он включает классы для пользователей, категорий, продуктов и покупок.  
Модели определены с использованием SQLAlchemy ORM и отражают структуру таблиц в базе данных.

## Подробнее

Модуль предоставляет классы для представления таблиц базы данных, включая пользователей, категории, продукты и покупки.
Определены связи между таблицами для обеспечения целостности данных и упрощения доступа к связанным данным.
Использование SQLAlchemy позволяет абстрагироваться от конкретной СУБД и упрощает работу с базой данных.

## Классы

### `User`

**Описание**: Класс представляет таблицу пользователей в базе данных.

**Наследует**: `Base` (из `bot.dao.database`)

**Атрибуты**:
- `telegram_id` (int): Уникальный идентификатор пользователя в Telegram.
- `username` (str | None): Имя пользователя в Telegram (может отсутствовать).
- `first_name` (str | None): Имя пользователя (может отсутствовать).
- `last_name` (str | None): Фамилия пользователя (может отсутствовать).
- `purchases` (List['Purchase']): Список покупок, связанных с пользователем.

**Методы**:
- `__repr__()`: Возвращает строковое представление объекта `User`.

**Принцип работы**:
Класс `User` представляет таблицу пользователей в базе данных. Атрибуты класса соответствуют полям таблицы.
Связь с классом `Purchase` позволяет получить список покупок, совершенных пользователем.

### `Category`

**Описание**: Класс представляет таблицу категорий товаров в базе данных.

**Наследует**: `Base` (из `bot.dao.database`)

**Атрибуты**:
- `category_name` (str): Название категории.
- `products` (List["Product"]): Список товаров, относящихся к данной категории.

**Методы**:
- `__repr__()`: Возвращает строковое представление объекта `Category`.

**Принцип работы**:
Класс `Category` представляет таблицу категорий товаров в базе данных. Атрибуты класса соответствуют полям таблицы.
Связь с классом `Product` позволяет получить список товаров, принадлежащих к данной категории.

### `Product`

**Описание**: Класс представляет таблицу продуктов в базе данных.

**Наследует**: `Base` (из `bot.dao.database`)

**Атрибуты**:
- `name` (str): Название продукта.
- `description` (str): Описание продукта.
- `price` (int): Цена продукта.
- `file_id` (str | None): Идентификатор файла, связанного с продуктом (может отсутствовать).
- `category_id` (int): Идентификатор категории, к которой относится продукт.
- `hidden_content` (str): Скрытое содержимое, связанное с продуктом.
- `category` (Category): Категория, к которой относится продукт.
- `purchases` (List['Purchase']): Список покупок, включающих данный продукт.

**Методы**:
- `__repr__()`: Возвращает строковое представление объекта `Product`.

**Принцип работы**:
Класс `Product` представляет таблицу продуктов в базе данных. Атрибуты класса соответствуют полям таблицы.
Связи с классами `Category` и `Purchase` позволяют получить категорию продукта и список покупок, включающих данный продукт.

### `Purchase`

**Описание**: Класс представляет таблицу покупок в базе данных.

**Наследует**: `Base` (из `bot.dao.database`)

**Атрибуты**:
- `user_id` (int): Идентификатор пользователя, совершившего покупку.
- `product_id` (int): Идентификатор купленного продукта.
- `price` (int): Цена покупки.
- `payment_type` (str): Тип оплаты.
- `payment_id` (str): Уникальный идентификатор платежа.
- `user` (User): Пользователь, совершивший покупку.
- `product` (Product): Купленный продукт.

**Методы**:
- `__repr__()`: Возвращает строковое представление объекта `Purchase`.

**Принцип работы**:
Класс `Purchase` представляет таблицу покупок в базе данных. Атрибуты класса соответствуют полям таблицы.
Связи с классами `User` и `Product` позволяют получить информацию о пользователе, совершившем покупку, и купленном продукте.

## Методы классов

### `User.__repr__()`

```python
def __repr__(self):
    """
    Возвращает строковое представление объекта `User`.

    Args:
        self (User): Экземпляр класса `User`.

    Returns:
        str: Строковое представление объекта `User`.

    """
    ...
```

### `Category.__repr__()`

```python
def __repr__(self):
    """
    Возвращает строковое представление объекта `Category`.

    Args:
        self (Category): Экземпляр класса `Category`.

    Returns:
        str: Строковое представление объекта `Category`.

    """
    ...
```

### `Product.__repr__()`

```python
def __repr__(self):
    """
    Возвращает строковое представление объекта `Product`.

    Args:
        self (Product): Экземпляр класса `Product`.

    Returns:
        str: Строковое представление объекта `Product`.

    """
    ...
```

### `Purchase.__repr__()`

```python
def __repr__(self):
    """
    Возвращает строковое представление объекта `Purchase`.

    Args:
        self (Purchase): Экземпляр класса `Purchase`.

    Returns:
        str: Строковое представление объекта `Purchase`.

    """
    ...
```

## Примеры

### Создание и использование объектов моделей

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

# Создание движка SQLAlchemy (замените connection_string на вашу строку подключения)
engine = create_engine('sqlite:///:memory:')  

# Создание таблиц в базе данных
Base.metadata.create_all(engine)

# Создание сессии для работы с базой данных
Session = sessionmaker(bind=engine)
session = Session()

# Пример создания пользователя
new_user = User(telegram_id=123456789, username='testuser', first_name='Test', last_name='User')
session.add(new_user)
session.commit()

# Пример создания категории
new_category = Category(category_name='Electronics')
session.add(new_category)
session.commit()

# Пример создания продукта
new_product = Product(name='Smartphone', description='New smartphone model', price=500, category_id=new_category.id)
session.add(new_product)
session.commit()

# Пример создания покупки
new_purchase = Purchase(user_id=new_user.id, product_id=new_product.id, price=500, payment_type='card', payment_id='12345')
session.add(new_purchase)
session.commit()

# Запрос на получение пользователя по telegram_id
user = session.query(User).filter_by(telegram_id=123456789).first()
print(user)

# Запрос на получение продуктов по категории
products = session.query(Product).filter_by(category_id=new_category.id).all()
for product in products:
    print(product)

# Закрытие сессии
session.close()
# Документация для Telegram-бота Digital Market Hook

## Обзор

Этот документ содержит подробное описание проекта `Digital Market Hook` - учебного Telegram-бота для цифрового интернет-магазина. Описаны функциональность бота, используемые технологии, процесс установки и настройки, а также инструкции по использованию.

## Подробнее

`Digital Market Hook` разработан как демонстрационный проект, показывающий возможности создания Telegram-ботов для электронной коммерции. Он включает интеграцию с тремя платежными системами (ЮКасса, Telegram-Stars и Robocassa), админ-панель, профили пользователей и каталог товаров с категориями. Особенностью бота является использование веб-хуков для обеспечения высокой производительности и обработки платежей.

## Содержание

1.  [Описание](#описание)
2.  [Технологии](#технологии)
3.  [Установка](#установка)
4.  [Использование](#использование)
5.  [Тестовые данные для оплаты](#тестовые-данные-для-оплаты)
6.  [Автор](#автор)
7.  [Лицензия](#лицензия)
8.  [Демонстрация функционала](#демонстрация-функционала)
9.  [Дополнительная информация](#дополнительная-информация)

## Описание

Бот использует технологию веб-хуков, реализованных через `aiohttp`. Веб-хуки применяются для работы бота и обработки платежей через Robocassa.

Поддерживаются три платежные системы:

*   **ЮKassa**: Интеграция через BotFather.
*   **Telegram-Stars**: Интеграция для платежей в Telegram.
*   **Robocassa**: Прямая интеграция, обрабатываемая через веб-хуки.

## Технологии

В проекте используются следующие технологии:

*   **aiogram** 3.15.0: Асинхронный фреймворк для разработки Telegram-ботов.
*   **aiosqlite** 0.20.0: Асинхронный драйвер для SQLite.
*   **loguru** 0.7.2: Библиотека для продвинутого логирования.
*   **pydantic-settings** 2.7.0: Управление настройками с использованием Pydantic.
*   **SQLAlchemy** 2.0.35: SQL-библиотека и ORM для Python.
*   **pydantic** >=2.4.1,<2.10: Библиотека для валидации данных и управления настройками.
*   **alembic** 1.14.0: Инструмент для управления миграциями базы данных.
*   **aiohttp** 3.10.11: Веб-сервер для обслуживания веб-хуков.

## Установка

1.  Клонируйте репозиторий:

    ```bash
    git clone https://github.com/Yakvenalex/DigitalMarketHookBot.git
    ```

2.  Перейдите в директорию проекта:

    ```bash
    cd DigitalMarketHookBot
    ```

3.  Создайте и активируйте виртуальное окружение:

    ```bash
    python -m venv venv
    source venv/bin/activate  # Для Windows: venv\Scripts\activate
    ```

4.  Получите токен бота через [@BotFather](https://t.me/BotFather).
5.  Получите платежный токен ЮКассы через [@BotFather](https://t.me/BotFather) (подойдет тестовый).
6.  Зарегистрируйтесь в ЮКассе и Робокассе, создайте магазины для обработки платежей.
7.  Установите зависимости:

    ```bash
    pip install -r requirements.txt
    ```

8.  Создайте файл `.env` в корне проекта:

    ```
    BOT_TOKEN=ВАШ_ТОКЕН
    ADMIN_IDS=[ADMIN_TG1, ADMIN_TG2, ADMIN_TG3]
    PROVIDER_TOKEN=ТОКЕН_Ю_КАССЫ
    SITE_URL=ВЕБ_САЙТ_ДЛЯ_ХУКОВ
    SITE_HOST=0.0.0.0
    SITE_PORT=8000
    MRH_LOGIN=ЛОГИН_С_РОБОКАССЫ
    MRH_PASS_1=ПАРОЛЬ_1_С_РОБОКАССЫ
    MRH_PASS_2=ПАРОЛЬ_2_С_РОБОКАССЫ
    IN_TEST=1/0
    ```

    Параметр `IN_TEST` со значением `1` включает тестовый режим для ROBOCASSA, `0` — боевой режим.

9.  Для работы с вебхуками необходимо активировать туннель на локальной машине, например, через **Ngrok**:

    *   Скачайте Ngrok с [официального сайта](https://ngrok.com/download).
    *   Запустите Ngrok, указав локальный порт вашего сервера (например, 8000):

        ```bash
        ngrok http 8000
        ```

    *   Ngrok предоставит вам временный публичный URL, который вы можете использовать в качестве `SITE_URL`.

10. Запустите бота:

    ```bash
    python -m bot.main
    ```

## Использование

После запуска бота, взаимодействуйте с ним в Telegram. Бот предоставляет функциональность цифрового магазина с тестовой оплатой через ЮKassa, Робокасса и Telegram Stars. При оплате Telegram Stars реализован автоматический возврат звезд.

## Тестовые данные для оплаты

*   **Карта:** 1111 1111 1111 1026
*   **Годен до:** 12/26
*   **CVC-код:** 000

## Автор

**Алексей Яковенко** [Telegram](https://t.me/yakvenalexx) — разработчик данного учебного проекта.

## Лицензия

Этот проект распространяется под лицензией MIT.

## Демонстрация функционала

Для ознакомления с функционалом бота доступны следующие материалы:

1.  **Полная демонстрация функционала**:  
    [Видео-демонстрация проекта](https://rutube.ru/video/f57c1617bd03368611ee8aeb44ccb2e5/), демонстрирующая основные возможности бота, включая оплату через Robokassa.
2.  **Дополнительные оплаты**:  
    [Видео](https://rutube.ru/video/bbf601d7f0dab962ba24cb57df706640/), показывающее обработку дополнительных платежей и взаимодействие с системой оплаты.
3.  **Работающий бот**:  
    [Бот в Telegram](https://t.me/DigitalMarketAiogramHookBot) для личного тестирования функций, включая оплату.

## Дополнительная информация

Рекомендуется изучить исходный код и комментарии в репозитории для более подробного понимания архитектуры проекта.

> **Примечание:** Проект создан в образовательных целях и не предназначен для коммерческого использования без доработки и тестирования.
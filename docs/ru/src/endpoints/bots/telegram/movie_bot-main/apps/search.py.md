# Модуль для выполнения поисковых запросов на Kinopoisk через Google

## Обзор

Модуль `search.py` предназначен для выполнения поисковых запросов на сайте Kinopoisk через поисковую систему Google. Он использует библиотеку `requests` для отправки HTTP-запросов, `BeautifulSoup` для парсинга HTML-ответов и модуль `useragent` для получения случайного User-Agent. Результаты поиска возвращаются в виде словаря с информацией о фильме или сериале.

## Подробнее

Модуль выполняет поиск на сайте Kinopoisk, используя поисковую систему Google, и возвращает наиболее релевантный результат. Он предназначен для использования в Telegram-боте для поиска информации о фильмах и сериалах. Для работы модуля требуется установленное окружение с библиотеками `requests`, `BeautifulSoup4` и `python-dotenv`, а также переменные окружения, заданные в файле `.env`.

## Функции

### `search_query`

```python
def search_query(query: str, type_movie: str = 'series') -> dict | None:
    """ Функция выполняет поисковый запрос на сайте Kinopoisk через Google.

    Args:
        query (str): Поисковый запрос (название фильма или сериала).
        type_movie (str): Тип контента для поиска ('series' или другой). По умолчанию 'series'.

    Returns:
        dict | None: Словарь с информацией о фильме или сериале, включающий ссылку, заголовок и описание.
                     Возвращает `None`, если ничего не найдено.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса.

    """
    def inner_function():
        """ Внутрняя функция  - отсутствует """
        pass
    
    ...
```

**Назначение**: Выполняет поисковый запрос на сайте Kinopoisk через Google.

**Параметры**:
- `query` (str): Поисковый запрос (название фильма или сериала).
- `type_movie` (str): Тип контента для поиска ('series' или другой). По умолчанию 'series'.

**Возвращает**:
- `dict | None`: Словарь с информацией о фильме или сериале, включающий ссылку, заголовок и описание. Возвращает `None`, если ничего не найдено.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при выполнении запроса.

**Как работает функция**:
1. Формирует поисковый запрос для Google, используя переданные параметры `query` и `type_movie`.
2. Отправляет GET-запрос к Google с использованием библиотеки `requests`, подменяя User-Agent для предотвращения блокировки.
3. Обрабатывает HTML-ответ с использованием библиотеки `BeautifulSoup4`.
4. Извлекает из результатов поиска блок, содержащий ссылки на искомый фильм или сериал.
5. Перебирает результаты поиска и извлекает ссылку, заголовок и описание.
6. Проверяет, является ли ссылка ссылкой на Kinopoisk, проверяя, состоит ли предпоследний элемент URL из цифр.
7. Формирует и возвращает словарь с информацией о фильме или сериале.
8. Если ничего не найдено, возвращает `None`.

**Примеры**:

```python
print(search_query('теория большого взрыва'))
# {'link': 'https://w2.kpfr.wiki/series/123456/', 'title': 'Теория большого взрыва - Кинопоиск', 'description': 'Описание сериала...'}

print(search_query('Игра престолов', type_movie='series'))
# {'link': 'https://w2.kpfr.wiki/series/67890/', 'title': 'Игра престолов - Кинопоиск', 'description': 'Описание сериала...'}

print(search_query('Интерстеллар', type_movie='film'))
# {'link': 'https://w2.kpfr.wiki/film/112233/', 'title': 'Интерстеллар - Кинопоиск', 'description': 'Описание фильма...'}
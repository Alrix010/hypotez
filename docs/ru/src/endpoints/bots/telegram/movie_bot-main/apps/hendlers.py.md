# Модуль обработки хэндлеров для Telegram-бота

## Обзор

Модуль `hendlers.py` содержит обработчики (handlers) для различных команд и действий, выполняемых пользователями в Telegram-боте. Он использует библиотеку `aiogram` для обработки входящих сообщений и callback-запросов. Определены состояния (states) для управления диалогом с пользователем при поиске фильмов.

## Подробней

Этот модуль является ключевым компонентом Telegram-бота, поскольку он определяет логику взаимодействия с пользователем. Он обрабатывает команды `/start`, запросы на поиск фильмов и сериалов, а также сохраняет и передает данные между различными состояниями диалога.

## Классы

### `Params`

**Описание**: Класс `Params` представляет собой группу состояний (states) для конечного автомата (FSM), используемого для управления процессом поиска фильма или сериала.

**Наследует**:
- `StatesGroup` из `aiogram.fsm.state`

**Атрибуты**:
- `type_movie` (State): Состояние для хранения типа фильма (фильм или сериал).
- `name` (State): Состояние для хранения названия фильма или сериала.

**Принцип работы**:
Класс `Params` определяет два состояния: `type_movie` и `name`. Эти состояния используются для последовательного получения от пользователя типа фильма (фильм или сериал) и названия фильма. FSM позволяет боту сохранять контекст диалога и запрашивать необходимую информацию шаг за шагом.

## Функции

### `command_start_handler`

```python
async def command_start_handler(message: Message) -> None:
    """Обработчик команды /start.

    Args:
        message (Message): Объект сообщения от пользователя.

    Returns:
        None

    """
    ...
```

**Назначение**: Обрабатывает команду `/start`, отправляет приветственное сообщение пользователю и предлагает начать поиск фильма.

**Параметры**:
- `message` (Message): Объект сообщения, содержащий информацию о сообщении, отправленном пользователем.

**Как работает функция**:
1. Отправляет приветственное сообщение пользователю, используя его полное имя.
2. Предлагает пользователю найти интересующий фильм, отправляя сообщение с клавиатурой `kb.find_movie`.

**Примеры**:
```python
# Пример вызова (обычно вызывается автоматически aiogram при получении команды /start)
# await command_start_handler(message)
```

### `movie_handler`

```python
async def movie_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """Обработчик callback-запроса для начала поиска фильма.

    Args:
        callback (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием диалога.

    Returns:
        None

    """
    ...
```

**Назначение**: Обрабатывает callback-запрос, возникающий при нажатии кнопки "Найти фильм" и переводит пользователя в состояние выбора типа фильма (`Params.type_movie`).

**Параметры**:
- `callback` (CallbackQuery): Объект callback-запроса, содержащий информацию о запросе, отправленном пользователем.
- `state` (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

**Как работает функция**:
1. Устанавливает состояние `Params.type_movie`, чтобы запросить у пользователя тип фильма (фильм или сериал).
2. Редактирует сообщение, отправляя пользователю клавиатуру `kb.choice` с вариантами выбора типа фильма.

**Примеры**:
```python
# Пример вызова (обычно вызывается автоматически aiogram при получении callback-запроса с data == 'new_movies')
# await movie_handler(callback, state)
```

### `series_handler`

```python
async def series_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """Обработчик callback-запроса для выбора типа "сериал".

    Args:
        callback (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием диалога.

    Returns:
        None

    """
    ...
```

**Назначение**: Обрабатывает callback-запрос, возникающий при выборе пользователем типа "сериал", сохраняет этот выбор в FSM и переводит пользователя в состояние ввода названия (`Params.name`).

**Параметры**:
- `callback` (CallbackQuery): Объект callback-запроса, содержащий информацию о запросе, отправленном пользователем.
- `state` (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

**Как работает функция**:
1. Удаляет предыдущее сообщение с вариантами выбора типа фильма.
2. Обновляет данные в FSM, сохраняя `type_movie = 'series'`.
3. Устанавливает состояние `Params.name`, чтобы запросить у пользователя название сериала.
4. Отправляет пользователю сообщение с запросом на ввод названия.

**Примеры**:
```python
# Пример вызова (обычно вызывается автоматически aiogram при получении callback-запроса с data == 'series')
# await series_handler(callback, state)
```

### `film_handler`

```python
async def film_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """Обработчик callback-запроса для выбора типа "фильм".

    Args:
        callback (CallbackQuery): Объект callback-запроса от пользователя.
        state (FSMContext): Объект FSMContext для управления состоянием диалога.

    Returns:
        None

    """
    ...
```

**Назначение**: Обрабатывает callback-запрос, возникающий при выборе пользователем типа "фильм", сохраняет этот выбор в FSM и переводит пользователя в состояние ввода названия (`Params.name`).

**Параметры**:
- `callback` (CallbackQuery): Объект callback-запроса, содержащий информацию о запросе, отправленном пользователем.
- `state` (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

**Как работает функция**:
1. Удаляет предыдущее сообщение с вариантами выбора типа фильма.
2. Обновляет данные в FSM, сохраняя `type_movie = 'film'`.
3. Устанавливает состояние `Params.name`, чтобы запросить у пользователя название фильма.
4. Отправляет пользователю сообщение с запросом на ввод названия.

**Примеры**:
```python
# Пример вызова (обычно вызывается автоматически aiogram при получении callback-запроса с data == 'film')
# await film_handler(callback, state)
```

### `name_handler`

```python
async def name_handler(message: Message, state: FSMContext) -> None:
    """Обработчик сообщения с названием фильма.

    Args:
        message (Message): Объект сообщения от пользователя с названием фильма.
        state (FSMContext): Объект FSMContext для управления состоянием диалога.

    Returns:
        None

    """
    ...
```

**Назначение**: Обрабатывает сообщение с названием фильма, введенным пользователем, выполняет поиск фильма и отправляет результаты пользователю.

**Параметры**:
- `message` (Message): Объект сообщения, содержащий информацию о сообщении, отправленном пользователем.
- `state` (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

**Как работает функция**:
1. Обновляет данные в FSM, сохраняя название фильма.
2. Получает данные из FSM, включая название и тип фильма.
3. Вызывает функцию `search_query` для поиска фильма.
4. Отправляет пользователю сообщение с информацией о запросе (название и тип фильма).
5. Если фильм найден, отправляет информацию о фильме (название, описание, ссылка).
6. Если фильм не найден, отправляет сообщение о том, что фильм не найден.
7. Предлагает пользователю найти новый фильм, отправляя сообщение с клавиатурой `kb.find_movie`.
8. Очищает состояние FSM.

**Внутренние функции**:
- Отсутствуют

**Примеры**:
```python
# Пример вызова (обычно вызывается автоматически aiogram при получении сообщения в состоянии Params.name)
# await name_handler(message, state)
```
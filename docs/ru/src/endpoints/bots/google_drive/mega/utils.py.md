# Модуль `utils.py` для работы с Google Drive MEGA

## Обзор

Модуль содержит набор утилитных функций, необходимых для шифрования, дешифрования и кодирования данных при работе с Google Drive MEGA. Включает функции преобразования данных между различными форматами (например, `a32` в строку, строка в `a32`), шифрования и дешифрования AES, кодирования и декодирования Base64, а также для разбиения размера файла на чанки.

## Подробней

Модуль предоставляет функции для безопасной передачи данных, используя шифрование AES и кодирование Base64. Он также содержит утилиты для работы с данными в формате `a32`, который, вероятно, является специфическим для MEGA. Функции модуля позволяют подготавливать данные к передаче, безопасно передавать их и восстанавливать исходные данные после получения.

## Функции

### `a32_to_str`

```python
def a32_to_str(a):
    """Преобразует массив 32-битных целых чисел в строку байтов.

    Args:
        a (list[int]): Массив 32-битных целых чисел.

    Returns:
        bytes: Строка байтов, полученная из массива `a`.
    """
```

**Назначение**: Преобразует массив 32-битных целых чисел в строку байтов, используя структуру данных.

**Параметры**:
- `a` (list[int]): Массив 32-битных целых чисел.

**Возвращает**:
- `bytes`: Строка байтов, полученная из массива `a`.

**Как работает функция**:
Функция принимает массив 32-битных целых чисел и упаковывает их в строку байтов, используя спецификатор формата `>%dI`, где `%d` - длина массива.

**Примеры**:

```python
a = [1, 2, 3, 4]
result = a32_to_str(a)
print(result)
```

### `aes_cbc_encrypt`

```python
def aes_cbc_encrypt(data, key):
    """Шифрует данные с использованием алгоритма AES в режиме CBC.

    Args:
        data (bytes): Данные для шифрования.
        key (bytes): Ключ шифрования.

    Returns:
        bytes: Зашифрованные данные.
    """
```

**Назначение**: Шифрует данные с использованием алгоритма AES в режиме CBC (Cipher Block Chaining).

**Параметры**:
- `data` (bytes): Данные для шифрования.
- `key` (bytes): Ключ шифрования.

**Возвращает**:
- `bytes`: Зашифрованные данные.

**Как работает функция**:
Функция создает объект шифрования AES с использованием переданного ключа и режима CBC, а затем шифрует переданные данные. Вектор инициализации (IV) заполнен нулями.

**Примеры**:

```python
data = b'Some data to encrypt'
key = b'Sixteen byte key'
result = aes_cbc_encrypt(data, key)
print(result)
```

### `aes_cbc_encrypt_a32`

```python
def aes_cbc_encrypt_a32(data, key):
    """Шифрует данные в формате a32 с использованием алгоритма AES в режиме CBC.

    Args:
        data (list[int]): Данные для шифрования в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        list[int]: Зашифрованные данные в формате a32.
    """
```

**Назначение**: Шифрует данные в формате `a32` с использованием алгоритма AES в режиме CBC.

**Параметры**:
- `data` (list[int]): Данные для шифрования в формате `a32`.
- `key` (list[int]): Ключ шифрования в формате `a32`.

**Возвращает**:
- `list[int]: Зашифрованные данные в формате `a32`.

**Как работает функция**:
Функция сначала преобразует данные и ключ из формата `a32` в строку байтов, затем шифрует данные с помощью `aes_cbc_encrypt` и преобразует зашифрованные данные обратно в формат `a32`.

**Примеры**:

```python
data = [1, 2, 3, 4]
key = [5, 6, 7, 8]
result = aes_cbc_encrypt_a32(data, key)
print(result)
```

### `str_to_a32`

```python
def str_to_a32(b):
    """Преобразует строку байтов в массив 32-битных целых чисел.

    Args:
        b (bytes): Строка байтов.

    Returns:
        tuple[int]: Массив 32-битных целых чисел, полученный из строки `b`.
    """
```

**Назначение**: Преобразует строку байтов в массив 32-битных целых чисел.

**Параметры**:
- `b` (bytes): Строка байтов.

**Возвращает**:
- `tuple[int]`: Массив 32-битных целых чисел, полученный из строки `b`.

**Как работает функция**:
Функция принимает строку байтов, добавляет нулевые байты для дополнения длины до кратной 4, если необходимо, и затем преобразует строку в массив 32-битных целых чисел, используя структуру данных.

**Примеры**:

```python
b = b'some data'
result = str_to_a32(b)
print(result)
```

### `mpi2int`

```python
def mpi2int(s):
    """Преобразует строку, представляющую число MPI, в целое число.

    Args:
        s (bytes): Строка, представляющая число MPI.

    Returns:
        int: Целое число, полученное из строки `s`.
    """
```

**Назначение**: Преобразует строку, представляющую число MPI (Multi-Precision Integer), в целое число.

**Параметры**:
- `s` (bytes): Строка, представляющая число MPI.

**Возвращает**:
- `int`: Целое число, полученное из строки `s`.

**Как работает функция**:
Функция извлекает данные числа MPI из строки, преобразует их в шестнадцатеричный формат и затем в целое число.

**Примеры**:

```python
s = b'\\x00\\x02\\x01\\x00'
result = mpi2int(s)
print(result)
```

### `aes_cbc_decrypt`

```python
def aes_cbc_decrypt(data, key):
    """Дешифрует данные с использованием алгоритма AES в режиме CBC.

    Args:
        data (bytes): Данные для дешифрования.
        key (bytes): Ключ дешифрования.

    Returns:
        bytes: Дешифрованные данные.
    """
```

**Назначение**: Дешифрует данные с использованием алгоритма AES в режиме CBC (Cipher Block Chaining).

**Параметры**:
- `data` (bytes): Данные для дешифрования.
- `key` (bytes): Ключ дешифрования.

**Возвращает**:
- `bytes`: Дешифрованные данные.

**Как работает функция**:
Функция создает объект дешифрования AES с использованием переданного ключа и режима CBC, а затем дешифрует переданные данные. Вектор инициализации (IV) заполнен нулями.

**Примеры**:

```python
data = b'encrypted data'
key = b'Sixteen byte key'
result = aes_cbc_decrypt(data, key)
print(result)
```

### `aes_cbc_decrypt_a32`

```python
def aes_cbc_decrypt_a32(data, key):
    """Дешифрует данные в формате a32 с использованием алгоритма AES в режиме CBC.

    Args:
        data (list[int]): Данные для дешифрования в формате a32.
        key (list[int]): Ключ дешифрования в формате a32.

    Returns:
        list[int]: Дешифрованные данные в формате a32.
    """
```

**Назначение**: Дешифрует данные в формате `a32` с использованием алгоритма AES в режиме CBC.

**Параметры**:
- `data` (list[int]): Данные для дешифрования в формате `a32`.
- `key` (list[int]): Ключ дешифрования в формате `a32`.

**Возвращает**:
- `list[int]`: Дешифрованные данные в формате `a32`.

**Как работает функция**:
Функция сначала преобразует данные и ключ из формата `a32` в строку байтов, затем дешифрует данные с помощью `aes_cbc_decrypt` и преобразует дешифрованные данные обратно в формат `a32`.

**Примеры**:

```python
data = [1, 2, 3, 4]
key = [5, 6, 7, 8]
result = aes_cbc_decrypt_a32(data, key)
print(result)
```

### `base64urldecode`

```python
def base64urldecode(data):
    """Декодирует строку Base64, закодированную в URL-безопасном формате.

    Args:
        data (str): Строка Base64 в URL-безопасном формате.

    Returns:
        bytes: Декодированные данные.
    """
```

**Назначение**: Декодирует строку Base64, закодированную в URL-безопасном формате.

**Параметры**:
- `data` (str): Строка Base64 в URL-безопасном формате.

**Возвращает**:
- `bytes`: Декодированные данные.

**Как работает функция**:
Функция заменяет URL-безопасные символы (`-`, `_`, `,`) на стандартные символы Base64 (`+`, `/`, ``), добавляет необходимое количество символов `=` для корректной длины и декодирует строку Base64.

**Примеры**:

```python
data = 'some-data_with,url'
result = base64urldecode(data)
print(result)
```

### `base64_to_a32`

```python
def base64_to_a32(s):
    """Декодирует строку Base64 и преобразует ее в массив 32-битных целых чисел.

    Args:
        s (str): Строка Base64.

    Returns:
        tuple[int]: Массив 32-битных целых чисел, полученный из строки Base64.
    """
```

**Назначение**: Декодирует строку Base64 и преобразует ее в массив 32-битных целых чисел.

**Параметры**:
- `s` (str): Строка Base64.

**Возвращает**:
- `tuple[int]`: Массив 32-битных целых чисел, полученный из строки Base64.

**Как работает функция**:
Функция сначала декодирует строку Base64 с помощью `base64urldecode`, а затем преобразует полученные байты в массив 32-битных целых чисел с помощью `str_to_a32`.

**Примеры**:

```python
s = 'c29tZSBkYXRh'
result = base64_to_a32(s)
print(result)
```

### `base64urlencode`

```python
def base64urlencode(data):
    """Кодирует данные в URL-безопасный формат Base64.

    Args:
        data (bytes): Данные для кодирования.

    Returns:
        str: Строка, закодированная в URL-безопасный формат Base64.
    """
```

**Назначение**: Кодирует данные в URL-безопасный формат Base64.

**Параметры**:
- `data` (bytes): Данные для кодирования.

**Возвращает**:
- `str`: Строка, закодированная в URL-безопасный формат Base64.

**Как работает функция**:
Функция кодирует данные в Base64, а затем заменяет стандартные символы Base64 (`+`, `/`, `=`) на URL-безопасные символы (`-`, `_`, ``).

**Примеры**:

```python
data = b'some data'
result = base64urlencode(data)
print(result)
```

### `a32_to_base64`

```python
def a32_to_base64(a):
    """Преобразует массив 32-битных целых чисел в строку Base64, закодированную в URL-безопасном формате.

    Args:
        a (list[int]): Массив 32-битных целых чисел.

    Returns:
        str: Строка Base64 в URL-безопасном формате.
    """
```

**Назначение**: Преобразует массив 32-битных целых чисел в строку Base64, закодированную в URL-безопасном формате.

**Параметры**:
- `a` (list[int]): Массив 32-битных целых чисел.

**Возвращает**:
- `str`: Строка Base64 в URL-безопасном формате.

**Как работает функция**:
Функция сначала преобразует массив 32-битных целых чисел в строку байтов с помощью `a32_to_str`, а затем кодирует полученные байты в URL-безопасный формат Base64 с помощью `base64urlencode`.

**Примеры**:

```python
a = [1, 2, 3, 4]
result = a32_to_base64(a)
print(result)
```

### `get_chunks`

```python
def get_chunks(size):
    """Разбивает размер файла на чанки для загрузки.

    Args:
        size (int): Размер файла в байтах.

    Returns:
        dict[int, int]: Словарь, где ключ - смещение начала чанка, а значение - размер чанка.
    """
```

**Назначение**: Разбивает размер файла на чанки для загрузки.

**Параметры**:
- `size` (int): Размер файла в байтах.

**Возвращает**:
- `dict[int, int]`: Словарь, где ключ - смещение начала чанка, а значение - размер чанка.

**Как работает функция**:
Функция определяет размер чанков для загрузки файла, начиная с малых чанков и увеличивая их размер до определенного предела, а затем использует чанки большего размера. Функция возвращает словарь, где ключи — это начальные позиции чанков, а значения — размеры этих чанков.

**Примеры**:

```python
size = 1048576  # 1MB
result = get_chunks(size)
print(result)
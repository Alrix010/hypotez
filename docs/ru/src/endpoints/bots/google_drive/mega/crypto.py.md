# Модуль crypto.py

## Обзор

Модуль `crypto.py` предоставляет набор функций для шифрования и дешифрования данных, используемых в mega. Он включает в себя функции для выполнения шифрования AES в режиме CBC, хеширования строк и подготовки ключей.

## Подробней

Этот модуль содержит функции для шифрования и дешифрования данных с использованием алгоритма AES в режиме CBC (Cipher Block Chaining). Он также включает функции для подготовки ключей шифрования и хеширования строк, что позволяет обеспечить безопасную передачу и хранение данных в mega.

## Функции

### `aes_cbc_encrypt`

```python
def aes_cbc_encrypt(data, key):
    """Выполняет шифрование данных с использованием алгоритма AES в режиме CBC.
    
    Args:
        data (bytes): Данные для шифрования.
        key (bytes): Ключ шифрования.

    Returns:
        bytes: Зашифрованные данные.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Шифрование данных с использованием алгоритма AES в режиме CBC.

**Параметры**:
- `data` (bytes): Данные, которые необходимо зашифровать.
- `key` (bytes): Ключ, используемый для шифрования данных.

**Возвращает**:
- `bytes`: Зашифрованные данные.

**Как работает функция**:
- Функция создает объект шифрования AES с использованием предоставленного ключа и режима CBC.
- Выполняет шифрование предоставленных данных с использованием созданного объекта шифрования.
- Возвращает зашифрованные данные.

**Примеры**:
```python
key = b'\\0' * 16
data = b'Test data'
encrypted_data = aes_cbc_encrypt(data, key)
print(encrypted_data)
```

### `aes_cbc_decrypt`

```python
def aes_cbc_decrypt(data, key):
    """Выполняет дешифрование данных, зашифрованных алгоритмом AES в режиме CBC.

    Args:
        data (bytes): Зашифрованные данные.
        key (bytes): Ключ шифрования.

    Returns:
        bytes: Дешифрованные данные.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Дешифрование данных, зашифрованных с использованием алгоритма AES в режиме CBC.

**Параметры**:
- `data` (bytes): Зашифрованные данные.
- `key` (bytes): Ключ, используемый для дешифрования данных.

**Возвращает**:
- `bytes`: Дешифрованные данные.

**Как работает функция**:
- Функция создает объект дешифрования AES с использованием предоставленного ключа и режима CBC.
- Выполняет дешифрование предоставленных данных с использованием созданного объекта дешифрования.
- Возвращает дешифрованные данные.

**Примеры**:
```python
key = b'\\0' * 16
data = b'Test data'
encrypted_data = aes_cbc_encrypt(data, key)
decrypted_data = aes_cbc_decrypt(encrypted_data, key)
print(decrypted_data)
```

### `aes_cbc_encrypt_a32`

```python
def aes_cbc_encrypt_a32(data, key):
    """Шифрует данные, представленные в формате a32, используя алгоритм AES в режиме CBC.

    Args:
        data (list[int]): Данные для шифрования в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        list[int]: Зашифрованные данные в формате a32.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Шифрование данных в формате a32 с использованием AES в режиме CBC.

**Параметры**:
- `data` (list[int]): Данные для шифрования в формате a32.
- `key` (list[int]): Ключ шифрования в формате a32.

**Возвращает**:
- `list[int]`: Зашифрованные данные в формате a32.

**Как работает функция**:
- Преобразует входные данные и ключ из формата a32 в строку.
- Вызывает функцию `aes_cbc_encrypt` для шифрования строковых данных с использованием строкового ключа.
- Преобразует зашифрованные данные обратно в формат a32.
- Возвращает зашифрованные данные в формате a32.

**Примеры**:
```python
data = [1, 2, 3, 4]
key = [5, 6, 7, 8]
encrypted_data = aes_cbc_encrypt_a32(data, key)
print(encrypted_data)
```

### `aes_cbc_decrypt_a32`

```python
def aes_cbc_decrypt_a32(data, key):
    """Дешифрует данные, представленные в формате a32, используя алгоритм AES в режиме CBC.

    Args:
        data (list[int]): Зашифрованные данные в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        list[int]: Дешифрованные данные в формате a32.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Дешифрование данных в формате a32 с использованием AES в режиме CBC.

**Параметры**:
- `data` (list[int]): Зашифрованные данные в формате a32.
- `key` (list[int]): Ключ шифрования в формате a32.

**Возвращает**:
- `list[int]`: Дешифрованные данные в формате a32.

**Как работает функция**:
- Преобразует входные данные и ключ из формата a32 в строку.
- Вызывает функцию `aes_cbc_decrypt` для дешифрования строковых данных с использованием строкового ключа.
- Преобразует дешифрованные данные обратно в формат a32.
- Возвращает дешифрованные данные в формате a32.

**Примеры**:
```python
data = [1, 2, 3, 4]
key = [5, 6, 7, 8]
encrypted_data = aes_cbc_encrypt_a32(data, key)
decrypted_data = aes_cbc_decrypt_a32(encrypted_data, key)
print(decrypted_data)
```

### `stringhash`

```python
def stringhash(s, aeskey):
    """Генерирует хеш строки с использованием AES-ключа.

    Args:
        s (str): Входная строка.
        aeskey (list[int]): AES-ключ в формате a32.

    Returns:
        str: Хеш строки в формате base64.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Генерация хеша строки с использованием AES-ключа.

**Параметры**:
- `s` (str): Входная строка.
- `aeskey` (list[int]): AES-ключ в формате a32.

**Возвращает**:
- `str`: Хеш строки в формате base64.

**Как работает функция**:
- Преобразует входную строку в формат a32.
- Инициализирует хеш-значение.
- Выполняет XOR операции между символами строки и хеш-значением.
- Выполняет несколько раундов шифрования AES в режиме CBC для хеш-значения.
- Преобразует хеш-значение в формат base64.
- Возвращает хеш строки в формате base64.

**Примеры**:
```python
s = 'example string'
aeskey = [1, 2, 3, 4, 5, 6, 7, 8]
string_hash = stringhash(s, aeskey)
print(string_hash)
```

### `prepare_key`

```python
def prepare_key(a):
    """Подготавливает ключ шифрования на основе входных данных.

    Args:
        a (list[int]): Входные данные для подготовки ключа.

    Returns:
        list[int]: Подготовленный ключ шифрования.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Подготовка ключа шифрования на основе входных данных.

**Параметры**:
- `a` (list[int]): Входные данные для подготовки ключа.

**Возвращает**:
- `list[int]`: Подготовленный ключ шифрования.

**Как работает функция**:
- Инициализирует начальное значение ключа.
- Выполняет несколько раундов шифрования AES в режиме CBC для подготовки ключа.
- Возвращает подготовленный ключ шифрования.

**Примеры**:
```python
a = [1, 2, 3, 4, 5, 6, 7, 8]
prepared_key = prepare_key(a)
print(prepared_key)
```

### `encrypt_key`

```python
def encrypt_key(a, key):
    """Шифрует ключ с использованием AES в режиме CBC.

    Args:
        a (list[int]): Ключ для шифрования.
        key (list[int]): Ключ шифрования.

    Returns:
        list[int]: Зашифрованный ключ.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Шифрование ключа с использованием AES в режиме CBC.

**Параметры**:
- `a` (list[int]): Ключ для шифрования.
- `key` (list[int]): Ключ шифрования.

**Возвращает**:
- `list[int]`: Зашифрованный ключ.

**Как работает функция**:
- Разделяет входной ключ на блоки по 4 элемента.
- Шифрует каждый блок с использованием AES в режиме CBC.
- Объединяет зашифрованные блоки.
- Возвращает зашифрованный ключ.

**Примеры**:
```python
a = [1, 2, 3, 4, 5, 6, 7, 8]
key = [9, 10, 11, 12]
encrypted_key = encrypt_key(a, key)
print(encrypted_key)
```

### `decrypt_key`

```python
def decrypt_key(a, key):
    """Дешифрует ключ, зашифрованный с использованием AES в режиме CBC.

    Args:
        a (list[int]): Зашифрованный ключ.
        key (list[int]): Ключ шифрования.

    Returns:
        list[int]: Дешифрованный ключ.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Дешифрование ключа, зашифрованного с использованием AES в режиме CBC.

**Параметры**:
- `a` (list[int]): Зашифрованный ключ.
- `key` (list[int]): Ключ шифрования.

**Возвращает**:
- `list[int]`: Дешифрованный ключ.

**Как работает функция**:
- Разделяет входной зашифрованный ключ на блоки по 4 элемента.
- Дешифрует каждый блок с использованием AES в режиме CBC.
- Объединяет дешифрованные блоки.
- Возвращает дешифрованный ключ.

**Примеры**:
```python
a = [1, 2, 3, 4, 5, 6, 7, 8]
key = [9, 10, 11, 12]
encrypted_key = encrypt_key(a, key)
decrypted_key = decrypt_key(encrypted_key, key)
print(decrypted_key)
```

### `enc_attr`

```python
def enc_attr(attr, key):
    """Шифрует атрибуты с использованием AES в режиме CBC.

    Args:
        attr (dict): Атрибуты для шифрования.
        key (list[int]): Ключ шифрования.

    Returns:
        bytes: Зашифрованные атрибуты.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Шифрование атрибутов с использованием AES в режиме CBC.

**Параметры**:
- `attr` (dict): Атрибуты для шифрования.
- `key` (list[int]): Ключ шифрования.

**Возвращает**:
- `bytes`: Зашифрованные атрибуты.

**Как работает функция**:
- Преобразует атрибуты в JSON-строку и добавляет префикс "MEGA".
- Дополняет строку нулевыми символами до кратной длины 16 байт.
- Шифрует полученную строку с использованием AES в режиме CBC.
- Возвращает зашифрованные атрибуты.

**Примеры**:
```python
attr = {'name': 'test', 'value': 123}
key = [1, 2, 3, 4]
encrypted_attr = enc_attr(attr, key)
print(encrypted_attr)
```

### `dec_attr`

```python
def dec_attr(attr, key):
    """Дешифрует атрибуты, зашифрованные с использованием AES в режиме CBC.

    Args:
        attr (bytes): Зашифрованные атрибуты.
        key (list[int]): Ключ шифрования.

    Returns:
        dict: Дешифрованные атрибуты.

    Raises:
        Не вызывает исключений.

    """
```

**Назначение**: Дешифрование атрибутов, зашифрованных с использованием AES в режиме CBC.

**Параметры**:
- `attr` (bytes): Зашифрованные атрибуты.
- `key` (list[int]): Ключ шифрования.

**Возвращает**:
- `dict`: Дешифрованные атрибуты.

**Как работает функция**:
- Дешифрует входные данные с использованием AES в режиме CBC.
- Удаляет нулевые символы в конце строки.
- Извлекает JSON-строку, удаляя префикс "MEGA".
- Преобразует JSON-строку в словарь.
- Возвращает дешифрованные атрибуты.

**Примеры**:
```python
attr = {'name': 'test', 'value': 123}
key = [1, 2, 3, 4]
encrypted_attr = enc_attr(attr, key)
decrypted_attr = dec_attr(encrypted_attr, key)
print(decrypted_attr)
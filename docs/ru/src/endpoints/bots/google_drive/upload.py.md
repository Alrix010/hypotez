# Модуль для загрузки файлов в Google Drive
=================================================

Модуль предназначен для загрузки файлов в Google Drive с использованием библиотеки `PyDrive`. Он обеспечивает функциональность авторизации, создания папок (при необходимости) и загрузки файлов с возможностью управления разрешениями доступа.

## Обзор

Модуль содержит функцию `upload`, которая принимает имя файла, флаг обновления, контекст и (опционально) имя родительской папки в Google Drive. Он использует учетные данные пользователя для авторизации, создает папку, если она не существует, и загружает указанный файл в Google Drive.

## Подробней

Этот модуль используется для автоматической загрузки файлов в Google Drive, что может быть полезно для резервного копирования, обмена файлами и других задач. Он поддерживает загрузку как в обычные папки Google Drive, так и в Team Drives.

## Функции

### `upload`

```python
def upload(filename: str, update, context, parent_folder: str = None) -> None:
    """
    Загружает файл в Google Drive.

    Args:
        filename (str): Имя файла для загрузки.
        update: Объект, содержащий информацию об обновлении от пользователя.
        context: Контекст выполнения.
        parent_folder (str, optional): Имя родительской папки в Google Drive. По умолчанию `None`.

    Returns:
        None: Функция ничего не возвращает, но загружает файл в Google Drive и устанавливает разрешения доступа.

    Raises:
        Exception: Если возникает ошибка при загрузке файла.

    Example:
        >>> upload('my_file.txt', update, context, 'MyFolder')
    """
```

**Назначение**: Загружает указанный файл в Google Drive, создавая родительскую папку, если она не существует.

**Параметры**:
- `filename` (str): Путь к файлу, который нужно загрузить.
- `update`: Объект, содержащий информацию об обновлении от пользователя (например, сообщение из Telegram бота).
- `context`: Контекст выполнения (например, информация о текущем состоянии бота).
- `parent_folder` (str, optional): Имя родительской папки в Google Drive. Если не указана, файл будет загружен в корневую папку. По умолчанию `None`.

**Как работает функция**:
1. **Авторизация**: Функция пытается загрузить учетные данные пользователя из файла. Если учетные данные отсутствуют или устарели, она пытается обновить или запросить их.
2. **Инициализация Google Drive**: После успешной авторизации функция инициализирует объект `GoogleDrive` для взаимодействия с Google Drive API.
3. **Проверка существования файла**: Функция проверяет, существует ли указанный файл локально. Если файл не существует, функция завершается.
4. **Обработка родительской папки**: Если указана родительская папка, функция проверяет, существует ли она в Google Drive. Если папка не существует, она создает папку с указанным именем.
5. **Загрузка файла**: Функция создает метаданные файла, устанавливает родительскую папку (если указана) и загружает файл в Google Drive.
6. **Установка разрешений**: Если не используется Team Drive, функция устанавливает разрешение на чтение файла для всех пользователей, у которых есть ссылка.

**Примеры**:

```python
# Пример загрузки файла в корневую папку
upload('my_file.txt', update, context)

# Пример загрузки файла в указанную папку
upload('my_file.txt', update, context, 'MyFolder')
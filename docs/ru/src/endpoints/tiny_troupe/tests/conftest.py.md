# Модуль конфигурации тестов `conftest.py`

## Обзор

Файл `conftest.py` содержит конфигурацию для тестов, определяя глобальные параметры и опции командной строки для управления поведением тестов. Он позволяет настраивать использование кэша API и запуск примеров в тестах.

## Подробнее

Этот файл определяет глобальные переменные и функции, используемые в процессе тестирования. Он обрабатывает опции командной строки, переданные в `pytest`, и устанавливает соответствующие значения глобальных переменных, которые затем используются в тестах для определения поведения кэширования API и запуска примеров.

## Функции

### `pytest_addoption`

**Назначение**: Добавляет опции командной строки для управления поведением тестов.

```python
def pytest_addoption(parser):
    """Добавляет опции командной строки для управления поведением тестов.
    Args:
        parser: Объект парсера аргументов командной строки pytest.
    """
```

**Параметры**:

- `parser`: Объект парсера аргументов командной строки `pytest`.

**Как работает функция**:

Функция `pytest_addoption` использует объект `parser` для добавления трех опций командной строки:
- `--refresh_cache`: Если указана, принудительно обновляет кэш API для тестов, чтобы гарантировать использование самых свежих данных.
- `--use_cache`: Если указана, использует кэш API для тестов, чтобы уменьшить количество фактических вызовов API.
- `--test_examples`: Если указана, также запускает все примеры, чтобы убедиться, что они все еще работают. Это может существенно увеличить время выполнения тестов.

### `pytest_generate_tests`

**Назначение**: Обрабатывает опции командной строки и устанавливает глобальные переменные на основе их значений.

```python
def pytest_generate_tests(metafunc):
    """Обрабатывает опции командной строки и устанавливает глобальные переменные на основе их значений.
    Args:
        metafunc: Объект metafunc pytest, предоставляющий информацию о текущем тестовом случае.
    """
```

**Параметры**:

- `metafunc`: Объект `metafunc` `pytest`, предоставляющий информацию о текущем тестовом случае.

**Как работает функция**:

1.  Функция `pytest_generate_tests` сначала объявляет глобальные переменные `refresh_cache`, `use_cache` и `test_examples`.
2.  Затем она извлекает значения опций командной строки `--refresh_cache`, `--use_cache` и `--test_examples` с использованием `metafunc.config.getoption()` и присваивает их соответствующим глобальным переменным.
3.  Далее функция извлекает имя текущего тестового случая из `metafunc.function.__name__`.
4.  Наконец, функция выводит информацию для пользователя о текущем тестовом случае и значениях глобальных переменных, чтобы предоставить обратную связь о том, как будут выполняться тесты.

**Примеры**:

Запуск тестов с обновлением кэша API:

```bash
pytest --refresh_cache
```

Запуск тестов с использованием кэша API:

```bash
pytest --use_cache
```

Запуск тестов с выполнением всех примеров:

```bash
pytest --test_examples
```

## Переменные

- `refresh_cache`: Глобальная переменная, указывающая, следует ли обновлять кэш API для тестов.
- `use_cache`: Глобальная переменная, указывающая, следует ли использовать кэш API для тестов.
- `test_examples`: Глобальная переменная, указывающая, следует ли запускать все примеры в тестах.
# Модуль тестирования класса TinyPerson
## Обзор

Модуль `test_tinyperson.py` содержит набор юнит-тестов для проверки корректности работы класса `TinyPerson` и его методов. Тесты охватывают различные аспекты поведения агентов, такие как взаимодействие, прослушивание, определение характеристик, социализация, восприятие, мышление, целеполагание, перемещение, изменение контекста, сохранение и загрузка спецификаций.

## Подробнее

Модуль использует библиотеку `pytest` для организации и запуска тестов. Он также импортирует классы агентов `create_oscar_the_architect`, `create_lisa_the_data_scientist` и вспомогательные функции из модуля `testing_utils` для упрощения процесса тестирования. Модуль предназначен для обеспечения стабильности и надежности агентов `TinyPerson` путем автоматизированной проверки их функциональности после внесения изменений в код.

## Функции

### `test_act`

```python
def test_act(setup):
    """
    Тестирует взаимодействие агента с окружением.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент выполняет действия в ответ на стимул, возвращает список действий, включающий как минимум одно действие, действие типа "TALK" (если требуется) и завершается действием типа "DONE".

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Взаимодействие**: Вызывает метод `listen_and_act` для каждого агента, передавая сообщение "Tell me a bit about your life." и запрашивая возврат списка действий.
3.  **Логирование**: Записывает текущие взаимодействия агента в лог.
4.  **Утверждения**: Проверяет, что:
    *   Список действий не пуст (минимум одно действие).
    *   Список действий содержит действие типа "TALK".
    *   Список действий завершается действием типа "DONE".

**Примеры**:
```python
# Пример вызова функции
test_act(setup)
```

### `test_listen`

```python
def test_listen(setup):
    """
    Тестирует способность агента воспринимать речь и обновлять свои текущие сообщения.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент корректно обрабатывает речевой стимул, добавляет сообщение в свою память и обновляет текущие сообщения.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Прослушивание**: Вызывает метод `listen` для каждого агента, передавая сообщение "Hello, how are you?".
3.  **Утверждения**: Проверяет, что:
    *   Список текущих сообщений агента не пуст.
    *   Последнее сообщение в эпизодической памяти имеет роль "user".
    *   Последнее сообщение содержит стимул типа "CONVERSATION".
    *   Содержимое последнего сообщения соответствует переданному тексту.

**Примеры**:
```python
# Пример вызова функции
test_listen(setup)
```

### `test_define`

```python
def test_define(setup):
    """
    Тестирует способность агента определять значения конфигурации и сбрасывать свой промпт.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент может устанавливать новые значения в своей конфигурации (`_persona`) и что это приводит к изменению текущего промпта.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Сохранение промпта**: Сохраняет оригинальный промпт агента.
3.  **Определение значения**: Вызывает метод `define` для установки значения "age" равным 25.
4.  **Утверждения**: Проверяет, что:
    *   Значение "age" в конфигурации агента установлено равным 25.
    *   Текущий промпт агента отличается от оригинального.
    *   Текущий промпт агента содержит значение "25".

**Примеры**:
```python
# Пример вызова функции
test_define(setup)
```

### `test_define_several`

```python
def test_define_several(setup):
    """
    Тестирует способность агента определять несколько значений для группы параметров.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент может определять несколько значений для группы параметров (например, списка навыков).

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Определение значений**: Вызывает метод `define` для установки списка навыков (skills).
3.  **Утверждения**: Проверяет, что:
    *   Конфигурация агента содержит "Python" в списке навыков.
    *   Конфигурация агента содержит "Machine learning" в списке навыков.
    *   Конфигурация агента содержит "GPT-3" в списке навыков.

**Примеры**:
```python
# Пример вызова функции
test_define_several(setup)
```

### `test_socialize`

```python
def test_socialize(setup):
    """
    Тестирует взаимодействие агента с другим агентом.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент может взаимодействовать с другим агентом, обмениваться информацией и учитывать это в своих действиях.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Создает двух агентов: Оскара и Лизу.
2.  **Взаимодействие**: Проходит по списку агентов (Оскар, Лиза).
3.  **Определение партнера**: Определяет другого агента (партнера) для текущего агента.
4.  **Установление доступности**: Вызывает метод `make_agent_accessible` для текущего агента, чтобы сделать партнера доступным.
5.  **Прослушивание**: Вызывает метод `listen` для текущего агента, передавая сообщение от партнера.
6.  **Действие**: Вызывает метод `act` для текущего агента, запрашивая возврат списка действий.
7.  **Утверждения**: Проверяет, что:
    *   Список действий не пуст.
    *   Список действий содержит действие типа "TALK".
    *   Действие типа "TALK" содержит имя партнера.

**Примеры**:
```python
# Пример вызова функции
test_socialize(setup)
```

### `test_see`

```python
def test_see(setup):
    """
    Тестирует способность агента воспринимать визуальные стимулы.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент корректно обрабатывает визуальный стимул, генерирует действие типа "THINK" и упоминает увиденное в этом действии.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Восприятие**: Вызывает метод `see` для каждого агента, передавая описание визуального стимула ("A beautiful sunset over the ocean.").
3.  **Действие**: Вызывает метод `act` для каждого агента, запрашивая возврат списка действий.
4.  **Утверждения**: Проверяет, что:
    *   Список действий не пуст.
    *   Список действий содержит действие типа "THINK".
    *   Действие типа "THINK" содержит упоминание "sunset".

**Примеры**:
```python
# Пример вызова функции
test_see(setup)
```

### `test_think`

```python
def test_think(setup):
    """
    Тестирует способность агента размышлять о чем-либо.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент может размышлять о чем-либо, генерирует действие типа "TALK" и упоминает тему размышлений в этом действии.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Размышление**: Вызывает метод `think` для каждого агента, передавая текст размышления ("I will tell everyone right now how awesome life is!").
3.  **Действие**: Вызывает метод `act` для каждого агента, запрашивая возврат списка действий.
4.  **Утверждения**: Проверяет, что:
    *   Список действий не пуст.
    *   Список действий содержит действие типа "TALK".
    *   Действие типа "TALK" содержит упоминание "life".

**Примеры**:
```python
# Пример вызова функции
test_think(setup)
```

### `test_internalize_goal`

```python
def test_internalize_goal(setup):
    """
    Тестирует способность агента усваивать цель.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент может усваивать цели, генерирует действие типа "THINK" и упоминает цель в этом действии.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Целеполагание**: Вызывает метод `internalize_goal` для каждого агента, передавая описание цели ("I want to compose in my head a wonderful poem about how cats are glorious creatures.").
3.  **Действие**: Вызывает метод `act` для каждого агента, запрашивая возврат списка действий.
4.  **Утверждения**: Проверяет, что:
    *   Список действий не пуст.
    *   Список действий содержит действие типа "THINK".
    *   Действие типа "THINK" содержит упоминание "cats".

**Примеры**:
```python
# Пример вызова функции
test_internalize_goal(setup)
```

### `test_move_to`

```python
def test_move_to(setup):
    """
    Тестирует способность агента перемещаться в новое место.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент может перемещаться в новое место, обновляет свое местоположение и контекст.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Перемещение**: Вызывает метод `move_to` для каждого агента, передавая новое местоположение ("New York") и контекст (\["city", "busy", "diverse"]).
3.  **Утверждения**: Проверяет, что:
    *   Местоположение агента установлено равным "New York".
    *   Контекст агента содержит "city".
    *   Контекст агента содержит "busy".
    *   Контекст агента содержит "diverse".

**Примеры**:
```python
# Пример вызова функции
test_move_to(setup)
```

### `test_change_context`

```python
def test_change_context(setup):
    """
    Тестирует способность агента изменять свой контекст.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент может изменять свой контекст.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Изменение контекста**: Вызывает метод `change_context` для каждого агента, передавая новый контекст (\["home", "relaxed", "comfortable"]).
3.  **Утверждения**: Проверяет, что:
    *   Контекст агента содержит "home".
    *   Контекст агента содержит "relaxed".
    *   Контекст агента содержит "comfortable".

**Примеры**:
```python
# Пример вызова функции
test_change_context(setup)
```

### `test_save_specification`

```python
def test_save_specification(setup):
    """
    Тестирует способность агента сохранять свою спецификацию в файл.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агент может сохранять свою спецификацию в файл и что загруженная из файла спецификация соответствует оригиналу.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  **Сохранение**: Вызывает метод `save_specification` для сохранения спецификации агента в файл.
3.  **Утверждения о сохранении**: Проверяет, что файл был создан.
4.  **Загрузка**: Загружает спецификацию из файла с новым именем агента.
5.  **Утверждения о загрузке**: Проверяет, что:
    *   Имя загруженного агента соответствует новому имени.
    *   Конфигурация загруженного агента соответствует оригиналу (за исключением имени).

**Примеры**:
```python
# Пример вызова функции
test_save_specification(setup)
```

### `test_programmatic_definitions`

```python
def test_programmatic_definitions(setup):
    """
    Тестирует программное определение параметров агента.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Назначение**: Проверяет, что агенты, созданные с использованием программных определений (например, через `create_oscar_the_architect_2()` и `create_lisa_the_data_scientist_2()`), корректно взаимодействуют с окружением.

**Параметры**:
- `setup`: Фикстура pytest, обеспечивающая начальную настройку тестовой среды.

**Как работает функция**:

1.  **Инициализация**: Проходит по списку агентов, созданных с помощью `create_oscar_the_architect_2()` и `create_lisa_the_data_scientist_2()`.
2.  **Взаимодействие**: Вызывает метод `listen_and_act` для каждого агента, передавая сообщение "Tell me a bit about your life.".

**Примеры**:
```python
# Пример вызова функции
test_programmatic_definitions(setup)
```

## Вспомогательные функции (из `testing_utils`)

Функции, импортированные из `testing_utils`, используются для упрощения процесса тестирования и содержат вспомогательные методы для проверки действий агентов, равенства конфигураций и т. д.
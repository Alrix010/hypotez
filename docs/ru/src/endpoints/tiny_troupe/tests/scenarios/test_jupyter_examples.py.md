# Документация для модуля `test_jupyter_examples.py`

## Обзор

Модуль `test_jupyter_examples.py` предназначен для автоматического тестирования Jupyter Notebook, расположенных в директории `examples`. Он использует `pytest` для запуска тестов и проверяет, что ни один из ноутбуков не вызывает исключений при выполнении. Модуль обеспечивает целостность и корректность примеров использования, предоставляемых в виде Jupyter Notebook.

## Подробнее

Этот модуль является частью системы автоматизированного тестирования проекта `hypotez`. Он сканирует указанную директорию на наличие файлов Jupyter Notebook (`.ipynb`), исключает уже выполненные или локальные версии, и запускает каждый ноутбук, проверяя отсутствие ошибок. Если в процессе выполнения ноутбука возникает исключение, тест помечается как проваленный. После выполнения, независимо от результата, создается копия выполненного ноутбука с добавлением суффикса `.executed.local.ipynb`.

## Функции

### `get_notebooks`

```python
def get_notebooks(folder: str) -> list[str]:
    """Retrieve all Jupyter notebook files from the specified folder."""
    ...
```

**Назначение**: Функция получает список всех файлов Jupyter Notebook из указанной директории.

**Параметры**:

-   `folder` (str): Путь к директории, в которой расположены ноутбуки.

**Возвращает**:

-   `list[str]`: Список полных путей к файлам Jupyter Notebook, исключая файлы с `.executed.` или `.local.` в имени.

**Как работает функция**:

1.  Функция `get_notebooks` принимает путь к директории (`folder`).
2.  Использует `os.listdir(folder)` для получения списка всех файлов и поддиректорий в указанной директории.
3.  Фильтрует полученный список, оставляя только те элементы, которые соответствуют следующим критериям:
    *   Оканчиваются на `.ipynb` (являются файлами Jupyter Notebook).
    *   Не содержат `.executed.` в имени файла (исключает уже выполненные ноутбуки).
    *   Не содержат `.local.` в имени файла (исключает локальные копии ноутбуков).
4.  Формирует полный путь к каждому отобранному файлу с помощью `os.path.join(folder, f)`.
5.  Возвращает список полных путей к файлам Jupyter Notebook.

**Примеры**:

```python
# Пример использования функции get_notebooks
notebooks = get_notebooks("/path/to/notebooks")
print(notebooks)
# Вывод: ['/path/to/notebooks/example1.ipynb', '/path/to/notebooks/example2.ipynb']
```

### `test_notebook_execution`

```python
@pytest.mark.parametrize("notebook_path", get_notebooks(NOTEBOOK_FOLDER))
def test_notebook_execution(notebook_path: str) -> None:
    """Execute a Jupyter notebook and assert that no exceptions occur."""
    ...
```

**Назначение**: Функция выполняет Jupyter Notebook и проверяет, что в процессе выполнения не возникает исключений.

**Параметры**:

-   `notebook_path` (str): Путь к файлу Jupyter Notebook, который необходимо выполнить.

**Возвращает**:

-   `None`: Функция ничего не возвращает. Она либо успешно выполняет ноутбук, либо вызывает исключение `pytest.fail`, если в процессе выполнения ноутбука возникла ошибка.

**Как работает функция**:

1.  Функция `test_notebook_execution` принимает путь к файлу Jupyter Notebook (`notebook_path`).
2.  Проверяет, включены ли примеры тестов (`conftest.test_examples`).
3.  Если тесты включены, открывает файл ноутбука в режиме чтения с кодировкой UTF-8.
4.  Использует `nbformat.read` для чтения содержимого ноутбука в формате, пригодном для обработки.
5.  Инициализирует `ExecutePreprocessor` с заданным таймаутом (`TIMEOUT`) и именем ядра (`KERNEL_NAME`).
6.  Пытается выполнить ноутбук с помощью `ep.preprocess`, передавая ему сам ноутбук и метаданные, содержащие путь к директории с ноутбуками.
7.  Если выполнение завершается успешно, выводит сообщение об успешном выполнении.
8.  Если в процессе выполнения возникает исключение, перехватывает его и вызывает `pytest.fail` с сообщением об ошибке и информацией об исключении.
9.  В блоке `finally` сохраняет копию выполненного ноутбука с добавлением суффикса `.executed.local.ipynb`.
10. Если тесты не включены, выводит сообщение о пропуске выполнения ноутбука.

**Внутренние функции**:
Функция `test_notebook_execution` не содержит внутренних функций

**Примеры**:

```python
# Пример использования функции test_notebook_execution (автоматически вызывается pytest)
# pytest test_jupyter_examples.py
```

**ASCII flowchart**:

```
A: Проверка `conftest.test_examples`
│
├───> Нет: Вывод сообщения о пропуске
│
└───> Да:
      │
      B: Чтение файла ноутбука
      │
      C: Инициализация `ExecutePreprocessor`
      │
      D: Попытка выполнения ноутбука
      │
      ├───> Успех: Вывод сообщения об успехе
      │
      └───> Ошибка: Вызов `pytest.fail`
      │
      E: Сохранение выполненной копии ноутбука
      │
      F: Завершение
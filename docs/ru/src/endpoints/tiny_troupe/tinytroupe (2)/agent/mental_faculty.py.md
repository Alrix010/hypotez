# Модуль `mental_faculty.py`

## Обзор

Модуль определяет основные классы для представления ментальных способностей агента в системе TinyTroupe. Ментальные способности позволяют агенту выполнять различные когнитивные задачи, такие как вспоминание информации, доступ к файлам и веб-страницам, а также использование инструментов.

## Подробнее

Модуль содержит абстрактный базовый класс `TinyMentalFaculty`, который определяет интерфейс для всех ментальных способностей. Также реализованы конкретные классы, такие как `CustomMentalFaculty`, `RecallFaculty`, `FilesAndWebGroundingFaculty` и `TinyToolUse`, представляющие различные типы ментальных способностей агента.

## Классы

### `TinyMentalFaculty`

**Описание**:
Абстрактный базовый класс, представляющий ментальную способность агента. Определяет основные методы, которые должны быть реализованы в подклассах.

**Атрибуты**:
- `name` (str): Название ментальной способности.
- `requires_faculties` (list): Список названий других ментальных способностей, необходимых для функционирования данной способности.

**Методы**:
- `__init__(self, name: str, requires_faculties: list = None) -> None`:
    - **Назначение**: Инициализирует ментальную способность.
    - **Параметры**:
        - `name` (str): Название ментальной способности.
        - `requires_faculties` (list, optional): Список названий других ментальных способностей, необходимых для функционирования данной способности. По умолчанию `None`.
    - **Возвращает**: `None`

- `__str__(self) -> str`:
    - **Назначение**: Возвращает строковое представление объекта `TinyMentalFaculty`.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Строковое представление объекта.

- `__eq__(self, other) -> bool`:
    - **Назначение**: Сравнивает два объекта `TinyMentalFaculty` на равенство по имени.
    - **Параметры**:
        - `other` (TinyMentalFaculty): Другой объект для сравнения.
    - **Возвращает**: `bool`: `True`, если объекты равны, `False` в противном случае.

- `process_action(self, agent, action: dict) -> bool`:
    - **Назначение**: Абстрактный метод для обработки действия, связанного с данной ментальной способностью.
    - **Параметры**:
        - `agent` (Agent): Агент, выполняющий действие.
        - `action` (dict): Словарь, описывающий действие.
    - **Возвращает**: `bool`: `True`, если действие было успешно обработано, `False` в противном случае.
    - **Вызывает исключения**:
        - `NotImplementedError`: Если метод не реализован в подклассе.

- `actions_definitions_prompt(self) -> str`:
    - **Назначение**: Абстрактный метод для получения описания действий, связанных с данной ментальной способностью.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание действий.
    - **Вызывает исключения**:
        - `NotImplementedError`: Если метод не реализован в подклассе.

- `actions_constraints_prompt(self) -> str`:
    - **Назначение**: Абстрактный метод для получения описания ограничений на действия, связанные с данной ментальной способностью.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание ограничений.
    - **Вызывает исключения**:
        - `NotImplementedError`: Если метод не реализован в подклассе.

### `CustomMentalFaculty`

**Описание**:
Класс, представляющий пользовательскую ментальную способность агента. Позволяет определять действия и ограничения, специфичные для данной способности.

**Наследует**:
- `TinyMentalFaculty`

**Атрибуты**:
- `actions_configs` (dict): Словарь с конфигурацией действий, которые может выполнять эта способность. Формат: `{<action_name>: {"description": <description>, "function": <function>}}`.
- `constraints` (dict): Список ограничений, вводимых этой способностью. Формат: `[<constraint1>, <constraint2>, ...]`.

**Методы**:
- `__init__(self, name: str, requires_faculties: list = None, actions_configs: dict = None, constraints: dict = None)`:
    - **Назначение**: Инициализирует пользовательскую ментальную способность.
    - **Параметры**:
        - `name` (str): Название ментальной способности.
        - `requires_faculties` (list, optional): Список названий других ментальных способностей, необходимых для функционирования данной способности. Формат: `["faculty1", "faculty2", ...]` . По умолчанию `None`.
        - `actions_configs` (dict, optional): Словарь с конфигурацией действий, которые может выполнять эта способность. Формат: `{<action_name>: {"description": <description>, "function": <function>}}`. По умолчанию `None`.
        - `constraints` (dict, optional): Список ограничений, вводимых этой способностью. Формат: `[<constraint1>, <constraint2>, ...]`. По умолчанию `None`.
    - **Возвращает**: `None`

- `add_action(self, action_name: str, description: str, function: Callable = None)`:
    - **Назначение**: Добавляет новое действие в конфигурацию действий.
    - **Параметры**:
        - `action_name` (str): Название действия.
        - `description` (str): Описание действия.
        - `function` (Callable, optional): Функция, выполняющая действие. По умолчанию `None`.
    - **Возвращает**: `None`

- `add_actions(self, actions: dict)`:
    - **Назначение**: Добавляет несколько действий из словаря в конфигурацию действий.
    - **Параметры**:
        - `actions` (dict): Словарь действий, где ключ - название действия, а значение - словарь с описанием и функцией. Формат: `{<action_name>: {"description": <description>, "function": <function>}}`.
    - **Возвращает**: `None`

- `add_action_constraint(self, constraint: str)`:
    - **Назначение**: Добавляет новое ограничение в список ограничений.
    - **Параметры**:
        - `constraint` (str): Ограничение.
    - **Возвращает**: `None`

- `add_actions_constraints(self, constraints: list)`:
    - **Назначение**: Добавляет несколько ограничений из списка в список ограничений.
    - **Параметры**:
        - `constraints` (list): Список ограничений.
    - **Возвращает**: `None`

- `process_action(self, agent, action: dict) -> bool`:
    - **Назначение**: Обрабатывает действие, связанное с данной ментальной способностью.
    - **Параметры**:
        - `agent` (Agent): Агент, выполняющий действие.
        - `action` (dict): Словарь, описывающий действие.
    - **Возвращает**: `bool`: `True`, если действие было успешно обработано, `False` в противном случае.
    - **Как работает функция**:
        - Извлекает тип действия из словаря `action`.
        - Проверяет, есть ли данный тип действия в конфигурации действий (`self.actions_configs`).
        - Если действие найдено, извлекает конфигурацию действия (`action_config`) и функцию действия (`action_function`).
        - Если функция действия существует, вызывает её с аргументами `agent` и `action`.
        - Возвращает `True`, если действие было успешно обработано, иначе `False`.
    - **Примеры**:
      ```python
      # Пример создания CustomMentalFaculty с одним действием
      def example_action(agent, action):
          agent.logger.info(f"Выполнено действие: {action['type']}")

      actions_configs = {
          "EXAMPLE_ACTION": {"description": "Пример пользовательского действия", "function": example_action}
      }
      faculty = CustomMentalFaculty(name="MyCustomFaculty", actions_configs=actions_configs)

      # Пример вызова process_action
      action = {"type": "EXAMPLE_ACTION"}
      result = faculty.process_action(agent, action)
      print(f"Результат обработки действия: {result}")  # Вывод: Результат обработки действия: True
      ```
- `actions_definitions_prompt(self) -> str`:
    - **Назначение**: Возвращает описание действий, связанных с данной ментальной способностью, в виде строки для prompt.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание действий.
    - **Как работает функция**:
      Собирает строки описания для каждого действия из `self.actions_configs`, формируя prompt строку.

- `actions_constraints_prompt(self) -> str`:
    - **Назначение**: Возвращает описание ограничений на действия, связанных с данной ментальной способностью, в виде строки для prompt.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание ограничений.
    - **Как работает функция**:
        Собирает строки описания для каждого ограничения из `self.constraints`, формируя prompt строку.

### `RecallFaculty`

**Описание**:
Класс, представляющий ментальную способность агента вспоминать информацию из памяти.

**Наследует**:
- `TinyMentalFaculty`

**Методы**:
- `__init__(self)`:
    - **Назначение**: Инициализирует ментальную способность вспоминать информацию.
    - **Параметры**: `None`
    - **Возвращает**: `None`

- `process_action(self, agent, action: dict) -> bool`:
    - **Назначение**: Обрабатывает действие "RECALL", извлекая релевантные воспоминания из семантической памяти агента.
    - **Параметры**:
        - `agent` (Agent): Агент, выполняющий действие.
        - `action` (dict): Словарь, описывающий действие.
    - **Возвращает**: `bool`: `True`, если действие было успешно обработано, `False` в противном случае.
    - **Как работает функция**:
        - Проверяет, является ли тип действия "RECALL" и есть ли контент для поиска.
        - Извлекает релевантные воспоминания из семантической памяти агента, используя `agent.retrieve_relevant_memories()`.
        - Если найдены воспоминания, агент "думает" (вызывает `agent.think()`) о найденной информации.
        - Если воспоминания не найдены, агент сообщает, что не может ничего вспомнить.
    - **Примеры**:
      ```python
      # Пример создания RecallFaculty
      faculty = RecallFaculty()

      # Пример вызова process_action с действием RECALL
      action = {"type": "RECALL", "content": "важная информация"}
      result = faculty.process_action(agent, action)
      print(f"Результат обработки действия: {result}")  # Вывод: Результат обработки действия: True или False, в зависимости от наличия воспоминаний
      ```
- `actions_definitions_prompt(self) -> str`:
    - **Назначение**: Возвращает описание действия "RECALL" для prompt.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание действия "RECALL".

- `actions_constraints_prompt(self) -> str`:
    - **Назначение**: Возвращает описание ограничений на действие "RECALL" для prompt.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание ограничений на действие "RECALL".

### `FilesAndWebGroundingFaculty`

**Описание**:
Класс, предоставляющий агенту возможность доступа к локальным файлам и веб-страницам для обоснования своих знаний.

**Наследует**:
- `TinyMentalFaculty`

**Атрибуты**:
- `local_files_grounding_connector` (LocalFilesGroundingConnector): Объект для доступа к локальным файлам.
- `web_grounding_connector` (WebPagesGroundingConnector): Объект для доступа к веб-страницам.

**Методы**:
- `__init__(self, folders_paths: list = None, web_urls: list = None)`:
    - **Назначение**: Инициализирует ментальную способность доступа к файлам и веб-страницам.
    - **Параметры**:
        - `folders_paths` (list, optional): Список путей к локальным папкам. По умолчанию `None`.
        - `web_urls` (list, optional): Список URL веб-страниц. По умолчанию `None`.
    - **Возвращает**: `None`

- `process_action(self, agent, action: dict) -> bool`:
    - **Назначение**: Обрабатывает действия "CONSULT" (консультация с документом) и "LIST_DOCUMENTS" (список доступных документов).
    - **Параметры**:
        - `agent` (Agent): Агент, выполняющий действие.
        - `action` (dict): Словарь, описывающий действие.
    - **Возвращает**: `bool`: `True`, если действие было успешно обработано, `False` в противном случае.
    -  **Как работает функция**:
        - Если тип действия "CONSULT", пытается получить документ по имени из локальных файлов и веб-страниц.
        - Если тип действия "LIST_DOCUMENTS", составляет список доступных документов из локальных файлов и веб-страниц.
        - Агент "думает" (вызывает `agent.think()`) о найденной информации или сообщает об отсутствии документов.
    - **Примеры**:
      ```python
      # Пример создания FilesAndWebGroundingFaculty
      faculty = FilesAndWebGroundingFaculty(folders_paths=["/path/to/files"], web_urls=["http://example.com"])

      # Пример вызова process_action с действием CONSULT
      action = {"type": "CONSULT", "content": "документ1"}
      result = faculty.process_action(agent, action)
      print(f"Результат обработки действия: {result}")  # Вывод: Результат обработки действия: True или False, в зависимости от наличия документа

      # Пример вызова process_action с действием LIST_DOCUMENTS
      action = {"type": "LIST_DOCUMENTS", "content": "список"}
      result = faculty.process_action(agent, action)
      print(f"Результат обработки действия: {result}")  # Вывод: Результат обработки действия: True или False, в зависимости от наличия документов
      ```

- `actions_definitions_prompt(self) -> str`:
    - **Назначение**: Возвращает описание действий "CONSULT" и "LIST_DOCUMENTS" для prompt.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание действий "CONSULT" и "LIST_DOCUMENTS".

- `actions_constraints_prompt(self) -> str`:
    - **Назначение**: Возвращает описание ограничений на действия "CONSULT" и "LIST_DOCUMENTS" для prompt.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание ограничений на действия "CONSULT" и "LIST_DOCUMENTS".

### `TinyToolUse`

**Описание**:
Класс, представляющий ментальную способность агента использовать инструменты для выполнения задач.

**Наследует**:
- `TinyMentalFaculty`

**Атрибуты**:
- `tools` (list): Список инструментов, доступных агенту.

**Методы**:
- `__init__(self, tools: list)`:
    - **Назначение**: Инициализирует ментальную способность использовать инструменты.
    - **Параметры**:
        - `tools` (list): Список инструментов.
    - **Возвращает**: `None`

- `process_action(self, agent, action: dict) -> bool`:
    - **Назначение**: Обрабатывает действие, пытаясь выполнить его с помощью доступных инструментов.
    - **Параметры**:
        - `agent` (Agent): Агент, выполняющий действие.
        - `action` (dict): Словарь, описывающий действие.
    - **Возвращает**: `bool`: `True`, если действие было успешно обработано одним из инструментов, `False` в противном случае.
    - **Как работает функция**:
        - Перебирает инструменты в списке `self.tools`.
        - Для каждого инструмента вызывает метод `process_action()`.
        - Если какой-либо инструмент успешно обработал действие, возвращает `True`.
        - Если ни один инструмент не обработал действие, возвращает `False`.
    - **Примеры**:
      ```python
      # Пример создания TinyToolUse с двумя инструментами
      class MockTool:
          def process_action(self, agent, action):
              if action["type"] == "MOCK_ACTION":
                  agent.logger.info("MockTool обработал действие")
                  return True
              return False

          def actions_definitions_prompt(self) -> str:
              return " - MOCK_ACTION: Это действие выполняет MockTool.\n"

          def actions_constraints_prompt(self) -> str:
              return " - Используйте MOCK_ACTION, когда требуется помощь MockTool.\n"

      tool1 = MockTool()
      tool2 = MockTool()
      faculty = TinyToolUse(tools=[tool1, tool2])

      # Пример вызова process_action с действием, которое обработает MockTool
      action = {"type": "MOCK_ACTION"}
      result = faculty.process_action(agent, action)
      print(f"Результат обработки действия: {result}")  # Вывод: Результат обработки действия: True
      ```

- `actions_definitions_prompt(self) -> str`:
    - **Назначение**: Возвращает объединение описаний действий, предоставляемых каждым инструментом, для prompt.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание действий, предоставляемых каждым инструментом.

- `actions_constraints_prompt(self) -> str`:
    - **Назначение**: Возвращает объединение описаний ограничений на действия, предоставляемых каждым инструментом, для prompt.
    - **Параметры**: `None`
    - **Возвращает**: `str`: Описание ограничений на действия, предоставляемых каждым инструментом.
# Модуль `mental_faculty.py`

## Обзор

Модуль содержит классы для представления и управления ментальными способностями агента, такими как память, доступ к файлам и использование инструментов.

## Подробней

Модуль предоставляет базовый класс `TinyMentalFaculty`, от которого наследуются другие классы, реализующие конкретные ментальные способности. Также модуль содержит классы `CustomMentalFaculty`, `RecallFaculty`, `FilesAndWebGroundingFaculty` и `TinyToolUse`, каждый из которых предоставляет агенту определенные когнитивные возможности.

## Классы

### `TinyMentalFaculty`

**Описание**:
Представляет ментальную способность агента. Ментальные способности - это когнитивные способности, которыми обладает агент.

**Принцип работы**:
Этот класс является базовым для всех ментальных способностей. Он содержит общую логику инициализации и обработки действий.

**Аттрибуты**:
- `name` (str): Имя ментальной способности.
- `requires_faculties` (list): Список ментальных способностей, которые необходимы для нормального функционирования этой способности.

**Методы**:
- `__init__(self, name: str, requires_faculties: list = None) -> None`:
    Инициализирует ментальную способность.
- `__str__(self) -> str`:
    Возвращает строковое представление ментальной способности.
- `__eq__(self, other)`:
    Сравнивает текущую ментальную способность с другой на равенство.
- `process_action(self, agent, action: dict) -> bool`:
    Обрабатывает действие, связанное с этой способностью. Должен быть переопределен в подклассах.
- `actions_definitions_prompt(self) -> str`:
    Возвращает prompt для определения действий, связанных с этой способностью. Должен быть переопределен в подклассах.
- `actions_constraints_prompt(self) -> str`:
    Возвращает prompt для определения ограничений на действия, связанные с этой способностью. Должен быть переопределен в подклассах.

---

### `CustomMentalFaculty`

**Описание**:
Представляет собой пользовательскую ментальную способность агента. Пользовательские ментальные способности — это когнитивные способности, которыми обладает агент.

**Наследует**:
`TinyMentalFaculty`

**Принцип работы**:
Этот класс позволяет пользователю определять ментальные способности, указывая действия, которые способность может выполнять, и ограничения, которые она вводит.

**Аттрибуты**:
- `name` (str): Имя ментальной способности.
- `requires_faculties` (list): Список ментальных способностей, которые необходимы для нормального функционирования этой способности.
- `actions_configs` (dict): Словарь с конфигурацией действий, которые может выполнять эта способность.
- `constraints` (dict): Список ограничений, вводимых этой способностью.

**Методы**:
- `__init__(self, name: str, requires_faculties: list = None, actions_configs: dict = None, constraints: dict = None)`:
    Инициализирует пользовательскую ментальную способность.

- `add_action(self, action_name: str, description: str, function: Callable = None)`:
    Добавляет действие в конфигурацию действий этой способности.
- `add_actions(self, actions: dict)`:
    Добавляет несколько действий в конфигурацию действий этой способности.
- `add_action_constraint(self, constraint: str)`:
    Добавляет ограничение на действие.
- `add_actions_constraints(self, constraints: list)`:
    Добавляет несколько ограничений на действия.
- `process_action(self, agent, action: dict) -> bool`:
    Обрабатывает действие, связанное с этой способностью.

    **Как работает функция**:

    1. Извлекает тип действия из входного словаря `action`.
    2. Проверяет, существует ли этот тип действия в конфигурации `self.actions_configs`.
    3. Если тип действия существует, извлекает соответствующую конфигурацию действия `action_config`.
    4. Пытается получить функцию действия `action_function` из конфигурации (если она определена).
    5. Если функция действия определена, вызывает её с агентом и действием в качестве аргументов.
    6. Возвращает `True`, если действие было успешно обработано, и `False` в противном случае.

    ```
    Начало
    │
    ├───> Получение типа действия из action['type']
    │
    ├───> Проверка: action_type in self.actions_configs
    │     └───> Да: Извлечение action_config из self.actions_configs[action_type]
    │           └───> Попытка получить action_function из action_config
    │                 └───> Если action_function существует:
    │                       └───> Вызов action_function(agent, action)
    │                             └───> Возврат True
    │                 └───> Иначе: Возврат True
    │     └───> Нет: Возврат False
    │
    └───> Конец
    ```

- `actions_definitions_prompt(self) -> str`:
    Возвращает prompt для определения действий, связанных с этой способностью.
- `actions_constraints_prompt(self) -> str`:
    Возвращает prompt для определения ограничений на действия, связанные с этой способностью.

---

### `RecallFaculty`

**Описание**:
Представляет ментальную способность агента к извлечению информации из памяти.

**Наследует**:
`TinyMentalFaculty`

**Принцип работы**:
Этот класс позволяет агенту извлекать информацию из своей семантической памяти на основе заданного запроса.

**Методы**:
- `__init__(self)`:
    Инициализирует способность к извлечению информации из памяти.
- `process_action(self, agent, action: dict) -> bool`:
    Обрабатывает действие, связанное с этой способностью.

    **Как работает функция**:

    1. Проверяет, является ли тип действия "RECALL" и содержит ли действие какой-либо контент.
    2. Если да, извлекает контент из действия.
    3. Извлекает релевантные воспоминания из семантической памяти агента на основе контента.
    4. Логирует информацию об извлеченных воспоминаниях.
    5. Если воспоминания найдены, заставляет агента подумать о них и использовать их для руководства в последующих действиях.
    6. Если воспоминания не найдены, заставляет агента подумать о том, что он ничего не помнит об этом.
    7. Возвращает `True`, если действие было успешно обработано, и `False` в противном случае.

    ```
    Начало
    │
    ├───> Проверка: action['type'] == "RECALL" and action['content'] is not None
    │     └───> Да: Извлечение content из action['content']
    │           └───> Извлечение semantic_memories из agent.retrieve_relevant_memories(relevance_target=content)
    │           └───> Логирование информации об извлеченных воспоминаниях
    │           └───> Проверка: len(semantic_memories) > 0
    │                 └───> Да: Заставляет агента подумать о воспоминаниях и возвращает True
    │                 └───> Нет: Заставляет агента подумать, что он ничего не помнит и возвращает True
    │     └───> Нет: Возврат False
    │
    └───> Конец
    ```
- `actions_definitions_prompt(self) -> str`:
    Возвращает prompt для определения действий, связанных с этой способностью.
- `actions_constraints_prompt(self) -> str`:
    Возвращает prompt для определения ограничений на действия, связанные с этой способностью.

---

### `FilesAndWebGroundingFaculty`

**Описание**:
Позволяет агенту получать доступ к локальным файлам и веб-страницам, чтобы обосновать свои знания.

**Наследует**:
`TinyMentalFaculty`

**Принцип работы**:
Этот класс предоставляет агенту возможность консультации документов и извлечения информации из локальных файлов и веб-страниц.

**Аттрибуты**:
- `local_files_grounding_connector` (LocalFilesGroundingConnector): Объект для доступа к локальным файлам.
- `web_grounding_connector` (WebPagesGroundingConnector): Объект для доступа к веб-страницам.

**Методы**:
- `__init__(self, folders_paths: list = None, web_urls: list = None)`:
    Инициализирует способность доступа к файлам и веб-страницам.
- `process_action(self, agent, action: dict) -> bool`:
    Обрабатывает действие, связанное с этой способностью.

    **Как работает функция**:

    1. Проверяет тип действия: "CONSULT" или "LIST_DOCUMENTS".
    2. Если тип действия "CONSULT", извлекает имя целевого документа из действия.
    3. Извлекает результаты поиска по имени документа из локальных файлов и веб-страниц.
    4. Если результаты найдены, заставляет агента подумать о прочитанном документе.
    5. Если результаты не найдены, заставляет агента подумать, что он не может найти документ с указанным именем.
    6. Если тип действия "LIST_DOCUMENTS", извлекает список доступных документов из локальных файлов и веб-страниц.
    7. Если список документов не пуст, заставляет агента подумать о доступных документах.
    8. Если список документов пуст, заставляет агента подумать, что нет доступных документов для осмотра.
    9. Возвращает `True`, если действие было успешно обработано, и `False` в противном случае.

    ```
    Начало
    │
    ├───> Проверка: action['type'] == "CONSULT" and action['content'] is not None
    │     └───> Да: Извлечение target_name из action['content']
    │           └───> Извлечение результатов поиска из локальных файлов и веб-страниц
    │           └───> Проверка: len(results) > 0
    │                 └───> Да: Заставляет агента подумать о прочитанном документе и возвращает True
    │                 └───> Нет: Заставляет агента подумать, что он не может найти документ и возвращает True
    │
    ├───> Проверка: action['type'] == "LIST_DOCUMENTS" and action['content'] is not None
    │     └───> Да: Извлечение списка доступных документов из локальных файлов и веб-страниц
    │           └───> Проверка: len(available_names) > 0
    │                 └───> Да: Заставляет агента подумать о доступных документах и возвращает True
    │                 └───> Нет: Заставляет агента подумать, что нет доступных документов и возвращает True
    │
    └───> Нет: Возврат False
    │
    └───> Конец
    ```

- `actions_definitions_prompt(self) -> str`:
    Возвращает prompt для определения действий, связанных с этой способностью.
- `actions_constraints_prompt(self) -> str`:
    Возвращает prompt для определения ограничений на действия, связанные с этой способностью.

---

### `TinyToolUse`

**Описание**:
Позволяет агенту использовать инструменты для выполнения задач. Использование инструментов - один из важнейших когнитивных навыков, которым обладают люди и приматы.

**Наследует**:
`TinyMentalFaculty`

**Принцип работы**:
Этот класс предоставляет агенту возможность использовать различные инструменты для выполнения задач.

**Аттрибуты**:
- `tools` (list): Список доступных инструментов.

**Методы**:
- `__init__(self, tools: list) -> None`:
    Инициализирует способность использования инструментов.
- `process_action(self, agent, action: dict) -> bool`:
    Обрабатывает действие, связанное с этой способностью.

    **Как работает функция**:

    1. Перебирает каждый инструмент в списке `self.tools`.
    2. Для каждого инструмента вызывает метод `process_action(agent, action)`.
    3. Если какой-либо инструмент успешно обработал действие, возвращает `True`.
    4. Если ни один инструмент не обработал действие, возвращает `False`.

    ```
    Начало
    │
    ├───> Для каждого tool в self.tools:
    │     └───> Вызов tool.process_action(agent, action)
    │           └───> Если tool.process_action вернул True:
    │                 └───> Возврат True
    │
    └───> Возврат False
    │
    └───> Конец
    ```
- `actions_definitions_prompt(self) -> str`:
    Возвращает prompt для определения действий, связанных с этой способностью.
- `actions_constraints_prompt(self) -> str`:
    Возвращает prompt для определения ограничений на действия, связанные с этой способностью.

## Функции

В данном модуле функции отсутствуют.
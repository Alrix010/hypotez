# Модуль tiny_enricher

## Обзор

Модуль `tiny_enricher.py` предназначен для обогащения текстового контента на основе заданных требований и контекстной информации с использованием языковых моделей (LLM). Он содержит класс `TinyEnricher`, который управляет процессом обогащения контента, используя шаблоны сообщений и взаимодействие с OpenAI API.

## Подробней

Модуль предоставляет функциональность для динамического обогащения контента, что позволяет улучшить качество и релевантность информации. Класс `TinyEnricher` использует шаблоны Mustache для формирования запросов к LLM, а также кэширует контекстную информацию для повторного использования.

## Классы

### `TinyEnricher`

**Описание**:
Класс `TinyEnricher` предназначен для обогащения контента с использованием языковых моделей. Он управляет процессом формирования запросов к LLM, отправки запросов и обработки результатов.

**Принцип работы**:

1.  Инициализация класса `TinyEnricher` задает необходимость использования предыдущих результатов в контексте.
2.  Метод `enrich_content` принимает требования, контент и контекстную информацию, формирует сообщения для LLM на основе шаблонов, отправляет запрос к OpenAI API и извлекает обогащенный контент из ответа.
3.  Результаты обогащения логируются для отладки.

**Аттрибуты**:

*   `use_past_results_in_context` (bool): Определяет, использовать ли предыдущие результаты в контексте. По умолчанию `False`.
*   `context_cache` (list): Кэш для хранения контекстной информации.

**Методы**:

*   `__init__`: Инициализирует экземпляр класса `TinyEnricher`.
*   `enrich_content`: Обогащает контент на основе заданных требований и контекстной информации.

## Функции

### `__init__`

```python
def __init__(self, use_past_results_in_context=False) -> None:
    """
    Инициализирует экземпляр класса `TinyEnricher`.

    Args:
        use_past_results_in_context (bool): Определяет, использовать ли предыдущие результаты в контексте. По умолчанию `False`.

    Returns:
        None
    """
    ...
```

**Назначение**:
Инициализирует экземпляр класса `TinyEnricher`, устанавливая необходимость использования предыдущих результатов в контексте и инициализируя кэш контекстной информации.

**Параметры**:

*   `use_past_results_in_context` (bool): Флаг, определяющий, следует ли использовать предыдущие результаты в контексте. По умолчанию `False`.

**Возвращает**:

*   `None`

**Как работает функция**:

1.  Устанавливает значение атрибута `use_past_results_in_context` на основе переданного аргумента.
2.  Инициализирует пустой список `context_cache` для хранения контекстной информации.

```ascii
Инициализация TinyEnricher
│
├───> Установка флага use_past_results_in_context
│
└───> Инициализация context_cache как пустого списка
```

### `enrich_content`

```python
def enrich_content(self, requirements: str, content:str, content_type:str =None, context_info:str ="", context_cache:list=None, verbose:bool=False):
    """
    Обогащает контент на основе заданных требований и контекстной информации.

    Args:
        requirements (str): Требования к обогащению контента.
        content (str): Контент, который необходимо обогатить.
        content_type (str, optional): Тип контента. По умолчанию `None`.
        context_info (str, optional): Контекстная информация. По умолчанию "".
        context_cache (list, optional): Кэш контекстной информации. По умолчанию `None`.
        verbose (bool, optional): Флаг для вывода отладочной информации. По умолчанию `False`.

    Returns:
        str | None: Обогащенный контент или `None`, если обогащение не удалось.

    Raises:
        Exception: Если возникает ошибка при взаимодействии с LLM.
    """
    ...
```

**Назначение**:
Обогащает предоставленный контент, используя языковую модель, на основе заданных требований и контекстной информации.

**Параметры**:

*   `requirements` (str): Требования к обогащению контента.
*   `content` (str): Контент, который необходимо обогатить.
*   `content_type` (str, optional): Тип контента. По умолчанию `None`.
*   `context_info` (str, optional): Дополнительная контекстная информация. По умолчанию `""`.
*   `context_cache` (list, optional): Кэш контекстной информации. По умолчанию `None`.
*   `verbose` (bool, optional): Флаг для включения режима отладки. По умолчанию `False`.

**Возвращает**:

*   `str | None`: Обогащенный контент в виде строки или `None`, если обогащение не удалось.

**Как работает функция**:

1.  Формирует словарь `rendering_configs` с параметрами для шаблонов сообщений.
2.  Составляет сообщения для LLM, используя шаблоны "enricher.system.mustache" и "enricher.user.mustache".
3.  Отправляет сообщение в OpenAI API с помощью `openai_utils.client().send_message`.
4.  Извлекает код из ответа LLM с помощью `utils.extract_code_block`.
5.  Логирует и, при необходимости, выводит отладочную информацию.
6.  Возвращает обогащенный контент или `None` в случае ошибки.

```ascii
Обогащение контента
│
├───> Формирование rendering_configs
│
├───> Композиция сообщений LLM из шаблонов
│   │
│   ├───> Загрузка шаблона enricher.system.mustache
│   │
│   └───> Загрузка шаблона enricher.user.mustache
│
├───> Отправка сообщения в OpenAI API
│
├───> Извлечение кода из ответа LLM
│
├───> Логирование результата
│
└───> Возврат обогащенного контента
```

**Примеры**:

```python
from tinytroupe.enrichment.tiny_enricher import TinyEnricher

enricher = TinyEnricher()
requirements = "Добавить пример использования на Python."
content = "def hello_world():\n    print('Hello, world!')"
enriched_content = enricher.enrich_content(requirements, content)
if enriched_content:
    print(f"Enriched content: {enriched_content}")
else:
    print("Failed to enrich content.")
```
# Модуль для генерации отчетов о прайс-листах

## Обзор

Модуль предназначен для генерации HTML и PDF отчетов на основе данных о прайс-листах. Он использует шаблоны Jinja2 для создания HTML-контента, который затем преобразуется в PDF. Модуль предоставляет класс `ReportGenerator` для управления процессом генерации отчетов.

## Подробней

Модуль `pricelist_generator.py` является частью проекта `hypotez` и отвечает за генерацию отчетов о прайс-листах в формате HTML и PDF. Он использует шаблоны Jinja2 для создания HTML-контента, который затем преобразуется в PDF с использованием библиотеки `pdfkit`.

## Классы

### `ReportGenerator`

**Описание**: Класс для генерации HTML- и PDF-отчётов на основе данных из JSON.

**Атрибуты**:

-   `env` (Environment): Окружение Jinja2, используемое для загрузки и рендеринга шаблонов. Инициализируется с использованием `FileSystemLoader`, указывающего на текущую директорию.

**Методы**:

-   `generate_html(data: dict, lang: str) -> str`: Генерирует HTML-контент на основе шаблона и данных.
-   `create_report(data: dict, lang: str, html_file: str | Path, pdf_file: str | Path) -> bool`: Полный цикл генерации отчёта.

### `Environment`
**Описание**: Класс для создания окружения Jinja2
**Параметры**:
- `loader`: Загрузчик шаблонов. По умолчанию `FileSystemLoader`

**Принцип работы**:
Класс `ReportGenerator` используется для генерации отчетов о прайс-листах в формате HTML и PDF. Он принимает данные в формате JSON, загружает шаблоны Jinja2 и генерирует HTML-контент на основе этих данных. Затем HTML-контент преобразуется в PDF с использованием библиотеки `pdfkit`.

## Методы класса

### `generate_html`

```python
async def generate_html(self, data: dict, lang: str) -> str:
    """
    Генерирует HTML-контент на основе шаблона и данных.

    Args:
        data (dict): Словарь с данными для заполнения шаблона.
        lang (str): Язык отчёта ('he' для иврита, любой другой - для русского).

    Returns:
        str: HTML-контент.
    """
```

**Назначение**: Генерирует HTML-контент на основе шаблона и переданных данных.

**Параметры**:

-   `data` (dict): Словарь с данными для заполнения шаблона.
-   `lang` (str): Язык отчёта ('he' для иврита, любой другой - для русского).

**Возвращает**:

-   `str`: Сгенерированный HTML-контент.

**Как работает функция**:

1.  Определяет, какой шаблон использовать в зависимости от языка (`lang`). Если язык 'he', используется шаблон `template_table_he.html`, иначе - `template_table_ru.html`.
2.  Формирует путь к выбранному шаблону.
3.  Читает содержимое шаблона из файла.
4.  Создает объект шаблона Jinja2 из строки.
5.  Рендерит шаблон с использованием переданных данных (`data`).
6.  Возвращает сгенерированный HTML-контент.

**Примеры**:

```python
# Пример вызова функции
data = {'products': [{'name': 'Товар 1', 'price': 100}, {'name': 'Товар 2', 'price': 200}]}
lang = 'ru'
report_generator = ReportGenerator()
html_content = asyncio.run(report_generator.generate_html(data, lang))
print(html_content[:100])  # Вывод первых 100 символов HTML
```

### `create_report`

```python
async def create_report(self, data: dict, lang: str, html_file: str | Path, pdf_file: str | Path) -> bool:
    """
    Полный цикл генерации отчёта.

    Args:
        data (dict): Словарь с данными для отчёта.
        lang (str): Язык отчёта ('ru' или 'he').
        html_file (str | Path): Путь для сохранения HTML-файла.
        pdf_file (str | Path): Путь для сохранения PDF-файла.

    Returns:
        bool: `True`, если отчёт успешно сгенерирован, `False` в противном случае.
    """
```

**Назначение**: Генерирует HTML и PDF файлы отчета на основе предоставленных данных.

**Параметры**:

-   `data` (dict): Словарь с данными для отчёта.
-   `lang` (str): Язык отчёта ('ru' или 'he').
-   `html_file` (str | Path): Путь для сохранения HTML-файла.
-   `pdf_file` (str | Path): Путь для сохранения PDF-файла.

**Возвращает**:

-   `bool`: `True`, если отчёт успешно сгенерирован, `False` в противном случае.

**Как работает функция**:

1.  Добавляет информацию об обслуживании в данные (`data`). Если язык русский, добавляется запись с `product_title` равным "Сервис", иначе "שירות". Также добавляется описание сервиса из HTML-файла и случайное изображение.
2.  Генерирует HTML-контент с использованием метода `generate_html`.
3.  Сохраняет HTML-контент в файл.
4.  Инициализирует объект `PDFUtils`.
5.  Преобразует HTML-контент в PDF и сохраняет в файл с использованием `pdf.save_pdf_pdfkit`.
6.  В случае ошибки логирует сообщение и возвращает `False`.
7.  В случае успеха возвращает `True`.

**Примеры**:

```python
# Пример вызова функции
data = {'products': [{'name': 'Товар 1', 'price': 100}, {'name': 'Товар 2', 'price': 200}]}
lang = 'ru'
html_file = 'report.html'
pdf_file = 'report.pdf'
report_generator = ReportGenerator()
result = asyncio.run(report_generator.create_report(data, lang, html_file, pdf_file))
print(result)  # Вывод: True или False в зависимости от успеха генерации
```

## Функции

### `main`

```python
def main(mexiron: str, lang: str) -> bool:
    """
    Основная функция для запуска генерации отчёта.

    Args:
        mexiron (str): Название мехирона.
        lang (str): Язык отчёта ('ru' или 'he').

    Returns:
        bool: `True`, если отчёт успешно сгенерирован, `False` в противном случае.
    """
```

**Назначение**: Главная функция для запуска процесса генерации отчета.

**Параметры**:

-   `mexiron` (str): Название мехирона.
-   `lang` (str): Язык отчёта ('ru' или 'he').

**Возвращает**:

-   `bool`: `True`, если отчет успешно сгенерирован, `False` в противном случае.

**Как работает функция**:

1.  Формирует путь к данным JSON, HTML и PDF файлам на основе входных параметров `mexiron` и `lang`.
2.  Загружает данные из JSON-файла с использованием `j_loads`.
3.  Создает экземпляр класса `ReportGenerator`.
4.  Запускает асинхронную функцию `create_report` для генерации отчета.

**Примеры**:

```python
# Пример вызова функции
mexiron = '24_12_01_03_18_24_269'
lang = 'ru'
result = main(mexiron, lang)
print(result)  # Вывод: True или False в зависимости от успеха генерации
```
# Модуль `TeachAnything.py`

## Обзор

Модуль предоставляет асинхронный генератор для взаимодействия с API `teach-anything.com`. Он позволяет генерировать текст на основе предоставленных сообщений, используя модели Gemini. Модуль поддерживает выбор модели, передачу прокси и обработку ошибок декодирования.

## Подробней

Этот модуль предназначен для интеграции с веб-сервисом `teach-anything.com`, который предоставляет API для генерации текста с использованием моделей Gemini. Модуль предоставляет класс `TeachAnything`, который реализует асинхронный генератор для получения сгенерированного текста. Класс поддерживает выбор модели (`gemini-1.5-pro` или `gemini-1.5-flash`), передачу прокси и обработку ошибок декодирования.

## Классы

### `TeachAnything`

**Описание**: Класс для взаимодействия с API `teach-anything.com`. Реализует асинхронный генератор для получения сгенерированного текста на основе предоставленных сообщений.
**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает базовую функциональность асинхронного генератора.
- `ProviderModelMixin`: Предоставляет методы для работы с моделями.

**Атрибуты**:
- `url` (str): URL веб-сервиса `teach-anything.com`.
- `api_endpoint` (str): Endpoint API для генерации текста.
- `working` (bool): Указывает, работает ли провайдер.
- `default_model` (str): Модель по умолчанию (`gemini-1.5-pro`).
- `models` (List[str]): Список поддерживаемых моделей (`gemini-1.5-pro`, `gemini-1.5-flash`).

**Методы**:
- `create_async_generator()`: Создает асинхронный генератор для получения сгенерированного текста.
- `_get_headers()`: Возвращает словарь с заголовками HTTP-запроса.

## Функции

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str | None = None,
        **kwargs: Any
    ) -> AsyncResult:
        """Создает асинхронный генератор для получения сгенерированного текста.

        Args:
            model (str): Название модели для генерации текста.
            messages (Messages): Список сообщений для генерации текста.
            proxy (str | None, optional): URL прокси-сервера. По умолчанию `None`.
            **kwargs (Any): Дополнительные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий сгенерированный текст.

        Raises:
            aiohttp.ClientResponseError: Если HTTP-запрос завершается с ошибкой.
            UnicodeDecodeError: Если не удается декодировать полученные данные.

        """
```

**Назначение**: Создает асинхронный генератор для получения сгенерированного текста от API `teach-anything.com`.

**Параметры**:
- `model` (str): Название модели для генерации текста. Допустимые значения: `gemini-1.5-pro`, `gemini-1.5-flash`.
- `messages` (Messages): Список сообщений для генерации текста.
- `proxy` (str | None, optional): URL прокси-сервера. По умолчанию `None`.
- `**kwargs` (Any): Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий сгенерированный текст.

**Вызывает исключения**:
- `aiohttp.ClientResponseError`: Если HTTP-запрос завершается с ошибкой.
- `UnicodeDecodeError`: Если не удается декодировать полученные данные.

**Как работает функция**:

1. **Подготовка**:
   - Устанавливает заголовки запроса.
   - Получает название модели.
   - Форматирует входные сообщения в строку запроса.
2. **Отправка запроса**:
   - Отправляет POST-запрос к API `teach-anything.com` с использованием `aiohttp.ClientSession`.
   - Устанавливает таймаут для запроса.
3. **Обработка ответа**:
   - Итерируется по чанкам ответа, полученным от сервера.
   - Накапливает чанки в буфере.
   - Пытается декодировать буфер в UTF-8.
   - Если декодирование успешно, возвращает декодированную строку через генератор.
   - Если декодирование не удалось, ждет поступления новых данных.
4. **Обработка остатка**:
   - После завершения итерации по чанкам, пытается декодировать оставшийся буфер.
   - В случае успеха, возвращает декодированную строку через генератор.
   - В случае ошибки декодирования, печатает сообщение об ошибке.

```
    Подготовка данных и заголовков
    ↓
    Отправка POST-запроса к API teach-anything.com
    ↓
    Итерация по чанкам ответа
    │
    ├──→ Накопление чанков в буфере
    │
    └──→ Попытка декодирования буфера в UTF-8
        │
        ├──→ Успешно: Возврат декодированной строки через генератор
        │
        └──→ Неудачно: Ожидание новых данных
    ↓
    Обработка остатка в буфере
    │
    ├──→ Успешно: Возврат декодированной строки через генератор
    │
    └──→ Неудачно: Вывод сообщения об ошибке
```

**Примеры**:

```python
# Пример использования асинхронного генератора
async for chunk in TeachAnything.create_async_generator(model='gemini-1.5-pro', messages=[{'role': 'user', 'content': 'Hello'}]):
    print(chunk, end='')
```

### `_get_headers`

```python
    @staticmethod
    def _get_headers() -> Dict[str, str]:
        """Возвращает словарь с заголовками HTTP-запроса.

        Returns:
            Dict[str, str]: Словарь с заголовками HTTP-запроса.
        """
```

**Назначение**: Возвращает словарь с заголовками HTTP-запроса, необходимыми для взаимодействия с API `teach-anything.com`.

**Возвращает**:
- `Dict[str, str]`: Словарь с заголовками HTTP-запроса.

**Как работает функция**:

Функция создает и возвращает словарь, содержащий набор HTTP-заголовков, используемых для запросов к API `teach-anything.com`. Эти заголовки включают информацию о типе контента, User-Agent, Referer и другие параметры, необходимые для успешного взаимодействия с API.

```
    Создание словаря с HTTP-заголовками
    ↓
    Возврат словаря
```

**Примеры**:

```python
# Пример получения заголовков
headers = TeachAnything._get_headers()
print(headers)
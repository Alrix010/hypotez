# Модуль AiService
## Обзор
Модуль `AiService` представляет собой реализацию абстрактного провайдера `AbstractProvider` для взаимодействия с сервисом aiservice.vercel.app. Он предоставляет функциональность для создания завершений текста на основе предоставленных сообщений, имитируя поведение чат-ассистента. Модуль поддерживает модель `gpt-3.5-turbo`.

## Подробней

Этот модуль позволяет взаимодействовать с AI Service (aiservice.vercel.app) для генерации ответов на основе предоставленных сообщений. Он отправляет POST запросы к API сервиса и возвращает сгенерированный ответ. Модуль предназначен для использования в качестве одного из провайдеров в системе, где требуется взаимодействие с различными AI-моделями.

## Классы

### `AiService`

**Описание**: Класс `AiService` предоставляет методы для взаимодействия с AI Service API.

**Наследует**:

- `AbstractProvider`: Наследует базовый класс для провайдеров, определяющий интерфейс взаимодействия с AI-моделями.

**Атрибуты**:

- `url` (str): URL сервиса `https://aiservice.vercel.app/`.
- `working` (bool): Указывает, работает ли данный провайдер (в данном случае `False`).
- `supports_gpt_35_turbo` (bool): Указывает на поддержку модели `gpt-3.5-turbo` (в данном случае `True`).

**Методы**:

- `create_completion`: Создает завершение текста на основе предоставленных сообщений.

## Функции

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: Messages,
    stream: bool,
    **kwargs: Any,
) -> CreateResult:
    """ Функция создает завершение текста на основе предоставленных сообщений.

    Args:
        model (str): Идентификатор модели, используемой для генерации ответа.
        messages (Messages): Список сообщений, представляющих собой историю общения.
        stream (bool): Указывает, должен ли ответ возвращаться в режиме потока.
        **kwargs (Any): Дополнительные параметры.

    Returns:
        CreateResult: Результат создания завершения текста.

    Raises:
        requests.exceptions.HTTPError: Если возникает HTTP ошибка при запросе к API.
    """
```

**Назначение**: Метод `create_completion` отправляет запрос к AI Service API для генерации ответа на основе предоставленных сообщений.

**Параметры**:

- `model` (str): Идентификатор модели, используемой для генерации ответа.
- `messages` (Messages): Список сообщений, представляющих собой историю общения, где каждое сообщение содержит роль (`role`) и контент (`content`).
- `stream` (bool): Указывает, должен ли ответ возвращаться в режиме потока (в данном случае всегда `False`).
- `**kwargs` (Any): Дополнительные параметры, которые могут быть переданы в функцию.

**Возвращает**:

- `CreateResult`: Генератор, выдающий части сгенерированного текста.

**Вызывает исключения**:

- `requests.exceptions.HTTPError`: Возникает, если при выполнении запроса к API произошла HTTP ошибка (например, 404, 500).

**Как работает функция**:

1. **Формирование запроса**:
   - Функция принимает список сообщений `messages` и преобразует его в строку `base`, объединяя роль и контент каждого сообщения.
   - К строке `base` добавляется "assistant: ", чтобы указать, что следующим должен быть ответ ассистента.
2. **Подготовка заголовков**:
   - Определяются заголовки `headers` для HTTP запроса, включающие `accept`, `content-type`, `sec-fetch-dest`, `sec-fetch-mode`, `sec-fetch-site` и `Referer`.
3. **Отправка запроса**:
   - Создается словарь `data`, содержащий сформированную строку `base` под ключом "input".
   - Отправляется POST запрос по адресу `https://aiservice.vercel.app/api/chat/answer` с использованием библиотеки `requests`.
   - Устанавливается таймаут ожидания ответа от сервера.
4. **Обработка ответа**:
   - Проверяется статус ответа с помощью `response.raise_for_status()`, чтобы вызвать исключение в случае HTTP ошибки.
   - Извлекается JSON из ответа и извлекается поле `data`, которое содержит сгенерированный текст.
5. **Генерация результата**:
   - Функция возвращает генератор, который выдает сгенерированный текст.

**ASCII Flowchart**:

```
Формирование запроса
│
├───► Подготовка заголовков
│
├───► Отправка POST запроса
│
├───► Проверка статуса ответа
│
└───► Извлечение данных из JSON
│
└───► Генерация результата
```

**Примеры**:

```python
# Пример использования функции create_completion
messages = [
    {"role": "user", "content": "Привет!"},
    {"role": "assistant", "content": "Привет! Как я могу помочь?"},
    {"role": "user", "content": "Напиши программу на Python, которая выводит 'Hello, world!'"}
]
model = "gpt-3.5-turbo"
stream = False

result = AiService.create_completion(model=model, messages=messages, stream=stream)
for chunk in result:
    print(chunk)
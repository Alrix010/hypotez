# Модуль для работы с провайдером AiAsk
================================================

Модуль содержит класс :class:`AiAsk`, который используется для асинхронного взаимодействия с сервисом AiAsk для генерации текста.

Пример использования
----------------------

```python
# Пример использования класса AiAsk будет представлен позже, после его реализации.
```

## Классы

### `AiAsk`

**Описание**:
Класс `AiAsk` является асинхронным провайдером, предназначенным для взаимодействия с сервисом `e.aiask.me`. Он поддерживает историю сообщений и модель `gpt-3.5-turbo`.

**Атрибуты**:
- `url` (str): URL сервиса AiAsk (`https://e.aiask.me`).
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений (True).
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели gpt-3.5-turbo (True).
- `working` (bool): Флаг, указывающий на работоспособность провайдера (False).

**Методы**:
- `create_async_generator`: Асинхронный генератор для получения ответов от AiAsk.

## Функции

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        **kwargs
    ) -> AsyncResult:
        """
        Асинхронно создает генератор для получения ответов от AiAsk.

        Args:
            model (str): Модель для использования.
            messages (Messages): Список сообщений для отправки.
            proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
            **kwargs: Дополнительные параметры.

        Returns:
            AsyncResult: Асинхронный генератор, выдающий ответы от AiAsk.

        Raises:
            RuntimeError: Если достигнут лимит запросов (Rate limit reached).

        """
```

**Назначение**:
Функция `create_async_generator` создает асинхронный генератор, который взаимодействует с сервисом AiAsk для получения ответов на основе предоставленных сообщений. Она отправляет POST-запрос к API AiAsk и возвращает чанки данных по мере их поступления.

**Параметры**:
- `model` (str): Указывает модель, которую следует использовать для генерации ответа.
- `messages` (Messages): Список сообщений, отправляемых в запросе.
- `proxy` (str, optional): Адрес прокси-сервера для использования при подключении к AiAsk. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры, такие как `temperature`, влияющие на генерацию текста.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий текстовые чанки ответа от AiAsk.

**Вызывает исключения**:
- `RuntimeError`: Вызывается, если достигнут лимит запросов к AiAsk (сообщение "Rate limit reached").

**Как работает функция**:

1. **Формирование заголовков**:
   - Создаются HTTP-заголовки, включающие `accept`, `origin` и `referer`, необходимые для запроса к AiAsk.
2. **Создание сессии**:
   - Инициализируется асинхронная сессия `aiohttp.ClientSession` с заданными заголовками.
3. **Подготовка данных**:
   - Формируются данные запроса в формате JSON, включающие историю сообщений, параметры модели и прочие настройки.
4. **Отправка запроса и обработка ответа**:
   - Отправляется POST-запрос к API AiAsk (`/v1/chat/gpt/`) с использованием асинхронной сессии.
   - Для каждого чанка данных, полученного из ответа, выполняется проверка на достижение лимита запросов. Если лимит достигнут, вызывается исключение `RuntimeError`.
   - Если лимит не достигнут, чанк декодируется и возвращается через генератор.

```
    Формирование заголовков --> Создание сессии 
        ↓
    Подготовка данных  --> Отправка POST запроса к API AiAsk
        ↓
    Обработка ответа (проверка на лимит) --> Генерация чанков данных
        ↓
    Завершение
```

**Примеры**:
```python
# Пример использования функции create_async_generator будет представлен позже, после ее реализации.
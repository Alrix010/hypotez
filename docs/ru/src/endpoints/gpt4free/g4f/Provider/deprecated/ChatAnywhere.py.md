# Модуль ChatAnywhere

## Обзор

Модуль `ChatAnywhere` предоставляет асинхронный генератор для взаимодействия с сервисом `chatanywhere.cn`. Он поддерживает модель `gpt-3.5-turbo` и сохраняет историю сообщений. Модуль предназначен для использования в асинхронных приложениях.

## Подробней

Модуль используется для отправки запросов к сервису `chatanywhere.cn` и получения ответов в виде асинхронного генератора. Это позволяет обрабатывать большие объемы данных потоково, не загружая все данные в память сразу.

## Классы

### `ChatAnywhere`

**Описание**: Класс `ChatAnywhere` является провайдером для работы с сервисом `chatanywhere.cn`. Он наследуется от `AsyncGeneratorProvider` и реализует метод `create_async_generator` для создания асинхронного генератора.

**Наследует**:

- `AsyncGeneratorProvider`: Обеспечивает базовую функциональность для асинхронных генераторов.

**Атрибуты**:

- `url` (str): URL сервиса `chatanywhere.cn`.
- `supports_gpt_35_turbo` (bool): Указывает, что поддерживается модель `gpt-3.5-turbo`.
- `supports_message_history` (bool): Указывает, что поддерживается история сообщений.
- `working` (bool): Указывает, что модуль находится в рабочем состоянии.

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str | None = None,
    timeout: int = 120,
    temperature: float = 0.5,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для взаимодействия с сервисом ChatAnywhere.

    Args:
        model (str): Модель для использования.
        messages (Messages): Список сообщений для отправки.
        proxy (Optional[str], optional): Прокси-сервер для использования. По умолчанию `None`.
        timeout (int, optional): Время ожидания ответа от сервера. По умолчанию 120.
        temperature (float, optional): Температура генерации текста. По умолчанию 0.5.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий ответы от сервиса.

    Raises:
        aiohttp.ClientError: Если возникает ошибка при выполнении запроса к сервису.

    """
```

**Назначение**: Создает асинхронный генератор для взаимодействия с сервисом `chatanywhere.cn`.

**Параметры**:

- `cls`: Ссылка на класс.
- `model` (str): Модель для использования.
- `messages` (Messages): Список сообщений для отправки.
- `proxy` (Optional[str], optional): Прокси-сервер для использования. По умолчанию `None`.
- `timeout` (int, optional): Время ожидания ответа от сервера. По умолчанию 120.
- `temperature` (float, optional): Температура генерации текста. По умолчанию 0.5.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:

- `AsyncResult`: Асинхронный генератор, выдающий ответы от сервиса.

**Вызывает исключения**:

- `aiohttp.ClientError`: Если возникает ошибка при выполнении запроса к сервису.

**Как работает функция**:

1. **Определение заголовков**: Функция определяет заголовки, которые будут отправлены вместе с запросом к сервису `chatanywhere.cn`. Заголовки включают User-Agent, Accept, Accept-Language, Content-Type, Referer, Origin, Sec-Fetch-Dest, Sec-Fetch-Mode, Sec-Fetch-Site, Authorization, Connection и TE.
2. **Создание сессии**: Функция создает асинхронную сессию с использованием `aiohttp.ClientSession` и передает заголовки и время ожидания.
3. **Подготовка данных**: Функция подготавливает данные для отправки в теле запроса. Данные включают список сообщений, идентификатор, заголовок, промпт, температуру и модель.
4. **Отправка запроса**: Функция отправляет POST-запрос к сервису `chatanywhere.cn` с использованием асинхронной сессии и передает данные в формате JSON.
5. **Обработка ответа**: Функция обрабатывает ответ от сервиса, итерируясь по чанкам данных и декодируя их. Каждый чанк данных выдается как результат генератора.

**ASCII flowchart**:

```
    Определение заголовков
    ↓
    Создание асинхронной сессии
    ↓
    Подготовка данных для запроса
    ↓
    Отправка POST-запроса к сервису
    ↓
    Обработка ответа: итерация по чанкам и декодирование
    ↓
    Выдача чанков данных как результат генератора
```

**Примеры**:

```python
# Пример вызова функции create_async_generator
async def main():
    model = "gpt-3.5-turbo"
    messages = [{"role": "user", "content": "Hello, how are you?"}]
    proxy = None
    timeout = 120
    temperature = 0.5
    async for chunk in ChatAnywhere.create_async_generator(model, messages, proxy, timeout, temperature):
        print(chunk, end="")

# Запуск асинхронной функции
if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
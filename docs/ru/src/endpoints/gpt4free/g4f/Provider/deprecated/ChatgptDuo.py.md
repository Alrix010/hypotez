# Модуль ChatgptDuo

## Обзор

Модуль `ChatgptDuo` предоставляет асинхронный интерфейс для взаимодействия с моделью ChatgptDuo через веб-сайт `chatgptduo.com`. Он позволяет отправлять запросы к модели и получать ответы. Модуль поддерживает модель `gpt-3.5-turbo` и использует `StreamSession` для асинхронных запросов.

## Подробней

Этот модуль является частью набора провайдеров для проекта `hypotez`, предназначенных для работы с различными AI-моделями. Он предоставляет возможность использовать `ChatgptDuo` как один из источников ответов.

## Классы

### `ChatgptDuo`

**Описание**: Класс `ChatgptDuo` наследуется от `AsyncProvider` и предоставляет методы для взаимодействия с моделью `ChatgptDuo`.

**Наследует**:
- `AsyncProvider`: базовый класс для асинхронных провайдеров.

**Атрибуты**:
- `url` (str): URL веб-сайта `Chatgptduo.com`.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo`.
- `working` (bool): Указывает, работает ли провайдер в данный момент.
- `_sources` (list): Список источников, полученных из ответа модели.

**Методы**:
- `create_async`: Асинхронный метод для отправки запроса к модели и получения ответа.
- `get_sources`: Метод для получения списка источников, использованных при генерации ответа.

## Функции

### `create_async`

```python
@classmethod
async def create_async(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    timeout: int = 120,
    **kwargs
) -> str:
    """ Функция отправляет асинхронный запрос к модели ChatgptDuo и получает ответ.

    Args:
        cls (type[ChatgptDuo]): Класс `ChatgptDuo`.
        model (str): Название модели.
        messages (Messages): Список сообщений для отправки в запросе.
        proxy (str, optional): Прокси-сервер для использования при отправке запроса. По умолчанию `None`.
        timeout (int, optional): Время ожидания ответа в секундах. По умолчанию `120`.
        **kwargs: Дополнительные параметры.

    Returns:
        str: Ответ от модели.

    Raises:
        Exception: Если при выполнении запроса возникает ошибка.
    """
```

**Назначение**: Метод `create_async` отправляет запрос к модели `ChatgptDuo` и возвращает ответ.

**Параметры**:
- `cls` (type[ChatgptDuo]): Класс `ChatgptDuo`.
- `model` (str): Название модели.
- `messages` (Messages): Список сообщений для отправки в запросе.
- `proxy` (str, optional): Прокси-сервер для использования при отправке запроса. По умолчанию `None`.
- `timeout` (int, optional): Время ожидания ответа в секундах. По умолчанию `120`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `str`: Ответ от модели.

**Вызывает исключения**:
- `Exception`: Если при выполнении запроса возникает ошибка.

**Как работает функция**:

1.  Инициализация асинхронной сессии `StreamSession` с параметрами `impersonate`, `proxies` и `timeout`.
2.  Форматирование входных сообщений с помощью функции `format_prompt`.
3.  Создание словаря `data`, содержащего форматированный промт для отправки в запросе.
4.  Отправка POST-запроса к URL `cls.url` с использованием асинхронной сессии и переданных данных.
5.  Проверка статуса ответа и вызов исключения `HTTPError`, если статус код указывает на ошибку.
6.  Преобразование ответа в формат JSON.
7.  Извлечение списка источников из ответа и сохранение их в атрибуте `_sources` класса.
8.  Возвращение ответа из JSON-данных.

**ASCII flowchart**:

```
A: Инициализация сессии StreamSession
|
B: Форматирование промта
|
C: Создание данных запроса
|
D: Отправка POST-запроса
|
E: Проверка статуса ответа
|
F: Преобразование в JSON
|
G: Извлечение и сохранение источников
|
H: Возврат ответа
```

**Примеры**:

```python
# Пример использования create_async
messages = [{"role": "user", "content": "Hello, how are you?"}]
# response = await ChatgptDuo.create_async(model="gpt-3.5-turbo", messages=messages)
# print(response)
```

### `get_sources`

```python
@classmethod
def get_sources(cls):
    """ Функция возвращает список источников, использованных при генерации ответа.

    Args:
        cls (type[ChatgptDuo]): Класс `ChatgptDuo`.

    Returns:
        list: Список источников.
    """
```

**Назначение**: Метод `get_sources` возвращает список источников, использованных при генерации ответа.

**Параметры**:
- `cls` (type[ChatgptDuo]): Класс `ChatgptDuo`.

**Возвращает**:
- `list`: Список источников.

**Как работает функция**:

1. Возвращает значение атрибута `cls._sources`, который содержит список источников.

**ASCII flowchart**:

```
A: Возврат cls._sources
```

**Примеры**:

```python
# Пример использования get_sources
# sources = ChatgptDuo.get_sources()
# print(sources)
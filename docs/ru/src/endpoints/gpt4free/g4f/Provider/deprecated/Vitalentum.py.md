# Модуль Vitalentum

## Обзор

Модуль `Vitalentum` предоставляет асинхронный генератор для взаимодействия с API Vitalentum для получения ответов от языковой модели. Он использует `aiohttp` для выполнения асинхронных HTTP-запросов и предназначен для работы с GPT-3.5 Turbo.

## Подробней

Модуль реализует класс `Vitalentum`, который наследуется от `AsyncGeneratorProvider`. Этот класс предназначен для асинхронного получения ответов от модели Vitalentum.

## Классы

### `Vitalentum`

**Описание**: Класс для взаимодействия с API Vitalentum.

**Принцип работы**:
1.  Формирует заголовки и данные запроса на основе входных параметров (сообщения, модель, прокси).
2.  Использует `aiohttp.ClientSession` для отправки POST-запроса к API Vitalentum.
3.  Получает ответ в виде потока данных и извлекает контент из каждой строки ответа.
4.  Генерирует контент асинхронно, пока не получит сообщение о завершении (`data: [DONE]`).

**Аттрибуты**:

*   `url` (str): URL API Vitalentum.
*   `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель GPT-3.5 Turbo (в данном случае `True`).

**Методы**:

*   `create_async_generator`: Асинхронный генератор для получения ответов от API Vitalentum.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """ Функция создает асинхронный генератор для взаимодействия с API Vitalentum и получения ответов от языковой модели.

    Args:
        cls (Vitalentum): Класс `Vitalentum`.
        model (str): Название используемой модели.
        messages (Messages): Список сообщений для отправки в API.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные аргументы для передачи в API.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий контент из ответов API.

    Raises:
        aiohttp.ClientResponseError: Если HTTP-запрос возвращает код ошибки.

    """
```

**Назначение**: Создание асинхронного генератора для получения ответов от API Vitalentum.

**Параметры**:

*   `cls` (Vitalentum): Класс `Vitalentum`.
*   `model` (str): Название используемой модели.
*   `messages` (Messages): Список сообщений для отправки в API.
*   `proxy` (str, optional): URL прокси-сервера. По умолчанию `None`.
*   `**kwargs`: Дополнительные аргументы для передачи в API.

**Возвращает**:

*   `AsyncResult`: Асинхронный генератор, выдающий контент из ответов API.

**Вызывает исключения**:

*   `aiohttp.ClientResponseError`: Если HTTP-запрос возвращает код ошибки.

**Как работает функция**:

1.  **Подготовка заголовков запроса**: Функция задает заголовки HTTP-запроса, включая `User-Agent`, `Accept`, `Origin`, `Referer` и `Sec-Fetch-*`.
2.  **Преобразование сообщений**: Преобразует список сообщений в формат, ожидаемый API Vitalentum. Сообщения форматируются как список словарей, где роль пользователя или бота указывается в поле "speaker", а содержимое сообщения - в поле "text".
3.  **Формирование данных запроса**: Создает словарь `data`, включающий преобразованные сообщения, температуру (0.7) и дополнительные аргументы `kwargs`.
4.  **Отправка асинхронного запроса**: Использует `aiohttp.ClientSession` для отправки асинхронного POST-запроса к API Vitalentum (`/api/converse-edge`) с заданными заголовками, данными и прокси (если указан).
5.  **Обработка потока данных**: Читает ответ построчно. Если строка начинается с "data: ", она содержит полезные данные. Если строка "data: [DONE]", генерация завершается. Остальные строки преобразуются из JSON в словарь, из которого извлекается контент.
6.  **Генерация контента**: Выдает извлеченный контент с использованием `yield`.

```
   Начало
     ↓
   Подготовка заголовков и данных запроса
     ↓
   Отправка POST-запроса к API Vitalentum
     ↓
   Получение ответа в виде потока данных
     ↓
   Извлечение контента из каждой строки
     ↓
   Генерация контента асинхронно
     ↓
Завершение при получении сообщения "[DONE]"
```

**Примеры**:

```python
# Пример вызова функции (предполагается, что messages - это уже подготовленный список сообщений)
# async for content in Vitalentum.create_async_generator(model="gpt-3.5-turbo", messages=messages):
#     print(content, end="")
```
```python
# messages = [{"role": "user", "content": "Hello, how are you?"}]
# async for chunk in Vitalentum.create_async_generator(model="gpt-3.5-turbo", messages=messages):
#     print(chunk, end="")
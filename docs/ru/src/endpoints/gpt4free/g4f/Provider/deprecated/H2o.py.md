# Модуль для работы с H2o API (устаревший)
=================================================

Модуль содержит класс `H2o`, который является устаревшим провайдером для взаимодействия с API H2o.ai.
Он использует асинхронные запросы для генерации текста на основе предоставленных сообщений.

## Обзор

Модуль `H2o` предоставляет класс `H2o`, который наследуется от `AsyncGeneratorProvider` и предназначен для взаимодействия с API H2o.ai. Он позволяет отправлять запросы к модели `h2oai/h2ogpt-gm-oasst1-en-2048-falcon-40b-v1` для генерации текста на основе предоставленных сообщений. Модуль поддерживает использование прокси и предоставляет возможность настройки параметров генерации текста.

## Подробнее

Модуль `H2o` является частью устаревшего набора провайдеров `gpt4free` и может быть заменен более актуальными реализациями. Он использует библиотеку `aiohttp` для выполнения асинхронных HTTP-запросов.

## Классы

### `H2o`

**Описание**: Класс `H2o` предоставляет функциональность для взаимодействия с API H2o.ai и генерации текста на основе предоставленных сообщений.

**Наследует**:
- `AsyncGeneratorProvider`: Класс `H2o` наследует функциональность асинхронного генератора от `AsyncGeneratorProvider`.

**Атрибуты**:
- `url` (str): URL-адрес API H2o.ai.
- `model` (str): Название используемой модели.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения текстовых результатов от API H2o.ai.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для получения текстовых результатов от API H2o.ai.

    Args:
        cls (H2o): Ссылка на класс `H2o`.
        model (str): Название модели для использования.
        messages (Messages): Список сообщений для отправки в API.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные параметры для передачи в API.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий текстовые результаты.

    Raises:
        aiohttp.ClientResponseError: Если возникает ошибка при выполнении HTTP-запроса.

    **Внутренние функции**:
    - Отсутствуют.
    """
```

**Назначение**: Создание асинхронного генератора для получения текстовых результатов от API H2o.ai.

**Параметры**:
- `cls` (H2o): Ссылка на класс `H2o`.
- `model` (str): Название модели для использования.
- `messages (Messages)`: Список сообщений для отправки в API.
- `proxy (str, optional)`: URL прокси-сервера. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры для передачи в API.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий текстовые результаты.

**Вызывает исключения**:
- `aiohttp.ClientResponseError`: Если возникает ошибка при выполнении HTTP-запроса.

**Как работает функция**:

1. **Установка параметров**: Инициализирует параметры, такие как модель и заголовки запроса.
2. **Создание сессии**: Создает асинхронную сессию `aiohttp.ClientSession` с необходимыми заголовками.
3. **Отправка запроса настроек**: Отправляет POST-запрос к `/settings` для установки параметров, таких как принятие условий использования и выбор модели.
4. **Создание разговора**: Отправляет POST-запрос к `/conversation` для создания нового разговора и получения `conversationId`.
5. **Отправка запроса с сообщением**: Форматирует сообщения и отправляет POST-запрос к `/conversation/{conversationId}` с параметрами генерации текста.
6. **Получение результатов**: Получает ответы от API в виде потока данных и извлекает текстовые результаты из JSON-ответов.
7. **Удаление разговора**: После завершения генерации удаляет разговор, отправив DELETE-запрос к `/conversation/{conversationId}`.

**ASCII Flowchart**:

```
A[Установка параметров и заголовков]
|
B[Создание асинхронной сессии]
|
C[Отправка POST-запроса к /settings]
|
D[Отправка POST-запроса к /conversation для создания разговора]
|
E[Отправка POST-запроса с сообщениями и параметрами генерации текста]
|
F[Получение потока данных и извлечение текстовых результатов]
|
G[Отправка DELETE-запроса к /conversation для удаления разговора]
```

**Примеры**:

```python
# Пример использования create_async_generator
import asyncio

async def main():
    model = "h2oai/h2ogpt-gm-oasst1-en-2048-falcon-40b-v1"
    messages = [{"role": "user", "content": "Hello, how are you?"}]
    proxy = None
    kwargs = {"temperature": 0.5}

    async for message in H2o.create_async_generator(model, messages, proxy, **kwargs):
        print(message, end="")

if __name__ == "__main__":
    asyncio.run(main())
```
```python
# Пример использования create_async_generator с прокси
import asyncio

async def main():
    model = "h2oai/h2ogpt-gm-oasst1-en-2048-falcon-40b-v1"
    messages = [{"role": "user", "content": "Привет, как дела?"}]
    proxy = "http://your-proxy-url:your-proxy-port"
    kwargs = {"temperature": 0.7}

    async for message in H2o.create_async_generator(model, messages, proxy, **kwargs):
        print(message, end="")

if __name__ == "__main__":
    asyncio.run(main())
```
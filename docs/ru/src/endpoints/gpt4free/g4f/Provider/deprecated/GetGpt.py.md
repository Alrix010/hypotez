# Модуль GetGpt
## Обзор
Модуль `GetGpt` представляет собой реализацию абстрактного провайдера `AbstractProvider` для взаимодействия с сервисом `chat.getgpt.world`. Он предоставляет возможность отправки запросов к модели `gpt-3.5-turbo` через API `chat.getgpt.world` и получения ответов в потоковом режиме. Модуль поддерживает настройку различных параметров запроса, таких как `temperature`, `top_p`, `frequency_penalty` и `presence_penalty`.

## Подробней
Модуль `GetGpt` используется в проекте `hypotez` для обеспечения возможности взаимодействия с языковой моделью `gpt-3.5-turbo` через API `chat.getgpt.world`. Он позволяет отправлять запросы к модели и получать ответы в потоковом режиме, что может быть полезно для задач, требующих обработки больших объемов текста или генерации текста в реальном времени.

## Классы

### `GetGpt`

**Описание**:
Класс `GetGpt` является наследником класса `AbstractProvider` и предоставляет реализацию для взаимодействия с API `chat.getgpt.world`.

**Наследует**:
- `AbstractProvider`: Абстрактный класс, определяющий интерфейс для провайдеров, работающих с языковыми моделями.

**Аттрибуты**:
- `url` (str): URL-адрес сервиса `chat.getgpt.world`.
- `supports_stream` (bool): Флаг, указывающий на поддержку потокового режима. Установлен в `True`.
- `working` (bool): Флаг, указывающий на работоспособность провайдера. Установлен в `False`.
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели `gpt-3.5-turbo`. Установлен в `True`.

**Методы**:
- `create_completion()`: Статический метод для создания запроса к API `chat.getgpt.world` и получения ответа.

## Функции

### `create_completion`

```python
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool, **kwargs: Any) -> CreateResult:
    """
    Создает запрос к API chat.getgpt.world и возвращает ответ в потоковом режиме.

    Args:
        model (str): Название модели (в данном случае всегда 'gpt-3.5-turbo').
        messages (list[dict[str, str]]): Список сообщений для отправки в запросе.
        stream (bool): Флаг, указывающий на необходимость потокового режима.
        **kwargs (Any): Дополнительные параметры запроса, такие как temperature, top_p, frequency_penalty и presence_penalty.

    Returns:
        CreateResult: Генератор, возвращающий части ответа в потоковом режиме.

    Raises:
        requests.exceptions.HTTPError: Если возникает HTTP-ошибка при отправке запроса.

    """
```

**Назначение**:
Функция `create_completion` отправляет запрос к API `chat.getgpt.world` для получения ответа от языковой модели `gpt-3.5-turbo`. Она формирует заголовок запроса, упаковывает данные в формат JSON, шифрует их с использованием функции `_encrypt` и отправляет POST-запрос к API. Полученный ответ обрабатывается построчно, извлекается содержимое сообщения и возвращается в потоковом режиме с использованием генератора.

**Параметры**:
- `model` (str): Название модели, используемой для генерации ответа. В данном случае всегда `'gpt-3.5-turbo'`.
- `messages` (list[dict[str, str]]): Список сообщений, отправляемых в запросе. Каждое сообщение представляет собой словарь, содержащий ключи `'role'` и `'content'`.
- `stream` (bool): Флаг, указывающий на необходимость получения ответа в потоковом режиме.
- `**kwargs` (Any): Дополнительные параметры запроса, такие как:
  - `frequency_penalty` (float): Штраф за частоту использования токенов.
  - `max_tokens` (int): Максимальное количество токенов в ответе.
  - `presence_penalty` (float): Штраф за присутствие токенов.
  - `temperature` (float): Температура генерации (влияет на случайность ответов).
  - `top_p` (float): Вероятность выбора наиболее вероятных токенов.

**Возвращает**:
- `CreateResult`: Генератор, который возвращает части ответа в потоковом режиме. Каждая часть ответа представляет собой строку с содержимым сообщения.

**Вызывает исключения**:
- `requests.exceptions.HTTPError`: Возникает, если при отправке запроса к API `chat.getgpt.world` происходит HTTP-ошибка (например, если сервер возвращает код состояния 400 или 500).

**Как работает функция**:
1. **Формирование заголовков**: Создаются заголовки запроса, включающие `Content-Type`, `Referer` и `user-agent`.
2. **Формирование данных**: Создается словарь с данными запроса, включающий сообщения, параметры модели и другие настройки. Данные упаковываются в формат JSON.
3. **Шифрование данных**: Данные JSON шифруются с использованием функции `_encrypt`.
4. **Отправка запроса**: POST-запрос отправляется на URL-адрес `https://chat.getgpt.world/api/chat/stream` с использованием библиотеки `requests`. Указываются заголовки и зашифрованные данные.
5. **Обработка ответа**: Полученный ответ обрабатывается построчно. Для каждой строки проверяется наличие подстроки `b'content'`. Если подстрока найдена, строка декодируется, извлекается содержимое сообщения и возвращается с использованием генератора.

```
Формирование заголовков и данных запроса
     │
     ▼
Шифрование данных запроса (_encrypt)
     │
     ▼
Отправка POST-запроса к API chat.getgpt.world
     │
     ▼
Обработка ответа (построчно)
     │
     ▼
Извлечение содержимого сообщения из JSON
     │
     ▼
Возврат части ответа (генератор)
```

**Примеры**:

```python
# Пример вызова функции create_completion с минимальным набором параметров
messages = [{"role": "user", "content": "Hello, how are you?"}]
result = GetGpt.create_completion(model="gpt-3.5-turbo", messages=messages, stream=True)
for part in result:
    print(part, end="")

# Пример вызова функции create_completion с дополнительными параметрами
messages = [{"role": "user", "content": "Tell me a joke."}]
result = GetGpt.create_completion(
    model="gpt-3.5-turbo",
    messages=messages,
    stream=True,
    temperature=0.7,
    top_p=0.9,
    max_tokens=100
)
for part in result:
    print(part, end="")
```

### `_encrypt`

```python
def _encrypt(e: str):
    """
    Функция, предназначенная для шифрования данных.

    Args:
        e (str): Строка для шифрования.

    Returns:
        None: Функция всегда возвращает None.
    """
```

**Назначение**:
Функция `_encrypt` предназначена для шифрования входной строки `e`. В текущей реализации функция не выполняет никаких действий и просто возвращает `None`. Закомментированный код предполагает использование AES-шифрования, однако он неактивен.

**Параметры**:
- `e` (str): Строка, которую предполагается зашифровать.

**Возвращает**:
- `None`: Функция всегда возвращает `None`.

**Как работает функция**:
Функция не выполняет никаких действий и сразу возвращает `None`. В закомментированном коде содержатся шаги для AES-шифрования, которые в настоящее время не используются.

```
Прием строки на вход (e)
│
▼
Возврат None
```

**Примеры**:

```python
# Пример вызова функции _encrypt
encrypted_data = _encrypt("test data")
print(encrypted_data)  # Выводит: None
```

### `_pad_data`

```python
def _pad_data(data: bytes) -> bytes:
    """
    Функция, предназначенная для дополнения данных до размера блока AES.

    Args:
        data (bytes): Байтовая строка для дополнения.

    Returns:
        bytes: Функция всегда возвращает None.
    """
```

**Назначение**:
Функция `_pad_data` предназначена для дополнения входных данных (`data`) до размера блока, требуемого для AES-шифрования. В текущей реализации функция не выполняет никаких действий и просто возвращает `None`. Закомментированный код предполагает добавление padding, однако он неактивен.

**Параметры**:
- `data` (bytes): Байтовая строка, которую предполагается дополнить.

**Возвращает**:
- `bytes`: Функция всегда возвращает `None`.

**Как работает функция**:
Функция не выполняет никаких действий и сразу возвращает `None`. В закомментированном коде содержатся шаги для добавления padding, которые в настоящее время не используются.

```
Прием байтовой строки на вход (data)
│
▼
Возврат None
```

**Примеры**:

```python
# Пример вызова функции _pad_data
padded_data = _pad_data(b"test data")
print(padded_data)  # Выводит: None
# Модуль `Wuguokai`

## Обзор

Модуль `Wuguokai` предоставляет класс `Wuguokai`, который является провайдером для работы с сервисом `chat.wuguokai.xyz`. Он поддерживает модель `gpt-3.5-turbo` и предоставляет возможность генерации текста на основе заданных входных сообщений.

## Подробнее

Этот модуль используется для взаимодействия с API `chat.wuguokai.xyz` для генерации ответов на основе предоставленных сообщений. Он отправляет запросы к API и возвращает сгенерированный текст. Модуль включает в себя настройки заголовков (`headers`) и данных (`data`) для отправки запросов, а также обработку ответов от API. В случае ошибки при запросе к API, выбрасывается исключение.

## Классы

### `Wuguokai`

**Описание**: Класс `Wuguokai` является провайдером для работы с сервисом `chat.wuguokai.xyz`.

**Наследует**:
- `AbstractProvider`: Абстрактный базовый класс для всех провайдеров.

**Атрибуты**:
- `url` (str): URL сервиса `chat.wuguokai.xyz`.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживается ли модель `gpt-3.5-turbo`.
- `working` (bool): Указывает, работает ли провайдер в данный момент.

**Методы**:
- `create_completion`: Статический метод для создания завершения (генерации текста) на основе предоставленных входных данных.

## Функции

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool,
    **kwargs: Any,
) -> CreateResult:
    """
    Создает завершение (генерацию текста) на основе предоставленных входных данных.

    Args:
        model (str): Название модели для генерации.
        messages (list[dict[str, str]]): Список сообщений для генерации ответа.
        stream (bool): Указывает, должен ли ответ быть возвращен в виде потока.
        **kwargs (Any): Дополнительные аргументы.

    Returns:
        CreateResult: Результат создания завершения.

    Raises:
        Exception: Если возникает ошибка при запросе к API.
    """
```

**Назначение**:
Метод `create_completion` отправляет запрос к API `chat.wuguokai.xyz` и возвращает сгенерированный текст на основе предоставленных сообщений.

**Параметры**:
- `model` (str): Название модели для генерации текста.
- `messages` (list[dict[str, str]]): Список сообщений, содержащих запросы и ответы.
- `stream` (bool): Флаг, указывающий, следует ли возвращать результат в виде потока.
- `**kwargs` (Any): Дополнительные параметры, такие как прокси.

**Возвращает**:
- `CreateResult`: Сгенерированный текст или поток текста.

**Вызывает исключения**:
- `Exception`: Если HTTP-ответ имеет статус код, отличный от 200.

**Как работает функция**:

1. **Формирование заголовков**: Создаются заголовки HTTP-запроса, включающие `user-agent`, `content-type` и другие необходимые параметры.
2. **Формирование данных**: Подготавливаются данные для отправки в теле запроса, включая сообщения, параметры и ID пользователя.
3. **Отправка запроса**: Отправляется POST-запрос к API `https://ai-api20.wuguokai.xyz/api/chat-process` с заданными заголовками, данными и параметрами (например, прокси).
4. **Обработка ответа**: Анализируется ответ от API. Если статус код не равен 200, выбрасывается исключение. Если ответ содержит разделитель "> 若回答失败请重试或多刷新几次界面后重试", текст разделяется, и возвращается вторая часть. В противном случае возвращается весь текст.
5. **Генерация результата**: Результат возвращается с помощью `yield`, что позволяет использовать функцию как генератор.

**ASCII flowchart**:

```
    Начало
     ↓
Формирование заголовков и данных запроса
     ↓
   Отправка POST-запроса к API
     ↓
  Получение ответа
     ↓
  Проверка статуса ответа (200?)
     ├── Нет → Выброс исключения
     └── Да
         ↓
  Разделение текста по разделителю "> 若回答失败请重试或多刷新几次界面后重试"
         ↓
  Извлечение и возврат текста
     ↓
    Конец
```

**Примеры**:

```python
# Пример вызова функции create_completion
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = False
kwargs = {}

result = Wuguokai.create_completion(model=model, messages=messages, stream=stream, **kwargs)
for item in result:
    print(item)
# Модуль Equing

## Обзор

Модуль `Equing` представляет собой реализацию провайдера для взаимодействия с сервисом `next.eqing.tech`. Он предоставляет функциональность для создания завершений (completions) на основе предоставленных сообщений с использованием моделей, поддерживаемых сервисом.

## Подробней

Модуль `Equing` является частью системы, которая позволяет взаимодействовать с различными AI-моделями через унифицированный интерфейс. Этот конкретный модуль обеспечивает подключение к сервису `next.eqing.tech`, предоставляя возможность использовать его модели для генерации текста на основе входных данных. Модуль поддерживает потоковую передачу данных, что позволяет получать ответы в режиме реального времени.

## Классы

### `Equing(AbstractProvider)`

**Описание**: Класс `Equing` является наследником абстрактного класса `AbstractProvider` и реализует специфическое взаимодействие с сервисом `next.eqing.tech`.

**Наследует**:

- `AbstractProvider`: Абстрактный класс, определяющий интерфейс для всех провайдеров.

**Атрибуты**:

- `url` (str): URL-адрес сервиса `next.eqing.tech`.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_stream` (bool): Флаг, указывающий на поддержку потоковой передачи данных.
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели `gpt-3.5-turbo`.
- `supports_gpt_4` (bool): Флаг, указывающий на поддержку модели `gpt-4`.

**Методы**:

- `create_completion(model: str, messages: list[dict[str, str]], stream: bool, **kwargs: Any) -> CreateResult`: Метод для создания завершения на основе предоставленных сообщений и параметров.

## Функции

### `create_completion(model: str, messages: list[dict[str, str]], stream: bool, **kwargs: Any) -> CreateResult`

```python
@staticmethod
@abstractmethod
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool, **kwargs: Any) -> CreateResult:
    """
    Создает завершение на основе предоставленных сообщений и параметров.

    Args:
        model (str): Идентификатор модели, используемой для генерации завершения.
        messages (list[dict[str, str]]): Список сообщений, представляющих контекст для генерации завершения.
        stream (bool): Флаг, указывающий на необходимость потоковой передачи данных.
        **kwargs (Any): Дополнительные параметры для запроса.

    Returns:
        CreateResult: Результат создания завершения.

    Raises:
        Exception: В случае ошибки при выполнении запроса к сервису.
    """
    ...
```

**Назначение**: Метод `create_completion` отправляет запрос к API `next.eqing.tech` для получения завершения на основе предоставленных сообщений, модели и других параметров.

**Параметры**:

- `model` (str): Идентификатор модели, используемой для генерации завершения.
- `messages` (list[dict[str, str]]): Список сообщений, представляющих контекст для генерации завершения.
- `stream` (bool): Флаг, указывающий на необходимость потоковой передачи данных.
- `**kwargs` (Any): Дополнительные параметры для запроса, такие как `temperature`, `presence_penalty`, `frequency_penalty` и `top_p`.

**Возвращает**:

- `CreateResult`: Результат создания завершения, который может быть либо строкой (если `stream=False`), либо генератором строк (если `stream=True`).

**Вызывает исключения**:

- Отсутствуют явные исключения, но функция может генерировать исключения в случае проблем с сетевым запросом или обработкой данных.

**Как работает функция**:

1.  Формирование заголовков запроса (`headers`) для отправки к API `next.eqing.tech`.
2.  Формирование тела запроса (`json_data`) с использованием входных параметров, таких как сообщения, модель, температура и другие параметры.
3.  Отправка `POST`-запроса к API `next.eqing.tech` с использованием библиотеки `requests`.
4.  Если `stream=False`, функция возвращает контент первого сообщения из ответа в формате JSON.
5.  Если `stream=True`, функция итерируется по содержимому ответа и извлекает токены из каждой строки, содержащей `"content"`, и возвращает их в виде генератора.

**ASCII flowchart**:

```
+---------------------+
|  Формирование headers  |
+---------------------+
|
V
+---------------------+
|  Формирование json_data |
+---------------------+
|
V
+---------------------+
|  POST-запрос к API   |
+---------------------+
|
V
+---------------------+
| stream == False?     |
+---------+-----------+
|    Да    |      Нет    |
+---------+-----------+
|
V           V
+---------+   +---------------------+
|Извлечение |   |   Итерация по       |
| контента  |   |  содержимому ответа |
+---------+   +---------------------+
|           |   |
V           V
+---------+   +---------------------+
|  Возврат  |   |Извлечение токенов |
| контента  |   +---------------------+
+---------+   |
            V
            +---------------------+
            |     yield token     |
            +---------------------+
```

**Примеры**:

```python
# Пример 1: Получение завершения без потоковой передачи данных
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = False
result = Equing.create_completion(model=model, messages=messages, stream=stream)
# result будет содержать строку с ответом от API

# Пример 2: Получение завершения с потоковой передачей данных
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Tell me a story."}]
stream = True
result = Equing.create_completion(model=model, messages=messages, stream=stream)
# result будет генератором, который выдает токены по мере их поступления от API
for token in result:
    print(token, end="")
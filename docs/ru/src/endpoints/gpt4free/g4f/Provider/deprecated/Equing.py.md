# Модуль `Equing`

## Обзор

Модуль `Equing` представляет собой реализацию провайдера для взаимодействия с сервисом `next.eqing.tech`. Он предоставляет функциональность для создания запросов к API этого сервиса и получения ответов в виде текста. Модуль поддерживает потоковую передачу данных, а также модель `gpt-3.5-turbo`.

## Подробней

Модуль является частью системы провайдеров, используемых для абстракции взаимодействия с различными API для генерации текста. Он использует библиотеку `requests` для выполнения HTTP-запросов и `json` для обработки данных в формате JSON.

## Классы

### `Equing(AbstractProvider)`

**Описание**: Класс `Equing` является подклассом `AbstractProvider` и реализует методы для взаимодействия с API `next.eqing.tech`.

**Наследует**:
- `AbstractProvider`: Абстрактный базовый класс для всех провайдеров.

**Атрибуты**:
- `url` (str): URL-адрес сервиса `next.eqing.tech`.
- `working` (bool): Указывает, работает ли провайдер в данный момент. По умолчанию `False`.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных. По умолчанию `True`.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo`. По умолчанию `True`.
- `supports_gpt_4` (bool): Указывает, поддерживает ли провайдер модель `gpt-4`. По умолчанию `False`.

**Методы**:
- `create_completion()`: Статический метод для создания запроса к API и получения ответа.

## Методы класса

### `create_completion(model: str, messages: list[dict[str, str]], stream: bool, **kwargs: Any) -> CreateResult`

**Назначение**: Отправляет запрос к API `next.eqing.tech` для генерации текста на основе предоставленных параметров.

**Параметры**:
- `model` (str): Идентификатор используемой модели.
- `messages` (list[dict[str, str]]): Список сообщений, формирующих контекст запроса. Каждое сообщение представляет собой словарь с ключами `"role"` и `"content"`.
- `stream` (bool): Указывает, следует ли использовать потоковый режим передачи данных.
- `**kwargs` (Any): Дополнительные параметры запроса, такие как `temperature`, `presence_penalty`, `frequency_penalty` и `top_p`.

**Возвращает**:
- `CreateResult`: Генератор, выдающий части сгенерированного текста, или строку с полным текстом, если потоковый режим не используется.

**Как работает функция**:

1. Формирует заголовки HTTP-запроса, включая информацию о браузере пользователя и типе контента.
2. Формирует JSON-данные для отправки в теле запроса, включая сообщения, модель, параметры температуры и штрафов.
3. Отправляет POST-запрос к API `https://next.eqing.tech/api/openai/v1/chat/completions` с использованием библиотеки `requests`.
4. Если `stream` установлен в `False`, возвращает содержимое ответа в формате JSON, извлекая текст из поля `content`.
5. Если `stream` установлен в `True`, итерируется по содержимому ответа в чанках размером 1024 байта.
6. Для каждой строки в ответе проверяет наличие подстроки `b'content'`.
7. Если подстрока `b'content'` найдена, извлекает JSON из строки, декодирует его и извлекает значение поля `content` из секции `delta`, которое содержит сгенерированный токен.
8. Возвращает токен.

**Примеры**:

```python
# Пример вызова create_completion с потоковой передачей данных
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, world!"}]
stream = True
for token in Equing.create_completion(model, messages, stream):
    print(token, end="")

# Пример вызова create_completion без потоковой передачи данных
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Как тебя зовут?"}]
stream = False
response = "".join(Equing.create_completion(model, messages, stream))
print(response)
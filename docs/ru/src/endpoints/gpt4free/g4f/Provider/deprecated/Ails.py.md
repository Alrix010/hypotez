# Модуль `Ails`

## Обзор

Модуль `Ails` предоставляет асинхронный генератор для взаимодействия с сервисом `ai.ls`. Он поддерживает потоковую передачу данных и предназначен для использования с GPT-3.5 Turbo.

## Подробней

Модуль использует асинхронные запросы к API `caipacity.com` для получения ответов от модели GPT-3.5 Turbo. Он формирует заголовки и данные запроса, отправляет их и обрабатывает потоковые ответы, генерируя токены.

## Классы

### `Ails(AsyncGeneratorProvider)`

**Описание**: Класс `Ails` является асинхронным провайдером генератора, предназначенным для взаимодействия с API `ai.ls`.

**Наследует**:
- `AsyncGeneratorProvider`: Предоставляет базовый интерфейс для асинхронных провайдеров генераторов.

**Атрибуты**:
- `url` (str): URL сервиса `ai.ls`.
- `working` (bool): Указывает, работает ли провайдер в данный момент.
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель GPT-3.5 Turbo.

**Методы**:
- `create_async_generator()`: Создает асинхронный генератор для получения ответов от модели.

## Методы класса

### `create_async_generator`

```python
@staticmethod
async def create_async_generator(
    model: str,
    messages: Messages,
    stream: bool,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для получения ответов от модели.

    Args:
        model (str): Название модели.
        messages (Messages): Список сообщений для отправки.
        stream (bool): Указывает, использовать ли потоковую передачу данных.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные аргументы, такие как `temperature`.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий токены ответа.

    Raises:
        Exception: Если ответ содержит запрещенные токены (`ai.ls` или `ai.ci`).

    
    - Функция формирует заголовки запроса, включая `client-id` и `authorization`.
    - Создается `ClientSession` для выполнения асинхронных HTTP-запросов.
    - Формируются данные запроса в формате JSON, включая модель, температуру, сообщения и временные метки.
    - Отправляется POST-запрос к API `caipacity.com`.
    - Функция обрабатывает потоковые ответы, извлекая токены из JSON-ответов.
    - Если в токене обнаружены запрещенные слова, выбрасывается исключение.
    - Возвращает асинхронный генератор, который выдает токены.
    """
```

### `_hash`

```python
def _hash(json_data: dict[str, str]) -> SHA256:
    """Создает SHA256 хеш из строки, сгенерированной на основе данных JSON.

    Args:
        json_data (dict[str, str]): Словарь, содержащий данные для хеширования.

    Returns:
        SHA256: Объект SHA256, представляющий хеш.

    
    - Функция принимает словарь `json_data`, содержащий ключи "t" (timestamp) и "m" (message).
    - Формирует строку `base_string` путем конкатенации значений из `json_data` с фиксированными строками.
    - Вычисляет SHA256 хеш от `base_string`.
    - Возвращает хеш в виде объекта `SHA256`.
    """
```

### `_format_timestamp`

```python
def _format_timestamp(timestamp: int) -> str:
    """Форматирует timestamp, изменяя последнюю цифру в соответствии с условием.

    Args:
        timestamp (int): Timestamp для форматирования.

    Returns:
        str: Отформатированный timestamp в виде строки.

    
    - Функция принимает целочисленный timestamp.
    - Вычисляет последнюю цифру `n` timestamp.
    - Если `n` четное, то `r` присваивается `n + 1`, иначе `n`.
    - Возвращает timestamp с измененной последней цифрой в виде строки.
    """
```
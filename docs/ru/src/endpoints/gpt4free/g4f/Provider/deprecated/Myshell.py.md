# Модуль `Myshell`

## Обзор

Модуль `Myshell` предоставляет асинхронный интерфейс для взаимодействия с сервисом Myshell AI. Он позволяет генерировать текст на основе предоставленных сообщений, используя различные модели, такие как "samantha", "gpt-3.5-turbo" и "gpt-4". Модуль поддерживает использование прокси и настройку времени ожидания.

## Подробнее

Модуль использует библиотеку `aiohttp` для установления асинхронного WebSocket-соединения с сервером Myshell AI. Он реализует логику для отправки запросов и получения ответов в реальном времени. Также модуль включает функции для генерации уникальных идентификаторов посетителей и подписей для обеспечения безопасности соединения.

## Классы

### `Myshell`

**Описание**: Класс `Myshell` является асинхронным провайдером генерации текста.

**Наследует**: `AsyncGeneratorProvider`

**Атрибуты**:
- `url` (str): URL для подключения к сервису Myshell AI.
- `working` (bool): Указывает, работает ли провайдер.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель "gpt-3.5-turbo".
- `supports_gpt_4` (bool): Указывает, поддерживает ли провайдер модель "gpt-4".

**Методы**:

- `create_async_generator`(): Создает асинхронный генератор для получения текстовых результатов от Myshell AI.

## Методы класса

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    timeout: int = 90,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для получения текстовых результатов от Myshell AI.
    
    Args:
        cls (type): Ссылка на класс.
        model (str): Имя используемой модели ("samantha", "gpt-3.5-turbo", "gpt-4").
        messages (Messages): Список сообщений для отправки в формате `List[dict]`.
        proxy (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
        timeout (int, optional): Максимальное время ожидания ответа в секундах. По умолчанию 90.
        **kwargs: Дополнительные именованные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий текстовые результаты.

    Raises:
        ValueError: Если указанная модель не поддерживается.
        RuntimeError: Если получен неожиданный тип сообщения.

    
    - Функция устанавливает WebSocket-соединение с сервером Myshell AI.
    - Генерирует уникальный идентификатор посетителя.
    - Отправляет приветственное сообщение и аутентифицируется.
    - Форматирует входные сообщения в текстовый формат, пригодный для отправки.
    - Генерирует подпись для обеспечения безопасности запроса.
    - Отправляет сообщение чата и получает ответы в реальном времени.
    - Возвращает текстовые результаты через асинхронный генератор.
    - Обрабатывает различные типы сообщений, включая текстовые потоки и сообщения об ошибках.

    Внутренние функции:
    - Отсутствуют.

    Примеры:
        >>> async for message in Myshell.create_async_generator(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello!"}]):
        ...     print(message)
    """
```

## Функции

### `generate_timestamp`

```python
def generate_timestamp() -> str:
    """Генерирует временную метку для использования в подписи запроса.

    Returns:
        str: Строка, представляющая собой временную метку.

    
    - Функция получает текущее время в миллисекундах.
    - Вычисляет контрольную сумму на основе цифр времени.
    - Объединяет время и контрольную сумму в строку.

    Примеры:
        >>> generate_timestamp()
        '1678886400000'
    """
```

### `generate_signature`

```python
def generate_signature(text: str):
    """Генерирует подпись для запроса к Myshell AI.

    Args:
        text (str): Текст сообщения, для которого генерируется подпись.

    Returns:
        dict: Словарь, содержащий подпись, временную метку и версию.

    
    - Функция генерирует временную метку с помощью `generate_timestamp()`.
    - Определяет версию API и секретный ключ.
    - Объединяет версию, текст сообщения, временную метку и секретный ключ в строку.
    - Вычисляет MD5-хеш от полученной строки.
    - Инвертирует полученный хеш и возвращает его в виде словаря.

    Примеры:
        >>> generate_signature("Hello!")
        {'signature': '...', 'timestamp': '...', 'version': 'v1.0.0'}
    """
```

### `xor_hash`

```python
def xor_hash(B: str):
    """Вычисляет XOR-хеш от входной строки.

    Args:
        B (str): Входная строка для вычисления хеша.

    Returns:
        str: Строка, представляющая собой XOR-хеш.

    
    - Функция преобразует каждый символ входной строки в его числовое представление (код Unicode).
    - Выполняет XOR-операцию над этими числами, накапливая результат.

    Примеры:
        >>> xor_hash("test")
        '...'
    """
```

### `performance`

```python
def performance() -> str:
    """Генерирует строку, отражающую производительность системы.

    Returns:
        str: Строка, содержащая шестнадцатеричное представление времени и количества итераций.

    
    - Функция измеряет время, необходимое для выполнения нескольких итераций цикла.
    - Возвращает шестнадцатеричное представление времени и количества итераций.

    Примеры:
        >>> performance()
        '...'
    """
```

### `generate_visitor_id`

```python
def generate_visitor_id(user_agent: str) -> str:
    """Генерирует уникальный идентификатор посетителя на основе User-Agent.

    Args:
        user_agent (str): Строка User-Agent.

    Returns:
        str: Уникальный идентификатор посетителя.

    
    - Функция использует `performance()` для получения данных о производительности.
    - Генерирует случайное число.
    - Вычисляет XOR-хеш от User-Agent с помощью `xor_hash()`.
    - Объединяет все полученные значения в строку, разделенную дефисами.

    Примеры:
        >>> generate_visitor_id("Mozilla/5.0 ...")
        '...'
    """
# Модуль для работы с Forefront API
=================================================

Модуль содержит класс `Forefront`, который используется для взаимодействия с API Forefront для генерации текста.

Пример использования
----------------------

```python
from src.endpoints.gpt4free.g4f.Provider import Forefront

messages = [{"role": "user", "content": "Hello, how are you?"}]
for message in Forefront.create_completion(model="gpt-4", messages=messages, stream=True):
    print(message, end="", flush=True)
```

## Обзор

Этот модуль предоставляет класс `Forefront` для взаимодействия с API Forefront. Он поддерживает потоковую передачу данных и модель `gpt-35-turbo`. Модуль использует библиотеку `requests` для выполнения HTTP-запросов к API.

## Подробнее

Модуль `Forefront.py` предназначен для обеспечения доступа к API Forefront для генерации текста на основе предоставленных сообщений. Он отправляет POST-запросы к API и обрабатывает потоковые ответы, возвращая сгенерированный текст частями. Этот модуль является частью проекта `hypotez` и предназначен для интеграции с другими компонентами, требующими взаимодействия с Forefront API.

## Классы

### `Forefront(AbstractProvider)`

**Описание**: Класс `Forefront` предоставляет интерфейс для взаимодействия с API Forefront.

**Наследует**:
- `AbstractProvider`: Наследует от абстрактного класса `AbstractProvider`, предоставляющего базовый интерфейс для провайдеров.

**Аттрибуты**:
- `url` (str): URL адрес сервиса Forefront.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-35-turbo`.

**Методы**:
- `create_completion()`: Метод для создания запроса к API Forefront и получения ответа.

## Функции

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool, **kwargs: Any) -> CreateResult:
    """ Функция создает запрос к API Forefront и возвращает результат генерации текста.

    Args:
        model (str): Идентификатор модели, используемой для генерации текста.
        messages (list[dict[str, str]]): Список сообщений, представляющих контекст для генерации текста.
        stream (bool): Указывает, следует ли использовать потоковую передачу данных.
        **kwargs (Any): Дополнительные параметры.

    Returns:
        CreateResult: Результат генерации текста.

    Raises:
        requests.exceptions.HTTPError: Если HTTP-запрос завершается с ошибкой.
    """
```

**Назначение**: Функция `create_completion` отправляет запрос к API Forefront для генерации текста на основе предоставленных сообщений и возвращает результат в потоковом режиме, если это указано.

**Параметры**:
- `model` (str): Идентификатор модели, используемой для генерации текста (например, "gpt-4").
- `messages` (list[dict[str, str]]): Список сообщений, где каждое сообщение представляет собой словарь с ключами "role" (роль отправителя, например, "user") и "content" (содержание сообщения).
- `stream` (bool): Флаг, указывающий, следует ли использовать потоковый режим передачи данных. Если `True`, функция возвращает генератор, выдающий части сгенерированного текста.
- `**kwargs` (Any): Дополнительные параметры, которые могут быть переданы в API Forefront.

**Возвращает**:
- `CreateResult`: Генератор, выдающий части сгенерированного текста, если `stream` равен `True`. В противном случае возвращает полную строку сгенерированного текста.

**Вызывает исключения**:
- `requests.exceptions.HTTPError`: Возникает, если HTTP-запрос завершается с кодом ошибки (например, 400, 500).

**Как работает функция**:

1. **Подготовка данных**: Создается словарь `json_data`, содержащий параметры запроса, включая текст последнего сообщения, историю сообщений, идентификаторы и настройки модели.
2. **Отправка запроса**: Отправляется POST-запрос к API Forefront (`https://streaming.tenant-forefront-default.knative.chi.coreweave.com/free-chat`) с использованием библиотеки `requests`. Указывается, что ожидается потоковый ответ (`stream=True`).
3. **Обработка ответа**:
   - Проверяется статус ответа с помощью `response.raise_for_status()`. Если статус код указывает на ошибку, выбрасывается исключение `HTTPError`.
   - Если статус код успешный, начинается итерация по строкам ответа с использованием `response.iter_lines()`.
   - Каждая строка проверяется на наличие подстроки `b"delta"`. Если эта подстрока присутствует, строка считается содержащей часть сгенерированного текста.
   - Из строки извлекается JSON-объект, содержащий поле `delta`, которое представляет собой часть сгенерированного текста.
   - Извлеченная часть текста передается через `yield`, что делает функцию генератором.

```
    Подготовка данных json_data
    │
    └── Отправка POST-запроса к API Forefront
        │
        └── Проверка статуса ответа response.raise_for_status()
            │
            ├── Ошибка: Выброс исключения HTTPError
            │
            └── Успех: Итерация по строкам ответа response.iter_lines()
                │
                └── Проверка наличия b"delta" в строке
                    │
                    ├── Нет: Пропуск строки
                    │
                    └── Да: Извлечение JSON и передача delta через yield
```

**Примеры**:

```python
# Пример использования функции create_completion с потоковой передачей данных
messages = [{"role": "user", "content": "Напиши короткое стихотворение о весне."}]
for token in Forefront.create_completion(model="gpt-4", messages=messages, stream=True):
    print(token, end="", flush=True)

# Пример использования функции create_completion с моделью gpt-3.5-turbo
messages = [{"role": "user", "content": "Как дела?"}]
for token in Forefront.create_completion(model="gpt-3.5-turbo", messages=messages, stream=True):
    print(token, end="", flush=True)
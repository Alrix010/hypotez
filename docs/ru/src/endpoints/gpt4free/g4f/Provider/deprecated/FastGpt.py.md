# Модуль `FastGpt`

## Обзор

Модуль `FastGpt` предоставляет интерфейс для взаимодействия с провайдером FastGPT для создания и получения ответов от моделей GPT. Он поддерживает стриминг ответов, а также работу с моделью `gpt-3.5-turbo`.

## Подробней

Модуль предназначен для интеграции с сервисом FastGPT, позволяя отправлять запросы на генерацию текста и получать ответы в потоковом режиме. Он определяет необходимые заголовки и параметры запроса, а также обрабатывает ответы, извлекая из них полезную информацию.

## Классы

### `FastGpt(AbstractProvider)`

**Описание**: Класс `FastGpt` является подклассом `AbstractProvider` и предоставляет методы для взаимодействия с API FastGPT.

**Наследует**: `AbstractProvider`

**Атрибуты**:
- `url` (str): URL-адрес сервиса FastGPT. По умолчанию `'https://chat9.fastgpt.me/'`.
- `working` (bool): Указывает, работает ли провайдер. По умолчанию `False`.
- `needs_auth` (bool): Указывает, требуется ли аутентификация. По умолчанию `False`.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных. По умолчанию `True`.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo`. По умолчанию `True`.
- `supports_gpt_4` (bool): Указывает, поддерживает ли провайдер модель `gpt-4`. По умолчанию `False`.

**Методы**:
- `create_completion()`: Создает запрос на завершение текста и возвращает результат.

## Методы класса

### `create_completion(model: str, messages: list[dict[str, str]], stream: bool, **kwargs: Any) -> CreateResult`

**Назначение**: Создает запрос на завершение текста к API FastGPT и возвращает результат в потоковом режиме, если это поддерживается.

**Параметры**:
- `model` (str): Название модели, которую нужно использовать для завершения текста.
- `messages` (list[dict[str, str]]): Список сообщений, представляющих контекст для завершения текста.
- `stream` (bool): Флаг, указывающий, нужно ли использовать потоковый режим передачи данных.
- `**kwargs` (Any): Дополнительные параметры запроса, такие как `temperature`, `presence_penalty`, `frequency_penalty` и `top_p`.

**Возвращает**:
- `CreateResult`: Результат запроса к API FastGPT. В случае успеха возвращает генератор токенов, в противном случае возвращает текст ошибки.

**Вызывает исключения**:
- Отсутствуют явные исключения, но функция может выбрасывать исключения, связанные с сетевыми запросами (`requests.post`).

**Как работает функция**:

1.  **Подготовка заголовков**: Функция задает заголовки HTTP-запроса, включая `authority`, `accept`, `content-type` и другие параметры, необходимые для взаимодействия с API FastGPT.
2.  **Подготовка данных JSON**: Функция формирует JSON-данные, включающие сообщения, модель, параметры температуры, штрафы за присутствие и частоту, а также значение `top_p`.
3.  **Выбор поддомена**: Функция случайным образом выбирает один из поддоменов (`jdaen979ew` или `chat9`) для отправки запроса.
4.  **Отправка POST-запроса**: Функция отправляет POST-запрос к API FastGPT с использованием библиотеки `requests`. Запрос отправляется в потоковом режиме, если `stream` установлен в `True`.
5.  **Обработка потока ответов**:
    *   Функция итерируется по строкам ответа, полученного от API.
    *   Для каждой строки проверяется, содержит ли она `b'content'`. Если да, строка декодируется из UTF-8, разделяется по `data: `, и загружается как JSON.
    *   Из JSON извлекается содержимое (`content`) из `choices[0].delta`.
    *   Если содержимое присутствует, оно возвращается как токен с использованием `yield`.
6.  **Обработка исключений**: Если в процессе обработки ответа возникает исключение, оно игнорируется, и функция переходит к следующей строке.

**Примеры**:

```python
# Пример использования create_completion с потоковой передачей
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Напиши стихотворение о весне."}]
stream = True
kwargs = {"temperature": 0.7, "top_p": 0.9}

result = FastGpt.create_completion(model, messages, stream, **kwargs)
for token in result:
    print(token, end="")

# Пример использования create_completion без потоковой передачи
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Как вычислить площадь круга?"}]
stream = False
kwargs = {}

result = FastGpt.create_completion(model, messages, stream, **kwargs)
print(result)
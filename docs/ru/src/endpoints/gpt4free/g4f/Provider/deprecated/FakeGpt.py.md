# Модуль `FakeGpt`

## Обзор

Модуль `FakeGpt` предоставляет асинхронный генератор для взаимодействия с сервисом `chat-shared2.zhile.io`. Он использует этот сервис для имитации работы GPT моделей. Модуль поддерживает модель `gpt-3.5-turbo` и использует `aiohttp` для асинхронных запросов.

## Подробней

Модуль предназначен для использования в качестве одного из провайдеров в проекте `hypotez`. Он получает ответы от сервиса `chat-shared2.zhile.io` и форматирует их для дальнейшей обработки. Для работы требуется получение токена доступа и поддержание сессии.

## Классы

### `FakeGpt`

**Описание**: Класс `FakeGpt` является асинхронным генераторным провайдером.

**Наследует**:

- `AsyncGeneratorProvider`: Наследует функциональность асинхронного генератора.

**Атрибуты**:

- `url` (str): URL сервиса `chat-shared2.zhile.io`.
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo`.
- `working` (bool): Флаг, указывающий, работает ли провайдер.
- `_access_token` (Optional[str]): Приватный атрибут для хранения токена доступа.
- `_cookie_jar` (Optional[CookieJar]): Приватный атрибут для хранения cookie.

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для получения ответов от сервиса.

    Args:
        cls (FakeGpt): Ссылка на класс.
        model (str): Модель для использования (например, "gpt-3.5-turbo").
        messages (Messages): Список сообщений для отправки в сервис.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий ответы от сервиса.

    Raises:
        RuntimeError: Если не получен корректный ответ от сервиса.

    Как работает функция:
    1. **Подготовка**:
       - Функция `create_async_generator` асинхронно создает генератор для взаимодействия с сервисом `chat-shared2.zhile.io`.
       - Формируются заголовки для HTTP-запросов, включая User-Agent, Referer и информацию о браузере.
       - Если отсутствует токен доступа (`cls._access_token`), выполняется процесс аутентификации, включающий получение списка токенов, выбор случайного токена и запрос на логин.
    2. **Аутентификация**:
       - Если токен доступа отсутствует, функция получает его, выполняя запросы к `/api/loads` и `/auth/login`.
       - После успешной аутентификации токен доступа сохраняется в `cls._access_token`, а cookie сохраняются в `cls._cookie_jar`.
    3. **Формирование запроса**:
       - Формируется JSON-запрос с использованием предоставленных сообщений, идентификаторов и других параметров.
       - Запрос отправляется на `/api/conversation` с использованием метода POST.
    4. **Обработка ответа**:
       - Функция асинхронно обрабатывает ответ, получаемый по частям.
       - Каждая строка ответа проверяется на наличие префикса `data: `.
       - Если строка содержит данные, она преобразуется из JSON.
       - Извлекается текст сообщения и передается в генератор.
    5. **Завершение**:
       - Генератор завершается, когда встречается маркер `[DONE]`.
       - Если не получено ни одного валидного сообщения, вызывается исключение `RuntimeError`.

    Внутренние функции:
        Внутри данной функции нет внутренних функций.

    ASCII flowchart:

    [Начало] --> [Проверка наличия токена]
    [Проверка наличия токена] -- Нет --> [Получение списка токенов]
    [Получение списка токенов] --> [Выбор случайного токена]
    [Выбор случайного токена] --> [Запрос на логин]
    [Запрос на логин] --> [Получение токена доступа]
    [Проверка наличия токена] -- Да --> [Формирование JSON запроса]
    [Формирование JSON запроса] --> [Отправка запроса на /api/conversation]
    [Отправка запроса на /api/conversation] --> [Обработка ответа]
    [Обработка ответа] --> [Извлечение текста сообщения]
    [Извлечение текста сообщения] --> [Выдача текста сообщения в генератор]
    [Обработка ответа] -- [DONE] --> [Завершение]
    [Завершение] --> [Конец]


    Примеры:
        Пример 1: Создание генератора с использованием модели "gpt-3.5-turbo" и сообщений:

        >>> messages = [{"role": "user", "content": "Hello!"}]
        >>> generator = FakeGpt.create_async_generator(model="gpt-3.5-turbo", messages=messages)

        Пример 2: Создание генератора с использованием прокси:

        >>> messages = [{"role": "user", "content": "Hello!"}]
        >>> generator = FakeGpt.create_async_generator(model="gpt-3.5-turbo", messages=messages, proxy="http://proxy.example.com")

        Пример 3: Обработка исключения при отсутствии валидного ответа:

        >>> messages = [{"role": "user", "content": "Hello!"}]
        >>> try:
        ...     generator = FakeGpt.create_async_generator(model="gpt-3.5-turbo", messages=messages)
        ... except RuntimeError as ex:
        ...     print(f"Error: {ex}")
    """
    ...
```
## Функции

В данном модуле функции отсутствуют.
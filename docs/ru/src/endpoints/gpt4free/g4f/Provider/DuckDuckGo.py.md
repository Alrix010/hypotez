# Модуль для работы с DuckDuckGo в качестве провайдера AI
==================================================

Модуль содержит класс `DuckDuckGo`, который используется для взаимодействия с AI DuckDuckGo.
Он позволяет использовать DuckDuckGo в качестве провайдера для получения ответов от AI, поддерживая стриминг, системные сообщения и историю сообщений.

Пример использования:
```python
# Пример использования будет добавлен после реализации
```

## Обзор

Этот модуль реализует класс `DuckDuckGo`, который предоставляет интерфейс для взаимодействия с сервисом DuckDuckGo AI. Он использует библиотеку `duckduckgo_search` для выполнения запросов к DuckDuckGo. Модуль поддерживает асинхронные запросы и генерацию ответов, что позволяет эффективно обрабатывать большие объемы данных.
Расположение этого файла `/src/endpoints/gpt4free/g4f/Provider/DuckDuckGo.py` указывает, что он является частью системы `gpt4free` и предоставляет способ взаимодействия с DuckDuckGo AI через этот фреймворк.
Класс наследуется от `AsyncGeneratorProvider` и `ProviderModelMixin`, что позволяет ему поддерживать асинхронную генерацию ответов и использовать модели, специфичные для провайдера.

## Подробней

Модуль предназначен для использования в системах, требующих взаимодействия с AI через DuckDuckGo. Он предоставляет удобный интерфейс для выполнения запросов и получения ответов в асинхронном режиме.
Взаимодействие с DuckDuckGo осуществляется через библиотеку `duckduckgo_search`, которая должна быть установлена перед использованием модуля.
Для аутентификации используется `nodriver`, если он установлен.

## Классы

### `DuckDuckGo`

**Описание**: Класс для взаимодействия с DuckDuckGo AI.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает поддержку асинхронной генерации ответов.
- `ProviderModelMixin`: Обеспечивает поддержку моделей, специфичных для провайдера.

**Атрибуты**:
- `label` (str): Метка провайдера ("Duck.ai (duckduckgo_search)").
- `url` (str): URL для DuckDuckGo AI ("https://duckduckgo.com/aichat").
- `api_base` (str): Базовый URL API DuckDuckGo ("https://duckduckgo.com/duckchat/v1/").
- `working` (bool): Флаг, указывающий, работает ли провайдер (по умолчанию `False`).
- `supports_stream` (bool): Флаг, указывающий, поддерживает ли провайдер стриминг (по умолчанию `True`).
- `supports_system_message` (bool): Флаг, указывающий, поддерживает ли провайдер системные сообщения (по умолчанию `True`).
- `supports_message_history` (bool): Флаг, указывающий, поддерживает ли провайдер историю сообщений (по умолчанию `True`).
- `default_model` (str): Модель, используемая по умолчанию ("gpt-4o-mini").
- `models` (List[str]): Список поддерживаемых моделей.
- `ddgs` (DDGS | None): Объект `DDGS` для выполнения запросов к DuckDuckGo.
- `model_aliases` (dict[str, str]): Словарь псевдонимов моделей.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от DuckDuckGo AI.
- `nodriver_auth`: Выполняет аутентификацию с использованием `nodriver`.

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        timeout: int = 60,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для получения ответов от DuckDuckGo AI.

        Args:
            model (str): Имя модели для использования.
            messages (Messages): Список сообщений для отправки.
            proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
            timeout (int, optional): Время ожидания запроса. По умолчанию 60.
            **kwargs: Дополнительные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, выдающий ответы от DuckDuckGo AI.

        Raises:
            ImportError: Если не установлена библиотека `duckduckgo_search`.

        Как работает функция:
        1. Проверяет, установлена ли библиотека `duckduckgo_search`. Если нет, вызывает исключение `ImportError`.
        2. Если `cls.ddgs` не инициализирован, создает экземпляр `DDGS` с использованием предоставленного прокси и времени ожидания.
        3. Если установлена библиотека `nodriver`, вызывает метод `nodriver_auth` для аутентификации.
        4. Получает имя модели с помощью метода `get_model`.
        5. Итерирует по чанкам, возвращаемым методом `chat_yield` объекта `cls.ddgs`, и выдает их.

        """
```

ASCII flowchart:

```
    A [Проверка наличия duckduckgo_search]
    |
    B [Инициализация DDGS]
    |
    C [nodriver_auth (если has_nodriver)]
    |
    D [Получение имени модели]
    |
    E [chat_yield]
    |
    F [Выдача чанков]
```

**Примеры**:
```python
# Пример использования будет добавлен после реализации
```

### `nodriver_auth`
```python
    @classmethod
    async def nodriver_auth(cls, proxy: str = None):
        """Выполняет аутентификацию с использованием `nodriver`.

        Args:
            proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.

        Как работает функция:
        1. Получает браузер и функцию остановки браузера с помощью `get_nodriver`.
        2. Пытается выполнить аутентификацию, перехватывая запросы к `cls.api_base` и извлекая необходимые заголовки.
        3. Устанавливает обработчик событий для перехвата запросов `RequestWillBeSent`.
        4. Открывает страницу `cls.url` в браузере.
        5. Ожидает, пока не будет установлен атрибут `cls.ddgs._chat_vqd`.
        6. Закрывает страницу и останавливает браузер.

        """
```

ASCII flowchart:

```
    A [Получение браузера и функции остановки браузера]
    |
    B [Установка обработчика событий для перехвата запросов]
    |
    C [Открытие страницы cls.url в браузере]
    |
    D [Ожидание установки атрибута cls.ddgs._chat_vqd]
    |
    E [Закрытие страницы и остановка браузера]
```
**Примеры**:
```python
# Пример использования будет добавлен после реализации
```
## Функции

В данном модуле функции отсутствуют.
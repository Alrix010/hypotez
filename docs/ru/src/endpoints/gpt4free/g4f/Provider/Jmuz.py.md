# Модуль Jmuz

## Обзор

Модуль `Jmuz` предоставляет класс для взаимодействия с API Jmuz, который является одним из провайдеров для получения ответов от различных AI-моделей. Этот модуль наследуется от класса `OpenaiTemplate` и предназначен для работы с асинхронными запросами.

## Подробней

Модуль содержит информацию о URL, базовом URL API, API-ключе и статусе работоспособности Jmuz. Он также определяет псевдонимы для некоторых моделей, чтобы обеспечить совместимость с другими частями проекта. Класс `Jmuz` позволяет получать список поддерживаемых моделей и создавать асинхронный генератор для обмена сообщениями с AI-моделью.

## Классы

### `Jmuz(OpenaiTemplate)`

**Описание**: Класс `Jmuz` предназначен для взаимодействия с API Jmuz.

**Наследует**:
- `OpenaiTemplate`: Предоставляет общую структуру для работы с API, подобными OpenAI.

**Атрибуты**:
- `url` (str): URL для получения дополнительной информации о Jmuz.
- `api_base` (str): Базовый URL API Jmuz.
- `api_key` (str): API-ключ для аутентификации запросов.
- `working` (bool): Флаг, указывающий, работает ли провайдер.
- `supports_system_message` (bool): Флаг, указывающий, поддерживает ли провайдер системные сообщения.
- `default_model` (str): Модель, используемая по умолчанию (`gpt-4o`).
- `model_aliases` (dict): Словарь псевдонимов моделей для совместимости.

**Методы**:
- `get_models(**kwargs)`: Возвращает список поддерживаемых моделей.
- `create_async_generator(model: str, messages: Messages, stream: bool = True, api_key: str = None, **kwargs) -> AsyncResult`: Создает асинхронный генератор для взаимодействия с API.

## Функции

### `get_models(**kwargs)`

**Назначение**: Получение списка доступных моделей. Если список моделей еще не был получен, он запрашивается у родительского класса `OpenaiTemplate`.

```python
    @classmethod
    def get_models(cls, **kwargs):
        """
        Получает список доступных моделей.

        Args:
            **kwargs: Дополнительные аргументы для передачи в функцию `get_models` родительского класса.

        Returns:
            list: Список доступных моделей.
        """
        ...
```

**Параметры**:
- `**kwargs`: Дополнительные аргументы, которые могут потребоваться для получения списка моделей (например, `api_key` и `api_base`).

**Возвращает**:
- `list`: Список доступных моделей.

**Как работает функция**:
1. Проверяется, был ли уже получен список моделей (`cls.models`).
2. Если список моделей пуст, вызывается метод `get_models` родительского класса (`OpenaiTemplate`) с передачей `api_key` и `api_base` класса `Jmuz`.
3. Возвращается список моделей.

**Примеры**:

```python
models = Jmuz.get_models()
print(models)
```

### `create_async_generator(model: str, messages: Messages, stream: bool = True, api_key: str = None, **kwargs) -> AsyncResult`

**Назначение**: Создает асинхронный генератор для обмена сообщениями с AI-моделью.

```python
    @classmethod
    async def create_async_generator(
            cls,
            model: str,
            messages: Messages,
            stream: bool = True,
            api_key: str = None, # Remove api_key from kwargs
            **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для обмена сообщениями с AI-моделью.

        Args:
            model (str): Имя модели для использования.
            messages (Messages): Список сообщений для отправки.
            stream (bool, optional): Флаг, указывающий, использовать ли потоковую передачу. По умолчанию `True`.
            api_key (str, optional): API-ключ для аутентификации. По умолчанию `None`.
            **kwargs: Дополнительные аргументы для передачи в функцию `create_async_generator` родительского класса.

        Returns:
            AsyncResult: Асинхронный генератор для получения ответов от AI-модели.
        """
        ...
```

**Параметры**:
- `model` (str): Имя модели для использования.
- `messages` (Messages): Список сообщений для отправки.
- `stream` (bool, optional): Флаг, указывающий, использовать ли потоковую передачу. По умолчанию `True`.
- `api_key` (str, optional): API-ключ для аутентификации. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы для передачи в функцию `create_async_generator` родительского класса.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор для получения ответов от AI-модели.

**Как работает функция**:

```
A [Получение модели и подготовка заголовков]
|
B [Создание асинхронного генератора]
|
C [Обработка чанков данных]
|
D [Фильтрация и очистка данных]
|
E [Передача очищенных данных]
```

1.  **Получение модели и подготовка заголовков (A)**:
    *   Получает модель, используя `cls.get_model(model)`.
    *   Формирует заголовки запроса, включая API-ключ, тип контента и User-Agent.

2.  **Создание асинхронного генератора (B)**:
    *   Вызывает метод `create_async_generator` родительского класса (`OpenaiTemplate`) для создания асинхронного генератора на основе полученных параметров.

3.  **Обработка чанков данных (C)**:
    *   Итерируется по чанкам данных, полученным от асинхронного генератора.

4.  **Фильтрация и очистка данных (D)**:
    *   Фильтрует и очищает данные, удаляя нежелательные префиксы и полные фразы (например, "Join for free", "https://discord.gg/", "o1-preview").

5.  **Передача очищенных данных (E)**:
    *   Если данные прошли фильтрацию и очистку, передает их дальше с помощью `yield`.

**Примеры**:

```python
messages = [{"role": "user", "content": "Hello, how are you?"}]
async for chunk in Jmuz.create_async_generator(model="gpt-4o", messages=messages):
    print(chunk)
```
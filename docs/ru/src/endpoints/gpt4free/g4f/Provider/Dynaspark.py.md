# Документация для `Dynaspark.py`

## Обзор

Модуль `Dynaspark.py` предоставляет класс `Dynaspark`, который является асинхронным провайдером для взаимодействия с сервисом Dynaspark. Этот сервис позволяет генерировать ответы на основе предоставленных сообщений и медиа-контента, используя различные AI-модели, такие как Gemini. Dynaspark поддерживает стриминг ответов и может работать без драйвера.

## Подробнее

Класс `Dynaspark` наследуется от `AsyncGeneratorProvider` и `ProviderModelMixin`, что обеспечивает его функциональность как асинхронного генератора ответов и предоставляет возможности для работы с моделями. Он использует библиотеку `aiohttp` для выполнения асинхронных HTTP-запросов к API Dynaspark.
В классе реализована поддержка отправки текстовых запросов и изображений, а также выбора различных моделей Gemini для генерации ответов.

## Классы

### `Dynaspark`

**Описание**:
Класс `Dynaspark` реализует функциональность асинхронного провайдера для взаимодействия с Dynaspark API. Он позволяет генерировать ответы на основе текстовых сообщений и медиа-контента, используя различные модели AI, такие как Gemini.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию ответов.
- `ProviderModelMixin`: Предоставляет функциональность для работы с различными моделями.

**Атрибуты**:
- `url` (str): URL сервиса Dynaspark.
- `login_url` (Optional[str]): URL для логина (в данном случае `None`).
- `api_endpoint` (str): URL API для генерации ответов.
- `working` (bool): Флаг, указывающий, что провайдер работает (в данном случае `True`).
- `needs_auth` (bool): Флаг, указывающий необходимость аутентификации (в данном случае `False`).
- `use_nodriver` (bool): Флаг, указывающий, что драйвер не используется (в данном случае `True`).
- `supports_stream` (bool): Флаг, указывающий поддержку стриминга (в данном случае `True`).
- `supports_system_message` (bool): Флаг, указывающий поддержку системных сообщений (в данном случае `False`).
- `supports_message_history` (bool): Флаг, указывающий поддержку истории сообщений (в данном случае `False`).
- `default_model` (str): Модель, используемая по умолчанию (`gemini-1.5-flash`).
- `default_vision_model` (str): Модель для обработки изображений, используемая по умолчанию (`gemini-1.5-flash`).
- `vision_models` (List[str]): Список поддерживаемых моделей для обработки изображений.
- `models` (List[str]): Список поддерживаемых моделей.
- `model_aliases` (Dict[str, str]): Словарь с псевдонимами моделей.

**Принцип работы**:
Класс использует `aiohttp.ClientSession` для отправки асинхронных POST-запросов к API Dynaspark. Он формирует данные формы (`FormData`) с текстовым сообщением и, при необходимости, медиа-контентом. Полученный ответ от API возвращается как асинхронный генератор.

## Методы класса

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        media: MediaListType = None,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для получения ответов от Dynaspark API.

        Args:
            model (str): Имя используемой модели.
            messages (Messages): Список сообщений для отправки.
            proxy (str, optional): Адрес прокси-сервера. По умолчанию `None`.
            media (MediaListType, optional): Список медиа-файлов для отправки. По умолчанию `None`.
            **kwargs: Дополнительные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий ответы от API.

        Raises:
            Exception: Если возникает ошибка при выполнении запроса.

        Как работает функция:
        - Формирует заголовки запроса.
        - Создает асинхронную сессию `aiohttp.ClientSession` с заданными заголовками.
        - Формирует данные формы (`FormData`) с текстовым сообщением и, при необходимости, медиа-контентом.
        - Отправляет POST-запрос к API Dynaspark.
        - Обрабатывает полученный ответ и извлекает текст ответа.
        - Возвращает ответ в виде асинхронного генератора.

        """
```

## Параметры класса

- `url` (str): URL сервиса Dynaspark.
- `login_url` (Optional[str]): URL для логина (в данном случае `None`).
- `api_endpoint` (str): URL API для генерации ответов.
- `working` (bool): Флаг, указывающий, что провайдер работает (в данном случае `True`).
- `needs_auth` (bool): Флаг, указывающий необходимость аутентификации (в данном случае `False`).
- `use_nodriver` (bool): Флаг, указывающий, что драйвер не используется (в данном случае `True`).
- `supports_stream` (bool): Флаг, указывающий поддержку стриминга (в данном случае `True`).
- `supports_system_message` (bool): Флаг, указывающий поддержку системных сообщений (в данном случае `False`).
- `supports_message_history` (bool): Флаг, указывающий поддержку истории сообщений (в данном случае `False`).
- `default_model` (str): Модель, используемая по умолчанию (`gemini-1.5-flash`).
- `default_vision_model` (str): Модель для обработки изображений, используемая по умолчанию (`gemini-1.5-flash`).
- `vision_models` (List[str]): Список поддерживаемых моделей для обработки изображений.
- `models` (List[str]): Список поддерживаемых моделей.
- `model_aliases` (Dict[str, str]): Словарь с псевдонимами моделей.

## Примеры

Пример использования класса `Dynaspark` для создания асинхронного генератора:

```python
model = "gemini-1.5-flash"
messages = [{"role": "user", "content": "Hello, Dynaspark!"}]
async for response in Dynaspark.create_async_generator(model=model, messages=messages):
    print(response)
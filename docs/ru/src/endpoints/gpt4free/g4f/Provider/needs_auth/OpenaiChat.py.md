# Модуль OpenaiChat

## Обзор

Модуль `OpenaiChat` предназначен для организации взаимодействия с сервисом чата OpenAI. Он предоставляет функциональность для создания и управления беседами, загрузки изображений, аутентификации и синтеза речи. Модуль поддерживает работу с различными моделями OpenAI, включая GPT-4 и модели для обработки изображений.

## Подробней

Модуль `OpenaiChat` является асинхронным провайдером, способным поддерживать как аутентифицированные, так и неаутентифицированные запросы к OpenAI. Он использует `StreamSession` для асинхронного взаимодействия с API и предоставляет методы для обработки сообщений, управления куки и заголовками, а также для генерации изображений. Модуль также включает поддержку веб-поиска и может быть использован для синтеза речи.

## Классы

### `OpenaiChat`

**Описание**: Класс для создания и управления беседами с чат-сервисом OpenAI.

**Принцип работы**:

Класс `OpenaiChat` предоставляет интерфейс для взаимодействия с API OpenAI. Он включает методы для аутентификации, загрузки изображений, создания сообщений и управления беседами. Класс поддерживает различные модели OpenAI, включая GPT-4 и модели для обработки изображений.

**Наследует**:
- `AsyncAuthedProvider`: Предоставляет базовую функциональность для асинхронной аутентификации.
- `ProviderModelMixin`: Предоставляет методы для управления моделями.

**Атрибуты**:
- `label` (str): Метка провайдера ("OpenAI ChatGPT").
- `url` (str): URL чат-сервиса ("https://chatgpt.com").
- `working` (bool): Флаг, указывающий на работоспособность провайдера (True).
- `use_nodriver` (bool): Флаг, указывающий на использование nodriver (True).
- `supports_gpt_4` (bool): Флаг, указывающий на поддержку GPT-4 (True).
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений (True).
- `supports_system_message` (bool): Флаг, указывающий на поддержку системных сообщений (True).
- `default_model` (str): Модель по умолчанию (default_model).
- `default_image_model` (str): Модель для обработки изображений по умолчанию (default_image_model).
- `image_models` (list): Список моделей для обработки изображений (image_models).
- `vision_models` (list): Список моделей для анализа текста (text_models).
- `models` (list): Список поддерживаемых моделей (models).
- `synthesize_content_type` (str): Тип контента для синтеза речи ("audio/aac").
- `request_config` (RequestConfig): Объект конфигурации запросов.
- `_api_key` (str): API ключ.
- `_headers` (dict): Заголовки запросов.
- `_cookies` (Cookies): Куки.
- `_expires` (int): Время истечения срока действия API ключа.

**Методы**:
- `on_auth_async`: Асинхронный метод для аутентификации.
- `upload_images`: Загружает изображения и возвращает URL для скачивания.
- `create_messages`: Создает список сообщений для пользовательского ввода.
- `get_generated_image`: Получает сгенерированное изображение.
- `create_authed`: Создает асинхронный генератор для беседы.
- `iter_messages_line`: Итератор для обработки строк сообщений.
- `synthesize`: Синтезирует речь.
- `login`: Выполняет вход в систему.
- `nodriver_auth`: Выполняет аутентификацию с использованием nodriver.
- `get_default_headers`: Возвращает заголовки по умолчанию.
- `_create_request_args`: Создает аргументы запроса.
- `_update_request_args`: Обновляет аргументы запроса.
- `_set_api_key`: Устанавливает API ключ.
- `_update_cookie_header`: Обновляет заголовок куки.

### `Conversation`

**Описание**: Класс для инкапсуляции полей ответа.

**Принцип работы**:
Этот класс используется для хранения и передачи информации о текущем состоянии разговора с OpenAI. Он содержит идентификаторы разговора и сообщений, причину завершения, а также флаги, указывающие на состояние обработки сообщений.

**Наследует**:
- `JsonConversation`: Предоставляет базовую структуру для хранения информации о разговоре в формате JSON.

**Атрибуты**:
- `conversation_id` (str): Идентификатор разговора.
- `message_id` (str): Идентификатор сообщения.
- `user_id` (str): Идентификатор пользователя.
- `finish_reason` (str): Причина завершения разговора.
- `parent_message_id` (str): Идентификатор родительского сообщения.
- `is_thinking` (bool): Флаг, указывающий, находится ли бот в состоянии "размышления".
- `is_recipient` (bool): Флаг, указывающий, является ли сообщение предназначенным для всех получателей.

**Методы**:
- `__init__`: Конструктор класса.

## Функции

### `on_auth_async`

```python
    @classmethod
    async def on_auth_async(cls, proxy: str = None, **kwargs) -> AsyncIterator:
        """
        Асинхронно аутентифицирует пользователя и возвращает объект AuthResult.

        Args:
            proxy (str, optional): Прокси-сервер для использования при запросах. Defaults to None.
            **kwargs: Дополнительные аргументы.

        Yields:
            AsyncIterator: Асинхронный итератор, возвращающий чанки данных аутентификации и объект AuthResult.
            
        Принцип работы:
            1. Вызывает метод `login` для выполнения процесса входа в систему.
            2. Перебирает чанки, возвращаемые методом `login`, и передает их вызывающей стороне.
            3. После завершения процесса входа создает и возвращает объект `AuthResult`, содержащий данные аутентификации,
               такие как API-ключ, куки, заголовки и токены.
        """
```

**Назначение**: Асинхронно аутентифицирует пользователя и возвращает объект `AuthResult`.

**Параметры**:
- `proxy` (str, optional): Прокси-сервер для использования при запросах. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncIterator`: Асинхронный итератор, возвращающий чанки данных аутентификации и объект `AuthResult`.

**Как работает функция**:

1.  Вызывает метод `login` для выполнения процесса входа в систему.
2.  Перебирает чанки, возвращаемые методом `login`, и передает их вызывающей стороне.
3.  После завершения процесса входа создает и возвращает объект `AuthResult`, содержащий данные аутентификации, такие как API-ключ, куки, заголовки и токены.

```
A: Вызов login()
|
B: Перебор чанков из login()
|
C: Создание AuthResult
|
D: Возврат AuthResult
```

**Примеры**:

```python
async for result in OpenaiChat.on_auth_async():
    print(result)
```

### `upload_images`

```python
    @classmethod
    async def upload_images(
        cls,
        session: StreamSession,
        auth_result: AuthResult,
        media: MediaListType,
    ) -> ImageRequest:
        """
        Загружает изображение на сервис и получает URL для скачивания.

        Args:
            session (StreamSession): Объект StreamSession для выполнения запросов.
            auth_result (AuthResult): Объект, содержащий данные аутентификации.
            media (MediaListType): Изображения для загрузки (PIL Image или bytes).

        Returns:
            ImageRequest: Объект ImageRequest, содержащий URL для скачивания, имя файла и другие данные.

        Принцип работы:
            1. Определяет асинхронную функцию `upload_image` для обработки каждого изображения.
            2. Конвертирует изображение в формат bytes и получает расширение.
            3. Отправляет данные изображения на сервис для получения данных о загрузке.
            4. Загружает bytes изображения по полученному URL.
            5. Отправляет запрос на получение URL для скачивания.
            6. Возвращает объект ImageRequest с данными об изображении.
        """
        async def upload_image(image, image_name):
            """
            Загружает одно изображение на сервис и получает URL для скачивания.

            Args:
                image: Изображение для загрузки (PIL Image или bytes).
                image_name: Имя изображения.

            Returns:
                ImageRequest: Объект ImageRequest, содержащий URL для скачивания, имя файла и другие данные.

            Принцип работы:
                1. Конвертирует изображение в формат bytes и получает расширение.
                2. Отправляет данные изображения на сервис для получения данных о загрузке.
                3. Загружает bytes изображения по полученному URL.
                4. Отправляет запрос на получение URL для скачивания.
                5. Возвращает объект ImageRequest с данными об изображении.
            """
```

**Назначение**: Загружает изображение на сервис и получает URL для скачивания.

**Параметры**:
- `session` (StreamSession): Объект `StreamSession` для выполнения запросов.
- `auth_result` (AuthResult): Объект, содержащий данные аутентификации.
- `media` (MediaListType): Изображения для загрузки (PIL Image или bytes).

**Возвращает**:
- `ImageRequest`: Объект `ImageRequest`, содержащий URL для скачивания, имя файла и другие данные.

**Как работает функция**:

1.  Определяет асинхронную функцию `upload_image` для обработки каждого изображения.
2.  Конвертирует изображение в формат bytes и получает расширение.
3.  Отправляет данные изображения на сервис для получения данных о загрузке.
4.  Загружает bytes изображения по полученному URL.
5.  Отправляет запрос на получение URL для скачивания.
6.  Возвращает объект `ImageRequest` с данными об изображении.

```
A: Для каждого изображения:
|
B: Конвертация в bytes и получение расширения
|
C: Отправка данных на сервис
|
D: Загрузка bytes по URL
|
E: Получение URL для скачивания
|
F: Возврат ImageRequest
```

**Примеры**:

```python
image_requests = await OpenaiChat.upload_images(session, auth_result, media)
```

### `create_messages`

```python
    @classmethod
    def create_messages(cls, messages: Messages, image_requests: ImageRequest = None, system_hints: list = None):
        """
        Создает список сообщений для пользовательского ввода.

        Args:
            messages (Messages): Список предыдущих сообщений.
            image_requests (ImageRequest, optional): Объект ответа изображения, если есть. Defaults to None.
            system_hints (list, optional): Системные подсказки для модели. Defaults to None.

        Returns:
            list: Список сообщений с пользовательским вводом и изображением, если есть.

        Принцип работы:
            1. Преобразует список сообщений в формат, ожидаемый API.
            2. Если предоставлены объекты `image_requests`, изменяет содержимое последнего сообщения пользователя,
               добавляя информацию об изображении.
            3. Добавляет метаданные об изображениях в последнее сообщение пользователя.
            4. Возвращает список сообщений.
        """
```

**Назначение**: Создает список сообщений для пользовательского ввода.

**Параметры**:
- `messages` (Messages): Список предыдущих сообщений.
- `image_requests` (ImageRequest, optional): Объект ответа изображения, если есть. По умолчанию `None`.
- `system_hints` (list, optional): Системные подсказки для модели. По умолчанию `None`.

**Возвращает**:
- `list`: Список сообщений с пользовательским вводом и изображением, если есть.

**Как работает функция**:

1.  Преобразует список сообщений в формат, ожидаемый API.
2.  Если предоставлены объекты `image_requests`, изменяет содержимое последнего сообщения пользователя, добавляя информацию об изображении.
3.  Добавляет метаданные об изображениях в последнее сообщение пользователя.
4.  Возвращает список сообщений.

```
A: Преобразование сообщений в формат API
|
B: Добавление информации об изображении (если есть)
|
C: Добавление метаданных об изображениях
|
D: Возврат списка сообщений
```

**Примеры**:

```python
messages = OpenaiChat.create_messages(messages, image_requests)
```

### `get_generated_image`

```python
    @classmethod
    async def get_generated_image(cls, session: StreamSession, auth_result: AuthResult, element: dict, prompt: str = None) -> ImageResponse:
        """
        Получает сгенерированное изображение.

        Args:
            session (StreamSession): Сессия для выполнения запросов.
            auth_result (AuthResult): Данные аутентификации.
            element (dict): Элемент, содержащий информацию об изображении.
            prompt (str, optional): Текст запроса. Defaults to None.

        Returns:
            ImageResponse: Объект ответа с изображением.

        Raises:
            RuntimeError: Если не удается получить изображение.

        Принцип работы:
            1. Извлекает `prompt` и `file_id` из элемента `element`.
            2. Отправляет запрос на скачивание изображения.
            3. Извлекает URL скачивания из ответа.
            4. Возвращает объект `ImageResponse` с URL и текстом запроса.
        """
```

**Назначение**: Получает сгенерированное изображение.

**Параметры**:
- `session` (StreamSession): Сессия для выполнения запросов.
- `auth_result` (AuthResult): Данные аутентификации.
- `element` (dict): Элемент, содержащий информацию об изображении.
- `prompt` (str, optional): Текст запроса. По умолчанию `None`.

**Возвращает**:
- `ImageResponse`: Объект ответа с изображением.

**Вызывает исключения**:
- `RuntimeError`: Если не удается получить изображение.

**Как работает функция**:

1.  Извлекает `prompt` и `file_id` из элемента `element`.
2.  Отправляет запрос на скачивание изображения.
3.  Извлекает URL скачивания из ответа.
4.  Возвращает объект `ImageResponse` с URL и текстом запроса.

```
A: Извлечение prompt и file_id
|
B: Запрос на скачивание изображения
|
C: Извлечение URL скачивания
|
D: Возврат ImageResponse
```

**Примеры**:

```python
image_response = await OpenaiChat.get_generated_image(session, auth_result, element)
```

### `create_authed`

```python
    @classmethod
    async def create_authed(
        cls,
        model: str,
        messages: Messages,
        auth_result: AuthResult,
        proxy: str = None,
        timeout: int = 180,
        auto_continue: bool = False,
        action: str = "next",
        conversation: Conversation = None,
        media: MediaListType = None,
        return_conversation: bool = False,
        web_search: bool = False,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для беседы.

        Args:
            model (str): Название модели.
            messages (Messages): Список предыдущих сообщений.
            auth_result (AuthResult): Результаты аутентификации.
            proxy (str, optional): Прокси-сервер для использования. Defaults to None.
            timeout (int, optional): Время ожидания запроса. Defaults to 180.
            auto_continue (bool, optional): Автоматическое продолжение беседы. Defaults to False.
            action (str, optional): Тип действия ("next", "continue", "variant"). Defaults to "next".
            conversation (Conversation, optional): Объект беседы. Defaults to None.
            media (MediaListType, optional): Список медиафайлов. Defaults to None.
            return_conversation (bool, optional): Возвращать ли объект беседы. Defaults to False.
            web_search (bool, optional): Использовать ли веб-поиск. Defaults to False.
            **kwargs: Дополнительные аргументы.

        Yields:
            AsyncResult: Асинхронные результаты из генератора.

        Raises:
            RuntimeError: Если произошла ошибка во время обработки.

        Принцип работы:
            1. Инициализирует сессию `StreamSession` с заданными параметрами.
            2. Загружает изображения, если они предоставлены.
            3. Получает модель и создает объект `Conversation`.
            4. В цикле отправляет запросы к API для получения ответов.
            5. Обрабатывает ответы и возвращает результаты.
            6. Если включено автоматическое продолжение, продолжает беседу.
        """
```

**Назначение**: Создает асинхронный генератор для беседы.

**Параметры**:
- `model` (str): Название модели.
- `messages` (Messages): Список предыдущих сообщений.
- `auth_result` (AuthResult): Результаты аутентификации.
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
- `timeout` (int, optional): Время ожидания запроса. По умолчанию `180`.
- `auto_continue` (bool, optional): Автоматическое продолжение беседы. По умолчанию `False`.
- `action` (str, optional): Тип действия ("next", "continue", "variant"). По умолчанию `"next"`.
- `conversation` (Conversation, optional): Объект беседы. По умолчанию `None`.
- `media` (MediaListType, optional): Список медиафайлов. По умолчанию `None`.
- `return_conversation` (bool, optional): Возвращать ли объект беседы. По умолчанию `False`.
- `web_search` (bool, optional): Использовать ли веб-поиск. По умолчанию `False`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронные результаты из генератора.

**Вызывает исключения**:
- `RuntimeError`: Если произошла ошибка во время обработки.

**Как работает функция**:

1.  Инициализирует сессию `StreamSession` с заданными параметрами.
2.  Загружает изображения, если они предоставлены.
3.  Получает модель и создает объект `Conversation`.
4.  В цикле отправляет запросы к API для получения ответов.
5.  Обрабатывает ответы и возвращает результаты.
6.  Если включено автоматическое продолжение, продолжает беседу.

```
A: Инициализация StreamSession
|
B: Загрузка изображений (если есть)
|
C: Получение модели и создание Conversation
|
D: В цикле:
    |
    E: Отправка запроса к API
    |
    F: Обработка ответа
    |
    G: Возврат результатов
    |
    H: Автоматическое продолжение (если включено)
|
I: Завершение
```

**Примеры**:

```python
async for result in OpenaiChat.create_authed(model="gpt-4", messages=messages, auth_result=auth_result):
    print(result)
```

### `iter_messages_line`

```python
    @classmethod
    async def iter_messages_line(cls, session: StreamSession, auth_result: AuthResult, line: bytes, fields: Conversation, sources: Sources) -> AsyncIterator:
        """
        Итерирует строки сообщений и возвращает асинхронные результаты.

        Args:
            session (StreamSession): Сессия для выполнения запросов.
            auth_result (AuthResult): Данные аутентификации.
            line (bytes): Строка сообщения в байтах.
            fields (Conversation): Объект беседы.
            sources (Sources): Объект источников.

        Yields:
            AsyncIterator: Асинхронные результаты из генератора.

        Принцип работы:
            1. Проверяет, начинается ли строка с "data: ".
            2. Загружает JSON из строки.
            3. Обрабатывает различные типы сообщений и извлекает информацию.
            4. Возвращает результаты в зависимости от типа сообщения.
        """
```

**Назначение**: Итерирует строки сообщений и возвращает асинхронные результаты.

**Параметры**:
- `session` (StreamSession): Сессия для выполнения запросов.
- `auth_result` (AuthResult): Данные аутентификации.
- `line` (bytes): Строка сообщения в байтах.
- `fields` (Conversation): Объект беседы.
- `sources` (Sources): Объект источников.

**Возвращает**:
- `AsyncIterator`: Асинхронные результаты из генератора.

**Как работает функция**:

1.  Проверяет, начинается ли строка с "data: ".
2.  Загружает JSON из строки.
3.  Обрабатывает различные типы сообщений и извлекает информацию.
4.  Возвращает результаты в зависимости от типа сообщения.

```
A: Проверка начала строки с "data: "
|
B: Загрузка JSON
|
C: Обработка различных типов сообщений
|
D: Возврат результатов
```

**Примеры**:

```python
async for chunk in OpenaiChat.iter_messages_line(session, auth_result, line, conversation, sources):
    print(chunk)
```

### `synthesize`

```python
    @classmethod
    async def synthesize(cls, params: dict) -> AsyncIterator[bytes]:
        """
        Синтезирует речь на основе заданных параметров.

        Args:
            params (dict): Параметры для синтеза речи.

        Yields:
            AsyncIterator[bytes]: Асинхронный итератор байтов синтезированной речи.

        Принцип работы:
            1. Выполняет вход в систему.
            2. Инициализирует сессию `StreamSession`.
            3. Отправляет запрос на синтез речи с заданными параметрами.
            4. Итерирует содержимое ответа и возвращает байты синтезированной речи.
        """
```

**Назначение**: Синтезирует речь на основе заданных параметров.

**Параметры**:
- `params` (dict): Параметры для синтеза речи.

**Возвращает**:
- `AsyncIterator[bytes]`: Асинхронный итератор байтов синтезированной речи.

**Как работает функция**:

1.  Выполняет вход в систему.
2.  Инициализирует сессию `StreamSession`.
3.  Отправляет запрос на синтез речи с заданными параметрами.
4.  Итерирует содержимое ответа и возвращает байты синтезированной речи.

```
A: Выполнение входа в систему
|
B: Инициализация StreamSession
|
C: Отправка запроса на синтез речи
|
D: Итерация содержимого ответа и возврат байтов
```

**Примеры**:

```python
async for chunk in OpenaiChat.synthesize(params):
    print(chunk)
```

### `login`

```python
    @classmethod
    async def login(
        cls,
        proxy: str = None,
        api_key: str = None,
        proof_token: str = None,
        cookies: Cookies = None,
        headers: dict = None,
        **kwargs
    ) -> AsyncIterator:
        """
        Выполняет вход в систему.

        Args:
            proxy (str, optional): Прокси-сервер для использования. Defaults to None.
            api_key (str, optional): API-ключ для аутентификации. Defaults to None.
            proof_token (str, optional): Токен подтверждения. Defaults to None.
            cookies (Cookies, optional): Куки для аутентификации. Defaults to None.
            headers (dict, optional): Заголовки для аутентификации. Defaults to None.
            **kwargs: Дополнительные аргументы.

        Yields:
            AsyncIterator: Асинхронный итератор.

        Принцип работы:
            1. Проверяет, истек ли срок действия API-ключа.
            2. Устанавливает заголовки и куки.
            3. Если предоставлен API-ключ, устанавливает его.
            4. В противном случае пытается получить конфигурацию запроса из файла HAR.
            5. Если не удается получить конфигурацию, использует `nodriver_auth` для аутентификации.
        """
```

**Назначение**: Выполняет вход в систему.

**Параметры**:
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
- `api_key` (str, optional): API-ключ для аутентификации. По умолчанию `None`.
- `proof_token` (str, optional): Токен подтверждения. По умолчанию `None`.
- `cookies` (Cookies, optional): Куки для аутентификации. По умолчанию `None`.
- `headers` (dict, optional): Заголовки для аутентификации. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncIterator`: Асинхронный итератор.

**Как работает функция**:

1.  Проверяет, истек ли срок действия API-ключа.
2.  Устанавливает заголовки и куки.
3.  Если предоставлен API-ключ, устанавливает его.
4.  В противном случае пытается получить конфигурацию запроса из файла HAR.
5.  Если не удается получить конфигурацию, использует `nodriver_auth` для аутентификации.

```
A: Проверка срока действия API-ключа
|
B: Установка заголовков и куки
|
C: Установка API-ключа (если предоставлен)
|
D: Попытка получения конфигурации из файла HAR
|
E: Использование nodriver_auth (если не удалось получить конфигурацию)
```

**Примеры**:

```python
async for _ in OpenaiChat.login(api_key="YOUR_API_KEY"):
    pass
```

### `nodriver_auth`

```python
    @classmethod
    async def nodriver_auth(cls, proxy: str = None):
        """
        Выполняет аутентификацию с использованием nodriver.

        Args:
            proxy (str, optional): Прокси-сервер для использования. Defaults to None.

        Принцип работы:
            1. Запускает браузер с помощью `get_nodriver`.
            2. Устанавливает обработчики событий для перехвата запросов и получения данных аутентификации.
            3. Переходит на страницу входа и выполняет автоматический ввод данных и нажатие кнопок.
            4. Получает API-ключ и другие данные аутентификации из контекста страницы.
            5. Останавливает браузер.
        """
```

**Назначение**: Выполняет аутентификацию с использованием nodriver.

**Параметры**:
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.

**Как работает функция**:

1.  Запускает браузер с помощью `get_nodriver`.
2.  Устанавливает обработчики событий для перехвата запросов и получения данных аутентификации.
3.  Переходит на страницу входа и выполняет автоматический ввод данных и нажатие кнопок.
4.  Получает API-ключ и другие данные аутентификации из контекста страницы.
5.  Останавливает браузер.

```
A: Запуск браузера с помощью get_nodriver
|
B: Установка обработчиков событий
|
C: Переход на страницу входа и автоматический ввод данных
|
D: Получение API-ключа и других данных
|
E: Остановка браузера
```

**Примеры**:

```python
await OpenaiChat.nodriver_auth()
```

### `get_default_headers`

```python
    @staticmethod
    def get_default_headers() -> Dict[str, str]:
        """
        Возвращает словарь с заголовками по умолчанию.

        Returns:
            Dict[str, str]: Словарь с заголовками по умолчанию.
        """
```

**Назначение**: Возвращает словарь с заголовками по умолчанию.

**Возвращает**:
- `Dict[str, str]`: Словарь с заголовками по умолчанию.

**Как работает функция**:

1.  Создает и возвращает словарь, содержащий заголовки по умолчанию.

**Примеры**:

```python
headers = OpenaiChat.get_default_headers()
```

### `_create_request_args`

```python
    @classmethod
    def _create_request_args(cls, cookies: Cookies = None, headers: dict = None, user_agent: str = None):
        """
        Создает аргументы запроса.

        Args:
            cookies (Cookies, optional): Куки для запроса. Defaults to None.
            headers (dict, optional): Заголовки для запроса. Defaults to None.
            user_agent (str, optional): User-Agent для запроса. Defaults to None.

        Принцип работы:
            1. Устанавливает заголовки по умолчанию или использует предоставленные.
            2. Устанавливает User-Agent, если он предоставлен.
            3. Устанавливает куки, если они предоставлены.
            4. Обновляет заголовок Cookie.
        """
```

**Назначение**: Создает аргументы запроса.

**Параметры**:
- `cookies` (Cookies, optional): Куки для запроса. По умолчанию `None`.
- `headers` (dict, optional): Заголовки для запроса. По умолчанию `None`.
- `user_agent` (str, optional): User-Agent для запроса. По умолчанию `None`.

**Как работает функция**:

1.  Устанавливает заголовки по умолчанию или использует предоставленные.
2.  Устанавливает User-Agent, если он предоставлен.
3.  Устанавливает куки, если они предоставлены.
4.  Обновляет заголовок Cookie.

```
A: Установка заголовков
|
B: Установка User-Agent (если предоставлен)
|
C: Установка куки
|
D: Обновление заголовка Cookie
```

**Примеры**:

```python
OpenaiChat._create_request_args(cookies=cookies, headers=headers, user_agent=user_agent)
```

### `_update_request_args`

```python
    @classmethod
    def _update_request_args(cls, auth_result: AuthResult, session: StreamSession):
        """
        Обновляет аргументы запроса.

        Args:
            auth_result (AuthResult): Результаты аутентификации.
            session (StreamSession): Сессия для запроса.

        Принцип работы:
            1. Обновляет куки из сессии.
            2. Обновляет заголовок Cookie.
        """
```

**Назначение**: Обновляет аргументы запроса.

**Параметры**:
- `auth_result` (AuthResult): Результаты аутентификации.
- `session` (StreamSession): Сессия для запроса.

**Как работает функция**:

1.  Обновляет куки из сессии.
2.  Обновляет заголовок Cookie.

```
A: Обновление куки из сессии
|
B: Обновление заголовка Cookie
```

**Примеры**:

```python
OpenaiChat._update_request_args(auth_result, session)
```

### `_set_api_key`

```python
    @classmethod
    def _set_api_key(cls, api_key: str):
        """
        Устанавливает API-ключ.

        Args:
            api_key (str): API-ключ.

        Returns:
            bool: True, если API-ключ установлен, False в противном случае.

        Принцип работы:
            1. Извлекает время истечения срока действия API-ключа.
            2. Проверяет, не истек ли срок действия API-ключа.
            3. Устанавливает API-ключ и заголовок Authorization.
        """
```

**Назначение**: Устанавливает API-ключ.

**Параметры**:
- `api_key` (str): API-ключ.

**Возвращает**:
- `bool`: `True`, если API-ключ установлен, `False` в противном случае.

**Как работает функция**:

1.  Извлекает время истечения срока действия API-ключа.
2.  Проверяет, не истек ли срок действия API-ключа.
3.  Устанавливает API-ключ и заголовок `Authorization`.

```
A: Извлечение времени истечения срока действия API-ключа
|
B: Проверка срока действия API-ключа
|
C: Установка API-ключа и заголовка Authorization
```

**Примеры**:

```python
OpenaiChat._set_api_key(api_key)
```

### `_update_cookie_header`

```python
    @classmethod
    def _update_cookie_header(cls):
        """
        Обновляет заголовок Cookie.

        Принцип работы:
            1. Форматирует куки и устанавливает заголовок Cookie.
        """
```

**Назначение**: Обновляет заголовок Cookie.

**Как работает функция**:

1.  Форматирует куки и устанавливает заголовок `Cookie`.

```
A: Форматирование куки
|
B: Установка заголовка Cookie
```

**Примеры**:

```python
OpenaiChat._update_cookie_header()
```

### `get_cookies`

```python
def get_cookies(
    urls: Optional[Iterator[str]] = None
) -> Generator[Dict, Dict, Dict[str, str]]:
    """
    Получает куки для заданных URL.

    Args:
        urls (Optional[Iterator[str]], optional): Итератор URL. Defaults to None.

    Yields:
# Модуль `AIChatFree`

## Обзор

Модуль `AIChatFree` предоставляет асинхронный интерфейс для взаимодействия с сервисом AIChatFree, используя модель `gemini-1.5-pro`. Он поддерживает потоковую передачу данных и сохранение истории сообщений. Модуль предназначен для интеграции с другими частями проекта `hypotez` для предоставления доступа к AI-моделям.

## Подробнее

Модуль использует `aiohttp` для выполнения асинхронных HTTP-запросов и предоставляет класс `AIChatFree`, который наследуется от `AsyncGeneratorProvider` и `ProviderModelMixin`. Это позволяет использовать его как асинхронный генератор, который возвращает чанки данных по мере их поступления.

## Классы

### `AIChatFree`

**Описание**: Класс `AIChatFree` предоставляет асинхронный интерфейс для взаимодействия с сервисом AIChatFree.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию данных.
- `ProviderModelMixin`: Предоставляет функциональность для работы с моделями.

**Атрибуты**:
- `url` (str): URL-адрес сервиса AIChatFree.
- `working` (bool): Указывает, работает ли провайдер (в данном случае `False`).
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (в данном случае `True`).
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер сохранение истории сообщений (в данном случае `True`).
- `default_model` (str): Модель, используемая по умолчанию (в данном случае `gemini-1.5-pro`).

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для взаимодействия с сервисом.

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    connector: BaseConnector = None,
    **kwargs,
) -> AsyncResult:
    """Создает асинхронный генератор для взаимодействия с сервисом AIChatFree.

    Args:
        cls (AIChatFree): Ссылка на класс.
        model (str): Модель для использования.
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Адрес прокси-сервера. По умолчанию `None`.
        connector (BaseConnector, optional): Объект коннектора `aiohttp`. По умолчанию `None`.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий чанки данных.

    Raises:
        RateLimitError: Если достигнут лимит запросов.
        Exception: Если возникает ошибка при выполнении запроса.
    """
    ...
```

**Назначение**: Создает асинхронный генератор для взаимодействия с сервисом AIChatFree.

**Параметры**:
- `cls` (AIChatFree): Ссылка на класс.
- `model` (str): Модель для использования.
- `messages` (Messages): Список сообщений для отправки.
- `proxy` (str, optional): Адрес прокси-сервера. По умолчанию `None`.
- `connector` (BaseConnector, optional): Объект коннектора `aiohttp`. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий чанки данных.

**Вызывает исключения**:
- `RateLimitError`: Если достигнут лимит запросов.
- `Exception`: Если возникает ошибка при выполнении запроса.

**Как работает функция**:

1. **Подготовка заголовков**: Формируются HTTP-заголовки, включая User-Agent, Accept, Accept-Language, Accept-Encoding, Content-Type, Referer и Origin.
2. **Создание сессии**: Создается асинхронная сессия `aiohttp` с использованием предоставленного коннектора или прокси.
3. **Формирование данных**: Формируются данные для отправки, включая сообщения, временную метку и подпись.
4. **Выполнение запроса**: Выполняется POST-запрос к сервису AIChatFree.
5. **Обработка ответа**: Обрабатывается ответ от сервиса, проверяется наличие ошибок и лимитов.
6. **Генерация чанков**: Возвращается асинхронный генератор, который возвращает чанки данных по мере их поступления.

```
Подготовка заголовков и данных --> Создание асинхронной сессии
    |
    --> Выполнение POST-запроса к сервису AIChatFree
    |
    --> Обработка ответа от сервиса, проверка ошибок и лимитов
    |
    --> Генерация чанков данных
```

**Примеры**:

Пример использования функции `create_async_generator`:

```python
messages = [{"role": "user", "content": "Hello, how are you?"}]
model = "gemini-1.5-pro"
async for chunk in AIChatFree.create_async_generator(model=model, messages=messages):
    print(chunk, end="")
```

## Функции

### `generate_signature`

```python
def generate_signature(time: int, text: str, secret: str = ""):
    """Генерирует подпись для запроса.

    Args:
        time (int): Временная метка.
        text (str): Текст для подписи.
        secret (str, optional): Секретный ключ. По умолчанию "".

    Returns:
        str: Сгенерированная подпись.
    """
    ...
```

**Назначение**: Генерирует подпись для запроса, используя алгоритм SHA256.

**Параметры**:
- `time` (int): Временная метка.
- `text` (str): Текст для подписи.
- `secret` (str, optional): Секретный ключ. По умолчанию "".

**Возвращает**:
- `str`: Сгенерированная подпись.

**Как работает функция**:

1. **Формирование сообщения**: Формируется строка сообщения, включающая временную метку, текст и секретный ключ.
2. **Кодирование сообщения**: Сообщение кодируется в байты.
3. **Вычисление SHA256**: Вычисляется SHA256 хеш от закодированного сообщения.
4. **Возврат подписи**: Возвращается шестнадцатеричное представление хеша.

```
Формирование сообщения --> Кодирование сообщения в байты
    |
    --> Вычисление SHA256 хеша
    |
    --> Возврат шестнадцатеричного представления хеша
```

**Примеры**:

Пример использования функции `generate_signature`:

```python
time = int(time.time() * 1e3)
text = "Hello, how are you?"
signature = generate_signature(time, text)
print(signature)
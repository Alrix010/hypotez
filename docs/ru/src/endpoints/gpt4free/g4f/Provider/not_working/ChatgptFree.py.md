# Модуль `ChatgptFree.py`

## Обзор

Модуль предназначен для взаимодействия с сервисом ChatgptFree.ai с использованием асинхронных запросов. Он предоставляет асинхронный генератор, который позволяет получать ответы от модели чат-бота частями. Модуль использует `StreamSession` для асинхронной потоковой передачи данных и поддерживает проксирование.

## Подробней

Модуль `ChatgptFree.py` является частью проекта `hypotez` и предназначен для интеграции с сервисом ChatgptFree.ai. Он обеспечивает возможность отправки запросов к чат-боту и получения ответов в асинхронном режиме, что позволяет эффективно использовать ресурсы и обрабатывать большие объемы данных. Модуль включает в себя функциональность для получения идентификаторов `post_id` и `nonce`, необходимых для аутентификации запросов, а также для форматирования запросов в соответствии с требованиями API.

## Классы

### `ChatgptFree`

**Описание**:
Класс `ChatgptFree` предоставляет функциональность для взаимодействия с сервисом ChatgptFree.ai. Он наследует от `AsyncGeneratorProvider` и `ProviderModelMixin`, что позволяет ему использовать асинхронные генераторы для получения ответов от модели и управлять списком доступных моделей.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию данных.
- `ProviderModelMixin`: Предоставляет функциональность для управления моделями.

**Атрибуты**:
- `url` (str): URL сервиса ChatgptFree.ai.
- `working` (bool): Флаг, указывающий на работоспособность сервиса.
- `_post_id` (str | None): Идентификатор поста, необходимый для запросов.
- `_nonce` (str | None): Одноразовый код, необходимый для запросов.
- `default_model` (str): Модель, используемая по умолчанию.
- `models` (list[str]): Список поддерживаемых моделей.
- `model_aliases` (dict[str, str]): Словарь псевдонимов моделей.

**Методы**:
- `create_async_generator()`: Создает асинхронный генератор для получения ответов от модели.

## Методы класса

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    timeout: int = 120,
    cookies: dict = None,
    **kwargs
) -> AsyncGenerator[str, None]:
    """Создает асинхронный генератор для получения ответов от модели.

    Args:
        cls (ChatgptFree): Ссылка на класс.
        model (str): Модель для использования.
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        timeout (int, optional): Время ожидания запроса в секундах. По умолчанию 120.
        cookies (dict, optional): Куки для отправки с запросом. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncGenerator[str, None]: Асинхронный генератор, выдающий ответы от модели.

    Raises:
        RuntimeError: Если не удается получить `post_id` или `nonce`.
        Exception: Если возникает ошибка при выполнении запроса.

    Как работает функция:
    - Функция принимает модель, список сообщений, прокси-сервер, время ожидания и куки.
    - Если `_nonce` не установлен, функция отправляет GET-запрос к сервису для получения `post_id` и `nonce`.
    - Форматирует сообщения в строку.
    - Отправляет POST-запрос к сервису с данными, включая `_wpnonce`, `post_id`, `url`, `action`, `message` и `bot_id`.
    - Получает ответ от сервиса и извлекает контент из JSON-данных.
    - Генерирует контент, полученный от сервиса.
    - Если происходит ошибка при декодировании JSON, функция переходит к следующей итерации.

    Внутренние функции:
    - Отсутствуют.
    """
```

**Параметры**:
- `cls`: Ссылка на класс.
- `model` (str): Модель для использования.
- `messages` (Messages): Список сообщений для отправки.
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
- `timeout` (int, optional): Время ожидания запроса в секундах. По умолчанию 120.
- `cookies` (dict, optional): Куки для отправки с запросом. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncGenerator[str, None]`: Асинхронный генератор, выдающий ответы от модели.

**Вызывает исключения**:
- `RuntimeError`: Если не удается получить `post_id` или `nonce`.

**Примеры**:

```python
async def main():
    model = "gpt-4o-mini-2024-07-18"
    messages = [{"role": "user", "content": "Hello, how are you?"}]
    proxy = None
    timeout = 120
    cookies = None

    generator = ChatgptFree.create_async_generator(
        model=model, messages=messages, proxy=proxy, timeout=timeout, cookies=cookies
    )

    async for message in generator:
        print(message)

# asyncio.run(main())
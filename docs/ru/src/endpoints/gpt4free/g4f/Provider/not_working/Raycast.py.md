# Модуль `Raycast.py`

## Обзор

Модуль предоставляет реализацию провайдера `Raycast` для работы с API `raycast.com`. Он позволяет создавать запросы к моделям, таким как `gpt-3.5-turbo` и `gpt-4`, используя токен авторизации. Модуль поддерживает потоковую передачу данных и требует наличия аутентификации.

## Подробней

Модуль содержит класс `Raycast`, который наследуется от `AbstractProvider`.
Он предназначен для взаимодействия с API `Raycast` и предоставляет функциональность для создания и обработки запросов к моделям `GPT`.

## Классы

### `Raycast(AbstractProvider)`

**Описание**: Класс `Raycast` предназначен для взаимодействия с API `Raycast` для получения ответов от моделей, таких как `gpt-3.5-turbo` и `gpt-4`.

**Наследует**:

-   `AbstractProvider`: Абстрактный класс, определяющий интерфейс для провайдеров.

**Аттрибуты**:

-   `url` (str): URL API `Raycast`.
-   `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (значение `True`).
-   `needs_auth` (bool): Указывает, требуется ли аутентификация для использования провайдера (значение `True`).
-   `working` (bool): Указывает, работает ли провайдер в данный момент (значение `False`).
-   `models` (List[str]): Список поддерживаемых моделей (`gpt-3.5-turbo`, `gpt-4`).

**Методы**:

-   `create_completion`: Отправляет запрос к API `Raycast` и возвращает результат.

## Функции

### `create_completion`

```python
    @staticmethod
    def create_completion(
        model: str,
        messages: Messages,
        stream: bool,
        proxy: str = None,
        **kwargs,
    ) -> CreateResult:
        """ Функция отправляет запрос к API Raycast и возвращает результат.
        Args:
            model (str): Идентификатор модели для использования (например, "gpt-3.5-turbo", "gpt-4").
            messages (Messages): Список сообщений для отправки в запросе.
            stream (bool): Указывает, использовать ли потоковую передачу данных.
            proxy (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
            **kwargs: Дополнительные аргументы, такие как токен аутентификации (`auth`).

        Returns:
            CreateResult: Генератор токенов завершения.

        Raises:
            ValueError: Если не предоставлен токен аутентификации.
        """
```

**Назначение**: Функция `create_completion` отправляет запрос к API `Raycast` и возвращает результат в виде генератора токенов завершения.

**Параметры**:

-   `model` (str): Идентификатор модели для использования (например, `"gpt-3.5-turbo"`, `"gpt-4"`).
-   `messages` (Messages): Список сообщений для отправки в запросе.
-   `stream` (bool): Указывает, использовать ли потоковую передачу данных.
-   `proxy` (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
-   `**kwargs`: Дополнительные аргументы, такие как токен аутентификации (`auth`).

**Возвращает**:

-   `CreateResult`: Генератор токенов завершения.

**Вызывает исключения**:

-   `ValueError`: Если не предоставлен токен аутентификации.

**Как работает функция**:

1.  **Проверка аутентификации**: Функция проверяет наличие токена аутентификации в аргументах `kwargs`. Если токен отсутствует, вызывается исключение `ValueError`.
2.  **Подготовка заголовков**: Формируются заголовки запроса, включая токен аутентификации.
3.  **Преобразование сообщений**: Список сообщений преобразуется в формат, ожидаемый API `Raycast`.
4.  **Формирование данных запроса**: Подготавливаются данные запроса, включая модель, сообщения и параметры.
5.  **Отправка запроса**: Отправляется `POST`-запрос к API `Raycast` с использованием библиотеки `requests`.
6.  **Обработка потока токенов**: Функция итерируется по строкам ответа, извлекая токены завершения и передавая их в генератор.

```
Проверка наличия токена аутентификации (auth)
│
├─── Отсутствует токен аутентификации?
│    └─── Да: Выбросить исключение ValueError
│
└─── Токен аутентификации присутствует:
     │
     └─── Формирование заголовков запроса (headers)
          │
          └─── Преобразование сообщений в нужный формат (parsed_messages)
               │
               └─── Подготовка данных для POST запроса (data)
                    │
                    └─── Отправка POST запроса к API Raycast (requests.post)
                         │
                         └─── Итерация по строкам ответа для извлечения токенов
                              │
                              └─── Обнаружены данные (data:)?
                                   │
                                   ├─── Нет: Пропустить строку
                                   │
                                   └─── Да: Извлечь JSON из строки (completion_chunk)
                                        │
                                        └─── Извлечение текста из completion_chunk (token)
                                             │
                                             └─── Значение токена не None?
                                                  │
                                                  ├─── Нет: Пропустить токен
                                                  │
                                                  └─── Да: Передать токен в генератор (yield token)
```

**Примеры**:

```python
# Пример вызова функции create_completion
auth_token = "тут_твой_токен"

messages = [
    {"role": "user", "content": "Привет, как дела?"},
    {"role": "assistant", "content": "Все отлично, спасибо!"}
]

# Пример без использования прокси
result = Raycast.create_completion(
    model="gpt-3.5-turbo",
    messages=messages,
    stream=True,
    auth=auth_token
)

# Вывод токенов
for token in result:
    print(token, end="")
```
```python
# Пример вызова функции create_completion c использованием прокси
auth_token = "тут_твой_токен"

messages = [
    {"role": "user", "content": "Привет, как дела?"},
    {"role": "assistant", "content": "Все отлично, спасибо!"}
]

result = Raycast.create_completion(
    model="gpt-3.5-turbo",
    messages=messages,
    stream=True,
    auth=auth_token,
    proxy = "http://ваш_прокси:8080"
)

# Вывод токенов
for token in result:
    print(token, end="")
# Модуль `AutonomousAI.py`

## Обзор

Модуль предоставляет класс `AutonomousAI`, который является асинхронным генератором для взаимодействия с различными моделями AI, предоставляемыми Autonomous.AI. Он поддерживает потоковую передачу данных и использование системных сообщений.

## Подробнее

Модуль предназначен для асинхронного взаимодействия с AI-моделями через API Autonomous.AI. Он использует `aiohttp` для выполнения асинхронных HTTP-запросов и `base64` для кодирования сообщений.

## Классы

### `AutonomousAI`

**Описание**: Класс `AutonomousAI` реализует функциональность асинхронного генератора для взаимодействия с моделями AI, предоставляемыми Autonomous.AI. Он поддерживает потоковую передачу данных, использование системных сообщений и хранение истории сообщений.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает базовую функциональность для асинхронных провайдеров-генераторов.
- `ProviderModelMixin`: Предоставляет общие методы для работы с моделями провайдера.

**Атрибуты**:
- `url` (str): URL главной страницы Autonomous.AI.
- `api_endpoints` (dict): Словарь с конечными точками API для различных моделей.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_stream` (bool): Флаг, указывающий на поддержку потоковой передачи данных.
- `supports_system_message` (bool): Флаг, указывающий на поддержку системных сообщений.
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений.
- `default_model` (str): Модель, используемая по умолчанию (`llama`).
- `models` (list): Список поддерживаемых моделей.
- `model_aliases` (dict): Словарь псевдонимов моделей для удобства использования.

**Методы**:
- `create_async_generator`: Асинхронный генератор для получения ответов от AI-модели.

## Методы класса

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    stream: bool = False,
    **kwargs
) -> AsyncResult:
    """Функция создает асинхронный генератор для получения ответов от AI-модели.

    Args:
        cls (AutonomousAI): Ссылка на класс `AutonomousAI`.
        model (str): Название модели для использования.
        messages (Messages): Список сообщений для отправки в модель.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        stream (bool, optional): Флаг, указывающий на использование потоковой передачи данных. По умолчанию `False`.
        **kwargs: Дополнительные параметры.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий части ответа от модели.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса.

    """
```

**Назначение**: Создание асинхронного генератора для получения ответов от указанной AI-модели.

**Параметры**:
- `cls` (AutonomousAI): Ссылка на класс `AutonomousAI`.
- `model` (str): Название модели для использования.
- `messages` (Messages): Список сообщений для отправки в модель.
- `proxy` (str, optional): URL прокси-сервера. По умолчанию `None`.
- `stream` (bool, optional): Флаг, указывающий на использование потоковой передачи данных. По умолчанию `False`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий части ответа от модели.

**Как работает функция**:

1. **Определение конечной точки API**:
   - Функция извлекает конечную точку API для указанной модели из словаря `cls.api_endpoints`.
2. **Формирование заголовков**:
   - Создаются заголовки HTTP-запроса, включающие информацию о типе контента, стране, источнике запроса, User-Agent и временной зоне.
3. **Асинхронный HTTP-запрос**:
   - Используется `aiohttp.ClientSession` для выполнения асинхронного POST-запроса к API.
   - Сообщения кодируются в JSON, затем в base64.
   - Данные запроса включают закодированные сообщения, ID потока (модель), флаг потоковой передачи и название AI-агента (модель).
4. **Обработка потоковых данных**:
   - Функция итерируется по частям ответа, получаемым из `response.content`.
   - Каждая часть декодируется и обрабатывается:
     - Если часть равна `"data: [DONE]"`, она пропускается.
     - Из части извлекаются данные JSON, удаляя префикс `"data: "`.
     - Извлекается контент из поля `delta["content"]` и возвращается как часть ответа.
     - Если в данных есть `finish_reason`, он также возвращается.
5. **Обработка ошибок**:
   - В случае ошибки декодирования JSON, она игнорируется, и обработка продолжается.

**Примеры**:

Пример вызова функции:

```python
import asyncio
from src.endpoints.gpt4free.g4f.Provider.not_working.AutonomousAI import AutonomousAI

async def main():
    model = "llama"
    messages = [{"role": "user", "content": "Hello, how are you?"}]
    proxy = None
    stream = True

    async for chunk in AutonomousAI.create_async_generator(model=model, messages=messages, proxy=proxy, stream=stream):
        print(chunk, end="")

if __name__ == "__main__":
    asyncio.run(main())
# Модуль stubs

## Обзор

Модуль `stubs` содержит определения классов и моделей данных, используемых для представления различных структур данных, таких как токены, использование ресурсов, вызовы инструментов, сообщения чата, выбор завершения чата и ответы изображений. Он также включает вспомогательные функции для фильтрации данных и извлечения URI данных изображений.

## Подробнее

Этот модуль предоставляет статические типы для работы с ответами от моделей GPT-4Free. Он содержит классы для представления деталей токенов, использования моделей, вызовов инструментов, сообщений чата, выбора завершения чата и ответов изображений. Модуль также включает вспомогательные функции для фильтрации данных и извлечения URI данных изображений.

## Классы

### `BaseModel`

**Описание**: Базовый класс для моделей данных, используемый для создания объектов с атрибутами.

**Принцип работы**:
Класс `BaseModel` предоставляет базовую функциональность для создания моделей данных. Если `pydantic` не установлен, используется упрощенная реализация. В противном случае используется `BaseModel` из `pydantic`.

### `TokenDetails`

**Описание**: Модель данных для представления деталей токенов.

**Атрибуты**:
- `cached_tokens` (int): Количество кэшированных токенов.

### `UsageModel`

**Описание**: Модель данных для представления информации об использовании ресурсов.

**Атрибуты**:
- `prompt_tokens` (int): Количество токенов в запросе.
- `completion_tokens` (int): Количество токенов в завершении.
- `total_tokens` (int): Общее количество токенов.
- `prompt_tokens_details` (TokenDetails): Детали токенов в запросе.
- `completion_tokens_details` (TokenDetails): Детали токенов в завершении.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `UsageModel` с заданными параметрами.

### `ToolFunctionModel`

**Описание**: Модель данных для представления функции инструмента.

**Атрибуты**:
- `name` (str): Имя функции.
- `arguments` (str): Аргументы функции.

### `ToolCallModel`

**Описание**: Модель данных для представления вызова инструмента.

**Атрибуты**:
- `id` (str): Идентификатор вызова инструмента.
- `type` (str): Тип вызова инструмента.
- `function` (ToolFunctionModel): Функция инструмента.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `ToolCallModel` с заданными параметрами.

### `ChatCompletionChunk`

**Описание**: Модель данных для представления фрагмента завершения чата.

**Атрибуты**:
- `id` (str): Идентификатор фрагмента завершения чата.
- `object` (str): Тип объекта.
- `created` (int): Время создания.
- `model` (str): Модель, использованная для создания фрагмента.
- `provider` (Optional[str]): Провайдер модели.
- `choices` (List[ChatCompletionDeltaChoice]): Список вариантов фрагмента завершения чата.
- `usage` (UsageModel): Информация об использовании ресурсов.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `ChatCompletionChunk` с заданными параметрами.

### `ChatCompletionMessage`

**Описание**: Модель данных для представления сообщения чата.

**Атрибуты**:
- `role` (str): Роль отправителя сообщения.
- `content` (str): Содержание сообщения.
- `tool_calls` (list[ToolCallModel]): Список вызовов инструментов, связанных с сообщением.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `ChatCompletionMessage` с заданными параметрами.
- `save`: Сохраняет содержимое сообщения в файл.

### `ChatCompletionChoice`

**Описание**: Модель данных для представления выбора завершения чата.

**Атрибуты**:
- `index` (int): Индекс выбора.
- `message` (ChatCompletionMessage): Сообщение чата.
- `finish_reason` (str): Причина завершения.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `ChatCompletionChoice` с заданными параметрами.

### `ChatCompletion`

**Описание**: Модель данных для представления завершения чата.

**Атрибуты**:
- `id` (str): Идентификатор завершения чата.
- `object` (str): Тип объекта.
- `created` (int): Время создания.
- `model` (str): Модель, использованная для создания завершения.
- `provider` (Optional[str]): Провайдер модели.
- `choices` (list[ChatCompletionChoice]): Список вариантов завершения чата.
- `usage` (UsageModel): Информация об использовании ресурсов.
- `conversation` (dict): Словарь с историей разговора.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `ChatCompletion` с заданными параметрами.

### `ChatCompletionDelta`

**Описание**: Модель данных для представления дельты завершения чата.

**Атрибуты**:
- `role` (str): Роль отправителя сообщения.
- `content` (str): Содержание сообщения.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `ChatCompletionDelta` с заданными параметрами.

### `ChatCompletionDeltaChoice`

**Описание**: Модель данных для представления выбора дельты завершения чата.

**Атрибуты**:
- `index` (int): Индекс выбора.
- `delta` (ChatCompletionDelta): Дельта завершения чата.
- `finish_reason` (Optional[str]): Причина завершения.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `ChatCompletionDeltaChoice` с заданными параметрами.

### `Image`

**Описание**: Модель данных для представления изображения.

**Атрибуты**:
- `url` (Optional[str]): URL изображения.
- `b64_json` (Optional[str]): Изображение в формате base64.
- `revised_prompt` (Optional[str]): Пересмотренный запрос.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `Image` с заданными параметрами.

### `ImagesResponse`

**Описание**: Модель данных для представления ответа с изображениями.

**Атрибуты**:
- `data` (List[Image]): Список изображений.
- `model` (str): Модель, использованная для создания изображений.
- `provider` (str): Провайдер модели.
- `created` (int): Время создания.

**Методы**:
- `model_construct`: Конструктор модели, создающий экземпляр `ImagesResponse` с заданными параметрами.

## Функции

### `filter_none`

**Назначение**: Фильтрует словарь, удаляя элементы со значением `None`.

**Параметры**:
- `kwargs` (dict): Словарь, который необходимо отфильтровать.

**Возвращает**:
- `dict`: Отфильтрованный словарь.

**Как работает функция**:
1. Функция принимает словарь `kwargs`.
2. Создает новый словарь, содержащий только те элементы из `kwargs`, у которых значение не равно `None`.

```
A
|
B
|
C
```

Где:
- `A`: Принимает словарь `kwargs`.
- `B`: Фильтрует элементы со значением `None`.
- `C`: Возвращает отфильтрованный словарь.

**Примеры**:

```python
>>> filter_none(a=1, b=None, c="hello")
{'a': 1, 'c': 'hello'}
```
### `ChatCompletionMessage.save`

**Назначение**: Сохраняет содержимое сообщения чата в файл.

**Параметры**:
- `filepath` (str): Путь к файлу, в который необходимо сохранить содержимое сообщения.
- `allowd_types` (Any): Разрешенный тип файла.

**Как работает функция**:
1. Проверяет, содержит ли атрибут `content` атрибут `data`. Если да, переименовывает файл из временной директории в указанный путь.
2. Если `content` начинается с "data:", извлекает данные URI и записывает их в файл в бинарном режиме.
3. В противном случае фильтрует содержимое сообщения с помощью `filter_markdown` и записывает его в файл в текстовом режиме.

```
A -> B
|    |
|    C -> D
|    |    |
|    |    E
|    |
F -> G
```

Где:
- `A`: Начало функции.
- `B`: Проверяет наличие атрибута `data` в `self.content`.
- `C`: Если атрибут `data` присутствует, переименовывает файл.
- `D`: Проверяет, начинается ли `self.content` с "data:".
- `E`: Если начинается с "data:", извлекает данные URI и записывает их в файл.
- `F`: Фильтрует содержимое сообщения с помощью `filter_markdown`.
- `G`: Записывает отфильтрованное содержимое в файл.

**Примеры**:

```python
# Пример 1: Сохранение текстового сообщения
message = ChatCompletionMessage.model_construct(content="Hello, world!")
message.save("hello.txt")

# Пример 2: Сохранение изображения из data URI
message = ChatCompletionMessage.model_construct(content="data:image/png;base64,iVBORw0KGgo...")
message.save("image.png")
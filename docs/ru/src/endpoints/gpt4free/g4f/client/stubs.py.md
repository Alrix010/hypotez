# Модуль stubs

## Обзор

Модуль `stubs` содержит определения базовых моделей данных, используемых для представления различных структур данных, таких как токены, использование ресурсов, вызовы инструментов, сообщения чата, ответы чата и изображения. Модуль предоставляет классы `BaseModel`, `TokenDetails`, `UsageModel`, `ToolFunctionModel`, `ToolCallModel`, `ChatCompletionChunk`, `ChatCompletionMessage`, `ChatCompletionChoice`, `ChatCompletion`, `ChatCompletionDelta`, `ChatCompletionDeltaChoice`, `Image` и `ImagesResponse`, которые используются для структурирования и обмена данными между различными компонентами системы.

## Подробнее

Этот модуль предоставляет стандартные структуры данных для работы с API gpt4free. Определены модели для представления запросов и ответов, включая информацию об использовании токенов, инструментах, сообщениях в чате и изображениях. Это позволяет унифицировать обработку данных и обеспечивает типобезопасность.

## Классы

### `BaseModel`

**Описание**: Базовый класс для моделей данных, используемый для определения структуры данных и автоматической валидации типов.

**Наследует**:
- `pydantic.BaseModel` (если библиотека `pydantic` установлена).
- В противном случае, создается упрощенная версия класса `BaseModel`.

**Атрибуты**:
- Отсутствуют в базовой реализации.

**Методы**:
- `model_construct(**data)`: Метод класса, который создает экземпляр модели, заполняя его данными из переданного словаря `data`.
  Если `pydantic` установлен, использует `super().model_construct(**data)`.
  В противном случае создает экземпляр класса и устанавливает атрибуты напрямую.

### `TokenDetails`

**Описание**: Модель данных, представляющая детали использования токенов.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `cached_tokens` (int): Количество токенов, полученных из кэша.

### `UsageModel`

**Описание**: Модель данных, представляющая информацию об использовании ресурсов, таких как токены.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `prompt_tokens` (int): Количество токенов, использованных во входном запросе.
- `completion_tokens` (int): Количество токенов, использованных в ответе.
- `total_tokens` (int): Общее количество использованных токенов.
- `prompt_tokens_details` (TokenDetails): Детали использования токенов во входном запросе.
- `completion_tokens_details` (TokenDetails): Детали использования токенов в ответе.

**Методы**:
- `model_construct(prompt_tokens=0, completion_tokens=0, total_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, **kwargs)`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Автоматически создает экземпляры `TokenDetails` для `prompt_tokens_details` и `completion_tokens_details`, если они не переданы.

### `ToolFunctionModel`

**Описание**: Модель данных, представляющая функцию инструмента, используемую в вызовах инструментов.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `name` (str): Имя функции инструмента.
- `arguments` (str): Аргументы функции инструмента.

### `ToolCallModel`

**Описание**: Модель данных, представляющая вызов инструмента.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `id` (str): Уникальный идентификатор вызова инструмента.
- `type` (str): Тип вызова инструмента.
- `function` (ToolFunctionModel): Функция инструмента, которую необходимо вызвать.

**Методы**:
- `model_construct(function=None, **kwargs)`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Автоматически создает экземпляр `ToolFunctionModel` для атрибута `function`, если он не передан.

### `ChatCompletionChunk`

**Описание**: Модель данных, представляющая фрагмент ответа чата.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `id` (str): Уникальный идентификатор фрагмента ответа.
- `object` (str): Тип объекта (например, "chat.completion.chunk").
- `created` (int): Временная метка создания фрагмента.
- `model` (str): Идентификатор модели, использованной для генерации фрагмента.
- `provider` (Optional[str])`: Провайдер, предоставивший модель.
- `choices` (List[ChatCompletionDeltaChoice]): Список возможных вариантов фрагмента ответа.
- `usage` (UsageModel): Информация об использовании ресурсов.

**Методы**:
- `model_construct(content: str, finish_reason: str, completion_id: str = None, created: int = None, usage: UsageModel = None)`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Автоматически создает экземпляр `ChatCompletionDeltaChoice` с `ChatCompletionDelta`, используя переданные `content` и `finish_reason`.

### `ChatCompletionMessage`

**Описание**: Модель данных, представляющая сообщение в чате.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `role` (str): Роль отправителя сообщения (например, "assistant").
- `content` (str): Содержимое сообщения.
- `tool_calls` (list[ToolCallModel], optional): Список вызовов инструментов, связанных с сообщением. По умолчанию `None`.

**Методы**:
- `model_construct(content: str, tool_calls: list = None)`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Устанавливает роль в "assistant" и фильтрует `tool_calls` с помощью функции `filter_none`.
- `save(self, filepath: str, allowd_types = None)`:  Сохраняет содержимое сообщения в файл.
  Если содержимое является URI данных (начинается с "data:"), декодирует его и сохраняет как двоичный файл.
  В противном случае фильтрует содержимое с помощью `filter_markdown` и сохраняет как текстовый файл.

### `ChatCompletionChoice`

**Описание**: Модель данных, представляющая выбор в ответе чата.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `index` (int): Индекс выбора.
- `message` (ChatCompletionMessage): Сообщение, связанное с выбором.
- `finish_reason` (str): Причина завершения выбора.

**Методы**:
- `model_construct(message: ChatCompletionMessage, finish_reason: str)`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Устанавливает индекс в 0.

### `ChatCompletion`

**Описание**: Модель данных, представляющая ответ чата.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `id` (str): Уникальный идентификатор ответа.
- `object` (str): Тип объекта (например, "chat.completion").
- `created` (int): Временная метка создания ответа.
- `model` (str): Идентификатор модели, использованной для генерации ответа.
- `provider` (Optional[str])`: Провайдер, предоставивший модель.
- `choices` (list[ChatCompletionChoice]): Список возможных вариантов ответа.
- `usage` (UsageModel): Информация об использовании ресурсов.
- `conversation` (dict): Информация о контексте разговора.

**Методы**:
- `model_construct(content: str, finish_reason: str, completion_id: str = None, created: int = None, tool_calls: list[ToolCallModel] = None, usage: UsageModel = None, conversation: dict = None)`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Автоматически создает экземпляры `ChatCompletionChoice` с `ChatCompletionMessage`, используя переданные `content`, `tool_calls` и `finish_reason`.

### `ChatCompletionDelta`

**Описание**: Модель данных, представляющая изменение (delta) в ответе чата.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `role` (str): Роль отправителя изменения (например, "assistant").
- `content` (str): Содержимое изменения.

**Методы**:
- `model_construct(content: Optional[str])`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Устанавливает роль в "assistant".

### `ChatCompletionDeltaChoice`

**Описание**: Модель данных, представляющая выбор изменения (delta) в ответе чата.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `index` (int): Индекс выбора.
- `delta` (ChatCompletionDelta): Изменение, связанное с выбором.
- `finish_reason` (Optional[str])`: Причина завершения выбора.

**Методы**:
- `model_construct(delta: ChatCompletionDelta, finish_reason: Optional[str])`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Устанавливает индекс в 0.

### `Image`

**Описание**: Модель данных, представляющая изображение.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `url` (Optional[str])`: URL-адрес изображения.
- `b64_json` (Optional[str])`: Изображение в формате base64 JSON.
- `revised_prompt` (Optional[str])`: Пересмотренный запрос, использованный для генерации изображения.

**Методы**:
- `model_construct(url: str = None, b64_json: str = None, revised_prompt: str = None)`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Фильтрует аргументы с помощью функции `filter_none`.

### `ImagesResponse`

**Описание**: Модель данных, представляющая ответ с изображениями.

**Наследует**:
- `BaseModel`

**Атрибуты**:
- `data` (List[Image]): Список изображений в ответе.
- `model` (str): Идентификатор модели, использованной для генерации изображений.
- `provider` (str): Провайдер, предоставивший модель.
- `created` (int): Временная метка создания ответа.

**Методы**:
- `model_construct(data: List[Image], created: int = None, model: str = None, provider: str = None)`: Метод класса, который создает экземпляр модели, заполняя его данными из переданных аргументов.
  Если `created` не передан, устанавливает его текущее время.

## Функции

В данном модуле нет отдельных функций, только методы классов.
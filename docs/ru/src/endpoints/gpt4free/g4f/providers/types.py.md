# Модуль `types.py`

## Обзор

Модуль `types.py` определяет абстрактные базовые классы для провайдеров, используемых в проекте `hypotez` для взаимодействия с различными сервисами, такими как GPT-4 и другими. Он содержит абстрактные классы `BaseProvider` и `BaseRetryProvider`, а также класс `Streaming` для обработки потоковых данных.

## Подробнее

Этот модуль предоставляет интерфейсы для создания и управления провайдерами, которые используются для получения ответов от различных языковых моделей. `BaseProvider` определяет основные атрибуты и методы, которые должны быть реализованы каждым провайдером, а `BaseRetryProvider` добавляет логику повторных попыток с использованием нескольких провайдеров.
`Streaming` предназначен для работы с потоковыми данными, возвращаемыми провайдерами.

## Классы

### `BaseProvider`

**Описание**: Абстрактный базовый класс для провайдеров.

**Принцип работы**:
`BaseProvider` задает интерфейс для всех провайдеров. Он определяет атрибуты, такие как URL провайдера, статус работы, необходимость аутентификации, поддержку потоковой передачи, историю сообщений и системные сообщения. Также он содержит абстрактные методы для получения функций создания (синхронной и асинхронной) и представления провайдера в виде словаря.

**Атрибуты**:
- `url` (str): URL провайдера.
- `working` (bool): Указывает, работает ли провайдер в данный момент.
- `needs_auth` (bool): Указывает, требуется ли аутентификация для провайдера.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу.
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений.
- `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения.
- `params` (str): Список параметров для провайдера.

**Методы**:
- `get_create_function() -> callable`:
    ```python
    def get_create_function() -> callable:
        """
        Получает функцию создания для провайдера.

        Returns:
            callable: Функция создания.

        Raises:
            NotImplementedError: Если метод не реализован в подклассе.
        """
        raise NotImplementedError()
    ```
    **Назначение**: Получает функцию создания для провайдера.

    **Как работает функция**:
    1. Функция `get_create_function` является абстрактным методом, который должен быть реализован в каждом подклассе `BaseProvider`.
    2. При вызове этого метода, если он не реализован, выбрасывается исключение `NotImplementedError`.

    **Примеры**:
    ```python
    class MyProvider(BaseProvider):
        def get_create_function(self):
            return self._create

        def _create(self, messages: Messages, stream: bool = False) -> CreateResult:
            return "Текст ответа"
    ```
- `get_async_create_function() -> callable`:
    ```python
    def get_async_create_function() -> callable:
        """
        Получает асинхронную функцию создания для провайдера.

        Returns:
            callable: Асинхронная функция создания.

        Raises:
            NotImplementedError: Если метод не реализован в подклассе.
        """
        raise NotImplementedError()
    ```
    **Назначение**: Получает асинхронную функцию создания для провайдера.

    **Как работает функция**:
    1. Функция `get_async_create_function` является абстрактным методом, который должен быть реализован в каждом подклассе `BaseProvider`.
    2. При вызове этого метода, если он не реализован, выбрасывается исключение `NotImplementedError`.

    **Примеры**:
    ```python
    class MyProvider(BaseProvider):
        async def get_async_create_function(self):
            return self._create

        async def _create(self, messages: Messages, stream: bool = False) -> CreateResult:
            return "Текст ответа"
    ```
- `get_dict() -> Dict[str, str]`:
    ```python
    @classmethod
    def get_dict(cls) -> Dict[str, str]:
        """
        Возвращает словарь, представляющий провайдера.

        Returns:
            Dict[str, str]: Словарь с деталями провайдера.
        """
        return {'name': cls.__name__, 'url': cls.url, 'label': getattr(cls, 'label', None)}
    ```
    **Назначение**: Возвращает словарь, содержащий информацию о провайдере.

    **Как работает функция**:
    1. Функция `get_dict` является методом класса, который возвращает словарь, содержащий имя класса, URL и метку (если она определена).
    2. Используется `getattr` для безопасного получения атрибута `label`, чтобы избежать ошибки, если атрибут не существует.

    **Примеры**:
    ```python
    class MyProvider(BaseProvider):
        url = "https://example.com"
        label = "Example Provider"

    provider_dict = MyProvider.get_dict()
    print(provider_dict)  # {'name': 'MyProvider', 'url': 'https://example.com', 'label': 'Example Provider'}
    ```

### `BaseRetryProvider`

**Описание**: Базовый класс для провайдера, который реализует логику повторных попыток.

**Принцип работы**:
`BaseRetryProvider` наследуется от `BaseProvider` и добавляет функциональность для автоматического переключения между несколькими провайдерами в случае сбоя. Он использует список провайдеров и пытается выполнить запрос с каждым из них, пока не получит успешный ответ или не исчерпает все провайдеры.

**Атрибуты**:
- `__name__` (str): Имя провайдера, по умолчанию "RetryProvider".
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу (всегда `True`).
- `last_provider` (Type[BaseProvider]): Последний использованный провайдер.

### `Streaming`

**Описание**: Класс для представления потоковых данных.

**Принцип работы**:
`Streaming` используется для обертки потоковых данных, возвращаемых провайдерами. Он позволяет представить данные в виде строки.

**Атрибуты**:
- `data` (str): Строковые данные потока.

**Методы**:
- `__init__(self, data: str) -> None`:
    ```python
    def __init__(self, data: str) -> None:
        """
        Инициализирует экземпляр класса Streaming.

        Args:
            data (str): Строковые данные потока.
        """
        self.data = data
    ```
    **Назначение**: Инициализирует экземпляр класса `Streaming` с данными.

    **Как работает функция**:
    1. Функция `__init__` является конструктором класса `Streaming`.
    2. Она принимает строковые данные и сохраняет их в атрибуте `data`.
- `__str__(self) -> str`:
    ```python
    def __str__(self) -> str:
        """
        Возвращает строковое представление данных потока.

        Returns:
            str: Строковое представление данных.
        """
        return self.data
    ```
    **Назначение**: Возвращает строковое представление данных потока.

    **Как работает функция**:
    1. Функция `__str__` возвращает строковое представление данных, хранящихся в атрибуте `data`.
    2. Это позволяет использовать экземпляр класса `Streaming` как строку.

    **Примеры**:
    ```python
    streaming_data = Streaming("Пример потоковых данных")
    print(str(streaming_data))  # Пример потоковых данных
    ```

## Типы

### `ProviderType`

`ProviderType = Union[Type[BaseProvider], BaseRetryProvider]`

Определяет тип, который может быть либо типом `BaseProvider`, либо `BaseRetryProvider`.
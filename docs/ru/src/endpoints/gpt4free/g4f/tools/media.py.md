# Модуль для обработки медиа-контента

## Обзор

Модуль предоставляет функции для обработки и рендеринга медиа-контента, включая изображения и аудио, в сообщениях. Он также включает в себя функции для работы с файлами, находящимися в "bucket" (хранилище).

## Подробней

Этот модуль содержит функции для обработки медиафайлов, таких как изображения и аудио, и подготовки их для использования в сообщениях. Он отвечает за преобразование медиафайлов в форматы, подходящие для отображения или воспроизведения, например, в base64-encoded data URIs или URL-адреса.

## Функции

### `render_media`

```python
def render_media(bucket_id: str, name: str, url: str, as_path: bool = False, as_base64: bool = False) -> Union[str, Path]:
    """Функция подготавливает медиа-контент для отображения, возвращая URL, путь к файлу или base64-encoded data URI.

    Args:
        bucket_id (str): Идентификатор "bucket", в котором находится медиафайл.
        name (str): Имя файла медиа.
        url (str): URL медиафайла.
        as_path (bool, optional): Если `True`, возвращает путь к файлу. По умолчанию `False`.
        as_base64 (bool, optional): Если `True`, возвращает base64-encoded data URI. По умолчанию `False`.

    Returns:
        Union[str, Path]: URL, путь к файлу или base64-encoded data URI медиафайла.

    
        Функция проверяет аргументы `as_base64`, `as_path` и `url`. В зависимости от их значений, функция возвращает разные представления медиа-контента:
        - Если `as_path` равно `True`, функция возвращает путь к файлу.
        - Если `as_base64` равно `True` или `url` начинается с "/", функция считывает содержимое файла, кодирует его в base64 и возвращает в формате data URI.
        - В противном случае функция возвращает исходный URL.
    """
```

### `render_part`

```python
def render_part(part: dict) -> dict:
    """Функция подготавливает часть сообщения, содержащую медиа-контент, к отображению.

    Args:
        part (dict): Словарь, содержащий информацию о части сообщения.

    Returns:
        dict: Словарь, содержащий информацию о части сообщения, готовой к отображению.

    
        Функция принимает словарь `part`, содержащий информацию о части сообщения.
        Если в `part` есть ключ "type", функция возвращает `part` без изменений.
        Если в `part` отсутствует ключ "type", функция проверяет наличие ключа "name".
        Если "name" отсутствует, функция считывает содержимое "bucket" (хранилища) и возвращает текстовое сообщение.
        Если "name" присутствует, функция определяет тип медиа (аудио или изображение) и возвращает соответствующий словарь.
        Для аудио возвращается словарь с типом "input_audio", содержащий base64-encoded data URI и формат файла.
        Для изображений возвращается словарь с типом "image_url", содержащий URL изображения.
    """
```

### `merge_media`

```python
def merge_media(media: list, messages: list) -> Iterator:
    """Функция объединяет медиафайлы с сообщениями пользователей.

    Args:
        media (list): Список медиафайлов.
        messages (list): Список сообщений.

    Yields:
        str | None: Путь к медиафайлу или URL изображения.

    
        Функция принимает два списка: `media` и `messages`.
        Она итерируется по сообщениям, и если роль сообщения - "user", то функция извлекает медиафайлы из содержимого сообщения.
        Если в содержимом сообщения есть часть с ключом "name", функция подготавливает путь к медиафайлу.
        Если тип части сообщения "image_url", функция добавляет URL изображения в буфер.
        Функция возвращает генератор, который выдает пути к медиафайлам и URL изображений.
    """
```

### `render_messages`

```python
def render_messages(messages: Messages, media: list = None) -> Iterator:
    """Функция подготавливает сообщения для отображения, обрабатывая медиа-контент.

    Args:
        messages (Messages): Список сообщений.
        media (list, optional): Список медиафайлов. По умолчанию `None`.

    Yields:
        dict: Подготовленное сообщение для отображения.

    
        Функция принимает список сообщений и список медиафайлов.
        Она итерируется по сообщениям и обрабатывает содержимое каждого сообщения.
        Если содержимое сообщения - это список, функция рендерит каждую часть сообщения с помощью функции `render_part`.
        Если есть медиафайлы и текущее сообщение - последнее в списке, функция добавляет медиафайлы в содержимое сообщения.
        Для аудио добавляется элемент "input_audio" с base64-encoded data URI и форматом файла.
        Для изображений добавляется элемент "image_url" с URL изображения.
        Функция возвращает генератор, который выдает подготовленные сообщения для отображения.
    """
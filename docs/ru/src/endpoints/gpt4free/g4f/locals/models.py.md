# Модуль `models.py`

## Обзор

Модуль предназначен для загрузки, форматирования, чтения и сохранения информации о моделях, используемых в проекте `hypotez`. Он предоставляет функции для получения списка моделей с удаленного ресурса, их обработки и сохранения в локальном файле, а также для управления каталогом, где хранятся модели.

## Подробней

Модуль выполняет следующие основные задачи:

- Загрузка списка моделей с сайта gpt4all.io.
- Форматирование полученных данных о моделях.
- Чтение данных о моделях из локального JSON-файла.
- Сохранение данных о моделях в локальный JSON-файл.
- Управление каталогом для хранения моделей.

## Функции

### `load_models`

**Назначение**: Загружает список моделей с удаленного ресурса (https://gpt4all.io/models/models3.json).

```python
def load_models():
    """
    Загружает список моделей с удаленного ресурса.

    Returns:
        dict: Отформатированный словарь с информацией о моделях.

    Raises:
        requests.exceptions.HTTPError: Если HTTP-запрос завершается с ошибкой.
    """
    ...
```

**Как работает функция**:
- Функция отправляет GET-запрос к указанному URL.
- Вызывает функцию `raise_for_status` для проверки статуса ответа и вызывает исключение в случае ошибки.
- Преобразует JSON-ответ в Python-словарь.
- Вызывает функцию `format_models` для форматирования полученных данных.

**Примеры**:

```python
models = load_models()
print(models)
```

### `get_model_name`

**Назначение**: Извлекает имя модели из имени файла.

```python
def get_model_name(filename: str) -> str:
    """
    Извлекает имя модели из имени файла, удаляя лишние суффиксы.

    Args:
        filename (str): Имя файла модели.

    Returns:
        str: Очищенное имя модели.
    """
    ...
```

**Как работает функция**:

- Функция принимает имя файла в качестве аргумента.
- Разделяет имя файла по первому вхождению точки (`.`) и берет первую часть.
- Итерируется по списку суффиксов, которые нужно удалить из имени, и удаляет их.

**Примеры**:

```python
filename = "ggml-mpt-7b-chat-newbpe-q4_0.bin"
model_name = get_model_name(filename)
print(model_name)  # Вывод: ggml-mpt-7b-chat
```

### `format_models`

**Назначение**: Форматирует список моделей, полученный из JSON, в словарь.

```python
def format_models(models: list) -> dict:
    """
    Форматирует список моделей в словарь, где ключом является имя модели.

    Args:
        models (list): Список моделей, полученный из JSON.

    Returns:
        dict: Словарь, где ключ - имя модели, значение - информация о модели.
    """
    ...
```

**Как работает функция**:

- Функция принимает список моделей в качестве аргумента.
- Создает словарь, где ключом является имя модели, полученное с помощью функции `get_model_name`, а значением - словарь с информацией о модели (путь, требуемая RAM, шаблон промта, системный промпт).
- Использует генератор словарей для преобразования списка моделей.

**Примеры**:

```python
models = [
    {"filename": "ggml-mpt-7b-chat-newbpe-q4_0.bin", "ramrequired": "8 GB", "promptTemplate": "<prompt>", "systemPrompt": "<system>"},
    {"filename": "ggml-mpt-7b-chat-v1.bin", "ramrequired": "10 GB"}
]
formatted_models = format_models(models)
print(formatted_models)
```

### `read_models`

**Назначение**: Читает данные о моделях из JSON-файла.

```python
def read_models(file_path: str):
    """
    Читает данные о моделях из JSON-файла.

    Args:
        file_path (str): Путь к файлу.

    Returns:
        dict: Данные о моделях.
    """
    ...
```

**Как работает функция**:

- Функция принимает путь к файлу в качестве аргумента.
- Открывает файл в бинарном режиме для чтения (`"rb"`).
- Загружает JSON-данные из файла с помощью `json.load`.

**Примеры**:

```python
file_path = "models/models.json"
models = read_models(file_path)
print(models)
```

### `save_models`

**Назначение**: Сохраняет данные о моделях в JSON-файл.

```python
def save_models(file_path: str, data):
    """
    Сохраняет данные о моделях в JSON-файл.

    Args:
        file_path (str): Путь к файлу.
        data (dict): Данные для сохранения.
    """
    ...
```

**Как работает функция**:

- Функция принимает путь к файлу и данные для сохранения в качестве аргументов.
- Открывает файл для записи (`"w"`).
- Записывает JSON-данные в файл с отступами для удобочитаемости.

**Примеры**:

```python
file_path = "models/models.json"
data = {"model1": {"path": "path1"}, "model2": {"path": "path2"}}
save_models(file_path, data)
```

### `get_model_dir`

**Назначение**: Возвращает путь к каталогу, где хранятся модели.

```python
def get_model_dir() -> str:
    """
    Возвращает путь к каталогу, где хранятся модели. Если каталог не существует, он создается.

    Returns:
        str: Путь к каталогу моделей.
    """
    ...
```

**Как работает функция**:

- Функция определяет путь к каталогу `models` относительно текущего файла.
- Проверяет, существует ли каталог. Если нет, он создается.

**Примеры**:

```python
model_dir = get_model_dir()
print(model_dir)
```

### `get_models`

**Назначение**: Получает данные о моделях из файла, если он существует, или загружает их с удаленного ресурса и сохраняет в файл.

```python
def get_models() -> dict[str, dict]:
    """
    Получает данные о моделях из файла, если он существует, или загружает их с удаленного ресурса и сохраняет в файл.

    Returns:
        dict[str, dict]: Словарь с информацией о моделях.
    """
    ...
```

**Как работает функция**:

- Функция получает путь к каталогу моделей с помощью функции `get_model_dir`.
- Определяет путь к файлу `models.json` внутри каталога моделей.
- Проверяет, существует ли файл.
  - Если файл существует, функция читает данные из файла с помощью функции `read_models`.
  - Если файл не существует, функция загружает данные с удаленного ресурса с помощью функции `load_models`, сохраняет их в файл с помощью функции `save_models`.
- Возвращает полученные данные о моделях.

**Примеры**:

```python
models = get_models()
print(models)
```
# Модуль API для g4f GUI Server

## Обзор

Модуль `api.py` предоставляет API-интерфейсы для взаимодействия с различными моделями и провайдерами в g4f GUI Server. Он включает в себя функции для получения списка моделей, провайдеров, версий, а также для обработки запросов на генерацию текста и изображений.

## Подробней

Этот модуль является центральным элементом API сервера, обрабатывающим запросы от клиентской части. Он обеспечивает функциональность для выбора моделей и провайдеров, управления диалогами, а также для обработки и передачи результатов генерации контента.

## Классы

### `Api`

**Описание**: Класс `Api` содержит статические методы для получения информации о моделях, провайдерах и версиях, а также методы для обработки запросов и создания потоков ответов.

**Принцип работы**:
Класс предоставляет набор статических методов, которые служат в качестве API-endpoints для получения различной информации о моделях, провайдерах и версиях. Кроме того, он содержит методы для подготовки данных для обработки запросов и создания потоков ответов, что позволяет эффективно управлять генерацией контента.

**Методы**:
- `get_models()`: Возвращает список доступных моделей.
- `get_provider_models(provider: str, api_key: str = None, api_base: str = None)`: Возвращает список моделей, поддерживаемых указанным провайдером.
- `get_providers()`: Возвращает список доступных провайдеров.
- `get_version()`: Возвращает информацию о текущей и последней версиях.
- `serve_images(name)`: Возвращает запрошенное изображение из директории с изображениями.
- `_prepare_conversation_kwargs(self, json_data: dict)`: Подготавливает аргументы для создания диалога на основе полученных данных.
- `_create_response_stream(self, kwargs: dict, conversation_id: str, provider: str, download_media: bool = True)`: Создает поток ответов для генерации контента.
- `_yield_logs(self)`: Возвращает логи отладки.
- `_format_json(self, response_type: str, content = None, **kwargs)`: Форматирует данные в формат JSON для отправки клиенту.
- `handle_provider(self, provider_handler, model)`: Обрабатывает информацию о провайдере и форматирует ее для отправки клиенту.

## Функции

### `get_error_message`

```python
def get_error_message(exception: Exception) -> str:
    """
    Формирует сообщение об ошибке на основе перехваченного исключения.

    Args:
        exception (Exception): Перехваченное исключение.

    Returns:
        str: Отформатированное сообщение об ошибке, включающее тип исключения и сообщение.
    """
```

**Назначение**: Функция `get_error_message` предназначена для формирования информативного сообщения об ошибке на основе перехваченного исключения.

**Параметры**:
- `exception` (Exception): Исключение, для которого требуется сформировать сообщение об ошибке.

**Возвращает**:
- `str`: Строка, содержащая имя типа исключения и сообщение исключения.

**Как работает функция**:

1.  **Извлечение данных об исключении**: Функция извлекает имя типа исключения и сообщение исключения из объекта `exception`.
2.  **Форматирование сообщения**: Функция формирует строку, объединяющую имя типа исключения и сообщение исключения в формате "ИмяТипаИсключения: СообщениеИсключения".

**Примеры**:

```python
try:
    raise ValueError("Недопустимое значение")
except ValueError as ex:
    message = get_error_message(ex)
    print(message)  # Вывод: ValueError: Недопустимое значение
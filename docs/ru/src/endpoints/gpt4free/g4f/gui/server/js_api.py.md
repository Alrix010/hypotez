# Модуль `js_api.py`

## Обзор

Модуль `js_api.py` является частью проекта `hypotez` и предназначен для интеграции JavaScript API с серверной частью приложения. Он предоставляет интерфейс для взаимодействия с веб-интерфейсом, позволяя выполнять различные действия, такие как получение данных, выбор изображений и работа с камерой.

## Подробней

Этот модуль расширяет класс `Api` и предоставляет дополнительные методы для работы с веб-интерфейсом, используя библиотеку `webview`. Он позволяет асинхронно обмениваться данными между Python и JavaScript, что необходимо для реализации интерактивных функций в пользовательском интерфейсе.

## Классы

### `JsApi`

**Описание**: Класс `JsApi` расширяет функциональность класса `Api` и предоставляет методы для взаимодействия с веб-интерфейсом.

**Наследует**:
- `Api`: Этот класс наследует базовый функционал API, такой как получение версий, моделей и провайдеров.

**Атрибуты**:
- `image` (str | None): Путь к выбранному изображению. Изначально `None`.

**Методы**:
- `get_conversation()`: Получает разговор с использованием указанных параметров.
- `choose_image()`: Открывает диалоговое окно для выбора изображения.
- `take_picture()`: Делает снимок с камеры.
- `on_image_selection()`: Обрабатывает выбор изображения пользователем.
- `on_camera()`: Обрабатывает снимок, сделанный камерой.
- `set_selected()`: Устанавливает визуальное выделение для выбранного элемента интерфейса.
- `get_version()`: Возвращает версию API.
- `get_models()`: Возвращает список доступных моделей.
- `get_providers()`: Возвращает список доступных провайдеров.
- `get_provider_models()`: Возвращает список моделей для указанного провайдера.

### `JsApi.get_conversation`

```python
def get_conversation(self, options: dict, message_id: str = None, scroll: bool = None) -> Iterator:
    """Функция получает разговор с использованием указанных параметров и отправляет сообщения в веб-интерфейс.

    Args:
        options (dict): Словарь с параметрами для создания ответа.
        message_id (str, optional): Идентификатор сообщения. По умолчанию `None`.
        scroll (bool, optional): Флаг, указывающий, нужно ли прокручивать окно. По умолчанию `None`.

    Returns:
        Iterator: Итератор объектов сообщений.

    Raises:
        Нет явных исключений.

    
    - Функция получает параметры разговора и идентификатор сообщения.
    - Если установлено изображение, оно открывается в бинарном режиме и добавляется в опции.
    - Создается поток ответов с использованием метода `_create_response_stream`.
    - Для каждого сообщения в потоке выполняется JavaScript-код в веб-интерфейсе для добавления сообщения.
    - Если `is_stopped()` возвращает `True`, цикл прерывается.
    - Изображение сбрасывается в `None`.
    - Выбранный элемент сбрасывается в `None`.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> options = {"conversation_id": "123", "provider": "openai"}
        >>> for message in js_api.get_conversation(options):
        ...     print(message)
    """
    ...
```

### `JsApi.choose_image`

```python
def choose_image(self):
    """Функция открывает диалоговое окно для выбора изображения.

    Args:
        Нет аргументов.

    Returns:
        Нет возвращаемого значения.

    Raises:
        Нет явных исключений.

    
    - Функция вызывает `user_select_image` с колбэком `on_image_selection`.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> js_api.choose_image()
    """
    ...
```

### `JsApi.take_picture`

```python
def take_picture(self):
    """Функция делает снимок с камеры и сохраняет его во временный файл.

    Args:
        Нет аргументов.

    Returns:
        Нет возвращаемого значения.

    Raises:
        Нет явных исключений.

    
    - Функция генерирует уникальное имя файла для снимка.
    - Вызывает `camera.take_picture` с колбэком `on_camera`.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> js_api.take_picture()
    """
    ...
```

### `JsApi.on_image_selection`

```python
def on_image_selection(self, filename):
    """Функция обрабатывает выбор изображения пользователем.

    Args:
        filename (str | list[str]): Имя выбранного файла или список имен.

    Returns:
        Нет возвращаемого значения.

    Raises:
        Нет явных исключений.

    
    - Функция проверяет, является ли `filename` списком и извлекает имя файла.
    - Проверяет существование файла.
    - Устанавливает `self.image` в имя файла или в `None`, если файл не существует.
    - Сбрасывает выбранный элемент интерфейса.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> js_api.on_image_selection("example.png")
    """
    ...
```

### `JsApi.on_camera`

```python
def on_camera(self, filename):
    """Функция обрабатывает снимок, сделанный камерой.

    Args:
        filename (str): Имя файла, в который был сохранен снимок.

    Returns:
        Нет возвращаемого значения.

    Raises:
        Нет явных исключений.

    
    - Функция проверяет существование файла.
    - Устанавливает `self.image` в имя файла или в `None`, если файл не существует.
    - Сбрасывает выбранный элемент интерфейса.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> js_api.on_camera("camera.png")
    """
    ...
```

### `JsApi.set_selected`

```python
def set_selected(self, input_id: str = None):
    """Функция устанавливает визуальное выделение для выбранного элемента интерфейса.

    Args:
        input_id (str, optional): Идентификатор выбранного элемента. По умолчанию `None`.

    Returns:
        Нет возвращаемого значения.

    Raises:
        Нет явных исключений.

    
    - Функция удаляет выделение с текущего выбранного элемента.
    - Если `input_id` указан и является "image" или "camera", добавляет выделение к соответствующему элементу.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> js_api.set_selected("image")
    """
    ...
```

### `JsApi.get_version`

```python
def get_version(self):
    """Функция возвращает версию API.

    Args:
        Нет аргументов.

    Returns:
        str: Версия API.

    Raises:
        Нет явных исключений.

    
    - Функция вызывает метод `get_version` родительского класса `Api`.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> version = js_api.get_version()
        >>> print(version)
    """
    ...
```

### `JsApi.get_models`

```python
def get_models(self):
    """Функция возвращает список доступных моделей.

    Args:
        Нет аргументов.

    Returns:
        list: Список доступных моделей.

    Raises:
        Нет явных исключений.

    
    - Функция вызывает метод `get_models` родительского класса `Api`.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> models = js_api.get_models()
        >>> print(models)
    """
    ...
```

### `JsApi.get_providers`

```python
def get_providers(self):
    """Функция возвращает список доступных провайдеров.

    Args:
        Нет аргументов.

    Returns:
        list: Список доступных провайдеров.

    Raises:
        Нет явных исключений.

    
    - Функция вызывает метод `get_providers` родительского класса `Api`.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> providers = js_api.get_providers()
        >>> print(providers)
    """
    ...
```

### `JsApi.get_provider_models`

```python
def get_provider_models(self, provider: str, **kwargs):
    """Функция возвращает список моделей для указанного провайдера.

    Args:
        provider (str): Имя провайдера.
        **kwargs: Дополнительные аргументы.

    Returns:
        list: Список моделей для указанного провайдера.

    Raises:
        Нет явных исключений.

    
    - Функция вызывает метод `get_provider_models` родительского класса `Api`.

    Внутренние функции:
    - Нет внутренних функций.

    Примеры:
        >>> js_api = JsApi()
        >>> models = js_api.get_provider_models("openai")
        >>> print(models)
    """
    ...
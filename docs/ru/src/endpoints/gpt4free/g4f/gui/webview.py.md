# Модуль webview

## Обзор

Модуль `webview.py` предназначен для запуска графического интерфейса (GUI) библиотеки `g4f` с использованием `webview`. Он включает в себя настройку окна `webview`, интеграцию JavaScript API, а также обработку аргументов командной строки для настройки режима отладки и других параметров.

## Подробней

Этот модуль играет ключевую роль в отображении пользовательского интерфейса `g4f`. Он использует библиотеку `webview` для создания окон, в которых отображается интерфейс, реализованный на HTML, CSS и JavaScript. Модуль также включает в себя функциональность для обработки аргументов командной строки, что позволяет пользователям настраивать различные аспекты работы GUI, такие как режим отладки, порт HTTP и использование SSL.

## Классы

В данном модуле классы отсутствуют.

## Функции

### `run_webview`

```python
def run_webview(
    debug: bool = False,
    http_port: int = None,
    ssl: bool = True,
    storage_path: str = None,
    gui: str = None
):
    """Запускает окно webview с графическим интерфейсом g4f.

    Args:
        debug (bool, optional): Включает режим отладки. По умолчанию `False`.
        http_port (int, optional): Порт HTTP для webview. По умолчанию `None`.
        ssl (bool, optional): Определяет, использовать ли SSL. По умолчанию `True`.
        storage_path (str, optional): Путь для хранения данных webview. По умолчанию `None`.
        gui (str, optional):  <инструкция для модели gemini:необходимо уточнить, что это за параметр и какое влияние он оказывает на работу функции.> По умолчанию `None`.

    Raises:
        ImportError: Если библиотека `platformdirs` не установлена и `storage_path` не указан.

    """
```

**Назначение**: Функция `run_webview` настраивает и запускает окно `webview` с графическим интерфейсом для библиотеки `g4f`.

**Параметры**:
- `debug` (bool, optional): Включает режим отладки, если установлено значение `True`. По умолчанию `False`.
- `http_port` (int, optional): Определяет порт HTTP для `webview`. Если не указан, используется порт по умолчанию.
- `ssl` (bool, optional): Указывает, использовать ли SSL для соединения. По умолчанию `True`.
- `storage_path` (str, optional): Путь к директории, где `webview` будет хранить свои данные (например, кэш). Если не указан, используется директория по умолчанию, определяемая с помощью `platformdirs`.
- `gui` (str, optional): <инструкция для модели gemini:необходимо уточнить, что это за параметр и какое влияние он оказывает на работу функции.> По умолчанию `None`.

**Как работает функция**:

1. **Определение пути к файлам GUI**: Функция определяет путь к файлам графического интерфейса, который может зависеть от того, запущена ли программа в режиме замороженного приложения (`frozen`) или в обычном режиме разработки.

2. **Настройка параметров `webview`**: Функция устанавливает параметры `webview`, такие как разрешение открытия внешних ссылок в браузере и разрешение загрузок.

   - `webview.settings['OPEN_EXTERNAL_LINKS_IN_BROWSER'] = True`: Разрешает открытие внешних ссылок в браузере, установленном по умолчанию.
   - `webview.settings['ALLOW_DOWNLOADS'] = True`: Разрешает загрузки файлов из `webview`.

3. **Создание окна `webview`**: Создается окно `webview` с указанными параметрами, такими как заголовок, путь к HTML-файлу и JavaScript API.

   - `webview.create_window(...)`: Создает окно `webview` с указанным заголовком, путем к HTML-файлу (`client/index.html`), разрешает выделение текста (`text_select=True`) и передает экземпляр JavaScript API (`js_api=JsApi()`) для взаимодействия с кодом на JavaScript.

4. **Настройка пути для хранения данных**: Если `storage_path` не указан и установлена библиотека `platformdirs`, путь для хранения данных определяется с помощью `user_config_dir("g4f-webview")`.

5. **Запуск `webview`**: Функция запускает `webview` с указанными параметрами, такими как приватный режим, путь для хранения данных, режим отладки, порт HTTP и использование SSL.

   - `webview.start(...)`: Запускает приложение `webview` с указанными параметрами, такими как отключенный приватный режим (`private_mode=False`), путь для хранения данных (`storage_path`), режим отладки (`debug`), HTTP-порт (`http_port`) и использование SSL (`ssl`).

**Примеры**:

Запуск `webview` с параметрами по умолчанию:

```python
run_webview()
```

Запуск `webview` в режиме отладки с указанием порта HTTP:

```python
run_webview(debug=True, http_port=8080)
```

### Основной блок `if __name__ == "__main__":`

```python
if __name__ == "__main__":
    parser = gui_parser()
    args = parser.parse_args()
    if args.debug:
        g4f.debug.logging = True
    run_webview(args.debug, args.port, not args.debug)
```

**Назначение**: Этот блок кода выполняется только при запуске скрипта напрямую (а не при импорте как модуля). Он обрабатывает аргументы командной строки и запускает `webview`.

**Как работает**:

1. **Создание парсера аргументов**: Создается экземпляр парсера аргументов командной строки с помощью функции `gui_parser()`.
   - `parser = gui_parser()`: Создает парсер аргументов командной строки.

2. **Обработка аргументов**: Парсер обрабатывает аргументы командной строки и сохраняет их в объекте `args`.
   - `args = parser.parse_args()`: Обрабатывает аргументы командной строки.

3. **Включение отладочного логгирования**: Если указан аргумент `--debug`, включается отладочное логгирование.
   - `if args.debug:`: Проверяет, включен ли режим отладки.
   - `g4f.debug.logging = True`: Включает отладочное логгирование, если режим отладки включен.

4. **Запуск `webview`**: Функция `run_webview` вызывается с параметрами, полученными из аргументов командной строки.
   - `run_webview(args.debug, args.port, not args.debug)`: Запускает `webview` с указанными параметрами:
     - `args.debug`: Режим отладки.
     - `args.port`: Порт HTTP.
     - `not args.debug`: Использование SSL (отключается, если включен режим отладки).

**Примеры**:

Запуск скрипта с аргументом `--debug`:

```bash
python webview.py --debug
```

Запуск скрипта с указанием порта HTTP:

```bash
python webview.py --port 8080
```
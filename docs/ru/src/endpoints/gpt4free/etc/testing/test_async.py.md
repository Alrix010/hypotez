# Документация для модуля `test_async.py`

## Обзор

Модуль `test_async.py` предназначен для асинхронного тестирования различных провайдеров, используемых в проекте `hypotez` для работы с моделью GPT-3.5. Он выполняет запросы к этим провайдерам и логирует время выполнения каждого запроса.

## Подробней

Этот модуль является частью системы тестирования интеграции с различными API для доступа к языковой модели GPT-3.5. Он позволяет проверить работоспособность и измерить время отклика каждого провайдера. Модуль использует асинхронный подход для одновременного выполнения запросов к нескольким провайдерам. Расположение файла в структуре проекта указывает на то, что он используется для тестирования асинхронных функций, связанных с GPT4Free.

## Функции

### `create_async`

```python
async def create_async(provider):
    """
    Асинхронно создает запрос к указанному провайдеру и логирует время выполнения.

    Args:
        provider: Провайдер для выполнения запроса.

    Raises:
        Exception: В случае возникновения ошибки при выполнении запроса.
    """
```

**Как работает функция**:

1. **Обращение к провайдеру**: Функция принимает объект `provider` в качестве аргумента, который представляет собой конкретного провайдера API для доступа к GPT-3.5.
2. **Измерение времени**: Использует `log_time_async` для измерения времени выполнения запроса к провайдеру.
3. **Формирование запроса**: Отправляет асинхронный запрос к провайдеру с использованием метода `provider.create_async`. Запрос содержит сообщение для модели GPT-3.5.
4. **Обработка ответа**: Выводит в консоль ответ от провайдера или информацию об ошибке, если таковая возникла.

```
        create_async
            │
            │ provider
            │
            ▼
        log_time_async
            │
            │ provider.create_async
            │
            ▼
        Вывод ответа или ошибки
```

### `run_async`

```python
async def run_async():
  """
  Запускает асинхронные запросы ко всем доступным и рабочим провайдерам.

  """
```

**Как работает функция**:

1. **Получение списка провайдеров**: Использует `get_providers()` для получения списка всех доступных провайдеров.
2. **Фильтрация провайдеров**: Фильтрует список, оставляя только рабочие провайдеры (у которых атрибут `working` равен `True`).
3. **Создание задач**: Для каждого рабочего провайдера создает задачу на выполнение `create_async(provider)`.
4. **Запуск задач**: Использует `asyncio.gather(*responses)` для одновременного выполнения всех созданных задач.

```
        run_async
            │
            │ get_providers()
            │
            ▼
        Фильтрация провайдеров
            │
            │ create_async(provider)
            │
            ▼
        asyncio.gather
```

## Точка входа

```python
print("Total:", asyncio.run(log_time_async(run_async)))
```

**Как работает**:

1. **Запуск асинхронной функции**: Использует `asyncio.run()` для запуска асинхронной функции `run_async`.
2. **Измерение времени**: Измеряет общее время выполнения функции `run_async` с помощью `log_time_async`.
3. **Вывод результата**: Выводит общее время выполнения в консоль.

## Примеры

### Запуск `create_async` с конкретным провайдером:

```python
import asyncio
from unittest.mock import MagicMock

async def main():
    provider_mock = MagicMock()
    provider_mock.__name__ = "MockProvider"
    provider_mock.create_async.return_value = "Mock response"

    await create_async(provider_mock)

if __name__ == "__main__":
    asyncio.run(main())
```

### Запуск `run_async`:

```python
import asyncio

async def main():
    await run_async()

if __name__ == "__main__":
    asyncio.run(main())
# Модуль для логирования времени выполнения функций

## Обзор

Модуль содержит функции для измерения и логирования времени выполнения других функций. Это полезно для профилирования кода и выявления узких мест производительности. Модуль предоставляет три функции: `log_time_async`, `log_time_yield` и `log_time` для асинхронных, генераторов и обычных функций соответственно.

## Подробней

Данный модуль предоставляет инструменты для измерения времени выполнения функций. Он использует декораторы или обертки для измерения времени выполнения целевой функции и добавления информации о времени выполнения к результату. Функции `log_time_async`, `log_time_yield` и `log_time` предназначены для работы с асинхронными функциями, генераторами и обычными функциями соответственно.

## Функции

### `log_time_async`

```python
async def log_time_async(method: callable, **kwargs):
    """
    Измеряет время выполнения асинхронной функции и добавляет информацию о времени выполнения к результату.

    Args:
        method (callable): Асинхронная функция, время выполнения которой необходимо измерить.
        **kwargs: Произвольные аргументы, передаваемые в функцию `method`.

    Returns:
        str: Результат выполнения функции `method` с добавленной информацией о времени выполнения в секундах.
             Если результат выполнения функции `method` равен `None`, возвращается только информация о времени выполнения.

    Как работает функция:
    1. Фиксирует время начала выполнения функции.
    2. Вызывает асинхронную функцию `method` с переданными аргументами.
    3. Фиксирует время окончания выполнения функции.
    4. Вычисляет время выполнения в секундах.
    5. Формирует строку с информацией о времени выполнения.
    6. Если результат выполнения функции `method` не равен `None`, добавляет информацию о времени выполнения к результату и возвращает объединенную строку.
    7. Если результат выполнения функции `method` равен `None`, возвращает только информацию о времени выполнения.

    Примеры:
        Предположим, у нас есть асинхронная функция `my_async_function`:

        ```python
        async def my_async_function(param1: str, param2: int) -> str:
            await asyncio.sleep(1)  # Имитация работы
            return f"Result: {param1}, {param2}"
        ```

        Пример вызова `log_time_async`:

        ```python
        async def main():
            result = await log_time_async(my_async_function, param1="test", param2=123)
            print(result)  # Вывод: Result: test, 123 1.01 secs (время может отличаться)
        ```

        Если `my_async_function` возвращает `None`:

        ```python
        async def my_async_function(param1: str, param2: int) -> None:
            await asyncio.sleep(1)  # Имитация работы
            return None
        ```

        Пример вызова `log_time_async`:

        ```python
        async def main():
            result = await log_time_async(my_async_function, param1="test", param2=123)
            print(result)  # Вывод: 1.01 secs (время может отличаться)
        ```
    """
    start = time()
    result = await method(**kwargs)
    secs = f"{round(time() - start, 2)} secs"
    return " ".join([result, secs]) if result else secs
```

**Как работает функция**:

```text
    Начало --> Запись времени начала (start)
        ↓
    Вызов асинхронной функции (method) с аргументами (kwargs) --> result
        ↓
    Запись времени окончания
        ↓
    Вычисление времени выполнения (secs)
        ↓
    Проверка result is not None?
    ├── Да --> Форматирование результата: result + " " + secs
    └── Нет --> secs
        ↓
    Конец
```

### `log_time_yield`

```python
def log_time_yield(method: callable, **kwargs):
    """
    Измеряет время выполнения функции-генератора и добавляет информацию о времени выполнения к каждому возвращаемому значению.

    Args:
        method (callable): Функция-генератор, время выполнения которой необходимо измерить.
        **kwargs: Произвольные аргументы, передаваемые в функцию `method`.

    Yields:
        str: Значения, генерируемые функцией `method`, с добавленной информацией о времени выполнения в секундах после завершения работы генератора.

    Как работает функция:
    1. Фиксирует время начала выполнения функции.
    2. Вызывает функцию-генератор `method` с переданными аргументами.
    3. Перебирает значения, генерируемые функцией `method`, и передает их вызывающей стороне.
    4. После завершения работы генератора фиксирует время окончания выполнения функции.
    5. Вычисляет время выполнения в секундах.
    6. Генерирует строку с информацией о времени выполнения.
    7. Передает информацию о времени выполнения вызывающей стороне.

    Примеры:
        Предположим, у нас есть функция-генератор `my_generator_function`:

        ```python
        def my_generator_function(param1: str, param2: int):
            yield f"First: {param1}"
            yield f"Second: {param2}"
        ```

        Пример вызова `log_time_yield`:

        ```python
        def main():
            for result in log_time_yield(my_generator_function, param1="test", param2=123):
                print(result)
            # Вывод:
            # First: test
            # Second: 123
            #  0.0 secs (время может отличаться)
        ```
    """
    start = time()
    result = yield from method(**kwargs)
    yield f" {round(time() - start, 2)} secs"
```

**Как работает функция**:

```text
    Начало --> Запись времени начала (start)
        ↓
    Вызов функции-генератора (method) с аргументами (kwargs) --> result
        ↓
    yield from method
        ↓
    Запись времени окончания
        ↓
    Вычисление времени выполнения (secs)
        ↓
    yield f" {round(time() - start, 2)} secs"
        ↓
    Конец
```

### `log_time`

```python
def log_time(method: callable, **kwargs):
    """
    Измеряет время выполнения обычной функции и добавляет информацию о времени выполнения к результату.

    Args:
        method (callable): Обычная функция, время выполнения которой необходимо измерить.
        **kwargs: Произвольные аргументы, передаваемые в функцию `method`.

    Returns:
        str: Результат выполнения функции `method` с добавленной информацией о времени выполнения в секундах.
             Если результат выполнения функции `method` равен `None`, возвращается только информация о времени выполнения.

    Как работает функция:
    1. Фиксирует время начала выполнения функции.
    2. Вызывает функцию `method` с переданными аргументами.
    3. Фиксирует время окончания выполнения функции.
    4. Вычисляет время выполнения в секундах.
    5. Формирует строку с информацией о времени выполнения.
    6. Если результат выполнения функции `method` не равен `None`, добавляет информацию о времени выполнения к результату и возвращает объединенную строку.
    7. Если результат выполнения функции `method` равен `None`, возвращает только информацию о времени выполнения.

    Примеры:
        Предположим, у нас есть обычная функция `my_function`:

        ```python
        def my_function(param1: str, param2: int) -> str:
            time.sleep(1)  # Имитация работы
            return f"Result: {param1}, {param2}"
        ```

        Пример вызова `log_time`:

        ```python
        def main():
            result = log_time(my_function, param1="test", param2=123)
            print(result)  # Вывод: Result: test, 123 1.01 secs (время может отличаться)
        ```

        Если `my_function` возвращает `None`:

        ```python
        def my_function(param1: str, param2: int) -> None:
            time.sleep(1)  # Имитация работы
            return None
        ```

        Пример вызова `log_time`:

        ```python
        def main():
            result = log_time(my_function, param1="test", param2=123)
            print(result)  # Вывод: 1.01 secs (время может отличаться)
        ```
    """
    start = time()
    result = method(**kwargs)
    secs = f"{round(time() - start, 2)} secs"
    return " ".join([result, secs]) if result else secs
```

**Как работает функция**:

```text
    Начало --> Запись времени начала (start)
        ↓
    Вызов функции (method) с аргументами (kwargs) --> result
        ↓
    Запись времени окончания
        ↓
    Вычисление времени выполнения (secs)
        ↓
    Проверка result is not None?
    ├── Да --> Форматирование результата: result + " " + secs
    └── Нет --> secs
        ↓
    Конец
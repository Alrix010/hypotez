# Модуль для создания провайдера

## Обзор

Этот модуль предназначен для автоматического создания нового провайдера на основе cURL команды. Он считывает cURL команду, запрашивает у gpt-4o код провайдера на основе этой команды и сохраняет полученный код в файл.
Расположение файла в проекте: `hypotez/src/endpoints/gpt4free/etc/tool/create_provider.py`.

## Подробнее

Модуль выполняет следующие шаги:

1.  Запрашивает имя для нового провайдера.
2.  Проверяет, существует ли файл с таким именем.
3.  Если файл не существует, запрашивает cURL команду.
4.  Формирует запрос к gpt-4o с инструкцией создать код провайдера на основе cURL команды.
5.  Получает ответ от gpt-4o, извлекает код и сохраняет его в файл.
6.  Добавляет импорт нового провайдера в файл `g4f/Provider/__init__.py`.

## Функции

### `read_code`

```python
def read_code(text: str) -> str | None:
    """
    Извлекает код Python из текста, заключенного в блоки code fences (```python ... ```).

    Args:
        text (str): Текст, содержащий код.

    Returns:
        str | None: Извлеченный код Python или None, если код не найден.

    Raises:
        None

    Example:
        >>> text = "Some text ```python\\nprint('Hello')\\n```"
        >>> read_code(text)
        "print('Hello')"
    """
```

**Назначение**: Извлечение Python кода из текстового содержимого, обрамлённого символами ``` с указанием языка (python или py).

**Параметры**:

*   `text` (str): Строка, в которой производится поиск кода.

**Возвращает**:

*   `str | None`: Код Python, найденный в тексте, или `None`, если код не найден.

**Как работает функция**:

1.  Функция `read_code` использует регулярное выражение для поиска блоков кода, заключенных в тройные обратные кавычки (code fences) с указанием языка python или py.

2.  Если совпадение найдено, извлекается содержимое группы "code", которое соответствует коду Python внутри code fence.

3.  Если совпадение не найдено, возвращается `None`.

```ascii
    Текст запроса (text) --> Regex: ```(python|py)\n(?P<code>[\S\s]+?)\n``` --> Найдено совпадение?
    |                                                                                                |
    Нет                                                                                               Да
    |                                                                                                |
    Возврат None                                                                                     Извлечь код из группы "code"
    |                                                                                                |
    Конец                                                                                            Возврат кода
```

**Примеры**:

```python
text = "Some text ```python\nprint('Hello')\n```"
read_code(text)  # Возвращает "print('Hello')"

text = "Some text ```\nprint('Hello')\n```"
read_code(text)  # Возвращает None

text = "```python\nprint('Hello')\n```Some text"
read_code(text)  # Возвращает "print('Hello')"

text = "```py\nprint('Hello')\n```"
read_code(text) # Возвращает "print('Hello')"
```

### `input_command`

```python
def input_command() -> str:
    """
    Считывает многострочный ввод от пользователя (cURL команду) до тех пор, пока не будет введен символ конца файла (EOF).

    Args:
        None

    Returns:
        str: Объединенная строка, содержащая введенные пользователем строки.

    Raises:
        None

    Example:
        # Ввод пользователя:
        # line1
        # line2
        # Ctrl-D
        # input_command() возвращает "line1\\nline2"
    """
```

**Назначение**: Считывание многострочной команды (например, cURL) от пользователя через стандартный ввод до достижения символа конца файла (EOF).

**Параметры**:

*   Нет

**Возвращает**:

*   `str`: Объединенная строка, содержащая введенные пользователем строки, разделенные символами новой строки.

**Как работает функция**:

1.  Функция `input_command` выводит сообщение "Enter/Paste the cURL command. Ctrl-D or Ctrl-Z ( windows ) to save it."

2.  В цикле считывает строки из стандартного ввода до тех пор, пока не будет достигнут символ конца файла (EOF). EOF генерируется нажатием Ctrl-D в Unix-подобных системах и Ctrl-Z в Windows.

3.  Каждая введенная строка добавляется в список `contents`.

4.  После завершения ввода строки объединяются в одну строку, разделенные символами новой строки, и возвращаются.

```ascii
    Начало --> Вывод сообщения приглашения --> Инициализация списка contents --> Цикл: Чтение строки из ввода
             |
             Нет EOF                                                                     EOF
             |                                                                          |
             Добавить строку в contents --> Продолжить цикл                                Объединить строки из contents с разделителем '\n' --> Возврат результата
             |
             Конец
```

**Примеры**:

Предположим, пользователь вводит следующие строки и нажимает Ctrl-D:

```
line1
line2
```

Тогда `input_command()` вернет:

```
"line1\nline2"
```

### Основной блок кода

Основной блок кода выполняет следующую последовательность действий:

1.  Запрашивает у пользователя имя для провайдера и формирует путь к файлу провайдера.
2.  Проверяет, существует ли файл провайдера.
3.  Если файл не существует, запрашивает cURL команду у пользователя.
4.  Формирует prompt для gpt-4o, включающий cURL команду и пример кода провайдера.
5.  Запрашивает у gpt-4o код провайдера на основе prompt.
6.  Извлекает код из ответа gpt-4o и сохраняет его в файл провайдера.
7.  Добавляет импорт нового провайдера в файл `g4f/Provider/__init__.py`.
8.  Если файл провайдера существует, считывает его содержимое.

```ascii
    Начало --> Запрос имени провайдера --> Проверка существования файла провайдера
             |
             Файл существует                                                              Файл не существует
             |                                                                          |
             Чтение кода из файла --> Конец                                               Запрос cURL команды --> Формирование prompt для gpt-4o
                                                                                           |
                                                                                           Запрос кода провайдера у gpt-4o --> Извлечение кода из ответа
                                                                                           |
                                                                                           Сохранение кода в файл провайдера --> Добавление импорта провайдера в __init__.py
                                                                                           |
                                                                                           Конец
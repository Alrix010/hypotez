# Модуль для перевода README
=========================

Модуль предназначен для перевода файлов `README.md` на другие языки, используя API g4f (GPT4Free). В частности, в предоставленном коде выполняется перевод на немецкий язык. Модуль использует асинхронные функции для эффективной обработки и перевода текста.

## Подробнее

Модуль содержит функции для чтения текстовых файлов, перевода текста с использованием API g4f, а также обработки частей текста с учетом списка исключений и разрешений. Код позволяет переводить `README.md` файлы, сохраняя при этом структуру и элементы форматирования, такие как примеры кода.

## Функции

### `read_text`

```python
def read_text(text: str) -> str:
    """Извлекает текст из markdown документа, находящегося между блоками code fence (```).

    Args:
        text (str): Строка, содержащая markdown документ.

    Returns:
        str: Текст, находящийся между блоками code fence.

    Как работает функция:
    1. Разделяет входной текст на строки.
    2. Итерируется по строкам, определяя начало и конец блоков code fence.
    3. Извлекает и возвращает текст, находящийся между этими блоками.

    ASCII flowchart:
    Разбить текст на строки -> Найти начало code fence -> Найти конец code fence -> Извлечь текст между блоками code fence -> Вернуть текст

    Примеры:
        >>> text = "Some text\\n```\\nCode example\\n```\\nMore text"
        >>> read_text(text)
        'Code example'
    """
    ...
```

### `translate`

```python
async def translate(text: str) -> str:
    """Асинхронно переводит предоставленный текст на целевой язык с использованием API g4f.

    Args:
        text (str): Текст для перевода.

    Returns:
        str: Переведенный текст.

    Как работает функция:
    1. Формирует запрос к API g4f, включая текст для перевода и инструкции по форматированию.
    2. Использует `provider.create_async` для асинхронного выполнения запроса к API.
    3. Извлекает переведенный текст из ответа API.
    4. Добавляет закрывающий блок code fence, если необходимо.

    ASCII flowchart:
    Сформировать запрос -> Вызвать API g4f -> Извлечь переведенный текст -> Добавить закрывающий code fence (если необходимо) -> Вернуть переведенный текст

    Примеры:
        >>> text = "Hello, world!"
        >>> await translate(text)  #  "Hallo, Welt!" (примерный перевод на немецкий)
    """
    ...
```

### `translate_part`

```python
async def translate_part(part: str, i: int) -> str:
    """Асинхронно переводит часть текста, учитывая списки блокировки и разрешения.

    Args:
        part (str): Часть текста для перевода.
        i (int): Индекс части текста. Используется для логирования.

    Returns:
        str: Переведенная часть текста.

    Как работает функция:
    1. Проверяет, входит ли часть текста в список блокировки (`blocklist`).
    2. Если часть текста заблокирована, переводит только первую строку и элементы из списка разрешений (`allowlist`).
    3. Если часть текста не заблокирована, переводит её целиком.
    4. Логирует информацию о завершении перевода.

    ASCII flowchart:
    Проверить в списке блокировки -> Если заблокировано: перевести первую строку и элементы из списка разрешений -> Иначе: перевести всю часть -> Залогировать информацию о переводе -> Вернуть переведенную часть

    Примеры:
        >>> part = "## Some text to translate"
        >>> i = 1
        >>> await translate_part(part, i)  #  "## Irgendein zu übersetzender Text" (примерный перевод на немецкий)
    """
    ...
```

### `translate_readme`

```python
async def translate_readme(readme: str) -> str:
    """Асинхронно переводит весь README-файл, разделяя его на части.

    Args:
        readme (str): Содержимое README-файла.

    Returns:
        str: Переведенное содержимое README-файла.

    Как работает функция:
    1. Разделяет README-файл на части по заголовкам второго уровня ("## ").
    2. Асинхронно переводит каждую часть с использованием `translate_part`.
    3. Объединяет переведенные части обратно в единый текст.

    ASCII flowchart:
    Разделить README на части -> Асинхронно перевести каждую часть -> Объединить переведенные части -> Вернуть переведенный README

    Примеры:
        >>> readme = "## Title\\nSome text"
        >>> await translate_readme(readme)  #  "## Titel\\nIrgendein Text" (примерный перевод на немецкий)
    """
    ...
```

## Переменные

-   `iso`: Код страны для имени выходного файла (например, `"GE"` для Германии).
-   `language`: Язык, на который необходимо перевести текст (например, `"german"` для немецкого).
-   `translate_prompt`: Начальный текст запроса для API перевода, включающий инструкции по форматированию.
-   `keep_note`: Инструкция для сохранения определенного форматирования (например, "[!Note]").
-   `blocklist`: Список строк, которые нужно частично переводить (например, заголовки, которые не нужно переводить целиком).
-   `allowlist`: Список строк внутри заблокированных частей, которые все равно нужно переводить.
-   `provider`: Провайдер API g4f, используемый для перевода.

## Как работает модуль:

1.  **Чтение файла**:
    -   Считывает содержимое файла `README.md`.
2.  **Разделение на части**:
    -   Разделяет текст `README.md` на части, используя разделитель `## `.
3.  **Асинхронный перевод каждой части**:
    -   Для каждой части текста выполняется асинхронный перевод с использованием функции `translate_part`.
        -   Функция `translate_part` проверяет, входит ли часть текста в `blocklist`. Если да, то переводится только заголовок и элементы из `allowlist`. В противном случае переводится вся часть текста.
        -   Для перевода используется функция `translate`, которая отправляет запрос к API g4f и получает переведенный текст.
4.  **Объединение переведенных частей**:
    -   После завершения перевода всех частей, они объединяются в один текст.
5.  **Запись в файл**:
    -   Полученный переведенный текст записывается в новый файл с именем `README-{iso}.md`, где `{iso}` - это код страны (например, `README-GE.md`).

ASCII flowchart:
```
Чтение README.md
↓
Разделение на части по "## "
↓
Асинхронный перевод каждой части (translate_part)
│
├── Проверка на вхождение в blocklist
│   ├── Если в blocklist:
│   │   ├── Перевод только заголовка и allowlist
│   │   └── Вызов API g4f (translate)
│   └── Иначе:
│       └── Вызов API g4f (translate) для всей части
│
Объединение переведенных частей
↓
Запись в README-{iso}.md
```

## Примеры

```python
# Пример использования функций (необходимо запустить в асинхронном контексте)
import asyncio

async def main():
    readme_content = "## Title\\nSome text to translate.\\n### Other\\nMore text."
    translated_readme = await translate_readme(readme_content)
    print(translated_readme)

if __name__ == "__main__":
    asyncio.run(main())
# Модуль для генерации таблиц `Markdown` с информацией о провайдерах и моделях

## Обзор

Этот модуль предназначен для автоматического создания документации в формате `Markdown`, содержащей таблицы со списком провайдеров и моделей, поддерживаемых библиотекой `g4f`. Он включает в себя функции для тестирования провайдеров, сбора информации о них и форматирования этой информации в виде таблиц `Markdown`.

## Подробней

Модуль `readme_table.py` автоматизирует процесс создания документации, предоставляя актуальную информацию о поддерживаемых провайдерах и моделях. Он использует асинхронные функции для проверки доступности провайдеров и собирает данные об их функциональности, такие как поддержка потоковой передачи, системных сообщений и истории сообщений. Затем эти данные форматируются в виде таблиц `Markdown`, которые можно легко включить в документацию проекта.

## Функции

### `test_async`

```python
async def test_async(provider: ProviderType) -> bool:
    """
    Асинхронно проверяет работоспособность провайдера.

    Args:
        provider (ProviderType): Провайдер для тестирования.

    Returns:
        bool: `True`, если провайдер работает, `False` в противном случае.
    """
```

**Назначение**: Асинхронно проверяет работоспособность заданного провайдера.

**Параметры**:
- `provider` (ProviderType): Провайдер, который необходимо протестировать.

**Возвращает**:
- `bool`: Возвращает `True`, если провайдер успешно отвечает на тестовый запрос, и `False` в случае неудачи или если провайдер не работает.

**Как работает функция**:
1.  Проверяет, помечен ли провайдер как рабочий (`provider.working`). Если нет, возвращает `False`.
2.  Отправляет асинхронный запрос к провайдеру с использованием `ChatCompletion.create_async` с тестовым сообщением "Hello Assistant!".
3.  Устанавливает таймаут ожидания ответа в 30 секунд с помощью `asyncio.wait_for`.
4.  Возвращает `True`, если получен ответ, и `False` в случае исключения. В случае возникновения исключения, логирует информацию об ошибке.

**Примеры**:

```python
import asyncio
from g4f.providers import Ails

async def main():
    provider = Ails
    result = await test_async(provider)
    print(f"Provider {provider.__name__} is working: {result}")

if __name__ == "__main__":
    asyncio.run(main())
```

### `test_async_list`

```python
def test_async_list(providers: list[ProviderType]) -> list:
    """
    Асинхронно проверяет список провайдеров.

    Args:
        providers (list[ProviderType]): Список провайдеров для тестирования.

    Returns:
        list: Список результатов тестирования для каждого провайдера.
    """
```

**Назначение**: Асинхронно тестирует список провайдеров и возвращает результаты.

**Параметры**:
- `providers` (list[ProviderType]): Список провайдеров, которые необходимо протестировать.

**Возвращает**:
- `list`: Список булевых значений, где каждое значение соответствует результату тестирования провайдера из входного списка.

**Как работает функция**:

1.  Использует генератор списков для асинхронного тестирования каждого провайдера из входного списка `providers`.
2.  Для каждого провайдера вызывается функция `test_async`, результат которой добавляется в список `responses`.
3.  Возвращает список `responses` с результатами тестирования.

```ascii
    providers --> [test_async(provider) for provider in providers] --> responses
```

**Примеры**:

```python
import asyncio
from g4f.providers import Ails, ChatgptAi

async def main():
    providers = [Ails, ChatgptAi]
    results = test_async_list(providers)
    print(f"Results: {results}")

if __name__ == "__main__":
    asyncio.run(main())
```

### `print_providers`

```python
def print_providers() -> list[str]:
    """
    Собирает информацию о провайдерах и форматирует ее в виде строк Markdown для таблицы.

    Returns:
        list[str]: Список строк Markdown, представляющих таблицу с информацией о провайдерах.
    """
```

**Назначение**: Собирает информацию о провайдерах и формирует таблицу в формате `Markdown`.

**Возвращает**:
- `list[str]`: Список строк в формате `Markdown`, представляющих таблицу с информацией о провайдерах.

**Как работает функция**:

1.  Получает список рабочих провайдеров из `__providers__`.
2.  Тестирует список провайдеров с помощью `test_async_list` и сохраняет результаты.
3.  Создает список строк `lines`, который будет содержать `Markdown` таблицу.
4.  Разделяет провайдеров на две категории: "Free" и "Auth" (бесплатные и требующие аутентификацию).
5.  Для каждого провайдера формирует строку с информацией, такой как название, веб-сайт, статус, поддержка потоковой передачи, системных сообщений, истории сообщений и модели.
6.  Добавляет сформированные строки в список `lines`.
7.  Возвращает список `lines`.

```ascii
    __providers__ --> test_async_list() --> responses
    responses --> lines (Markdown table)
```

**Примеры**:

```python
# Пример вызова функции и печати результата
lines = print_providers()
for line in lines:
    print(line)
```

### `print_models`

```python
def print_models() -> list[str]:
    """
    Собирает информацию о моделях и форматирует ее в виде строк Markdown для таблицы.

    Returns:
        list[str]: Список строк Markdown, представляющих таблицу с информацией о моделях.
    """
```

**Назначение**: Собирает информацию о моделях и формирует таблицу в формате `Markdown`.

**Возвращает**:
- `list[str]`: Список строк в формате `Markdown`, представляющих таблицу с информацией о моделях.

**Как работает функция**:

1.  Определяет базовые имена и URL-адреса провайдеров.
2.  Создает список строк `lines`, который будет содержать `Markdown` таблицу.
3.  Перебирает модели из `models.ModelUtils.convert.items()`.
4.  Извлекает информацию о каждой модели, такую как имя, базовый провайдер, провайдер и URL-адрес.
5.  Форматирует информацию в виде строки `Markdown` и добавляет ее в список `lines`.
6.  Возвращает список `lines`.

```ascii
    models.ModelUtils.convert.items() --> lines (Markdown table)
```

**Примеры**:

```python
# Пример вызова функции и печати результата
lines = print_models()
for line in lines:
    print(line)
```

### `print_image_models`

```python
def print_image_models() -> list[str]:
    """
    Собирает информацию о моделях изображений и формирует таблицу в формате Markdown.

    Returns:
        list[str]: Список строк Markdown, представляющих таблицу с информацией о моделях изображений.
    """
```

**Назначение**: Собирает информацию о моделях изображений и формирует таблицу в формате `Markdown`.

**Возвращает**:
- `list[str]`: Список строк в формате `Markdown`, представляющих таблицу с информацией о моделях изображений.

**Как работает функция**:

1.  Создает список строк `lines`, который будет содержать `Markdown` таблицу.
2.  Перебирает провайдеров, у которых есть атрибуты `image_models` или `vision_models`.
3.  Извлекает информацию о каждой модели изображения, такую как метка, провайдер, модели изображений, модели vision и URL-адрес.
4.  Форматирует информацию в виде строки `Markdown` и добавляет ее в список `lines`.
5.  Возвращает список `lines`.

```ascii
    __providers__ --> lines (Markdown table)
```

**Примеры**:

```python
# Пример вызова функции и печати результата
lines = print_image_models()
for line in lines:
    print(line)
```

## Главный блок `if __name__ == "__main__":`

В главном блоке происходит следующее:

1.  Открывается файл `docs/providers.md` для записи.
2.  Записываются строки, сгенерированные функцией `print_providers()`.
3.  Записывается разделитель `---`.
4.  Записываются строки, сгенерированные функцией `print_image_models()`.

Этот блок предназначен для автоматического обновления документации `providers.md` при запуске скрипта.
# Модуль WebDriver Firefox

## Обзор

Этот модуль предоставляет класс `Firefox`, расширяющий стандартный `selenium.webdriver.Firefox` с дополнительными функциями, такими как управление пользовательскими профилями, режим киоска и настройки прокси.

## Подробнее

Модуль предназначен для управления экземплярами веб-драйвера Firefox с расширенными возможностями конфигурации. Он позволяет настраивать профили Firefox, устанавливать режимы отображения окна (например, киоск), задавать пользовательские агенты и настраивать прокси-серверы. Это обеспечивает гибкость при автоматизации веб-браузеров Firefox для различных задач, таких как тестирование, сбор данных и автоматическое взаимодействие с веб-сайтами.

## Классы

### `Config`

**Описание**: Класс конфигурации для WebDriver Firefox.

**Атрибуты**:

- `geckodriver_path` (str): Путь к исполняемому файлу GeckoDriver.
- `firefox_binary_path` (str): Путь к бинарному файлу Firefox.
- `profile_directory_default` (str): Значение по умолчанию для директории профиля.
- `profile_directory_os` (str): Путь к директории профиля, специфичной для операционной системы.
- `profile_directory_internal` (str): Внутренний путь к директории профиля.
- `options` (List[str]): Список опций Firefox.
- `headers` (Dict[str, Any]): Словарь заголовков для Firefox.
- `proxy_enabled` (bool): Флаг, указывающий, включен ли прокси.

**Методы**:

- `__init__(config_path: Path)`: Инициализирует объект `Config`, загружая настройки из JSON-файла.

**Принцип работы**:

Класс `Config` предназначен для загрузки и хранения конфигурационных параметров, необходимых для запуска WebDriver Firefox. Он считывает данные из JSON-файла, указанного в `config_path`, и сохраняет их в виде атрибутов объекта. Это позволяет централизованно управлять настройками, такими как пути к исполняемым файлам, параметры профиля, опции запуска и настройки прокси.

### `Firefox`

**Описание**: Класс, расширяющий `webdriver.Firefox` с улучшенными возможностями.

**Наследует**:

- `selenium.webdriver.Firefox.webdriver.WebDriver`

**Атрибуты**:

- `driver_name` (str): Имя драйвера ("firefox").

**Методы**:

- `__init__(profile_name: Optional[str] = None, geckodriver_version: Optional[str] = None, firefox_version: Optional[str] = None, user_agent: Optional[str] = None, proxy_file_path: Optional[str] = None, options: Optional[List[str]] = None, window_mode: Optional[str] = None, *args, **kwargs)`: Инициализирует WebDriver Firefox с пользовательскими настройками.
- `set_proxy(options: Options) -> None`: Настраивает параметры прокси из словаря.
- `_payload() -> None`: Загружает исполнителей для локаторов и скриптов JavaScript.

**Параметры**:

- `profile_name` (Optional[str], optional): Имя используемого профиля Firefox. По умолчанию `None`.
- `geckodriver_version` (Optional[str], optional): Версия GeckoDriver. По умолчанию `None`.
- `firefox_version` (Optional[str], optional): Версия Firefox. По умолчанию `None`.
- `user_agent` (Optional[str], optional): Строка пользовательского агента. Если `None`, используется случайный пользовательский агент. По умолчанию `None`.
- `proxy_file_path` (Optional[str], optional): Путь к файлу прокси. По умолчанию `None`.
- `options` (Optional[List[str]], optional): Список опций Firefox. По умолчанию `None`.
- `window_mode` (Optional[str], optional): Режим окна браузера (например, "windowless", "kiosk"). По умолчанию `None`.

**Принцип работы**:

Класс `Firefox` является основным классом модуля, предназначенным для управления веб-драйвером Firefox. При инициализации он загружает конфигурацию из JSON-файла, настраивает параметры запуска Firefox, устанавливает пользовательский профиль, задает пользовательский агент и настраивает прокси-сервер, если это необходимо. После запуска драйвера он загружает исполнителей для локаторов и JavaScript-скриптов, что позволяет выполнять различные действия на веб-страницах.

## Методы класса

### `Config.__init__`

**Назначение**: Инициализирует объект `Config`, загружая настройки из JSON-файла.

**Параметры**:

- `config_path` (Path): Путь к JSON-файлу конфигурации.

**Возвращает**:

- `None`

**Как работает функция**:

Функция `__init__` загружает конфигурацию из JSON-файла, используя функцию `j_loads_ns`, и присваивает значения атрибутам экземпляра класса `Config`. Эти атрибуты включают пути к исполняемым файлам GeckoDriver и Firefox, параметры профиля, опции запуска и настройки прокси.

**Примеры**:

```python
config = Config(Path(gs.path.src, "webdriver", "firefox", "firefox.json"))
print(config.geckodriver_path)
```

### `Firefox.__init__`

**Назначение**: Инициализирует WebDriver Firefox с пользовательскими настройками.

**Параметры**:

- `profile_name` (Optional[str], optional): Имя используемого профиля Firefox. По умолчанию `None`.
- `geckodriver_version` (Optional[str], optional): Версия GeckoDriver. По умолчанию `None`.
- `firefox_version` (Optional[str], optional): Версия Firefox. По умолчанию `None`.
- `user_agent` (Optional[str], optional): Строка пользовательского агента. Если `None`, используется случайный пользовательский агент. По умолчанию `None`.
- `proxy_file_path` (Optional[str], optional): Путь к файлу прокси. По умолчанию `None`.
- `options` (Optional[List[str]], optional): Список опций Firefox. По умолчанию `None`.
- `window_mode` (Optional[str], optional): Режим окна браузера (например, "windowless", "kiosk"). По умолчанию `None`.
- `*args`: Произвольные позиционные аргументы.
- `**kwargs`: Произвольные именованные аргументы.

**Возвращает**:

- `None`

**Вызывает исключения**:

- `WebDriverException`: Если не удается запустить WebDriver.
- `Exception`: При других непредвиденных ошибках во время инициализации.

**Как работает функция**:

1.  Логирует начало запуска WebDriver Firefox.
2.  Создает экземпляр класса `Config`, загружая конфигурацию из JSON-файла.
3.  Создает объект `Service` с указанием пути к исполняемому файлу GeckoDriver.
4.  Создает объект `Options` для настройки параметров Firefox.
5.  Загружает опции из конфигурационного файла и добавляет их в объект `Options`.
6.  Устанавливает режим окна браузера, если он указан.
7.  Добавляет опции из конструктора в объект `Options`.
8.  Добавляет заголовки из конфигурационного файла в объект `Options`.
9.  Устанавливает пользовательский агент, если он указан, или использует случайный пользовательский агент.
10. Настраивает прокси-сервер, если он включен.
11. Конфигурирует директорию профиля.
12. Инициализирует экземпляр WebDriver Firefox с использованием объекта `Service` и объекта `Options`.
13. Вызывает метод `_payload` для загрузки исполнителей локаторов и JavaScript-скриптов.
14. Логирует успешный запуск браузера.
15. Обрабатывает исключения, которые могут возникнуть при запуске WebDriver, и логирует соответствующие сообщения об ошибках.

**Примеры**:

```python
driver = Firefox(window_mode="kiosk")
driver.get("https://www.example.com")
driver.quit()
```

### `Firefox.set_proxy`

**Назначение**: Настраивает параметры прокси из словаря.

**Параметры**:

- `options` (Options): Объект опций Firefox, к которому добавляются настройки прокси.

**Возвращает**:

- `None`

**Как работает функция**:

1.  Функция `set_proxy` извлекает словарь прокси-серверов с использованием функции `get_proxies_dict()`.
2.  Объединяет списки прокси-серверов socks4 и socks5.
3.  Выбирает случайный рабочий прокси-сервер из списка.
4.  Если рабочий прокси-сервер найден, устанавливает параметры прокси в соответствии с протоколом (http, socks4 или socks5).
5.  Логирует информацию об установленном прокси-сервере.
6.  Если рабочий прокси-сервер не найден, логирует предупреждение.

**Примеры**:

```python
options = Options()
driver = Firefox()
driver.set_proxy(options)
driver.quit()
```

### `Firefox._payload`

**Назначение**: Загружает исполнителей для локаторов и скриптов JavaScript.

**Параметры**:

- `None`

**Возвращает**:

- `None`

**Как работает функция**:

1.  Создает экземпляр класса `JavaScript` для выполнения JavaScript-скриптов в браузере.
2.  Присваивает методы класса `JavaScript` атрибутам экземпляра класса `Firefox` для удобного доступа.
3.  Создает экземпляр класса `ExecuteLocator` для выполнения поиска элементов на веб-странице по локаторам.
4.  Присваивает методы класса `ExecuteLocator` атрибутам экземпляра класса `Firefox` для удобного доступа.

**Примеры**:

```python
driver = Firefox()
driver._payload()
driver.quit()
```
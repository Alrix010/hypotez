# Модуль `src.webdriver.bs`

## Обзор

Модуль `src.webdriver.bs` предоставляет функциональность для парсинга HTML-контента с использованием библиотек `BeautifulSoup` и `lxml` (через XPath). Он предназначен для облегчения извлечения данных из веб-страниц или локальных HTML-файлов.

## Подробнее

Этот модуль предоставляет класс `BS`, который инкапсулирует методы для загрузки HTML-контента из URL-адресов или файлов, а также для выполнения XPath-запросов к этому контенту. Он использует `BeautifulSoup` для парсинга HTML и `lxml` для выполнения XPath-запросов.

## Классы

### `BS`

**Описание**: Класс для парсинга HTML-контента с использованием BeautifulSoup и XPath.

**Атрибуты**:
- `html_content` (str): HTML-контент для парсинга.

**Методы**:
- `__init__(url: Optional[str] = None)`: Инициализирует парсер `BS` с необязательным URL-адресом.
- `get_url(url: str) -> bool`: Загружает HTML-контент из файла или URL-адреса и парсит его с помощью BeautifulSoup и XPath.
- `execute_locator(locator: Union[SimpleNamespace, dict], url: Optional[str] = None) -> List[etree._Element]`: Выполняет XPath-локатор на HTML-контенте.

**Принцип работы**:

Класс `BS` предоставляет методы для получения HTML-контента из различных источников (URL-адреса или локальные файлы) и выполнения XPath-запросов для извлечения элементов. Он использует `BeautifulSoup` для первичного парсинга HTML, а затем преобразует его в дерево `lxml` для поддержки XPath.

### `__init__`

```python
def __init__(self, url: Optional[str] = None):
    """
    Инициализирует BS парсер с необязательным URL-адресом.

    Args:
        url (Optional[str], optional): URL-адрес или путь к файлу для получения HTML-контента. По умолчанию `None`.
    """
    ...
```

**Назначение**: Инициализация экземпляра класса `BS`.

**Параметры**:
- `url` (Optional[str], optional): URL-адрес или путь к файлу для загрузки HTML-контента. Может быть `None`. По умолчанию `None`.

**Примеры**:

```python
parser = BS()
parser = BS('https://example.com')
```

### `get_url`

```python
def get_url(self, url: str) -> bool:
    """
    Извлекает HTML-контент из файла или URL-адреса и парсит его с помощью BeautifulSoup и XPath.

    Args:
        url (str): Путь к файлу или URL-адрес для получения HTML-контента.

    Returns:
        bool: `True`, если контент успешно получен, `False` в противном случае.
    """
    ...
```

**Назначение**: Загрузка HTML-контента из указанного URL-адреса или файла.

**Параметры**:
- `url` (str): URL-адрес или путь к файлу, откуда необходимо загрузить HTML-контент.

**Возвращает**:
- `bool`: `True`, если контент успешно загружен и сохранен в атрибуте `html_content`, `False` в случае ошибки.

**Как работает функция**:
- Функция проверяет, начинается ли URL с `file://` или `https://`.
- Если URL начинается с `file://`, функция пытается прочитать HTML-контент из указанного локального файла.
- Если URL начинается с `https://`, функция отправляет HTTP-запрос для получения HTML-контента.
- В случае успеха HTML-контент сохраняется в атрибуте `html_content`.
- В случае возникновения исключений в процессе чтения файла или отправки HTTP-запроса, функция регистрирует ошибку с помощью `logger.error` и возвращает `False`.

**Примеры**:

```python
parser = BS()
result = parser.get_url('https://example.com')
print(result)  # Выведет True, если контент успешно загружен

result = parser.get_url('file:///path/to/local/file.html')
print(result)  # Выведет True, если контент успешно загружен
```

### `execute_locator`

```python
def execute_locator(self, locator: Union[SimpleNamespace, dict], url: Optional[str] = None) -> List[etree._Element]:
    """
    Выполняет XPath-локатор на HTML-контенте.

    Args:
        locator (Union[SimpleNamespace, dict]): Объект-локатор, содержащий селектор и атрибут.
        url (Optional[str], optional): URL-адрес или путь к файлу для получения HTML-контента. По умолчанию `None`.

    Returns:
        List[etree._Element]: Список элементов, соответствующих локатору.
    """
    ...
```

**Назначение**: Выполнение XPath-запроса к HTML-контенту и возвращение списка найденных элементов.

**Параметры**:
- `locator` (Union[SimpleNamespace, dict]): Объект, содержащий информацию о локаторе, такую как тип поиска (`by`), атрибут (`attribute`) и селектор (`selector`).
- `url` (Optional[str], optional): URL-адрес или путь к файлу, из которого необходимо загрузить HTML-контент, если он еще не был загружен. По умолчанию `None`.

**Возвращает**:
- `List[etree._Element]`: Список элементов, соответствующих заданному XPath-локатору.

**Как работает функция**:
1. Если предоставлен `url`, функция вызывает `self.get_url(url)` для загрузки HTML-контента.
2. Проверяет, был ли загружен HTML-контент. Если `self.html_content` пуст, функция регистрирует ошибку и возвращает пустой список.
3. Создает объект `BeautifulSoup` из HTML-контента, используя парсер `lxml`.
4. Преобразует объект `BeautifulSoup` в дерево `lxml` для поддержки XPath-запросов.
5. Если `locator` является словарем, он преобразуется в `SimpleNamespace` для упрощения доступа к атрибутам.
6. Извлекает атрибуты `attribute`, `by` и `selector` из объекта `locator`.
7. В зависимости от значения `by` (ID, CSS, TEXT или XPath), формируется и выполняется соответствующий XPath-запрос.
8. Возвращает список элементов, соответствующих XPath-запросу.

**Примеры**:

```python
parser = BS()
parser.get_url('https://example.com')
locator = SimpleNamespace(by='ID', attribute='element_id', selector='//*[@id="element_id"]')
elements = parser.execute_locator(locator)
print(elements)
```

## Примеры использования

В основном блоке `if __name__ == "__main__":` демонстрируется пример использования класса `BS`: создается экземпляр класса, загружается HTML-контент с URL-адреса и выполняется XPath-локатор для извлечения элементов.
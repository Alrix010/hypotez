# Модуль тестирования TinyPerson (`test_tinyperson.py`)

## Обзор

Модуль содержит набор юнит-тестов для проверки функциональности агентов `TinyPerson`, включая их способность действовать, слушать, определять параметры, социализироваться, видеть, думать, усваивать цели, перемещаться, менять контекст и сохранять/загружать спецификации.

## Подробней

Этот модуль использует библиотеку `pytest` для организации и выполнения тестов. Он проверяет различные аспекты поведения агентов, такие как взаимодействие с окружением, обновление внутреннего состояния и сохранение/восстановление конфигурации.

## Классы

### `TinyPerson`

**Описание**: Класс, представляющий собой агента, способного взаимодействовать с окружением и другими агентами.

**Методы**:
- `listen_and_act()`: Заставляет агента слушать и действовать на основе полученной информации.
- `listen()`: Обновляет текущие сообщения агента на основе входящего стимула.
- `define()`: Определяет значение в конфигурации агента и сбрасывает его prompt.
- `make_agent_accessible()`: Позволяет агенту взаимодействовать с другим агентом.
- `see()`: Обрабатывает визуальный стимул и заставляет агента действовать.
- `think()`: Заставляет агента думать о чем-либо и действовать на основе размышлений.
- `internalize_goal()`: Заставляет агента усвоить цель и действовать для ее достижения.
- `move_to()`: Изменяет местоположение агента и его контекст.
- `change_context()`: Изменяет контекст агента.
- `save_specification()`: Сохраняет спецификацию агента в файл.
- `load_specification()`: Загружает спецификацию агента из файла.

## Функции

### `test_act`

**Назначение**: Тест проверяет, что агент выполняет хотя бы одно действие (даже если это действие "DONE") после получения сообщения. Также проверяется, что среди действий есть действие "TALK", если агента попросили рассказать о своей жизни, и что последовательность действий завершается действием "DONE".

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента вызывается метод `listen_and_act()` с запросом "Tell me a bit about your life.".
- Полученные действия проверяются на наличие хотя бы одного действия, действия типа "TALK" и завершающего действия типа "DONE".
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_act(setup)
```

### `test_listen`

**Назначение**: Тест проверяет, что агент слушает речь и обновляет свои текущие сообщения.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента вызывается метод `listen()` с сообщением "Hello, how are you?".
- Проверяется, что у агента есть хотя бы одно сообщение в списке текущих сообщений.
- Проверяется, что последнее сообщение имеет роль "user", тип стимула "CONVERSATION" и правильное содержимое.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_listen(setup)
```

### `test_define`

**Назначение**: Тест проверяет, что агент определяет значение в своей конфигурации и сбрасывает свой prompt.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента сохраняется оригинальный prompt.
- Вызывается метод `define()` для установки значения "age" равным 25.
- Проверяется, что значение "age" установлено в конфигурации агента.
- Проверяется, что prompt агента изменился и содержит новое значение.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_define(setup)
```

### `test_define_several`

**Назначение**: Тест проверяет, что определение нескольких значений для группы работает как ожидается.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента вызывается метод `define()` для установки списка навыков "skills".
- Проверяется, что каждый навык присутствует в конфигурации агента.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_define_several(setup)
```

### `test_socialize`

**Назначение**: Тест проверяет, что социализация с другим агентом работает как ожидается.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция создает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента определяется другой агент, с которым он будет социализироваться.
- Вызывается метод `make_agent_accessible()` для установления отношения между агентами.
- Агент "слушает" сообщение от другого агента.
- Проверяется, что агент выполняет хотя бы одно действие, среди которых есть действие "TALK", содержащее имя другого агента.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_socialize(setup)
```

### `test_see`

**Назначение**: Тест проверяет, что агент "видит" визуальный стимул и реагирует на него.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента вызывается метод `see()` с описанием визуального стимула.
- Проверяется, что агент выполняет хотя бы одно действие, среди которых есть действие "THINK", содержащее описание стимула.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_see(setup)
```

### `test_think`

**Назначение**: Тест проверяет, что агент думает о чем-либо и реагирует на это.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента вызывается метод `think()` с описанием мысли.
- Проверяется, что агент выполняет хотя бы одно действие, среди которых есть действие "TALK", содержащее описание мысли.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_think(setup)
```

### `test_internalize_goal`

**Назначение**: Тест проверяет, что агент усваивает цель и действует для ее достижения.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента вызывается метод `internalize_goal()` с описанием цели.
- Проверяется, что агент выполняет хотя бы одно действие, среди которых есть действие "THINK", содержащее описание цели.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_internalize_goal(setup)
```

### `test_move_to`

**Назначение**: Тест проверяет, что агент перемещается в новое местоположение и изменяет свой контекст.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента вызывается метод `move_to()` с указанием нового местоположения и контекста.
- Проверяется, что местоположение и контекст агента были изменены.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_move_to(setup)
```

### `test_change_context`

**Назначение**: Тест проверяет, что агент изменяет свой контекст.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента вызывается метод `change_context()` с указанием нового контекста.
- Проверяется, что контекст агента был изменен.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_change_context(setup)
```

### `test_save_specification`

**Назначение**: Тест проверяет, что спецификация агента сохраняется в файл и может быть загружена обратно.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
- Для каждого агента вызывается метод `save_specification()` для сохранения спецификации в файл.
- Проверяется, что файл был создан.
- Загружается спецификация из файла и создается новый агент.
- Проверяется, что новый агент имеет ту же конфигурацию, что и оригинальный.
- В случае невыполнения одного из условий, тест завершается с ошибкой.

**Примеры**:
```python
test_save_specification(setup)
```

### `test_programmatic_definitions`

**Назначение**: Тест проверяет, что программные определения работают как ожидается.

**Параметры**:
- `setup`: Параметр, предоставляемый `pytest` для настройки тестовой среды.

**Возвращает**:
- `None`

**Как работает функция**:
- Функция перебирает двух агентов: `create_oscar_the_architect_2()` и `create_lisa_the_data_scientist_2()`.
- Для каждого агента вызывается метод `listen_and_act()` с запросом "Tell me a bit about your life.".

**Примеры**:
```python
test_programmatic_definitions(setup)
```
# Модуль для запуска WebView интерфейса g4f

## Обзор

Модуль `webview.py` предназначен для запуска графического интерфейса пользователя (GUI) для проекта `g4f` с использованием библиотеки `webview`. Он обеспечивает отображение веб-интерфейса в отдельном окне, позволяя пользователю взаимодействовать с функциональностью `g4f` через удобный интерфейс.

## Подробней

Модуль использует библиотеку `webview` для создания окон с веб-интерфейсом. Он определяет местоположение файлов интерфейса, настраивает параметры отображения и запускает основной цикл обработки событий. Также, модуль интегрируется с `JsApi` для обеспечения взаимодействия между веб-интерфейсом и Python-кодом.

## Функции

### `run_webview`

```python
def run_webview(
    debug: bool = False,
    http_port: int = None,
    ssl: bool = True,
    storage_path: str = None,
    gui: str = None
):
    """ Запускает WebView интерфейс для g4f.

    Args:
        debug (bool, optional): Включает режим отладки. По умолчанию `False`.
        http_port (int, optional): HTTP порт для WebView. По умолчанию `None`.
        ssl (bool, optional): Использовать SSL. По умолчанию `True`.
        storage_path (str, optional): Путь для хранения данных WebView. По умолчанию `None`.
        gui (str, optional):  Не используется. По умолчанию `None`.

    Raises:
        ImportError: Если библиотека `platformdirs` не установлена и `storage_path` не указан.

    Как работает функция:
    - Определяет, запущено ли приложение как "frozen" (например, как исполняемый файл). Если да, определяет путь к ресурсам на основе `sys._MEIPASS`, иначе использует путь к текущему файлу.
    - Настраивает параметры библиотеки `webview`, включая разрешение открытия внешних ссылок в браузере и разрешение загрузок.
    - Создает окно WebView с указанным заголовком и загружает `index.html` в качестве содержимого.
    - Если `storage_path` не указан и библиотека `platformdirs` доступна, пытается определить путь для хранения данных конфигурации, используя `user_config_dir`.
    - Запускает основной цикл WebView с указанными параметрами, такими как режим отладки, путь для хранения данных и параметры HTTP.
    """
```

### Внутренние функции:
Внутри функции `run_webview` нет внутренних функций.

**Примеры**:

```python
run_webview(debug=True, http_port=8080, ssl=False, storage_path='/tmp/g4f-webview')
```

## Параметры функции `run_webview`

- `debug` (bool): Включает или отключает режим отладки для WebView.
- `http_port` (int): Указывает HTTP порт для WebView. Если не указан, используется порт по умолчанию.
- `ssl` (bool): Определяет, использовать ли SSL для WebView.
- `storage_path` (str): Задает путь для хранения данных WebView, таких как cookies и кэш.
- `gui` (str):  Не используется.

## Запуск модуля как основной программы

```python
if __name__ == "__main__":
    parser = gui_parser()
    args = parser.parse_args()
    if args.debug:
        g4f.debug.logging = True
    run_webview(args.debug, args.port, not args.debug)
```

**Описание**:

Данный блок кода запускается только в том случае, если скрипт выполняется как основная программа (а не импортируется как модуль). Он выполняет следующие действия:

1.  **Создание парсера аргументов командной строки**:
    *   Использует функцию `gui_parser()` для создания парсера аргументов командной строки.

2.  **Разбор аргументов командной строки**:
    *   Вызывает метод `parse_args()` у парсера для разбора аргументов, переданных при запуске скрипта. Результат сохраняется в переменной `args`.

3.  **Включение отладочного логирования**:
    *   Проверяет, установлен ли флаг `debug` в аргументах командной строки (`args.debug`).
    *   Если флаг установлен, включает отладочное логирование, устанавливая `g4f.debug.logging = True`.

4.  **Запуск WebView**:

    *   Вызывает функцию `run_webview()` с параметрами, полученными из аргументов командной строки:
        *   `args.debug`: Передает значение флага `debug` для включения/выключения режима отладки.
        *   `args.port`: Передает значение порта, указанного в аргументах командной строки.
        *   `not args.debug`: Передает инвертированное значение флага `debug` для параметра `ssl` (если режим отладки включен, SSL отключается).

### Как работает
1.  **Разбор аргументов командной строки**:
    *   Использует парсер аргументов командной строки, чтобы получить значения параметров, переданных при запуске скрипта.
2.  **Включение отладочного логирования**:
    *   Если указан флаг `--debug`, включает отладочное логирование.
3.  **Запуск WebView**:
    *   Вызывает функцию `run_webview()` с параметрами, полученными из аргументов командной строки, для запуска графического интерфейса пользователя.

### Пример

Для запуска скрипта с включенным режимом отладки и указанным портом:

```bash
python webview.py --debug --port 8080
```

## Зависимости

Модуль зависит от следующих библиотек:

-   `sys`
-   `os.path`
-   `webview`
-   `platformdirs` (опционально)
-   `g4f.gui.gui_parser`
-   `g4f.gui.server.js_api`
-   `g4f.version`
-   `g4f.debug`
# Модуль types

## Обзор

Модуль `types` содержит определения типов, используемые в клиенте `gpt4free` для работы с провайдерами, прокси и потоками данных. Он определяет типы для работы с изображениями, прокси, итераторами и асинхронными итераторами, а также содержит класс `Client` для инициализации клиента с API-ключом и прокси.

## Подробней

Этот модуль предоставляет типы и класс `Client`, необходимые для взаимодействия с различными API, используя прокси и обеспечивая типизацию данных для корректной обработки запросов и ответов. Он включает поддержку итераторов и асинхронных итераторов для обработки чанков данных.

## Классы

### `Client`

**Описание**: Класс `Client` используется для инициализации клиента с API-ключом и прокси.

**Атрибуты**:
- `api_key` (str): API-ключ для аутентификации.
- `proxies` (Proxies): Прокси для использования при подключении к API.
- `proxy` (str | None): Строка прокси, полученная из `proxies` или переменной окружения.

**Методы**:
- `get_proxy()`: Получает прокси из различных источников (строка прокси, словарь прокси, переменная окружения).

#### Принцип работы:

Класс `Client` предназначен для настройки соединения с API, используя предоставленные API-ключ и прокси. Он инициализируется с API-ключом и прокси, а также предоставляет метод `get_proxy` для определения, какой прокси использовать на основе предоставленных настроек или переменных окружения.

## Методы класса

### `__init__`

```python
def __init__(
    self,
    api_key: str = None,
    proxies: Proxies = None,
    **kwargs
) -> None:
    """Инициализирует экземпляр класса Client.

    Args:
        api_key (str, optional): API-ключ для аутентификации. По умолчанию None.
        proxies (Proxies, optional): Прокси для использования при подключении к API. Может быть словарем или строкой. По умолчанию None.
        **kwargs: Дополнительные параметры.

    Returns:
        None

    """
```

**Назначение**: Инициализирует экземпляр класса `Client`.

**Параметры**:
- `api_key` (str, optional): API-ключ для аутентификации. По умолчанию `None`.
- `proxies` (Proxies, optional): Прокси для использования при подключении к API. Может быть словарем или строкой. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `None`

**Как работает функция**:

Функция `__init__` инициализирует класс `Client`, сохраняя предоставленные API-ключ и прокси в атрибутах экземпляра. Затем она вызывает метод `self.get_proxy()` для определения, какой прокси будет использоваться.

**Примеры**:

```python
client = Client(api_key='ключ123', proxies={'https': 'http://proxy.com'})
client = Client(api_key='ключ456', proxies='http://proxy.com')
client = Client(api_key='ключ789')
```

### `get_proxy`

```python
def get_proxy(self) -> Union[str, None]:
    """Получает прокси из различных источников.

    Args:
        None

    Returns:
        Union[str, None]: Строка прокси или None, если прокси не найден.

    """
```

**Назначение**: Получает прокси из различных источников: из атрибута `proxies`, переменной окружения `G4F_PROXY`.

**Параметры**:
- `None`

**Возвращает**:
- `Union[str, None]`: Строка прокси или `None`, если прокси не найден.

**Как работает функция**:

Метод `get_proxy` проверяет, какой прокси следует использовать. Если `self.proxies` является строкой, она возвращается. Если `self.proxies` является `None`, то метод пытается получить прокси из переменной окружения `G4F_PROXY`. Если `self.proxies` является словарем, метод проверяет наличие ключей `"all"` или `"https"` и возвращает соответствующее значение. Если прокси не найден, возвращается `None`.

**Примеры**:

```python
import os
os.environ["G4F_PROXY"] = "http://env_proxy.com"

client1 = Client(proxies='http://string_proxy.com')
print(client1.get_proxy())  # Вывод: http://string_proxy.com

client2 = Client()
print(client2.get_proxy())  # Вывод: http://env_proxy.com

client3 = Client(proxies={'https': 'http://dict_proxy.com'})
print(client3.get_proxy())  # Вывод: http://dict_proxy.com

client4 = Client(proxies={'all': 'http://all_proxy.com'})
print(client4.get_proxy())  # Вывод: http://all_proxy.com

client5 = Client()
del os.environ["G4F_PROXY"]
print(client5.get_proxy())  # Вывод: None
```

## Параметры класса

- `api_key` (str): API-ключ, используемый для аутентификации при подключении к API.
- `proxies` (Proxies): Прокси, используемый для подключения к API. Может быть строкой или словарем.
- `proxy` (str | None): Фактически используемая строка прокси, полученная из `proxies` или переменной окружения.

## Переменные модуля

- `ImageProvider` (Union[BaseProvider, object]): Тип, представляющий провайдера изображений, может быть экземпляром `BaseProvider` или объектом.
- `Proxies` (Union[dict, str]): Тип, представляющий прокси, может быть словарем или строкой.
- `IterResponse` (Iterator[Union[ChatCompletion, ChatCompletionChunk]]): Тип для итератора ответов чата, содержащий `ChatCompletion` или `ChatCompletionChunk`.
- `AsyncIterResponse` (AsyncIterator[Union[ChatCompletion, ChatCompletionChunk]]): Тип для асинхронного итератора ответов чата, содержащий `ChatCompletion` или `ChatCompletionChunk`.
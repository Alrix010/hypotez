# Модуль crypto.py

## Обзор

Модуль `crypto.py` содержит функции для выполнения криптографических операций, таких как шифрование и дешифрование с использованием AES, хеширование строк и подготовка ключей. Эти функции используются для защиты данных в mega.

## Подробней

Модуль предоставляет набор криптографических функций, необходимых для безопасной работы с данными. Здесь реализованы функции шифрования и дешифрования AES в режиме CBC, хеширования строк, подготовки ключей, а также шифрования и дешифрования атрибутов. Эти функции обеспечивают конфиденциальность и целостность данных, передаваемых и хранящихся в системе.

## Функции

### `aes_cbc_encrypt`

```python
def aes_cbc_encrypt(data, key):
    """
    Шифрует данные с использованием алгоритма AES в режиме CBC.

    Args:
        data (bytes): Данные для шифрования.
        key (bytes): Ключ шифрования.

    Returns:
        bytes: Зашифрованные данные.
    """
    ...
```

**Назначение**: Шифрование данных с использованием алгоритма AES в режиме CBC.

**Параметры**:
- `data` (bytes): Данные для шифрования.
- `key` (bytes): Ключ шифрования.

**Возвращает**:
- `bytes`: Зашифрованные данные.

**Как работает функция**:
Функция инициализирует объект шифрования AES с использованием предоставленного ключа и режима CBC. Затем она шифрует предоставленные данные и возвращает зашифрованный результат.

**Примеры**:
```python
key = b'\\x00' * 16
data = b'This is a test'
encrypted_data = aes_cbc_encrypt(data, key)
print(encrypted_data)
```

### `aes_cbc_decrypt`

```python
def aes_cbc_decrypt(data, key):
    """
    Дешифрует данные, зашифрованные алгоритмом AES в режиме CBC.

    Args:
        data (bytes): Зашифрованные данные.
        key (bytes): Ключ дешифрования.

    Returns:
        bytes: Дешифрованные данные.
    """
    ...
```

**Назначение**: Дешифрование данных, зашифрованных алгоритмом AES в режиме CBC.

**Параметры**:
- `data` (bytes): Зашифрованные данные.
- `key` (bytes): Ключ дешифрования.

**Возвращает**:
- `bytes`: Дешифрованные данные.

**Как работает функция**:
Функция инициализирует объект дешифрования AES с использованием предоставленного ключа и режима CBC. Затем она дешифрует предоставленные данные и возвращает дешифрованный результат.

**Примеры**:
```python
key = b'\\x00' * 16
encrypted_data = b'\\xf3Y\\xbf\\x16\\xb1\\xbb\\xbb\\x9f\\xc1\\xcb\\xb7\\x8d\\xbb\\x8e*\\xa7'
decrypted_data = aes_cbc_decrypt(encrypted_data, key)
print(decrypted_data)
```

### `aes_cbc_encrypt_a32`

```python
def aes_cbc_encrypt_a32(data, key):
    """
    Шифрует данные (представленные в формате a32) с использованием алгоритма AES в режиме CBC.

    Args:
        data (list[int]): Данные для шифрования в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        list[int]: Зашифрованные данные в формате a32.
    """
    ...
```

**Назначение**: Шифрование данных (представленных в формате a32) с использованием алгоритма AES в режиме CBC.

**Параметры**:
- `data` (list[int]): Данные для шифрования в формате a32.
- `key` (list[int]): Ключ шифрования в формате a32.

**Возвращает**:
- `list[int]`: Зашифрованные данные в формате a32.

**Как работает функция**:
Функция преобразует данные и ключ из формата a32 в строковый формат, шифрует данные с использованием `aes_cbc_encrypt`, а затем преобразует зашифрованный результат обратно в формат a32.

**Примеры**:
```python
data = [1, 2, 3, 4]
key = [5, 6, 7, 8]
encrypted_data = aes_cbc_encrypt_a32(data, key)
print(encrypted_data)
```

### `aes_cbc_decrypt_a32`

```python
def aes_cbc_decrypt_a32(data, key):
    """
    Дешифрует данные (представленные в формате a32), зашифрованные алгоритмом AES в режиме CBC.

    Args:
        data (list[int]): Зашифрованные данные в формате a32.
        key (list[int]): Ключ дешифрования в формате a32.

    Returns:
        list[int]: Дешифрованные данные в формате a32.
    """
    ...
```

**Назначение**: Дешифрование данных (представленных в формате a32), зашифрованных алгоритмом AES в режиме CBC.

**Параметры**:
- `data` (list[int]): Зашифрованные данные в формате a32.
- `key` (list[int]): Ключ дешифрования в формате a32.

**Возвращает**:
- `list[int]`: Дешифрованные данные в формате a32.

**Как работает функция**:
Функция преобразует данные и ключ из формата a32 в строковый формат, дешифрует данные с использованием `aes_cbc_decrypt`, а затем преобразует дешифрованный результат обратно в формат a32.

**Примеры**:
```python
data = [1, 2, 3, 4]
key = [5, 6, 7, 8]
decrypted_data = aes_cbc_decrypt_a32(data, key)
print(decrypted_data)
```

### `stringhash`

```python
def stringhash(s, aeskey):
    """
    Вычисляет хеш строки с использованием AES-шифрования.

    Args:
        s (str): Строка для хеширования.
        aeskey (list[int]): Ключ AES в формате a32.

    Returns:
        str: Хеш строки в формате base64.
    """
    ...
```

**Назначение**: Вычисление хеша строки с использованием AES-шифрования.

**Параметры**:
- `s` (str): Строка для хеширования.
- `aeskey` (list[int]): Ключ AES в формате a32.

**Возвращает**:
- `str`: Хеш строки в формате base64.

**Как работает функция**:
Функция преобразует строку в формат a32, инициализирует хеш-значение, выполняет XOR-операцию между частями строки и хеш-значением, затем выполняет несколько раундов шифрования AES и, наконец, преобразует хеш-значение в формат base64.

**Примеры**:
```python
s = 'example'
aeskey = [1, 2, 3, 4]
hash_value = stringhash(s, aeskey)
print(hash_value)
```

### `prepare_key`

```python
def prepare_key(a):
    """
    Подготавливает ключ для шифрования.

    Args:
        a (list[int]): Исходный ключ в формате a32.

    Returns:
        list[int]: Подготовленный ключ в формате a32.
    """
    ...
```

**Назначение**: Подготовка ключа для шифрования.

**Параметры**:
- `a` (list[int]): Исходный ключ в формате a32.

**Возвращает**:
- `list[int]`: Подготовленный ключ в формате a32.

**Как работает функция**:
Функция инициализирует предварительный ключ, выполняет несколько раундов шифрования AES, используя части исходного ключа, и возвращает подготовленный ключ.

**Примеры**:
```python
a = [1, 2, 3, 4, 5, 6, 7, 8]
prepared_key = prepare_key(a)
print(prepared_key)
```

### `encrypt_key`

```python
def encrypt_key(a, key):
    """
    Шифрует ключ с использованием AES.

    Args:
        a (list[int]): Ключ для шифрования в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        list[int]: Зашифрованный ключ в формате a32.
    """
    ...
```

**Назначение**: Шифрование ключа с использованием AES.

**Параметры**:
- `a` (list[int]): Ключ для шифрования в формате a32.
- `key` (list[int]): Ключ шифрования в формате a32.

**Возвращает**:
- `list[int]`: Зашифрованный ключ в формате a32.

**Как работает функция**:
Функция разделяет ключ на блоки по 4 элемента и шифрует каждый блок с использованием `aes_cbc_encrypt_a32`.

**Примеры**:
```python
a = [1, 2, 3, 4, 5, 6, 7, 8]
key = [9, 10, 11, 12]
encrypted_key = encrypt_key(a, key)
print(encrypted_key)
```

### `decrypt_key`

```python
def decrypt_key(a, key):
    """
    Дешифрует ключ, зашифрованный с использованием AES.

    Args:
        a (list[int]): Зашифрованный ключ в формате a32.
        key (list[int]): Ключ дешифрования в формате a32.

    Returns:
        list[int]: Дешифрованный ключ в формате a32.
    """
    ...
```

**Назначение**: Дешифрование ключа, зашифрованного с использованием AES.

**Параметры**:
- `a` (list[int]): Зашифрованный ключ в формате a32.
- `key` (list[int]): Ключ дешифрования в формате a32.

**Возвращает**:
- `list[int]`: Дешифрованный ключ в формате a32.

**Как работает функция**:
Функция разделяет зашифрованный ключ на блоки по 4 элемента и дешифрует каждый блок с использованием `aes_cbc_decrypt_a32`.

**Примеры**:
```python
a = [1, 2, 3, 4, 5, 6, 7, 8]
key = [9, 10, 11, 12]
decrypted_key = decrypt_key(a, key)
print(decrypted_key)
```

### `enc_attr`

```python
def enc_attr(attr, key):
    """
    Шифрует атрибуты с использованием AES.

    Args:
        attr (dict): Атрибуты для шифрования.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        bytes: Зашифрованные атрибуты.
    """
    ...
```

**Назначение**: Шифрование атрибутов с использованием AES.

**Параметры**:
- `attr` (dict): Атрибуты для шифрования.
- `key` (list[int]): Ключ шифрования в формате a32.

**Возвращает**:
- `bytes`: Зашифрованные атрибуты.

**Как работает функция**:
Функция преобразует атрибуты в JSON-строку, добавляет префикс 'MEGA', дополняет строку нулями до кратной длины 16 байт и шифрует результат с использованием `aes_cbc_encrypt`.

**Примеры**:
```python
attr = {'name': 'example', 'size': 1024}
key = [1, 2, 3, 4]
encrypted_attr = enc_attr(attr, key)
print(encrypted_attr)
```

### `dec_attr`

```python
def dec_attr(attr, key):
    """
    Дешифрует атрибуты, зашифрованные с использованием AES.

    Args:
        attr (bytes): Зашифрованные атрибуты.
        key (list[int]): Ключ дешифрования в формате a32.

    Returns:
        dict: Дешифрованные атрибуты.
    """
    ...
```

**Назначение**: Дешифрование атрибутов, зашифрованных с использованием AES.

**Параметры**:
- `attr` (bytes): Зашифрованные атрибуты.
- `key` (list[int]): Ключ дешифрования в формате a32.

**Возвращает**:
- `dict`: Дешифрованные атрибуты.

**Как работает функция**:
Функция дешифрует атрибуты с использованием `aes_cbc_decrypt`, удаляет префикс 'MEGA' и возвращает словарь атрибутов.

**Примеры**:
```python
attr = b'U\\xb7\\xa6\\xb6\\xbb\\x9b\\xbb\\x11\\x12\\x8b\\xde\\xb0M\\xbb`\\x8f'
key = [1, 2, 3, 4]
decrypted_attr = dec_attr(attr, key)
print(decrypted_attr)
```
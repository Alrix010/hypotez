# Модуль для выполнения API-запросов к AliExpress

## Обзор

Модуль `requests.py` предоставляет функцию `api_request` для отправки запросов к API AliExpress и обработки ответов. Он включает обработку ошибок, логирование и преобразование JSON-ответов в объекты `SimpleNamespace` для упрощения доступа к данным.

## Подробней

Этот модуль разработан для выполнения запросов к API AliExpress, обработки возможных ошибок и преобразования полученных ответов в удобный формат. Функция `api_request` принимает объект запроса, имя ожидаемого ответа и количество попыток выполнения запроса. В случае успеха возвращает результат запроса, в противном случае логирует ошибки и возвращает `None`.

## Функции

### `api_request`

```python
def api_request(request, response_name, attemps:int = 1):
    """Выполняет API-запрос, обрабатывает ответ и возвращает результат.

    Args:
        request: Объект запроса, содержащий метод `getResponse` для выполнения запроса.
        response_name (str): Ключ для извлечения данных из ответа.
        attemps (int, optional): Количество попыток выполнения запроса. По умолчанию равен 1.

    Returns:
        SimpleNamespace | None: Результат запроса в виде объекта SimpleNamespace, или None в случае ошибки.

    Raises:
        ApiRequestException: Если во время выполнения запроса происходит исключение.
        ApiRequestResponseException: Если ответ API содержит ошибку.

    Принцип работы:
    - Пытается выполнить запрос с помощью метода `getResponse` объекта `request`.
    - В случае возникновения исключения во время выполнения запроса, перехватывает исключение, логирует ошибку и возвращает `None`.
    - После успешного выполнения запроса пытается извлечь данные из ответа, используя предоставленное имя `response_name`.
    - Преобразует JSON-ответ в объект `SimpleNamespace` для упрощения доступа к данным через атрибуты.
    - Если код ответа `resp_code` равен 200, возвращает результат `response.result`.
    - В противном случае логирует предупреждение с кодом и сообщением ответа и возвращает `None`.
    - В случае возникновения каких-либо исключений при обработке ответа, перехватывает исключение, логирует ошибку и возвращает `None`.
    """
    ...

    ```

**Параметры**:

*   `request`: Объект запроса, содержащий метод `getResponse` для выполнения запроса.
*   `response_name` (str): Ключ для извлечения данных из ответа.
*   `attemps` (int, optional): Количество попыток выполнения запроса. По умолчанию равен 1.

**Возвращает**:

*   `SimpleNamespace | None`: Результат запроса в виде объекта `SimpleNamespace`, или `None` в случае ошибки.

**Вызывает исключения**:

*   `ApiRequestException`: Если во время выполнения запроса происходит исключение.
*   `ApiRequestResponseException`: Если ответ API содержит ошибку.

**Примеры**:

```python
# Пример использования функции api_request
# Допустим, у нас есть объект request и имя ответа 'item_list'
# result = api_request(request, 'item_list')
# if result:
#     print(result.items)
# else:
#     print("Ошибка при выполнении запроса")
```
```python
# Еще один пример, когда нужно указать количество попыток
# result = api_request(request, 'item_list', attemps=3)
# if result:
#     print(result.items)
# else:
#     print("Ошибка при выполнении запроса")
```
```python
# Если api возвращает ошибку
# В этом случае будет залогировано предупреждение и функция вернет None
# result = api_request(request, 'item_list')
# if result is None:
#    logger.info("Запрос не удался, проверяем логи")
```
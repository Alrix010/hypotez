# Модуль для работы с прокси

## Обзор

Модуль определяет функции для загрузки, парсинга и проверки списка прокси-серверов. Он загружает текстовый файл со списком прокси-адресов из указанного URL и распределяет их по категориям (http, socks4, socks5). Также предоставляет функцию для проверки работоспособности каждого прокси-сервера.

## Подробнее

Этот модуль предназначен для автоматической загрузки и управления списком прокси-серверов, которые могут быть использованы для обхода ограничений доступа или обеспечения анонимности в сети. Он включает в себя функции для загрузки списка прокси, его парсинга и проверки доступности каждого прокси-сервера.
Анализируя предоставленный код, можно понять, что он выполняет следующие шаги:

1.  Загружает список прокси-серверов из указанного URL-адреса.
2.  Сохраняет список прокси-серверов в локальный файл.
3.  Парсит локальный файл, извлекая информацию о прокси-серверах (протокол, хост, порт).
4.  Разделяет прокси-серверы по категориям (http, socks4, socks5).
5.  Проверяет работоспособность каждого прокси-сервера, отправляя тестовый запрос.

## Функции

### `download_proxies_list`

```python
def download_proxies_list(url: str = url, save_path: Path = proxies_list_path) -> bool:
    """
    Загружает файл по указанному URL и сохраняет его в заданный путь.

    Args:
        url (str): URL файла для загрузки. По умолчанию используется глобальная переменная `url`.
        save_path (Path): Путь для сохранения загруженного файла. По умолчанию используется глобальная переменная `proxies_list_path`.

    Returns:
        bool: `True`, если файл успешно загружен и сохранен, `False` в случае ошибки.

    Raises:
        Exception: В случае возникновения ошибки при загрузке файла.

    """
    ...
```

**Назначение**: Загружает файл со списком прокси-серверов по указанному URL и сохраняет его в локальный файл.

**Параметры**:

*   `url` (str): URL файла для загрузки. По умолчанию используется глобальная переменная `url`.
*   `save_path` (Path): Путь для сохранения загруженного файла. По умолчанию используется глобальная переменная `proxies_list_path`.

**Возвращает**:

*   `bool`: `True`, если файл успешно загружен и сохранен, `False` в случае ошибки.

**Вызывает исключения**:

*   `Exception`: В случае возникновения ошибки при загрузке файла.

**Как работает функция**:

1.  Отправляет GET-запрос по указанному URL для загрузки файла.
2.  Проверяет статус ответа, чтобы убедиться, что запрос выполнен успешно.
3.  Сохраняет содержимое ответа в локальный файл по указанному пути.
4.  Логирует информацию об успешной загрузке или ошибке.

**Примеры**:

```python
from pathlib import Path
from src.webdriver.proxy import download_proxies_list

# Пример использования с параметрами по умолчанию
success = download_proxies_list()
print(f"Загрузка выполнена успешно: {success}")

# Пример использования с указанием URL и пути сохранения
url = "https://raw.githubusercontent.com/proxifly/free-proxy-list/main/proxies/all/data.txt"
save_path = Path("./proxies.txt")
success = download_proxies_list(url=url, save_path=save_path)
print(f"Загрузка выполнена успешно: {success}")
```

### `get_proxies_dict`

```python
def get_proxies_dict(file_path: Path = proxies_list_path) -> Dict[str, List[Dict[str, Any]]]:
    """
    Парсит файл с прокси-адресами и распределяет их по категориям.

    Args:
        file_path (Path): Путь к файлу с прокси. По умолчанию используется глобальная переменная `proxies_list_path`.

    Returns:
        Dict[str, List[Dict[str, Any]]]: Словарь с распределёнными по типам прокси.
            Ключи словаря: 'http', 'socks4', 'socks5'.
            Значения словаря: списки словарей с информацией о прокси (protocol, host, port).

    Raises:
        FileNotFoundError: Если файл с прокси не найден.
        Exception: В случае возникновения ошибки при парсинге прокси.

    """
    ...
```

**Назначение**: Парсит файл с прокси-адресами и распределяет их по категориям (http, socks4, socks5).

**Параметры**:

*   `file_path` (Path): Путь к файлу с прокси. По умолчанию используется глобальная переменная `proxies_list_path`.

**Возвращает**:

*   `Dict[str, List[Dict[str, Any]]]`: Словарь с распределёнными по типам прокси. Ключи словаря: 'http', 'socks4', 'socks5'. Значения словаря: списки словарей с информацией о прокси (protocol, host, port).

**Вызывает исключения**:

*   `FileNotFoundError`: Если файл с прокси не найден.
*   `Exception`: В случае возникновения ошибки при парсинге прокси.

**Как работает функция**:

1.  Вызывает функцию `download_proxies_list` для загрузки списка прокси-серверов (если он еще не загружен).
2.  Инициализирует словарь для хранения прокси-серверов, сгруппированных по протоколам (http, socks4, socks5).
3.  Открывает файл с прокси-серверами и читает его построчно.
4.  Для каждой строки пытается извлечь информацию о протоколе, хосте и порте, используя регулярное выражение.
5.  Если строка соответствует формату прокси-сервера, добавляет информацию о нем в соответствующий список в словаре.
6.  Возвращает словарь с распределенными прокси-серверами.
7.  Логирует информацию об ошибках, если они возникают.

**Примеры**:

```python
from pathlib import Path
from src.webdriver.proxy import get_proxies_dict

# Пример использования с параметрами по умолчанию
proxies = get_proxies_dict()
print(proxies)

# Пример использования с указанием пути к файлу
file_path = Path("./proxies.txt")
proxies = get_proxies_dict(file_path=file_path)
print(proxies)
```

### `check_proxy`

```python
def check_proxy(proxy: dict) -> bool:
    """
    Проверяет работоспособность прокси-сервера.

    Args:
        proxy (dict): Словарь с данными прокси (host, port, protocol).

    Returns:
        bool: True, если прокси работает, иначе False.

    Raises:
        ProxyError: Если возникает ошибка, связанная с прокси-сервером.
        RequestException: Если возникает ошибка при выполнении запроса.

    """
    ...
```

**Назначение**: Проверяет работоспособность прокси-сервера, отправляя тестовый запрос через него.

**Параметры**:

*   `proxy` (dict): Словарь с данными прокси (host, port, protocol).

**Возвращает**:

*   `bool`: `True`, если прокси работает, иначе `False`.

**Вызывает исключения**:

*   `ProxyError`: Если возникает ошибка, связанная с прокси-сервером.
*   `RequestException`: Если возникает ошибка при выполнении запроса.

**Как работает функция**:

1.  Формирует URL для тестового запроса (https://httpbin.org/ip).
2.  Формирует словарь с настройками прокси для библиотеки `requests`.
3.  Отправляет GET-запрос через указанный прокси-сервер с таймаутом 5 секунд.
4.  Проверяет статус ответа. Если статус равен 200, считает, что прокси-сервер работает.
5.  Логирует информацию о результате проверки.
6.  Возвращает `True`, если прокси-сервер работает, и `False` в противном случае.
7.  Обрабатывает исключения, которые могут возникнуть при подключении к прокси-серверу или выполнении запроса.

**Примеры**:

```python
from src.webdriver.proxy import check_proxy

# Пример использования
proxy = {'protocol': 'http', 'host': '127.0.0.1', 'port': '8080'}
is_working = check_proxy(proxy)
print(f"Прокси {proxy['host']}:{proxy['port']} работает: {is_working}")
```
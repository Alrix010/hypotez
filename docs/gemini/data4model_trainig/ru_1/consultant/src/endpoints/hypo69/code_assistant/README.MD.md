### **Анализ кода модуля `code_assistant`**

---

#### **Качество кода**:
- **Соответствие стандартам**: 7/10
- **Плюсы**:
  - Документ хорошо структурирован и предоставляет подробное описание модуля `code_assistant`.
  - Описаны основные компоненты и их функции.
  - Приведены примеры использования и командной строки.
- **Минусы**:
  - Форматирование документа не соответствует стандарту оформления кода в проекте. Используются большие и маленькие буквы, что не соответствует общепринятому стилю.
  - Не все части документа переведены на русский язык.
  - Встречаются элементы форматирования, которые не соответствуют Markdown (например, `<TABLE>`, `<TR>`, `<TD>`).
  - Отсутствует единообразие в использовании ссылок на файлы.

#### **Рекомендации по улучшению**:
1.  **Перевод на русский язык**:
    *   Полностью перевести все разделы и подразделы на русский язык.
2.  **Форматирование Markdown**:
    *   Заменить элементы HTML-таблиц (`<TABLE>`, `<TR>`, `<TD>`) на стандартные таблицы Markdown.
    *   Устранить несоответствия в использовании больших и маленьких букв в заголовках и тексте.
3.  **Улучшение структуры**:
    *   Пересмотреть структуру документа для улучшения читаемости.
    *   Убедиться, что все разделы логически связаны и не содержат избыточной информации.
4.  **Улучшение примеров кода**:
    *   Проверить примеры кода на соответствие синтаксису Python.
    *   Добавить комментарии к примерам кода для лучшего понимания.
5.  **Актуализация информации**:
    *   Проверить, что вся информация в `README.md` актуальна и соответствует текущей версии модуля `code_assistant`.
6.  **Использование ссылок**:
    *   Унифицировать стиль ссылок на файлы в репозитории.
7.  **Документация исключений**:
    *   Уточнить информацию о настройке исключений для файлов и каталогов, добавив конкретные примеры.
8.  **Зависимости**:
    *   Подробно описать, как устанавливать и настраивать зависимости (Gemini API, OpenAI API).

#### **Оптимизированный код**:

```markdown
### Анализ кода модуля `code_assistant`

=================================================

Модуль `code_assistant` представляет собой набор инструментов для взаимодействия с моделями Gemini и OpenAI с целью обработки исходного кода проекта. Он выполняет такие задачи, как генерация документации, проверка кода и создание тестов на основе указанных файлов. Кроме того, модуль включает скрипты для создания файла `SUMMARY.md` для компиляции документации и Telegram-бота для обработки задач, связанных с кодом.

Пример использования
----------------------

```bash
python code_assistant.py --settings settings.json
```

---

#### **Основные компоненты**:

*   `code_assistant.py`:
    *   Чтение кода из файлов `.py` и `README.MD` в указанных директориях.
    *   Взаимодействие с моделями для выполнения задач, таких как генерация документации или проверка ошибок.
    *   Сохранение ответов моделей в указанных директориях для каждой роли.
*   `make_summary.py`:
    *   Рекурсивный обход директории для создания файла `SUMMARY.md` для компиляции документации.
    *   Фильтрация файлов по языку (`ru` или `en`).
*   `onela_bot.py` и `bot_handlers.py`:
    *   Telegram-бот для обработки задач, связанных с кодом, таких как отправка фрагментов кода на проверку или генерация документации.
    *   Обработчики для обработки команд и сообщений бота.

#### **Структура проекта**:

*   Модели: Используются модели Gemini и OpenAI для обработки запросов.
*   Промпты: Чтение промптов из файлов в `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
*   Файлы: Обработка файлов `.py` и `README.MD` в указанных директориях.

#### **Примеры использования**:

*   Запуск с использованием JSON-файла настроек:

    ```bash
    python code_assistant.py --settings settings.json
    ```

*   Запуск с явными параметрами:

    ```bash
    python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2
    ```

*   Пример для роли `code_checker`:

    ```bash
    python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir
    ```

*   Пример для модели `openai`:

    ```bash
    python code_assistant.py --role doc_writer --lang en --models openai
    ```

#### **Параметры командной строки**:

*   `--settings`: Путь к JSON-файлу с настройками. Загружает параметры из файла.
*   `--role`: Роль модели для задачи (например, `doc_writer`, `code_checker`).
*   `--lang`: Язык для задачи (например, `ru` или `en`).
*   `--models`: Список моделей для инициализации (например, `gemini`, `openai`).
*   `--start_dirs`: Список директорий для обработки (например, `/path/to/dir1`).

#### **Схема работы**:

1.  Поиск файлов `.py` и `README.MD` в указанных директориях.
2.  Загрузка промптов, специфичных для роли, из `src/ai/prompts/developer/`.
3.  Формирование запросов на основе загруженных файлов и отправка их моделям.
4.  Сохранение ответов моделей в директориях, соответствующих роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

#### **Исключения**:

Настройка исключений для файлов и директорий с использованием параметров:

*   `exclude_file_patterns`: Список regex-шаблонов для исключения файлов.
*   `exclude_dirs`: Список директорий для исключения.
*   `exclude_files`: Список файлов для исключения.

#### **Логирование**:

Логи сохраняются с использованием библиотеки `logger` и содержат информацию об обработке файлов и ответах моделей.

#### **Зависимости**:

*   **Gemini API**: Требуется API-ключ для модели Gemini.
    *   Укажите, как получить и настроить API-ключ.
*   **OpenAI API**: Требуется API-ключ для модели OpenAI.
    *   Укажите, как получить и настроить API-ключ.

#### **Создание новой роли для AI-моделей**:

1.  **Обновление `code_assistant.json`**:

    *   Добавьте новую роль в список ролей:

        ```json
        "roles": [
          "code_checker",
          ...
        ]
        ```

    *   Или исключите её в `"exclude-roles"`.

2.  **Добавление роли в переводы**:

    *   Обновите файл `translations/translations.json` с новой ролью.

3.  **Создание системного промпта**:

    *   Добавьте новый системный промпт в `ai/prompts/developer/`.

4.  **Создание инструкции команды**:

    *   Добавьте новую инструкцию команды в `instructions/`.
```
# Модуль для поиска свободного порта

## Обзор

Модуль предназначен для поиска свободного порта на указанном хосте. Он предоставляет функцию `get_free_port`, которая может искать порт в заданном диапазоне или найти первый доступный порт, если диапазон не указан.

## Подробнее

Этот модуль предоставляет удобный способ найти свободный порт для использования в различных сетевых приложениях. Он проверяет, занят ли порт, прежде чем вернуть его, и может работать с диапазонами портов, заданными в виде строки или списка строк. В случае, если свободный порт не найден, выбрасывается исключение `ValueError`.

## Функции

### `get_free_port`

```python
def get_free_port(host: str, port_range: Optional[str | List[str]] = None) -> int:
    """
    Находит и возвращает свободный порт в указанном диапазоне или первый доступный порт, если диапазон не задан.

    Args:
        host (str): Адрес хоста для проверки доступных портов.
        port_range (Optional[str | List[str]], optional): Диапазон портов, заданный строкой "min-max" или списком строк.
               Например: "3000-3999", ["3000-3999", "8000-8010"], None. По умолчанию `None`.

    Returns:
        int: Доступный номер порта.

    Raises:
        ValueError: Если не удается найти свободный порт в указанном диапазоне или если диапазон портов недействителен.
    """
```

**Как работает функция**:
1. Функция `get_free_port` принимает адрес хоста `host` и необязательный диапазон портов `port_range`.
2. Если `port_range` не указан, функция начинает поиск с порта 1024 и увеличивает его, пока не найдет свободный порт.
3. Если `port_range` указан, функция проверяет, является ли он строкой или списком.
4. Если `port_range` является строкой, функция вызывает `_parse_port_range`, чтобы получить минимальный и максимальный порты.
5. Если `port_range` является списком, функция перебирает элементы списка, вызывая `_parse_port_range` для каждого элемента.
6. Для каждого диапазона функция перебирает порты в диапазоне и проверяет, используется ли порт, вызывая `_is_port_in_use`.
7. Если найден свободный порт, функция возвращает его.
8. Если свободный порт не найден в указанном диапазоне, функция выбрасывает исключение `ValueError`.

**Внутренние функции**:

#### `_is_port_in_use`

```python
    def _is_port_in_use(host: str, port: int) -> bool:
        """
        Проверяет, используется ли данный порт на указанном хосте.

        Args:
            host (str): Адрес хоста.
            port (int): Номер порта для проверки.

        Returns:
            bool: True, если порт используется, False в противном случае.
        """
```

**Как работает функция**:
1. Функция `_is_port_in_use` создает сокет и пытается привязать его к указанному хосту и порту.
2. Если привязка удалась, это означает, что порт свободен, и функция возвращает `False`.
3. Если привязка не удалась, это означает, что порт используется, и функция возвращает `True`.

#### `_parse_port_range`

```python
    def _parse_port_range(port_range_str: str) -> Tuple[int, int]:
        """
        Разбирает строку диапазона портов "min-max" в кортеж (min_port, max_port).

        Args:
            port_range_str (str): Строка диапазона портов.

        Returns:
            Tuple[int, int]: Кортеж, содержащий минимальный и максимальный номера портов.

        Raises:
            ValueError: Если формат строки диапазона портов недействителен.
        """
```

**Как работает функция**:
1. Функция `_parse_port_range` принимает строку диапазона портов `port_range_str`.
2. Функция разбивает строку на две части по символу "-".
3. Если строка не содержит символ "-", функция выбрасывает исключение `ValueError`.
4. Функция преобразует обе части в целые числа.
5. Если какая-либо из частей не является целым числом, функция выбрасывает исключение `ValueError`.
6. Если минимальный порт больше или равен максимальному порту, функция выбрасывает исключение `ValueError`.
7. Функция возвращает кортеж, содержащий минимальный и максимальный порты.

**Примеры**:

```python
get_free_port('localhost', '3000-3005')
get_free_port('localhost', ['3000-3005', '8000-8010'])
get_free_port('localhost')
```
# Модуль `Chatgpt4o.py`

## Обзор

Модуль предоставляет асинхронный класс `Chatgpt4o`, предназначенный для взаимодействия с сервисом chatgpt4o.one. Он позволяет отправлять сообщения и получать ответы, используя API этого сервиса. Модуль использует библиотеки `requests`, `typing` и `helper` для асинхронных запросов, работы с типами данных и форматирования сообщений соответственно.

## Подробнее

Этот модуль является частью проекта `hypotez` и предназначен для интеграции с сервисом chatgpt4o.one. Он предоставляет функциональность для обмена сообщениями с использованием асинхронных запросов. Класс `Chatgpt4o` реализует методы для получения `post_id` и `nonce` с главной страницы сервиса, а также для отправки сообщений и обработки ответов.

## Классы

### `Chatgpt4o`

**Описание**: Класс для взаимодействия с сервисом chatgpt4o.one.
**Наследует**: `AsyncProvider`, `ProviderModelMixin`

**Атрибуты**:
- `url` (str): URL сервиса chatgpt4o.one.
- `working` (bool): Указывает, работает ли провайдер.
- `_post_id` (str | None): ID поста, необходимый для запросов.
- `_nonce` (str | None): Nonce, необходимый для запросов.
- `default_model` (str): Модель, используемая по умолчанию.
- `models` (List[str]): Список поддерживаемых моделей.
- `model_aliases` (Dict[str, str]): Алиасы моделей.

**Методы**:
- `create_async()`: Асинхронный метод для отправки сообщений и получения ответов.

## Методы класса

### `create_async`

```python
@classmethod
async def create_async(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    timeout: int = 120,
    cookies: dict = None,
    **kwargs
) -> str:
    """Асинхронно отправляет сообщения к сервису chatgpt4o.one и возвращает ответ.

    Args:
        cls (Chatgpt4o): Класс, для которого вызывается метод.
        model (str): Используемая модель.
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        timeout (int, optional): Время ожидания ответа в секундах. По умолчанию 120.
        cookies (dict, optional): Куки для отправки с запросом. По умолчанию `None`.
        **kwargs: Дополнительные параметры.

    Returns:
        str: Ответ от сервиса.

    Raises:
        RuntimeError: Если не найдены `post_id` или `nonce`, или если отсутствует поле `data` в ответе.

    Внутренние функции:
        Нет внутренних функций
    Как работает функция:
    1.  Формирует заголовки для HTTP-запроса.
    2.  Создает асинхронную сессию с использованием `StreamSession`.
    3.  Если `_post_id` или `_nonce` не установлены, выполняет GET-запрос к главной странице сервиса для их получения.
    4.  Извлекает `post_id` и `nonce` из текста ответа с использованием регулярных выражений.
    5.  Форматирует промпт из списка сообщений.
    6.  Формирует данные для POST-запроса.
    7.  Выполняет POST-запрос к API сервиса для отправки сообщения.
    8.  Обрабатывает ответ, извлекая данные из JSON.
    9.  Возвращает полученные данные.

    Примеры:
        >>> await Chatgpt4o.create_async(model='gpt-4o-mini-2024-07-18', messages=[{'role': 'user', 'content': 'Hello'}])
        'Hello, how can I assist you today?'

        >>> await Chatgpt4o.create_async(model='gpt-4o-mini-2024-07-18', messages=[{'role': 'user', 'content': 'Привет'}])
        'Привет, как я могу тебе помочь сегодня?'
    """
```

## Параметры класса

- `url` (str): URL сервиса chatgpt4o.one.
- `working` (bool): Указывает, работает ли провайдер.
- `_post_id` (str | None): ID поста, необходимый для запросов.
- `_nonce` (str | None): Nonce, необходимый для запросов.
- `default_model` (str): Модель, используемая по умолчанию.
- `models` (List[str]): Список поддерживаемых моделей.
- `model_aliases` (Dict[str, str]): Алиасы моделей.
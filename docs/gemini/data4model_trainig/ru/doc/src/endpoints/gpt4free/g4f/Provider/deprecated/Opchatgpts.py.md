# Модуль Opchatgpts для асинхронного взаимодействия с сервисом Opchatgpts.net

## Обзор

Модуль предоставляет класс `Opchatgpts`, который является асинхронным генераторным провайдером для взаимодействия с сервисом Opchatgpts.net. 
Он поддерживает потоковую передачу данных и предназначен для работы с моделями GPT-3.5 Turbo. Модуль использует `aiohttp` для выполнения асинхронных HTTP-запросов.

## Подробнее

Этот модуль позволяет взаимодействовать с API Opchatgpts.net для получения ответов от языковой модели. 
Он создает асинхронный генератор, который выдает ответы по частям, что полезно для обработки больших объемов текста.
Модуль поддерживает установку прокси-сервера для обхода географических ограничений или повышения анонимности.

## Классы

### `Opchatgpts`

**Описание**: Класс `Opchatgpts` предоставляет функциональность для асинхронного взаимодействия с сервисом Opchatgpts.net.

**Наследует**:
- `AsyncGeneratorProvider`: Наследует от базового класса асинхронных генераторных провайдеров.

**Атрибуты**:
- `url` (str): URL сервиса Opchatgpts.net.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений.
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели GPT-3.5 Turbo.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от сервиса.

## Методы класса

### `create_async_generator`

```python
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None, **kwargs) -> AsyncResult:
        """ Создает асинхронный генератор для взаимодействия с API Opchatgpts.net.

        Args:
            cls (Opchatgpts): Класс, для которого создается генератор.
            model (str): Идентификатор модели, используемой для генерации ответа.
            messages (Messages): Список сообщений, отправляемых в API.
            proxy (Optional[str], optional): URL прокси-сервера для использования при подключении. По умолчанию `None`.
            **kwargs: Дополнительные именованные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, выдающий ответы от API.

        Raises:
            RuntimeError: Если получен некорректный формат данных от API.
            aiohttp.ClientResponseError: Если возникает ошибка при выполнении HTTP-запроса.

        Как работает функция:
            Функция выполняет следующие шаги:
            1. Формирует заголовки HTTP-запроса, включая User-Agent, Accept, Origin и Referer.
            2. Создает асинхронную сессию `aiohttp.ClientSession` с заданными заголовками.
            3. Формирует данные запроса в формате JSON, включая идентификаторы бота, чата, контекста, сообщения и флаг потоковой передачи.
            4. Отправляет POST-запрос к API `wp-json/mwai-ui/v1/chats/submit` с использованием асинхронной сессии.
            5. Обрабатывает ответ от API построчно, проверяя, начинается ли строка с префикса `b"data: "`.
            6. Извлекает JSON-данные из каждой строки и проверяет наличие ключа "type".
            7. Если тип данных равен "live", выдает данные из ключа "data" через генератор.
            8. Если тип данных равен "end", завершает работу генератора.
            9. В случае возникновения ошибок, вызывает исключение `RuntimeError` с информацией о сломанной строке.
        """
```

**Примеры**:

```python
import asyncio
from typing import List, Dict, AsyncGenerator, Optional

from aiohttp import ClientSession

from g4f.Provider.deprecated.Opchatgpts import Opchatgpts

async def main():
    messages: List[Dict[str, str]] = [
        {"role": "user", "content": "Hello, how are you?"}
    ]
    async for message in Opchatgpts.create_async_generator(model="gpt-3.5-turbo", messages=messages):
        print(message, end="", flush=True)

if __name__ == "__main__":
    asyncio.run(main())
```
## Параметры класса

- `cls`:  Класс, для которого создается генератор. Используется для доступа к атрибутам класса, таким как `cls.url`.
- `model` (str):  Идентификатор модели, используемой для генерации ответа. Определяет, какую языковую модель использовать для обработки сообщений.
- `messages` (Messages):  Список сообщений, отправляемых в API. Содержит историю сообщений, которая используется для контекста при генерации ответа.
- `proxy` (Optional[str], optional): URL прокси-сервера для использования при подключении. По умолчанию `None`. Позволяет перенаправлять запросы через прокси-сервер, что может быть полезно для обхода географических ограничений или повышения анонимности.
- `**kwargs`:  Дополнительные именованные аргументы. Используется для передачи дополнительных параметров, которые могут потребоваться для настройки запроса.
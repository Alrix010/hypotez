# Модуль `Yqcloud.py`

## Обзор

Модуль предоставляет интерфейс для взаимодействия с Yqcloud API для генерации текста. Он содержит функции для отправки запросов к API и получения ответов в потоковом режиме.

## Подробней

Модуль предназначен для использования в качестве одного из провайдеров для `g4f`. Он определяет функцию `_create_completion`, которая отправляет запрос к Yqcloud API и возвращает результат в виде потока токенов.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """
    Создает запрос на завершение текста к Yqcloud API и возвращает результат в виде потока токенов.

    Args:
        model (str): Идентификатор модели для использования.
        messages (list): Список сообщений для отправки в API.
        stream (bool): Флаг, указывающий, следует ли возвращать результат в виде потока.
        **kwargs: Дополнительные параметры для передачи в API.

    Returns:
        Generator[str, None, None]: Генератор токенов, полученных из API.

    Raises:
        Exception: Если возникает ошибка при отправке запроса или обработке ответа.

    Example:
        >>> model = "gpt-3.5-turbo"
        >>> messages = [{"role": "user", "content": "Hello, how are you?"}]
        >>> stream = True
        >>> generator = _create_completion(model, messages, stream)
        >>> for token in generator:
        ...     print(token, end="")
    """
    ...
```

**Параметры**:
- `model` (str): Идентификатор модели, используемой для генерации текста.
- `messages` (list): Список сообщений, отправляемых в API. Каждое сообщение представляет собой словарь с ключами `role` и `content`.
- `stream` (bool): Флаг, указывающий, следует ли возвращать результат в виде потока токенов.
- `**kwargs` (dict): Дополнительные параметры, которые могут быть переданы в API.

**Возвращает**:
- `Generator[str, None, None]`: Генератор, который выдает токены, полученные от API Yqcloud.

**Как работает функция**:
1. Формируются заголовки HTTP-запроса, необходимые для аутентификации и указания типа контента.
2. Формируется JSON-payload с данными для запроса, включая промпт, идентификатор пользователя, флаги и ключ API.
3. Отправляется POST-запрос к API `https://api.aichatos.cloud/api/generateStream` с использованием библиотеки `requests`. Указано, что ожидается потоковый ответ (`stream=True`).
4. Функция итерируется по содержимому ответа, полученного от API, с помощью `response.iter_content(chunk_size=2046)`. Это позволяет читать данные небольшими частями, что особенно полезно для потоковой обработки.
5. Для каждого полученного чанка данных проверяется, не содержит ли он байтовую строку `b'always respond in english'`. Если эта строка отсутствует, чанк декодируется в строку UTF-8 и возвращается как очередной токен из генератора.

**Внутренние функции**:
- Внутри данной функции нет внутренних функций.

**Примеры**:

```python
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Напиши небольшое стихотворение о Москве"}]
stream = True
generator = _create_completion(model, messages, stream)
for token in generator:
    print(token, end="")
```

## Переменные модуля

- `url` (str): URL-адрес Yqcloud API.
- `model` (list): Список поддерживаемых моделей.
- `supports_stream` (bool): Флаг, указывающий, поддерживает ли провайдер потоковую передачу.
- `needs_auth` (bool): Флаг, указывающий, требуется ли аутентификация.
- `params` (str): Строка, содержащая информацию о поддерживаемых типах параметров функции `_create_completion`.
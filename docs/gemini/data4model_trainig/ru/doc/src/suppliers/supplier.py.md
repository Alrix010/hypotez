# Модуль `supplier`

## Обзор

Модуль `supplier` предназначен для описания базового класса `Supplier`, который служит для абстрагирования и унификации взаимодействия с различными поставщиками. Он включает функциональность для загрузки связанных модулей поставщика и управления сценариями сбора данных.

## Подробней

Этот модуль является ключевым компонентом системы, обеспечивающим единый интерфейс для работы с разными поставщиками. Он позволяет запускать сценарии сбора данных, управлять локаторами элементов страницы и взаимодействовать с веб-драйвером.

## Классы

### `Supplier`

**Описание**: Класс `Supplier` предназначен для выполнения сценариев для различных поставщиков, управления их настройками и взаимодействия с веб-драйвером.

**Наследует**: `BaseModel` из библиотеки `pydantic`, что позволяет использовать функциональность валидации и управления данными.

**Атрибуты**:

- `supplier_id` (Optional[int]): Идентификатор поставщика (может отсутствовать).
- `supplier_prefix` (str): Префикс поставщика (обязательное поле).
- `locale` (str): Код локали в формате ISO 639-1 (по умолчанию 'en').
- `price_rule` (Optional[str]): Правило расчета цен (может отсутствовать).
- `related_modules` (Optional[ModuleType]): Функции, относящиеся к каждому поставщику (может отсутствовать).
- `scenario_files` (List[str]): Список файлов сценариев для выполнения (по умолчанию пустой список).
- `current_scenario` (Dict[str, Any]): Текущий исполняемый сценарий (по умолчанию пустой словарь).
- `locators` (List[SimpleNamespace]): Локаторы для элементов страницы (по умолчанию пустой список).
- `driver` (Optional['Driver']): Веб-драйвер (может отсутствовать).

**Принцип работы**:
Класс инициализируется с данными о поставщике, загружает соответствующие модули и настройки, а также позволяет выполнять сценарии сбора данных.

**Методы**:
- `__init__`: Инициализация класса `Supplier`.
- `check_supplier_prefix`: Проверка префикса поставщика на пустое значение.
- `_payload`: Загрузка параметров поставщика.
- `login`: Выполнение входа на сайт поставщика.
- `run_scenario_files`: Выполнение файлов сценариев.
- `run_scenarios`: Выполнение списка сценариев.

## Методы класса

### `__init__(self, **data)`

```python
def __init__(self, **data)
```

**Назначение**: Инициализация экземпляра класса `Supplier`. Загружает параметры поставщика и проверяет их корректность.

**Параметры**:
- `data` (dict): Словарь с данными для инициализации поставщика.

**Возвращает**:
- None

**Вызывает исключения**:
- `DefaultSettingsException`: Если не удалось загрузить параметры поставщика.

**Как работает функция**:
1. Вызывает конструктор базового класса `BaseModel` для инициализации атрибутов модели данными из `data`.
2. Вызывает метод `_payload` для загрузки настроек поставщика.
3. Если метод `_payload` возвращает `False`, выбрасывается исключение `DefaultSettingsException`.

**Примеры**:
```python
supplier_data = {
    'supplier_prefix': 'test_supplier',
    'locale': 'ru',
    'scenario_files': ['scenario1.json', 'scenario2.json']
}
supplier = Supplier(**supplier_data)
```

### `check_supplier_prefix(cls, value: str) -> str`

```python
@validator('supplier_prefix')
def check_supplier_prefix(cls, value: str) -> str
```

**Назначение**: Валидатор для проверки, что префикс поставщика не является пустым.

**Параметры**:
- `value` (str): Префикс поставщика.

**Возвращает**:
- `str`: Префикс поставщика, если он не пустой.

**Вызывает исключения**:
- `ValueError`: Если префикс поставщика пустой.

**Как работает функция**:
1. Проверяет, является ли переданный `value` пустой строкой.
2. Если `value` пуст, выбрасывает исключение `ValueError` с сообщением об ошибке.
3. Если `value` не пуст, возвращает его.

**Примеры**:
```python
Supplier.check_supplier_prefix('valid_prefix')  # Возвращает 'valid_prefix'
```

### `_payload(self) -> bool`

```python
def _payload(self) -> bool
```

**Назначение**: Загрузка параметров поставщика, включая связанные модули.

**Параметры**:
- None

**Возвращает**:
- `bool`: `True`, если загрузка успешна, `False` в случае ошибки.

**Как работает функция**:
1. Логирует начало загрузки настроек для поставщика.
2. Пытается импортировать модуль, связанный с поставщиком, используя `importlib.import_module`.
3. В случае успеха, устанавливает атрибут `related_modules` экземпляра класса `Supplier`.
4. В случае ошибки `ModuleNotFoundError`, логирует ошибку и возвращает `False`.
5. Если все операции выполнены успешно, возвращает `True`.

**Примеры**:
```python
supplier = Supplier(supplier_prefix='example_supplier')
result = supplier._payload()
print(result)
```

### `login(self) -> bool`

```python
def login(self) -> bool
```

**Назначение**: Выполняет вход на сайт поставщика, используя соответствующий модуль.

**Параметры**:
- None

**Возвращает**:
- `bool`: `True`, если вход выполнен успешно, `False` в случае ошибки.

**Как работает функция**:
1. Вызывает метод `login` из модуля `related_modules`, передавая текущий экземпляр `Supplier`.
2. Возвращает результат выполнения метода `login` из `related_modules`.

**Примеры**:
```python
supplier = Supplier(supplier_prefix='example_supplier')
supplier._payload()  # Необходимо загрузить related_modules
result = supplier.login()
print(result)
```

### `run_scenario_files(self, scenario_files: Optional[str | List[str]] = None) -> bool`

```python
def run_scenario_files(self, scenario_files: Optional[str | List[str]] = None) -> bool
```

**Назначение**: Выполняет сценарии из одного или нескольких файлов сценариев.

**Параметры**:
- `scenario_files` (Optional[str | List[str]]): Список файлов сценариев для выполнения. Если не указан, используются файлы из `self.scenario_files`.

**Возвращает**:
- `bool`: `True`, если все сценарии успешно выполнены, `False` в случае ошибки.

**Как работает функция**:
1. Если `scenario_files` не указан, использует значение `self.scenario_files`.
2. Вызывает функцию `run_scenario_files` из модуля `src.suppliers.scenario.scenario_executor`, передавая текущий экземпляр `Supplier` и список файлов сценариев.
3. Возвращает результат выполнения функции `run_scenario_files`.

**Примеры**:
```python
supplier = Supplier(supplier_prefix='example_supplier', scenario_files=['scenario1.json'])
result = supplier.run_scenario_files()
print(result)
```

### `run_scenarios(self, scenarios: dict | List[dict]) -> bool`

```python
def run_scenarios(self, scenarios: dict | List[dict]) -> bool
```

**Назначение**: Выполняет один или несколько сценариев, переданных в виде словаря или списка словарей.

**Параметры**:
- `scenarios` (dict | List[dict]): Сценарий или список сценариев для выполнения.

**Возвращает**:
- `bool`: `True`, если сценарий успешно выполнен, `False` в случае ошибки.

**Как работает функция**:
1. Вызывает функцию `run_scenarios` из модуля `src.suppliers.scenario.scenario_executor`, передавая текущий экземпляр `Supplier` и сценарии.
2. Возвращает результат выполнения функции `run_scenarios`.

**Примеры**:
```python
supplier = Supplier(supplier_prefix='example_supplier')
scenario = {'name': 'test_scenario', 'steps': []}
result = supplier.run_scenarios(scenario)
print(result)
```

## Параметры класса

- `supplier_id` (Optional[int]): Уникальный идентификатор поставщика, который может быть использован для связи с другими частями системы.
- `supplier_prefix` (str): Префикс, идентифицирующий поставщика, используется для загрузки связанных модулей и настроек.
- `locale` (str): Локаль, определяющая язык и региональные настройки для взаимодействия с сайтом поставщика.
- `price_rule` (Optional[str]): Правило расчета цен, используемое для обработки данных о товарах.
- `related_modules` (Optional[ModuleType]): Модуль, содержащий специфичные для поставщика функции, такие как вход на сайт и обработка данных.
- `scenario_files` (List[str]): Список файлов, содержащих сценарии для сбора данных с сайта поставщика.
- `current_scenario` (Dict[str, Any]): Текущий выполняемый сценарий, содержащий шаги и параметры для сбора данных.
- `locators` (List[SimpleNamespace]): Список локаторов элементов страницы, используемых для взаимодействия с веб-драйвером.
- `driver` (Optional['Driver']): Экземпляр веб-драйвера, используемый для навигации и взаимодействия с сайтом поставщика.
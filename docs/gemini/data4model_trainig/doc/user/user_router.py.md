# Модуль маршрутизации пользователя для Telegram-бота

## Обзор

Модуль `src.endpoints.bots.telegram.digital_market.bot.user.user_router` содержит маршрутизаторы для обработки запросов, связанных с пользователем в Telegram-боте.

## Подробней

Модуль предоставляет функции для обработки команды `/start`, отображения главной страницы, отображения информации о магазине и профиля пользователя.

## Функции

### `cmd_start`

```python
@user_router.message(CommandStart())
async def cmd_start(message: Message, session_with_commit: AsyncSession):
```

**Назначение**: Обрабатывает команду `/start`.

**Параметры**:

*   `message` (Message): Объект сообщения Telegram.
*   `session_with_commit` (AsyncSession): Асинхронная сессия базы данных с коммитом.

**Как работает функция**:

1.  Получает ID пользователя из объекта сообщения.
2.  Ищет пользователя в базе данных, используя `UserDAO.find_one_or_none`.
3.  Если пользователь найден, отправляет приветственное сообщение с клавиатурой основного меню.
4.  Если пользователь не найден, создает нового пользователя в базе данных, используя `UserDAO.add`, и отправляет приветственное сообщение с клавиатурой основного меню.

### `page_home`

```python
@user_router.callback_query(F.data == "home")
async def page_home(call: CallbackQuery):
```

**Назначение**: Обрабатывает нажатие кнопки "home" для отображения главной страницы.

**Параметры**:

*   `call` (CallbackQuery): Объект обратного вызова.

**Как работает функция**:

1.  Отправляет уведомление о переходе на главную страницу.
2.  Отправляет приветственное сообщение с клавиатурой основного меню.

### `page_about`

```python
@user_router.callback_query(F.data == "about")
async def page_about(call: CallbackQuery):
```

**Назначение**: Обрабатывает нажатие кнопки "about" для отображения информации о магазине.

**Параметры**:

*   `call` (CallbackQuery): Объект обратного вызова.

**Как работает функция**:

1.  Отправляет уведомление об отображении информации о магазине.
2.  Отправляет пользователю сообщение с описанием магазина, информацией для тестовой оплаты и клавиатурой основного меню.

### `page_about` (my_profile)

```python
@user_router.callback_query(F.data == "my_profile")
async def page_about(call: CallbackQuery, session_without_commit: AsyncSession):
```

**Назначение**: Обрабатывает нажатие кнопки "my\_profile" для отображения профиля пользователя.

**Параметры**:

*   `call` (CallbackQuery): Объект обратного вызова.
*   `session_without_commit` (AsyncSession): Асинхронная сессия базы данных без коммита.

**Как работает функция**:

1.  Отправляет уведомление об отображении профиля.
2.  Извлекает статистику покупок пользователя из базы данных, используя `UserDAO.get_purchase_statistics`.
3.  Формирует сообщение с информацией о количестве покупок и общей сумме.
4.  Отправляет пользователю сообщение с информацией о профиле и клавиатурой для управления покупками.

### `page_user_purchases`

```python
@user_router.callback_query(F.data == "purchases")
async def page_user_purchases(call: CallbackQuery, session_without_commit: AsyncSession):
```

**Назначение**: Обрабатывает нажатие кнопки "purchases" для отображения списка покупок пользователя.

**Параметры**:

*   `call` (CallbackQuery): Объект обратного вызова.
*   `session_without_commit` (AsyncSession): Асинхронная сессия базы данных без коммита.

**Как работает функция**:

1.  Отправляет уведомление об отображении списка покупок.
2.  Извлекает список покупок пользователя из базы данных, используя `UserDAO.get_purchased_products`.
3.  Если у пользователя нет покупок, отправляет соответствующее сообщение.
4.  Для каждой покупки формирует текстовое описание товара и отправляет его пользователю вместе с файлом (если есть).
5.  Отправляет пользователю сообщение с благодарностью за доверие и клавиатурой основного меню.
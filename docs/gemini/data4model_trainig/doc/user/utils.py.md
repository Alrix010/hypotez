# Модуль для обработки успешной оплаты

## Обзор

Модуль `src.endpoints.bots.telegram.digital_market.bot.user.utils` содержит функцию `successful_payment_logic`, которая обрабатывает успешные платежи в Telegram-боте для цифрового магазина.

## Подробней

Модуль отвечает за добавление информации о покупке в базу данных, отправку уведомлений администраторам и предоставление информации о покупке пользователю.

## Функции

### `successful_payment_logic`

```python
async def successful_payment_logic(session: AsyncSession, payment_data, currency, user_tg_id, bot: Bot):
```

**Назначение**: Обрабатывает успешное завершение платежа.

**Параметры**:

*   `session` (AsyncSession): Асинхронная сессия базы данных.
*   `payment_data`: Объект, содержащий информацию о платеже.
*   `currency` (str): Валюта платежа.
*   `user_tg_id` (int): Telegram ID пользователя.
*   `bot` (Bot): Экземпляр класса `aiogram.Bot`.

**Как работает функция**:

1.  Извлекает данные из объекта `payment_data`.
2.  Добавляет информацию о покупке в базу данных, используя `PurchaseDao.add`.
3.  Извлекает информацию о товаре из базы данных, используя `ProductDao.find_one_or_none_by_id`.
4.  Отправляет уведомления администраторам о новой покупке.
5.  Формирует текстовое описание товара и отправляет его пользователю.
6.  Отправляет файл товара пользователю (если есть).
7.   Если тип оплаты = stars делает возврат звезд.
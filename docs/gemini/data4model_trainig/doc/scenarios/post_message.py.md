# Модуль для публикации сообщений в группах Facebook

## Обзор

Модуль `src.endpoints.advertisement.facebook.scenarios.post_message` предназначен для публикации сообщений в группах Facebook.

## Подробней

Модуль содержит функции для отправки заголовка сообщения, загрузки медиафайлов и публикации сообщения в Facebook.

## Функции

### `post_title`

```python
def post_title(d: Driver, message: SimpleNamespace | str) -> bool:
```

**Назначение**: Отправляет заголовок и описание кампании в поле сообщения.

**Параметры**:

*   `d` (Driver): Экземпляр драйвера для взаимодействия с веб-страницей.
*   `message` (SimpleNamespace | str): Объект, содержащий заголовок и описание кампании.

**Возвращает**:

*   `bool`: `True`, если заголовок и описание отправлены успешно, иначе `False`.

**Как работает функция**:

1.  Выполняет прокрутку страницы вверх.
2.  Открывает поле добавления сообщения.
3.  Добавляет сообщение в поле ввода.
4.  Возвращает `True`, если все шаги выполнены успешно, иначе `False`.

### `upload_media`

```python
def upload_media(d: Driver, media: SimpleNamespace | List[SimpleNamespace] | str | list[str],   no_video: bool = False, without_captions:bool = False) -> bool:
```

**Назначение**: Загружает медиафайлы в секцию изображений и обновляет подписи.

**Параметры**:

*   `d` (Driver): Экземпляр драйвера для взаимодействия с веб-страницей.
*   `media` (SimpleNamespace | List[SimpleNamespace] | str | list[str]): Список продуктов, содержащих пути к медиафайлам.
*   `no_video` (bool, optional): Флаг для отключения видео. Defaults to `False`.
*   `without_captions` (bool, optional): Флаг для отключения добавления подписей. Defaults to `False`.

**Возвращает**:

*   `bool`: `True`, если медиафайлы загружены успешно, иначе `False`.

**Как работает функция**:

1.  Открывает форму добавления фото/видео.
2.  Итерируется по списку медиафайлов:

    *   Загружает медиафайл.
    *   Логирует ошибки при загрузке.
3.  Обновляет подписи для загруженных медиафайлов (если `without_captions` is `False`).

### `update_images_captions`

```python
def update_images_captions(d: Driver, media: List[SimpleNamespace], textarea_list: List[WebElement]) -> None:
```

**Назначение**: Добавляет описания к загруженным медиафайлам.

**Параметры**:

*   `d` (Driver): Экземпляр драйвера для взаимодействия с веб-страницей.
*   `media` (List[SimpleNamespace]): Список продуктов с деталями для обновления.
*   `textarea_list` (List[WebElement]): Список текстовых областей, где добавляются подписи.

**Как работает функция**:

1.  Загружает локализованные единицы из файла `translations.json`.
2.  Итерируется по списку медиафайлов и добавляет описание к каждому файлу, используя информацию о продукте и локализованные строки.

### `publish`

```python
def publish(d:Driver, attempts = 5) -> bool:
```

**Назначение**: Публикует сообщение.

**Параметры**:

*   `d` (Driver): Экземпляр веб-драйвера.
*   `attempts` (int, optional): Количество попыток. По умолчанию 5.

**Возвращает**:

*   `bool`: `True`, если публикация выполнена успешно, иначе `False`.

**Как работает функция**:

1.  Пытается нажать кнопку завершения редактирования.
2.  Пытается нажать кнопку публикации.
3.  Если публикация не удалась, закрывает всплывающее окно (если оно есть) и пробует снова.
4.  Повторяет попытки несколько раз.

### `promote_post`

```python
def promote_post(d: Driver, category: SimpleNamespace, products: List[SimpleNamespace], no_video: bool = False) -> bool:
```

**Назначение**: Управляет процессом продвижения сообщения с заголовком, описанием и медиафайлами.

**Параметры**:

*   `d` (Driver): Экземпляр веб-драйвера для взаимодействия с веб-страницей.
*   `category` (SimpleNamespace): Объект, содержащий заголовок и описание категории.
*   `products` (List[SimpleNamespace]): Список продуктов, содержащих пути к медиафайлам.
*   `no_video` (bool, optional): Флаг для отключения видео. Defaults to `False`.

**Возвращает**:

*   `bool`: `True`, если продвижение выполнено успешно, иначе `False`.

**Как работает функция**:

1.  Вызывает функцию `post_title` для отправки заголовка и описания.
2.  Вызывает функцию `upload_media` для загрузки медиафайлов.
3.  Нажимает кнопку завершения редактирования.
4.  Нажимает кнопку публикации.
5.  Возвращает `True`, если все шаги выполнены успешно, иначе `False`.

### `post_message`

```python
def post_message(d: Driver, message: SimpleNamespace,  no_video: bool = False,  images:Optional[str | list[str]] = None, without_captions:bool = False) -> bool:
```

**Назначение**: Управляет процессом продвижения сообщения с заголовком, описанием и медиафайлами.

**Параметры**:

*   `d` (Driver): Экземпляр веб-драйвера для взаимодействия с веб-страницей.
*   `message` (SimpleNamespace): Объект, содержащий заголовок и описание сообщения.
*   `no_video` (bool, optional): Флаг для отключения видео. Defaults to `False`.
*    `images` (Optional[str | list[str]], optional): Пути к изображениям. Defaults to `None`.
*   `without_captions` (bool, optional): Флаг, указывающий, следует ли добавлять подписи к медиафайлам. Defaults to `False`.

**Возвращает**:

*   `bool`: `True`, если продвижение выполнено успешно, иначе `False`.

**Как работает функция**:

1.  Вызывает функцию `post_title` для отправки заголовка и описания.
2.  Вызывает функцию `upload_media` для загрузки медиафайлов.
3.   Если было добавлено одно изображение, просто нажимает Send
4.  Нажимает кнопку завершения редактирования.
5.  Вызывает функцию `publish` для публикации сообщения.
6.  Возвращает `True`, если все шаги выполнены успешно, иначе `False`.
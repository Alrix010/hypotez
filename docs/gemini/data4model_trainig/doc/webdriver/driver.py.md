### Анализ кода модуля `hypotez/src/webdriver/driver.py`

## Обзор

Модуль предназначен для работы с веб-драйверами Selenium.

## Подробнее

Основное назначение класса `Driver` — обеспечение унифицированного интерфейса для работы с веб-драйверами Selenium.

Он предоставляет интерфейс для взаимодействия с веб-браузерами, такими как Chrome, Firefox и Edge. Код веб-драйверов находится в подмодулях `chrome`, `firefox`, `edge`, `playwright`. Файлы настроек для веб-браузеров находятся в: `chrome\\chrome.json`, `firefox\\firefox.json`, `edge\\edge.json`, `playwright\\playwright.json`. Класс Driver упрощает задачи инициализации драйвера, навигации по URL, управления куками и обработки исключений.

## Классы

### `Driver`

```python
class Driver:
    """
    Класс обеспечивает удобный интерфейс для работы с различными драйверами, такими как Chrome, Firefox и Edge.

    Attributes:
        driver (selenium.webdriver): Экземпляр Selenium WebDriver.
    """
```

**Описание**:
Класс обеспечивает удобный интерфейс для работы с различными драйверами, такими как Chrome, Firefox и Edge.

**Атрибуты**:
-   `driver` (selenium.webdriver): Экземпляр Selenium WebDriver.

**Методы**:

*   `__init__(self, webdriver_cls, *args, **kwargs)`: Инициализирует экземпляр класса Driver.
*   `__init_subclass__(cls, *, browser_name: Optional[str] = None, **kwargs)`: Автоматически вызывается при создании подкласса `Driver`.
*   `__getattr__(self, item: str)`: Прокси для доступа к атрибутам драйвера.
*   `scroll(self, scrolls: int = 1, frame_size: int = 600, direction: str = 'both', delay: float = .3) -> bool`: Прокручивает страницу в указанном направлении.
*   `locale(self) -> Optional[str]`: Определяет язык страницы на основе мета-тегов или JavaScript.
*   `get_url(self, url: str) -> bool`: Переходит по указанному URL и сохраняет текущий URL, предыдущий URL и куки.
*   `window_open(self, url: Optional[str] = None) -> None`: Открывает новую вкладку в текущем окне браузера и переключается на нее.
*   `wait(self, delay: float = .3) -> None`: Ожидает указанное количество времени.
*   `_save_cookies_localy(self) -> None`: Сохраняет текущие куки веб-драйвера в локальный файл.
*   `fetch_html(self, url: str) -> Optional[bool]`: Извлекает HTML-контент из файла или веб-страницы.

## Методы класса

### `__init__`

```python
def __init__(self, webdriver_cls, *args, **kwargs):
    """
    Инициализирует экземпляр класса Driver.

    Args:
        webdriver_cls: Класс WebDriver, например Chrome или Firefox.
        args: Позиционные аргументы для драйвера.
        kwargs: Ключевые аргументы для драйвера.

    Raises:
        TypeError: Если `webdriver_cls` не является допустимым классом WebDriver.

    Example:
        >>> from selenium.webdriver import Chrome
        >>> driver = Driver(Chrome, executable_path='/path/to/chromedriver')
    """
    ...
```

**Назначение**: Инициализирует экземпляр класса Driver.

**Параметры**:
- `webdriver_cls`: Класс WebDriver, например Chrome или Firefox.
- `args`: Позиционные аргументы для драйвера.
- `kwargs`: Ключевые аргументы для драйвера.

**Как работает функция**:
1. Проверяет, является ли `webdriver_cls` допустимым классом WebDriver (имеет атрибут `get`).
2. Создает экземпляр класса `webdriver_cls` с переданными аргументами.

**Вызывает исключения**:
- `TypeError`: Если `webdriver_cls` не является допустимым классом WebDriver.

### `__init_subclass__`

```python
def __init_subclass__(cls, *, browser_name: Optional[str] = None, **kwargs):
    """
    Автоматически вызывается при создании подкласса `Driver`.

    Args:
        browser_name: Имя браузера.
        kwargs: Дополнительные аргументы.

    Raises:
        ValueError: Если browser_name не указан.
    """
    ...
```

**Назначение**: Автоматически вызывается при создании подкласса `Driver`.

**Параметры**:
- `browser_name`: Имя браузера.
- `kwargs`: Дополнительные аргументы.

**Как работает функция**:
1. Вызывает метод `__init_subclass__` родительского класса.
2. Проверяет, указан ли аргумент `browser_name`. Если нет, вызывает исключение `ValueError`.
3. Сохраняет имя браузера в атрибуте класса `browser_name`.

**Вызывает исключения**:
- `ValueError`: Если `browser_name` не указан.

### `__getattr__`

```python
def __getattr__(self, item: str):
    """
    Прокси для доступа к атрибутам драйвера.

    Args:
        item: Имя атрибута.

    Example:
        >>> driver.current_url
    """
    ...
```

**Назначение**: Проксирует доступ к атрибутам экземпляра Selenium WebDriver.

**Параметры**:
- `item` (str): Имя атрибута, к которому необходимо получить доступ.

**Как работает функция**:
1.  Получает значение атрибута `item` из экземпляра Selenium WebDriver (`self.driver`) с помощью функции `getattr()`.
2.  Возвращает полученное значение.

### `scroll`

```python
def scroll(self, scrolls: int = 1, frame_size: int = 600, direction: str = 'both', delay: float = .3) -> bool:
    """
    Прокручивает страницу в указанном направлении.

    Args:
        scrolls: Количество прокруток, по умолчанию 1.
        frame_size: Размер прокрутки в пикселях, по умолчанию 600.
        direction: Направление ('both', 'down', 'up'), по умолчанию 'both'.
        delay: Задержка между прокрутками, по умолчанию 0.3.

    Returns:
        True, если успешно, иначе False.

    Example:
        >>> driver.scroll(scrolls=3, direction='down')
    """
    ...
```

**Назначение**: Прокручивает страницу в указанном направлении.

**Параметры**:
-   `scrolls` (int): Количество прокруток, по умолчанию 1.
-   `frame_size` (int): Размер прокрутки в пикселях, по умолчанию 600.
-   `direction` (str): Направление ('both', 'down', 'up'), по умолчанию 'both'.
-   `delay` (float): Задержка между прокрутками, по умолчанию 0.3.

**Возвращает**:
-   `bool`: True, если успешно, иначе False.

**Как работает функция**:

1.  Определяет внутреннюю функцию `carousel` для выполнения прокрутки в одном направлении.
2.  В зависимости от значения параметра `direction` вызывает функцию `carousel` для прокрутки страницы в нужном направлении.
3.  Использует JavaScript для выполнения прокрутки страницы.
4.  Возвращает `True`, если прокрутка выполнена успешно, и `False` в случае ошибки.

### `locale`

```python
@property
def locale(self) -> Optional[str]:
    """
    Определяет язык страницы на основе мета-тегов или JavaScript.

    Returns:
        Код языка, если найден, иначе None.

    Example:
        >>> lang = driver.locale
        >>> print(lang)  # 'en' или None
    """
    ...
```

**Назначение**: Определяет язык страницы на основе мета-тегов или JavaScript.

**Возвращает**:
- `Optional[str]`: Код языка, если найден, иначе None.

**Как работает функция**:

1.  Пытается получить код языка из мета-тега `Content-Language`.
2.  Если мета-тег не найден или не содержит информации о языке, пытается получить код языка с помощью JavaScript-функции `get_page_lang()`.
3.  Возвращает полученный код языка или `None`, если не удалось определить язык страницы.

### `get_url`

```python
def get_url(self, url: str) -> bool:
    """
    Переходит по указанному URL и сохраняет текущий URL, предыдущий URL и куки.

    Args:
        url: URL для перехода.

    Returns:
        `True`, если переход успешен и текущий URL совпадает с ожидаемым, `False` в противном случае.

    Raises:
        WebDriverException: Если возникает ошибка с WebDriver.
        InvalidArgumentException: Если URL некорректен.
        Exception: Для любых других ошибок при переходе.
    """
    ...
```

**Назначение**: Переходит по указанному URL и сохраняет текущий URL, предыдущий URL и куки.

**Параметры**:
- `url`: URL для перехода.

**Возвращает**:
- `True`, если переход успешен и текущий URL совпадает с ожидаемым, `False` в противном случае.

**Как работает функция**:

1.  Сохраняет текущий URL в переменную `_previous_url`.
2.  Пытается перейти по указанному URL с помощью `self.driver.get(url)`.
3.  Сохраняет куки.
4.  В случае возникновения исключений, логирует информацию об ошибке и возвращает `False`.

**Вызывает исключения**:
- `WebDriverException`: Если возникает ошибка с WebDriver.
- `InvalidArgumentException`: Если URL некорректен.
- `Exception`: Для любых других ошибок при переходе.

### `window_open`

```python
def window_open(self, url: Optional[str] = None) -> None:
    """Open a new tab in the current browser window and switch to it.

    Args:
        url: URL to open in the new tab. Defaults to `None`.
    """
    ...
```

**Назначение**: Открывает новую вкладку в текущем окне браузера и переключается на нее.

**Параметры**:
- `url`: URL для открытия в новой вкладке. Defaults to `None`.

**Как работает функция**:

1. Выполняет JavaScript код для открытия новой вкладки.
2. Переключается на новую вкладку.
3. Если указан URL, переходит по нему.

### `wait`

```python
def wait(self, delay: float = .3) -> None:
    """
    Ожидает указанное количество времени.

    Args:
        delay: Время задержки в секундах. По умолчанию 0.3.

    Returns:
        None
    """
    ...
```

**Назначение**: Ожидает указанное количество времени.

**Параметры**:
- `delay`: Время задержки в секундах. По умолчанию 0.3.

**Как работает функция**:

1.  Вызывает `time.sleep(delay)` для приостановки выполнения на указанное время.

### `_save_cookies_localy`

```python
def _save_cookies_localy(self) -> None:
    """
    Сохраняет текущие куки веб-драйвера в локальный файл.

    Returns:
        None

    Raises:
        Exception: Если возникает ошибка при сохранении куки.
    """
    ...
```

**Назначение**: Сохраняет текущие куки веб-драйвера в локальный файл.

**Как работает функция**:

1.  Получает куки из веб-драйвера с помощью `self.driver.get_cookies()`.
2.  Открывает файл, путь к которому берется из `gs.cookies_filepath`, в бинарном режиме для записи.
3.  Сохраняет куки в файл с помощью `pickle.dump()`.
4.  В случае ошибки логирует информацию об ошибке.

### `fetch_html`

```python
def fetch_html(self, url: str) -> Optional[bool]:
    """
    Извлекает HTML-контент из файла или веб-страницы.

    Args:
        url: Путь к файлу или URL для извлечения HTML-контента.

    Returns:
        Возвращает `True`, если контент успешно получен, иначе `None`.

    Raises:
        Exception: Если возникает ошибка при извлечении контента.
    """
    ...
```

**Назначение**: Извлекает HTML-контент из файла или веб-страницы.

**Параметры**:
- `url`: Путь к файлу или URL для извлечения HTML-контента.

**Возвращает**:
- `Optional[bool]`: Возвращает `True`, если контент успешно получен, иначе `None`.

**Как работает функция**:

1.  Проверяет протокол URL:
    *   Если URL начинается с `'file://'`, извлекает путь к локальному файлу и пытается прочитать HTML-контент из этого файла.
    *   Если URL начинается с `'http://'` или `'https://'`, использует `self.get_url(url)` для загрузки страницы и сохранения HTML-контента в атрибуте `self.html_content`.
2.  В случае возникновения ошибок логирует информацию об ошибке и возвращает `False`.

## Переменные

-   `PROJECT_ROOT_FOLDER`:  Путь к корневой директории проекта.
-   `EXCLUDE_DIRS`: Список директорий, которые исключаются из обработки при чтении файлов.
-   `MODE` : Указывает режим работы модуля (в данном случае \'development\').

## Запуск

Для использования этого модуля необходимо установить библиотеку `selenium`, `pickle`.
Также необходимо скачать веб-драйвер, соотвествующий вашему браузеру.

```bash
pip install selenium
```

Пример использования:

```python
from src.webdriver import Driver, Chrome

driver = Driver(Chrome)
driver.get_url("https://example.com")
html_content = driver.fetch_html("https://example.com")
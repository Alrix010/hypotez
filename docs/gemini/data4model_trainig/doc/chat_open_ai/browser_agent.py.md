# Модуль `browser_agent`

## Обзор

Модуль предназначен для быстрого создания и запуска ИИ-агента, который может искать информацию в Google и анализировать веб-страницы.

## Подробней

Модуль предоставляет класс `AIBrowserAgent`, который позволяет создавать агентов, использующих браузер для выполнения задач. Агент может искать информацию в интернете, анализировать веб-страницы и предоставлять ответы на вопросы.

## Классы

### `AIBrowserAgent`

**Описание**: Класс для создания агента, использующего браузер для выполнения задач.

**Атрибуты**:

*   `api_key` (str): Ключ API OpenAI.
*   `model_name` (str): Название языковой модели OpenAI для использования (по умолчанию `"gpt-4o-mini"`).
*   `search_engine` (str): Поисковая система для использования (по умолчанию `"google"`).
*   `llm` (ChatOpenAI): Объект ChatOpenAI для взаимодействия с OpenAI API.
*   `custom_driver` (Optional[object]): Опционально внедренный экземпляр WebDriver, по умолчанию `None` (используется драйвер `browser_use` по умолчанию).

**Методы**:

*   `__init__`: Инициализирует объект `AIBrowserAgent`.
*   `run_task`: Запускает агента для выполнения заданной задачи.
*   `find_product_alternatives`: Ищет в сети аналоги для продукта по заданному URL или SKU.
*   `ask`: Синхронная обертка для асинхронного метода `ask_async`. Не рекомендуется к использованию.
*   `ask_async`: Отвечает на заданный вопрос, используя поиск в интернете, если это необходимо.

### `__init__`

```python
def __init__(self,
             api_key: str,
             model_name: str = "gpt-4o-mini",
             search_engine: str = "google",
             custom_driver: Optional[object] = None):  # Type hint: object
    """
    Инициализирует класс BrowserAgent.

    Args:
        api_key: Ключ API OpenAI (необязательный). Если не указан, будет использован ключ из переменных окружения.
        model_name: Название языковой модели OpenAI для использования (по умолчанию "gpt-4o-mini").
        search_engine: Поисковая система для использования (по умолчанию "google").
        custom_driver: Optionally injected WebDriver instance, defaults to None (browser_use default).
    """
    ...
```

**Назначение**: Инициализирует объект `AIBrowserAgent`.

**Параметры**:

*   `api_key` (str): Ключ API OpenAI.
*   `model_name` (str, optional): Название языковой модели OpenAI для использования (по умолчанию `"gpt-4o-mini"`).
*   `search_engine` (str, optional): Поисковая система для использования (по умолчанию `"google"`).
*   `custom_driver` (Optional[object], optional): Опционально внедренный экземпляр WebDriver, по умолчанию `None` (используется драйвер `browser_use` по умолчанию).

**Как работает функция**:

1.  Инициализирует атрибуты `api_key`, `model_name`, `search_engine` и `custom_driver`.
2.  Создает экземпляр класса `ChatOpenAI` для взаимодействия с OpenAI API.

### `run_task`

```python
async def run_task(self, task_prompt: str) -> Optional[str]:
    """
    Запускает агента для выполнения заданной задачи.

    Args:
        task_prompt: Текст задачи для агента.

    Returns:
        Результат выполнения задачи в виде строки, или None в случае ошибки.
    """
    ...
```

**Назначение**: Запускает агента для выполнения заданной задачи.

**Параметры**:

*   `task_prompt` (str): Текст задачи для агента.

**Возвращает**:

*   `Optional[str]`: Результат выполнения задачи в виде строки или `None` в случае ошибки.

**Как работает функция**:

1.  Инициализирует веб-драйвер (использует `browser_use` по умолчанию или внедренный `custom_driver`).
2.  Создает экземпляр класса `Agent` из библиотеки `browser_use`, передавая ему задачу, языковую модель и веб-драйвер.
3.  Запускает агента для выполнения задачи с помощью метода `agent.run()`.
4.  Закрывает веб-драйвер (если это поддерживается).

### `find_product_alternatives`

```python
async def find_product_alternatives(self, product_url: Optional[str] = None,
                                        sku: Optional[str] = None) -> Optional[str]:
    """
    Ищет в сети аналоги для продукта по заданному URL или SKU.

    Args:
        product_url: URL продукта, для которого нужно найти аналоги (опционально).
        sku: SKU продукта, для которого нужно найти аналоги (опционально).

    Returns:
        Строку с описанием найденных аналогов, или None в случае ошибки.
    """
    ...
```

**Назначение**: Ищет в сети аналоги для продукта по заданному URL или SKU.

**Параметры**:

*   `product_url` (Optional[str]): URL продукта, для которого нужно найти аналоги (опционально).
*   `sku` (Optional[str]): SKU продукта, для которого нужно найти аналоги (опционально).

**Возвращает**:

*   `Optional[str]`: Строку с описанием найденных аналогов или `None` в случае ошибки.

**Как работает функция**:

1.  Формирует поисковый запрос на основе `product_url` или `sku`.
2.  URL-кодирует поисковый запрос.
3.  Формирует URL поисковой системы (Google или DuckDuckGo).
4.  Формирует задачу для агента, включающую URL поисковой системы и инструкцию по поиску аналогов.
5.  Запускает агента для выполнения задачи с помощью метода `self.run_task()`.

### `ask`

```python
def ask(self, q: str) -> Optional[str]:
    """
    Синхронная обертка для асинхронного метода ask_async.  Не рекомендуется к использованию.
    """
    ...
```

**Назначение**: Синхронная обертка для асинхронного метода `ask_async`. Не рекомендуется к использованию.

**Параметры**:

*   `q` (str): Вопрос для ответа.

**Возвращает**:

*   `Optional[str]`: Ответ на вопрос или `None` в случае ошибки.

**Как работает функция**:

1.  Формирует задачу для агента, включающую вопрос и инструкцию по использованию поиска в интернете.
2.  Запускает агента для выполнения задачи с помощью метода `self.run_task()`.

### `ask_async`

```python
async def ask_async(self, q: str) -> Optional[str]:
    """
    Отвечает на заданный вопрос, используя поиск в интернете, если это необходимо.

    Args:
        question: Вопрос, на который нужно ответить.

    Returns:
        Ответ на вопрос в виде строки, или None в случае ошибки.
    """
    ...
```

**Назначение**: Асинхронно отвечает на заданный вопрос, используя поиск в интернете, если это необходимо.

**Параметры**:

*   `q` (str): Вопрос для ответа.

**Возвращает**:

*   `Optional[str]`: Ответ на вопрос или `None` в случае ошибки.

**Как работает функция**:

1.  Формирует задачу для агента, включающую вопрос и инструкцию по использованию поиска в интернете.
2.  Запускает агента для выполнения задачи с помощью метода `self.run_task()`.

## Функция `main`

```python
async def main():
    """
    Пример использования класса BrowserAgent.
    """
    # api_key: str = gs.credentials.openai.hypotez.api_key  # Replace with your actual method of obtaining the API key
    api_key: str = None  # Replace with your actual method of obtaining the API key
    model_name: str = 'gpt-4o-mini'  # gpt-4o-mini существует, если указан api_key

    #########################################################################
    # OPTIONAL:  Inject custom Chrome, Firefox, Edge driver
    # selenium_driver = Firefox()  # (Or with args you use in Firefox class)
    # playwright_driver = PlaywrightFirefoxAdapter(selenium_driver)
    # agent = BrowserAgent(api_key=api_key, model_name=model_name, custom_driver = playwright_driver)
    #########################################################################
    agent = AIBrowserAgent(api_key=api_key, model_name=model_name) #  Default browser_use driver

    # Пример поиска аналогов продукта
    sku: str = '1493001'
    product_url: str = None  # "https://www.apple.com/iphone-14/"  # Замените на URL интересующего вас продукта
    alternatives = await agent.find_product_alternatives(product_url=product_url, sku=sku)
    if alternatives:
        print("Найденные аналоги:")
        print(alternatives)
    else:
        print("Не удалось найти аналоги.")

    # Пример ответа на вопрос
    question = "Какая сейчас погода в Москве?"
    answer = await agent.ask_async(question)  # Используем асинхронный метод напрямую
    if answer:
        print("Ответ на вопрос:")
        print(answer)
    else:
        print("Не удалось получить ответ на вопрос.")
```

**Назначение**: Демонстрирует пример использования класса `AIBrowserAgent`.

**Как работает функция**:

1.  Инициализирует объект `AIBrowserAgent`.
2.  Вызывает метод `find_product_alternatives` для поиска аналогов продукта по SKU и URL.
3.  Вызывает метод `ask_async` для ответа на вопрос.

## Зависимости

*   `langchain_openai`: Для взаимодействия с OpenAI API.
*   `browser_use`: Для управления браузером и выполнения задач.
*   `dotenv`: Для загрузки переменных окружения из файла `.env`.
*   `typing`: Для аннотаций типов.
*   `urllib.parse`: Для URL-кодирования поисковых запросов.

## Замечания

Модуль предоставляет базовую функциональность для создания ИИ-агента, использующего браузер для выполнения задач. Необходимо обеспечить корректную настройку API-ключей и других параметров конфигурации.
В коде много закоментированного кода, его стоит удалить.
Обратите внимание, что для корректной работы требуется установить OpenAI API и аккаунт к нему.
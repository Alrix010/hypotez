# Модуль утилит для работы с Mega

## Обзор

Модуль `src.endpoints.bots.google_drive.mega.utils` предоставляет набор утилитных функций для работы с сервисом Mega, включая функции для преобразования данных, шифрования и кодирования.

## Подробней

Модуль содержит функции для преобразования данных между различными форматами (a32, строка, base64), шифрования и дешифрования данных с использованием AES, а также для работы с чанками файлов.

## Функции

### `a32_to_str`

```python
def a32_to_str(a):
    return struct.pack('>%dI' % len(a), *a)
```

**Назначение**: Преобразует список 32-битных целых чисел в строку.

**Параметры**:

*   `a` (list): Список 32-битных целых чисел.

**Возвращает**:

*   `str`: Строка, полученная из списка целых чисел.

### `aes_cbc_encrypt`

```python
def aes_cbc_encrypt(data, key):
```

**Назначение**: Шифрует данные с использованием AES в режиме CBC.

**Параметры**:

*   `data` (bytes): Данные для шифрования.
*   `key` (bytes): Ключ шифрования.

**Возвращает**:

*   `bytes`: Зашифрованные данные.

### `aes_cbc_encrypt_a32`

```python
def aes_cbc_encrypt_a32(data, key):
```

**Назначение**: Шифрует данные в формате a32 с использованием AES в режиме CBC.

**Параметры**:

*   `data` (list): Данные для шифрования в формате a32.
*   `key` (list): Ключ шифрования в формате a32.

**Возвращает**:

*   `list`: Зашифрованные данные в формате a32.

### `str_to_a32`

```python
def str_to_a32(b):
```

**Назначение**: Преобразует строку в список 32-битных целых чисел.

**Параметры**:

*   `b` (str): Строка для преобразования.

**Возвращает**:

*   `list`: Список 32-битных целых чисел.

**Как работает функция**:

1.  Дополняет строку нулевыми байтами, если её длина не кратна 4.
2.  Преобразует строку в список 32-битных целых чисел.

### `mpi2int`

```python
def mpi2int(s):
```

**Назначение**: Преобразует многобайтовое целое число (MPI) в целое число Python.

**Параметры**:

*   `s` (bytes): MPI для преобразования.

**Возвращает**:

*   `int`: Целое число Python.

**Как работает функция**:

1.  Извлекает байты, начиная с третьего, и преобразует их в шестнадцатеричный вид.
2.  Преобразует шестнадцатеричное представление в целое число.

### `aes_cbc_decrypt`

```python
def aes_cbc_decrypt(data, key):
```

**Назначение**: Дешифрует данные с использованием AES в режиме CBC.

**Параметры**:

*   `data` (bytes): Данные для дешифрования.
*   `key` (bytes): Ключ дешифрования.

**Возвращает**:

*   `bytes`: Дешифрованные данные.

### `aes_cbc_decrypt_a32`

```python
def aes_cbc_decrypt_a32(data, key):
```

**Назначение**: Дешифрует данные в формате a32 с использованием AES в режиме CBC.

**Параметры**:

*   `data` (list): Данные для дешифрования в формате a32.
*   `key` (list): Ключ дешифрования в формате a32.

**Возвращает**:

*   `list`: Дешифрованные данные в формате a32.

### `base64urldecode`

```python
def base64urldecode(data):
```

**Назначение**: Декодирует строку в формате Base64 URL.

**Параметры**:

*   `data` (str): Строка для декодирования.

**Возвращает**:

*   `bytes`: Декодированные данные.

**Как работает функция**:

1.  Добавляет символы заполнения, если необходимо.
2.  Заменяет символы `-`, `_` и `,` на `+`, `/` и `''` соответственно.
3.  Декодирует строку с использованием Base64.

### `base64_to_a32`

```python
def base64_to_a32(s):
```

**Назначение**: Преобразует строку в формате Base64 URL в список 32-битных целых чисел.

**Параметры**:

*   `s` (str): Строка для преобразования.

**Возвращает**:

*   `list`: Список 32-битных целых чисел.

**Как работает функция**:

1.  Декодирует строку с использованием `base64urldecode`.
2.  Преобразует полученные байты в список 32-битных целых чисел с использованием `str_to_a32`.

### `base64urlencode`

```python
def base64urlencode(data):
```

**Назначение**: Кодирует данные в строку в формате Base64 URL.

**Параметры**:

*   `data` (bytes): Данные для кодирования.

**Возвращает**:

*   `str`: Закодированная строка.

**Как работает функция**:

1.  Кодирует данные с использованием Base64.
2.  Заменяет символы `+`, `/` и `=` на `-`, `_` и `''` соответственно.

### `a32_to_base64`

```python
def a32_to_base64(a):
```

**Назначение**: Преобразует список 32-битных целых чисел в строку в формате Base64 URL.

**Параметры**:

*   `a` (list): Список 32-битных целых чисел.

**Возвращает**:

*   `str`: Закодированная строка.

**Как работает функция**:

1.  Преобразует список целых чисел в строку с использованием `a32_to_str`.
2.  Кодирует полученную строку с использованием `base64urlencode`.

### `get_chunks`

```python
def get_chunks(size):
```

**Назначение**: Разбивает файл на чанки для загрузки.

**Параметры**:

*   `size` (int): Размер файла в байтах.

**Возвращает**:

*   `dict`: Словарь, где ключи - начальные позиции чанков, а значения - их размеры.

**Как работает функция**:

1.  Определяет размеры чанков в зависимости от размера файла.
2.  Возвращает словарь с информацией о чанках.
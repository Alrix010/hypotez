# Модуль для автоматической проверки прокси

## Обзор

Модуль `src.endpoints.freegpt-webui-ru/server/auto_proxy.py` предназначен для автоматического поиска и проверки прокси-серверов.

## Подробней

Модуль содержит функции для получения списка прокси, проверки их работоспособности и добавления рабочих прокси в глобальный список.

## Переменные

*   `working_proxies` (list): Глобальный список рабочих прокси-серверов.

## Функции

### `fetch_proxies`

```python
def fetch_proxies():
```

**Назначение**: Получает список прокси-серверов с сайта proxyscrape.com.

**Возвращает**:

*   `list`: Список прокси-серверов в формате "IP:Port".

**Как работает функция**:

1.  Выполняет GET-запрос к сайту proxyscrape.com.
2.  Если запрос успешен (код состояния 200), возвращает список прокси-серверов, разделенных символами `\r\n`.
3.  В случае ошибки выводит сообщение об ошибке и возвращает пустой список.

### `test_proxy`

```python
def test_proxy(proxy, prompt, timeout):
```

**Назначение**: Проверяет работоспособность заданного прокси-сервера с указанным промптом и временем ожидания.

**Параметры**:

*   `proxy` (str): Прокси-сервер в формате "IP:Port".
*   `prompt` (str): Тестовый промпт для проверки.
*   `timeout` (int): Максимальное время ожидания в секундах.

**Как работает функция**:

1.  Измеряет время выполнения запроса с использованием прокси-сервера.
2.  Если время выполнения меньше заданного таймаута, добавляет прокси-сервер в глобальный список `working_proxies`.

### `add_working_proxy`

```python
def add_working_proxy(proxy):
```

**Назначение**: Добавляет рабочий прокси-сервер в глобальный список `working_proxies`.

**Параметры**:

*   `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:

1.  Добавляет прокси-сервер в список `working_proxies`.

### `remove_proxy`

```python
def remove_proxy(proxy):
```

**Назначение**: Удаляет прокси-сервер из глобального списка `working_proxies`.

**Параметры**:

*   `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:

1.  Удаляет прокси-сервер из списка `working_proxies`, если он там есть.

### `get_working_proxies`

```python
def get_working_proxies(prompt, timeout=5):
```

**Назначение**: Получает и проверяет прокси-серверы, добавляя рабочие прокси в глобальный список `working_proxies`.

**Параметры**:

*   `prompt` (str): Тестовый промпт для проверки.
*   `timeout` (int, optional): Максимальное время ожидания в секундах. Defaults to 5.

**Как работает функция**:

1.  Получает список прокси-серверов с помощью `fetch_proxies`.
2.  Создает потоки для проверки каждого прокси-сервера с помощью функции `test_proxy`.
3.  Дожидается завершения всех потоков.

### `update_working_proxies`

```python
def update_working_proxies():
```

**Назначение**: Непрерывно обновляет глобальный список `working_proxies` рабочими прокси-серверами.

**Как работает функция**:

1.  В бесконечном цикле:
    *   Очищает список `working_proxies`.
    *   Получает и проверяет прокси-серверы с помощью `get_working_proxies`.
    *   Выводит сообщение об обновлении прокси.
    *   Ожидает 30 минут.

### `get_random_proxy`

```python
def get_random_proxy():
```

**Назначение**: Получает случайный рабочий прокси-сервер из глобального списка `working_proxies`.

**Возвращает**:

*   `str`: Случайный рабочий прокси-сервер в формате "IP:Port".

**Как работает функция**:

1.  Возвращает случайный элемент из списка `working_proxies`.
# Модуль для сбора иерархии файлов

## Обзор

Этот модуль предназначен для рекурсивного обхода указанной директории, сбора иерархии файлов определенных типов и копирования этих файлов в другую директорию, сохраняя структуру каталогов.

## Подробнее

Скрипт рекурсивно проходит по папке `src/utils` и собирает иерархию файлов в словарь, включая только файлы с расширениями `.py`, `.json`, `.md`, `.dot`, и `.mer`. Игнорируются папки `profiles`, `__pycache__`, `_experiments`, а также файлы и папки, названия которых начинаются с `___`, содержат `*`, `(`, или `)` в имени. Все найденные файлы копируются в папку `prod`, при этом структура папок сохраняется. После сбора иерархии файлов она сохраняется в файл `file_hierarchy.json` внутри папки `prod`.

## Функции

### `collect_and_copy_files`

```python
def collect_and_copy_files(directory: Path, target_directory: Path) -> dict:
    """Рекурсивно собирает и копирует файлы из исходной директории в целевую.

    Args:
        directory (Path): Путь к исходной директории.
        target_directory (Path): Путь к целевой директории.

    Returns:
        dict: Словарь, представляющий иерархию файлов и папок.
    """
    ...
```

**Назначение**:
Функция `collect_and_copy_files` рекурсивно обходит указанную директорию, собирает иерархию файлов и копирует файлы, соответствующие определенным критериям, в целевую директорию.

**Параметры**:
- `directory` (Path): Путь к исходной директории.
- `target_directory` (Path): Путь к целевой директории, куда будут скопированы файлы.

**Возвращает**:
- `dict`: Словарь, представляющий иерархию файлов и папок. Ключами словаря являются имена файлов и папок, а значениями - вложенные словари (для папок) или `None` (для файлов).

**Как работает функция**:
1. Инициализирует пустой словарь `hierarchy` для хранения иерархии файлов.
2. Перебирает все элементы (файлы и поддиректории) внутри указанной директории.
3. Если элемент является директорией:
   - Проверяет, не является ли имя директории одним из исключенных (`profiles`, `__pycache__`, `_experiments`) и не начинается ли с `___`, а также не содержит ли символ `*`.
   - Если директория не исключена, рекурсивно вызывает `collect_and_copy_files` для этой директории, передавая путь к поддиректории в целевом каталоге.
   - Добавляет результат рекурсивного вызова в словарь `hierarchy` под ключом, соответствующим имени директории.
4. Если элемент является файлом:
   - Проверяет, имеет ли файл одно из разрешенных расширений (`.py`, `.json`, `.md`, `.dot`, `.mer`), не начинается ли его имя с `___`, не содержит ли символ `*`, `(` или `)`.
   - Если файл соответствует критериям, добавляет его в словарь `hierarchy` под ключом, соответствующим имени файла, со значением `None`.
   - Создает необходимые поддиректории в целевом каталоге (если они не существуют).
   - Копирует файл в целевой каталог с сохранением структуры.
5. Возвращает словарь `hierarchy`.

**Примеры**:

Предположим, что у вас есть следующая структура каталогов:

```
src/utils/
├── file1.py
├── subdir1/
│   ├── file2.json
│   └── file3.md
└── subdir2/
    └── file4.dot
```

При вызове функции:

```python
from pathlib import Path
source_dir = Path("src/utils")
target_dir = Path("prod")
hierarchy = collect_and_copy_files(source_dir, target_dir)
print(hierarchy)
```

Результат будет примерно следующим:

```
{
    "file1.py": None,
    "subdir1": {
        "file2.json": None,
        "file3.md": None
    },
    "subdir2": {
        "file4.dot": None
    }
}
```

### `main`

```python
def main():
    """Собирает иерархию файлов и сохраняет её в JSON-файл."""
    ...
```

**Назначение**:
Функция `main` является основной точкой входа в скрипт. Она устанавливает пути к исходной и целевой директориям, вызывает функцию `collect_and_copy_files` для сбора иерархии файлов и копирования их в целевую директорию, а затем сохраняет полученную иерархию в формате JSON в файл `file_hierarchy.json`.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- None

**Как работает функция**:
1. Определяет путь к исходной директории (`src_directory`) как `src/utils` внутри корневого каталога проекта.
2. Определяет путь к целевой директории (`project_structure_directory`) как `prod` внутри исходной директории.
3. Вызывает функцию `collect_and_copy_files` для сбора иерархии файлов и копирования их в целевую директорию.
4. Определяет путь к файлу, в который будет сохранена иерархия (`json_output_path`) как `file_hierarchy.json` внутри целевой директории.
5. Вызывает функцию `j_dumps` для сохранения иерархии файлов в формате JSON в указанный файл.

**Примеры**:

Запуск скрипта приведет к созданию папки `prod` внутри папки `src/utils` и скопирует туда все файлы с расширениями `.py`, `.json`, `.md`, `.dot`, и `.mer`, сохранив исходную структуру каталогов. Также в папке `prod` будет создан файл `file_hierarchy.json`, содержащий JSON-представление иерархии файлов.

```python
if __name__ == "__main__":
    main()
```
# Модуль основных функций Telegram-бота Toolbox

## Обзор

Модуль `src.endpoints.bots.telegram.ToolBoxbot-main/ToolBox/ToolBox_requests.py` содержит класс `ToolBox` с основными функциями для работы Telegram-бота, включая обработку текста, изображений и управление тарифами.

## Подробней

Модуль предоставляет методы для взаимодействия с пользователями, генерации контента с использованием нейронных сетей и управления подписками.

## Классы

### `ToolBox`

**Наследует**:
 *   `keyboards`: Модуль клавиатур для Telegram-бота
 *   `neural_networks`: Модуль нейронных сетей для Telegram-бота

**Описание**: Класс для управления Telegram-ботом и обработки различных типов запросов.

**Атрибуты**:

*   `name` (list): Список названий кнопок основного меню.
*   `data` (list): Список обратных вызовов для кнопок основного меню.
*   `prompts_text` (dict): Словарь с текстами промптов для различных задач.
*   `bot` (telebot.TeleBot): Экземпляр Telegram-бота.

**Методы**:

*   `__init__(self)`: Инициализирует объект `ToolBox`.
*   `Text_types(self, message)`: Отображает типы текстов для генерации.
*   `Basic_tariff(self, message)`: Отображает информацию о базовом тарифе.
*   `Pro_tariff(self, message)`: Отображает информацию о PRO-тарифе.
*   `SomeTextsCommand(self, message, ind: int, tokens: dict[str, int])`: Обрабатывает команду генерации нескольких текстов.
*   `ImageCommand(self, message, prompt: str, size: list[int])`: Обрабатывает команду генерации изображения.
*   `Image_Regen_And_Upscale(self, message, prompt: str, size: list[int], seed, num_inference_steps=4)`: Генерирует и улучшает изображение.
*   `FreeCommand(self, message, prompts: list[str])`: Обрабатывает команду в бесплатном режиме.
*   `TarrifEnd(self, message)`: Сообщает об окончании действия тарифа.
*   `FreeTariffEnd(self, message)`: Сообщает об окончании действия бесплатного тарифа.

## Методы класса `ToolBox`

### `__init__`

```python
def __init__(self):
```

**Назначение**: Инициализирует объект `ToolBox`.

**Как работает функция**:

1.  Инициализирует списки `name` и `data` для кнопок основного меню.
2.  Загружает тексты промптов из JSON-файла.
3.  Инициализирует Telegram-бота с использованием токена из переменной окружения.

### `Text_types`

```python
def Text_types(self, message):
```

**Назначение**: Отображает типы текстов для генерации.

**Параметры**:

*   `message`: Объект сообщения Telegram.

**Как работает функция**:

1.  Определяет названия и обратные вызовы для кнопок типов текста.
2.  Редактирует сообщение, отображая клавиатуру с типами текста.

### `Basic_tariff`

```python
def Basic_tariff(self, message):
```

**Назначение**: Отображает информацию о базовом тарифе и предлагает подключить его.

**Параметры**:

*   `message`: Объект сообщения Telegram.

**Как работает функция**:

1.  Создает инлайн-клавиатуру с кнопкой для подключения базового тарифа.
2.  Отправляет счет для оплаты базового тарифа.

### `Pro_tariff`

```python
def Pro_tariff(self, message):
```

**Назначение**: Отображает информацию о PRO-тарифе и предлагает подключить его.

**Параметры**:

*   `message`: Объект сообщения Telegram.

**Как работает функция**:

1.  Создает инлайн-клавиатуру с кнопкой для подключения PRO-тарифа.
2.  Отправляет счет для оплаты PRO-тарифа.

### `SomeTextsCommand`

```python
def SomeTextsCommand(self, message, ind: int, tokens: dict[str, int]):
```

**Назначение**: Обрабатывает команду генерации нескольких текстов.

**Параметры**:

*   `message`: Объект сообщения Telegram.
*   `ind` (int): Индекс типа текста.
*   `tokens` (dict[str, int]): 
Словарь содержащий данные:
  - "incoming_tokens":
  -  "outgoing_tokens":
  - "free_requests":

**Как работает функция**:

1.  Запрашивает у пользователя количество текстов для генерации.
2.  Запрашивает текст источника для каждого текста.
3.  Запрашивает дополнительные параметры для каждого текста.
4.  Генерирует тексты с использованием нейронной сети.
5.  Отправляет сгенерированные тексты пользователю.

### `ImageCommand`

```python
def ImageCommand(self, message, prompt: str, size: list[int]):
```

**Назначение**: Обрабатывает команду генерации изображения.

**Параметры**:

*   `message`: Объект сообщения Telegram.
*   `prompt` (str): Текстовое описание изображения.
*   `size` (list[int]): Размеры изображения (ширина и высота).

**Как работает функция**:

1.  Генерирует случайное зерно (seed).
2.  Вызывает метод `__FLUX_schnell` для генерации изображения.
3.  Выводит клавиатуру для управления изображением.

### `Image_Regen_And_Upscale`

```python
def Image_Regen_And_Upscale(self, message, prompt: str, size: list[int], seed, num_inference_steps=4):
```

**Назначение**: Генерирует и улучшает изображение.

**Параметры**:

*   `message`: Объект сообщения Telegram.
*   `prompt` (str): Текстовое описание изображения.
*   `size` (list[int]): Размеры изображения (ширина и высота).
*   `seed`: Зерно для генерации случайных чисел.
*   `num_inference_steps` (int, optional): Количество шагов для генерации. Defaults to 4.

**Как работает функция**:

1.  Вызывает метод `__FLUX_schnell` для генерации изображения.

### `FreeCommand`

```python
def FreeCommand(self, message, prompts: list[str]):
```

**Назначение**: Обрабатывает команду в бесплатном режиме.

**Параметры**:

*   `message`: Объект сообщения Telegram.
*   `prompts` (list[str]): Список промптов.

**Как работает функция**:

1.  Добавляет текст сообщения пользователя в список промптов.
2.  Вызывает метод `__gpt_4o_mini` для генерации ответа.
3.  Добавляет ответ модели в список промптов.

### `TarrifEnd`

```python
def TarrifEnd(self, message):
```

**Назначение**: Сообщает об окончании действия тарифа.

**Параметры**:

*   `message`: Объект сообщения Telegram.

**Как работает функция**:

1.  Отправляет пользователю сообщение об окончании действия тарифа и предлагает продлить его.

### `FreeTariffEnd`

```python
def FreeTariffEnd(self, message):
```

**Назначение**: Сообщает об окончании действия бесплатного тарифа.

**Параметры**:

*   `message`: Объект сообщения Telegram.

**Как работает функция**:

1.  Отправляет пользователю сообщение об окончании действия бесплатного тарифа и предлагает выбрать платный тариф.

## Принцип работы

Модуль `ToolBox_requests` предоставляет интерфейс для взаимодействия с Telegram-ботом, обработки различных типов запросов (текстовых, графических, тарифных), а также управления состояниями пользователей и их подписками. Он использует другие модули и библиотеки, такие как `ToolBox_DataBase`, `neural_networks` и `telebot`, для реализации функциональности бота.
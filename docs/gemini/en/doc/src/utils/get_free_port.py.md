# Модуль для поиска свободного порта

## Обзор

Модуль предназначен для поиска свободного порта на указанном хосте. Он предоставляет возможность указать диапазон портов для поиска или найти первый доступный порт, если диапазон не задан.

## Детали

Модуль содержит функцию `get_free_port`, которая принимает хост и опциональный диапазон портов в качестве аргументов. Диапазон портов может быть задан строкой в формате "min-max" или списком строк. Если диапазон не указан, функция ищет первый доступный порт, начиная с 1024.

## Классы

В данном модуле классы отсутствуют.

## Функции

### `get_free_port`

```python
def get_free_port(host: str, port_range: Optional[str | List[str]] = None) -> int:
    """
    Находит и возвращает свободный порт в указанном диапазоне или первый доступный порт, если диапазон не указан.

    Args:
        host (str): Адрес хоста для проверки доступных портов.
        port_range (Optional[str | List[str]], optional): Диапазон портов, заданный строкой "min-max" или списком строк.
               Например: "3000-3999", ["3000-3999", "8000-8010"], None. По умолчанию `None`.

    Returns:
        int: Доступный номер порта.

    Raises:
        ValueError: Если не удается найти свободный порт в указанном диапазоне или если диапазон портов недействителен.
    """
```

**Как работает функция**:
1. Функция `get_free_port` принимает хост и диапазон портов (опционально).
2. Если диапазон портов указан:
   - Проверяется тип `port_range`:
     - Если это строка, то она парсится с помощью `_parse_port_range`.
     - Если это список, то каждый элемент списка (который должен быть строкой) парсится и проверяется.
   - Для каждого порта в указанном диапазоне вызывается функция `_is_port_in_use` для проверки его доступности.
   - Если найден свободный порт, он возвращается.
   - Если ни один порт в диапазоне не свободен, выбрасывается исключение `ValueError`.
3. Если диапазон портов не указан:
   - Функция начинает поиск с порта 1024.
   - Проверяет каждый порт, пока не найдет свободный.
   - Если порт не используется, функция возвращает его.
   - Если ни один порт не найден (порт > 65535), выбрасывается исключение `ValueError`.

**Внутренние функции**:

#### `_is_port_in_use`

```python
def _is_port_in_use(host: str, port: int) -> bool:
    """
    Проверяет, используется ли данный порт на указанном хосте.

    Args:
        host (str): Адрес хоста.
        port (int): Номер порта для проверки.

    Returns:
        bool: True, если порт используется, False в противном случае.
    """
```

**Как работает функция**:
1. Функция создает сокет и пытается привязать его к указанному хосту и порту.
2. Если привязка удалась, это означает, что порт свободен, и функция возвращает `False`.
3. Если возникает исключение `OSError`, это означает, что порт используется, и функция возвращает `True`.

#### `_parse_port_range`

```python
def _parse_port_range(port_range_str: str) -> Tuple[int, int]:
    """
    Разбирает строку диапазона портов "min-max" в кортеж (min_port, max_port).

    Args:
        port_range_str (str): Строка диапазона портов.

    Returns:
        Tuple[int, int]: Кортеж, содержащий минимальный и максимальный номера портов.

    Raises:
        ValueError: Если формат строки диапазона портов недействителен.
    """
```

**Как работает функция**:
1. Функция принимает строку, представляющую диапазон портов в формате "min-max".
2. Разбивает строку на две части по разделителю '-'.
3. Преобразует каждую часть в целое число.
4. Проверяет, что `min_port` меньше `max_port`.
5. Если все проверки пройдены, функция возвращает кортеж `(min_port, max_port)`.
6. Если формат строки недействителен или `min_port` больше или равен `max_port`, выбрасывается исключение `ValueError`.

**Примеры**:

```python
get_free_port('localhost', '3000-3005')
get_free_port('localhost', ['3000-3005', '8000-8010'])
get_free_port('localhost')
```
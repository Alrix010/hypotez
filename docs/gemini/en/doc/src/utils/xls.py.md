# Модуль для работы с XLS-файлами

## Обзор

Модуль `src.utils.xls` предоставляет функциональность для конвертации Excel-файлов в формат JSON и наоборот. Он включает функции для чтения данных из Excel-файлов в виде словарей и сохранения JSON-данных в Excel-файлы.

## Более подробно

Модуль предназначен для облегчения обмена данными между Excel-файлами и JSON-форматом. Он поддерживает чтение данных из определенных листов Excel, обработку нескольких листов, а также сохранение данных в Excel-файлы с использованием библиотеки `pandas`.

## Классы

В данном модуле классы отсутствуют.

## Функции

### `read_xls_as_dict`

```python
def read_xls_as_dict(
    xls_file: str,
    json_file: str = None,
    sheet_name: Union[str, int] = None
) -> Union[Dict, List[Dict], bool]:
    """
    Читает Excel-файл и преобразует его в JSON. Опционально преобразует указанный лист и сохраняет результат в JSON-файл.
    Обрабатывает ошибки.

    Args:
        xls_file (str): Путь к Excel-файлу.
        json_file (str, optional): Путь для сохранения JSON-файла. По умолчанию `None`.
        sheet_name (Union[str, int], optional): Имя или индекс листа для чтения. По умолчанию `None`.

    Returns:
        Union[Dict, List[Dict], bool]: Словарь с данными, список словарей (если указан конкретный лист) или `False` в случае ошибки.
    """
```

**Назначение**:
Функция `read_xls_as_dict` предназначена для чтения данных из Excel-файла и преобразования их в формат JSON. Она позволяет читать весь файл или конкретный лист, а также сохранять полученные данные в JSON-файл.

**Параметры**:
- `xls_file` (str): Путь к Excel-файлу, который требуется прочитать.
- `json_file` (str, optional): Путь к JSON-файлу, в который будут сохранены данные. Если не указан, данные не сохраняются в файл. По умолчанию `None`.
- `sheet_name` (Union[str, int], optional): Имя или индекс листа Excel, который нужно прочитать. Если не указан, читаются все листы. По умолчанию `None`.

**Возвращает**:
- `Union[Dict, List[Dict], bool]`: Возвращает словарь, где ключи - имена листов, а значения - списки словарей, представляющие строки данных. Если указан `sheet_name`, возвращается список словарей. В случае ошибки возвращает `False`.

**Как работает функция**:

1. Функция принимает путь к Excel-файлу, опциональный путь для сохранения JSON-файла и опциональное имя листа.
2. Проверяет существование указанного Excel-файла. Если файл не найден, логирует ошибку и возвращает `False`.
3. Использует библиотеку `pandas` для чтения Excel-файла.
4. Если `sheet_name` не указан, читает все листы в файле и сохраняет данные каждого листа в словарь `data_dict`, где ключи - имена листов.
5. Если `sheet_name` указан, читает только указанный лист и преобразует его в список словарей.
6. Если указан `json_file`, сохраняет полученные данные в JSON-файл с отступом в 4 пробела для читаемости.
7. В случае возникновения исключений, логирует ошибку и возвращает `False`.

**Примеры**:

```python
# Чтение всего Excel-файла
data = read_xls_as_dict('input.xlsx')

# Чтение определенного листа Excel-файла и сохранение в JSON
data = read_xls_as_dict('input.xlsx', 'output.json', 'Sheet1')

# Обработка ошибки при отсутствии файла
data = read_xls_as_dict('missing_file.xlsx')
if data is False:
    print("Файл не найден")
```

### `save_xls_file`

```python
def save_xls_file(data: Dict[str, List[Dict]], file_path: str) -> bool:
    """Сохраняет JSON данные в Excel-файл. Обрабатывает ошибки."""
```

**Назначение**:
Функция `save_xls_file` предназначена для сохранения JSON-данных в Excel-файл. Она принимает словарь, где ключи - имена листов, а значения - списки словарей, представляющие строки данных.

**Параметры**:
- `data` (Dict[str, List[Dict]]): Словарь, где ключи - имена листов, а значения - списки словарей, представляющие строки данных.
- `file_path` (str): Путь к Excel-файлу, в который нужно сохранить данные.

**Возвращает**:
- `bool`: Возвращает `True` в случае успешного сохранения данных в Excel-файл и `False` в случае ошибки.

**Как работает функция**:

1. Функция принимает словарь с данными и путь к файлу для сохранения.
2. Использует библиотеку `pandas` и `ExcelWriter` для записи данных в Excel-файл.
3. Перебирает все листы и соответствующие им данные из входного словаря.
4. Для каждого листа создает DataFrame из списка словарей.
5. Сохраняет DataFrame в соответствующий лист Excel-файла.
6. В случае возникновения исключений, логирует ошибку и возвращает `False`.

**Примеры**:

```python
# Сохранение данных в Excel-файл
data_to_save = {'Sheet1': [{'column1': 'value1', 'column2': 'value2'}]}
success = save_xls_file(data_to_save, 'output.xlsx')
if success:
    print("Успешно сохранено в output.xlsx")

# Обработка ошибки при сохранении
data_to_save = {'Sheet1': [{'column1': 'value1', 'column2': 'value2'}]}
success = save_xls_file(data_to_save, '/invalid/path/output.xlsx')
if not success:
    print("Ошибка при сохранении файла")
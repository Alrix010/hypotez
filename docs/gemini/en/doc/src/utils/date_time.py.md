# Модуль `src.utils.date_time`

## Обзор

Модуль содержит функции для проверки, находится ли текущее время в заданном интервале, с возможностью установки таймаута. Он также включает функцию для ожидания ввода пользователя с таймаутом.

## Подробнее

Этот модуль предоставляет класс `TimeoutCheck`, который позволяет определить, попадает ли текущее время в заданный временной интервал. Это полезно для выполнения операций, которые должны происходить только в определенные периоды времени (например, ночное обслуживание). Временной интервал по умолчанию — с 23:00 до 06:00, и функция может обрабатывать интервалы, охватывающие полночь.

Кроме того, модуль предоставляет функциональность для ожидания ответа с таймаутом и для получения ввода пользователя с таймаутом.

## Классы

### `TimeoutCheck`

**Описание**: Класс для проверки временных интервалов и ожидания ввода пользователя с таймаутом.
**Атрибуты**:
    - `result` (bool | None): Результат проверки временного интервала.
    - `user_input` (str | None): Ввод пользователя.

**Методы**:
    - `__init__`: Инициализирует экземпляр класса `TimeoutCheck`.
    - `interval`: Проверяет, находится ли текущее время в заданном интервале.
    - `interval_with_timeout`: Проверяет, находится ли текущее время в заданном интервале с таймаутом.
    - `get_input`: Запрашивает ввод от пользователя.
    - `input_with_timeout`: Ожидает ввод пользователя с таймаутом.

#### `__init__`

```python
    def __init__(self):
        """ Инициализирует экземпляр класса `TimeoutCheck`."""
        self.result = None
```

#### `interval`

```python
    def interval(self, start: time = time(23, 0), end: time = time(6, 0)) -> bool:
        """ Проверяет, находится ли текущее время в заданном интервале.
        
        Args:
            start (time): Начало интервала (по умолчанию 23:00).
            end (time): Конец интервала (по умолчанию 06:00).

        Returns:
            bool: `True`, если текущее время находится в интервале, `False` в противном случае.
        """
        current_time = datetime.now().time()

        if start < end:
            # Интервал в пределах одного дня (например, с 08:00 до 17:00)
            self.result = start <= current_time <= end
        else:
            # Интервал, охватывающий полночь (например, с 23:00 до 06:00)
            self.result = current_time >= start or current_time <= end
```

**Как работает**:
- Функция получает текущее время.
- Если время начала интервала меньше времени окончания интервала, то проверяется, находится ли текущее время между временем начала и временем окончания интервала.
- Если время начала интервала больше времени окончания интервала, то проверяется, находится ли текущее время после времени начала или до времени окончания интервала (для интервалов, пересекающих полночь).

**Примеры**:

```python
timeout_check = TimeoutCheck()
if timeout_check.interval(start=time(22, 0), end=time(7, 0)):
    print("Текущее время находится в интервале.")
else:
    print("Текущее время находится вне интервала.")
```

#### `interval_with_timeout`

```python
    def interval_with_timeout(self, timeout: int = 5, start: time = time(23, 0), end: time = time(6, 0)) -> bool:
        """ Проверяет, находится ли текущее время в заданном интервале с таймаутом.

        Args:
            timeout (int): Время в секундах для ожидания проверки интервала.
            start (time): Начало интервала (по умолчанию 23:00).
            end (time): Конец интервала (по умолчанию 06:00).

        Returns:
            bool: `True`, если текущее время находится в интервале и ответ получен в течение таймаута, `False`, если нет или произошел таймаут.
        """
        thread = threading.Thread(target=self.interval, args=(start, end))
        thread.start()
        thread.join(timeout)

        if thread.is_alive():
            print(f"Таймаут произошел после {timeout} секунд, продолжение выполнения.")
            thread.join()  # Гарантирует остановку потока после таймаута
            return False  # Произошел таймаут, поэтому возвращаем `False`
        return self.result
```

**Как работает**:
- Функция создает новый поток для выполнения проверки временного интервала.
- Запускает поток и ждет его завершения в течение заданного времени ожидания.
- Если поток не завершился в течение времени ожидания, то функция возвращает `False`.
- Если поток завершился в течение времени ожидания, то функция возвращает результат проверки временного интервала.

**Примеры**:

```python
timeout_check = TimeoutCheck()
if timeout_check.interval_with_timeout(timeout=10, start=time(22, 0), end=time(7, 0)):
    print("Текущее время находится в интервале.")
else:
    print("Текущее время находится вне интервала или произошел таймаут.")
```

#### `get_input`

```python
    def get_input(self):
        """ Запрашиваем ввод от пользователя."""
        self.user_input = input("U:> ")
```
#### `input_with_timeout`

```python
    def input_with_timeout(self, timeout: int = 5) -> str | None:
        """ Ожидаем ввод с тайм-аутом.

        Args:
            timeout (int): Время ожидания ввода в секундах.

        Returns:
            str | None: Введенные данные или `None`, если был тайм-аут.
        """
        # Запускаем поток для получения ввода от пользователя
        thread = threading.Thread(target=self.get_input)
        thread.start()

        # Ожидаем завершения потока или тайм-аут
        thread.join(timeout)

        if thread.is_alive():
            print(f"Таймаут произошел после {timeout} секунд.")
            return  # Возвращаем None, если тайм-аут произошел

        return self.user_input
```

**Как работает**:
- Функция создает новый поток для получения ввода от пользователя.
- Запускает поток и ждет его завершения в течение заданного времени ожидания.
- Если поток не завершился в течение времени ожидания, функция возвращает `None`.
- Если поток завершился в течение времени ожидания, функция возвращает введенные пользователем данные.

**Примеры**:

```python
timeout_check = TimeoutCheck()
user_input = timeout_check.input_with_timeout(timeout=5)
if user_input:
    print(f"Вы ввели: {user_input}")
else:
    print("Таймаут ввода.")
```
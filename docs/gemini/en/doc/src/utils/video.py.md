# Модуль: src.utils.video

## Обзор

Модуль `src.utils.video` предоставляет асинхронные функции для загрузки и сохранения видеофайлов, а также для получения видеоданных. Он включает в себя обработку ошибок и логирование для обеспечения надежной работы.

## Подробнее

Этот модуль предназначен для работы с видеофайлами, предоставляя функции для их асинхронной загрузки и сохранения, а также для извлечения двоичных данных. Он используется в проекте для обеспечения возможности загрузки видео по URL-адресу и сохранения их локально, а также для чтения видеоданных из локальных файлов. Модуль обрабатывает различные ошибки, такие как сетевые проблемы и ошибки файловой системы, и использует логирование для отслеживания операций и ошибок.

## Функции

### `save_video_from_url`

```python
async def save_video_from_url(
    url: str,
    save_path: str
) -> Optional[Path]:
    """
    Асинхронно загружает видео по URL-адресу и сохраняет его локально.

    Args:
        url (str): URL-адрес, с которого необходимо загрузить видео.
        save_path (str): Путь для сохранения загруженного видео.

    Returns:
        Optional[Path]: Путь к сохраненному файлу или `None`, если операция не удалась. Возвращает `None` в случае ошибок и если размер файла равен 0 байт.

    Raises:
        aiohttp.ClientError: При сетевых проблемах во время загрузки.
    """
    ...
```

**Назначение**:
Функция `save_video_from_url` асинхронно загружает видеофайл с заданного URL-адреса и сохраняет его по указанному пути. Функция выполняет проверку на наличие HTTP-ошибок и создает родительские каталоги, если они не существуют. После сохранения файла выполняются проверки для убеждения, что файл был успешно сохранен и не является пустым.

**Как работает функция**:
1. Принимает URL-адрес видео и путь для сохранения.
2. Использует `aiohttp.ClientSession` для асинхронного выполнения HTTP-запроса к указанному URL-адресу.
3. Проверяет статус ответа на наличие HTTP-ошибок.
4. Создает родительские каталоги для пути сохранения, если они не существуют.
5. Асинхронно читает содержимое ответа частями (chunks) и записывает их в файл, используя `aiofiles`.
6. После завершения загрузки проверяет, был ли файл успешно сохранен и не является ли он пустым.
7. В случае успеха возвращает путь к сохраненному файлу; в противном случае возвращает `None`.
8. Ловит исключения `aiohttp.ClientError` при сетевых проблемах и общие исключения при ошибках сохранения, логируя их с использованием `logger.error`.

**Примеры**:

```python
import asyncio
from pathlib import Path

# Пример успешной загрузки
url = "https://example.com/video.mp4"  # Замените на реальный URL-адрес
save_path = "local_video.mp4"
result = asyncio.run(save_video_from_url(url, save_path))
if result:
    print(f"Видео сохранено по пути: {result}")
else:
    print("Не удалось сохранить видео.")

# Пример обработки ошибки
url = "https://example.com/nonexistent_video.mp4"  # Несуществующий URL-адрес
save_path = "local_video.mp4"
result = asyncio.run(save_video_from_url(url, save_path))
if result:
    print(f"Видео сохранено по пути: {result}")
else:
    print("Не удалось сохранить видео.")
```

### `get_video_data`

```python
def get_video_data(file_name: str) -> Optional[bytes]:
    """
    Извлекает двоичные данные видеофайла, если он существует.

    Args:
        file_name (str): Путь к видеофайлу для чтения.

    Returns:
        Optional[bytes]: Двоичные данные файла, если он существует, или `None`, если файл не найден или произошла ошибка.
    """
    ...
```

**Назначение**:
Функция `get_video_data` извлекает двоичные данные из указанного видеофайла.

**Как работает функция**:
1. Принимает путь к видеофайлу.
2. Проверяет, существует ли файл по указанному пути. Если файл не существует, функция логирует ошибку и возвращает `None`.
3. Если файл существует, функция открывает его в двоичном режиме чтения (`"rb"`) и считывает все его содержимое.
4. В случае успеха функция возвращает двоичные данные файла.
5. Если во время чтения файла возникает исключение, функция логирует ошибку и возвращает `None`.

**Примеры**:

```python
# Пример успешного чтения данных
file_name = "local_video.mp4"
data = get_video_data(file_name)
if data:
    print(f"Длина видеоданных: {len(data)} байт")
else:
    print("Не удалось прочитать видеоданные.")

# Пример обработки ошибки, когда файл не найден
file_name = "nonexistent_video.mp4"
data = get_video_data(file_name)
if data:
    print(f"Длина видеоданных: {len(data)} байт")
else:
    print("Не удалось прочитать видеоданные.")
```

### `main`

```python
def main():
    url = "https://example.com/video.mp4"  # Replace with a valid URL!
    save_path = "local_video.mp4"
    result = asyncio.run(save_video_from_url(url, save_path))
    if result:
        print(f"Video saved to {result}")
```

**Назначение**:
Функция `main` является точкой входа для запуска примера использования функций модуля.

**Как работает функция**:
1. Определяет URL-адрес видео и путь для сохранения.
2. Вызывает асинхронную функцию `save_video_from_url` для загрузки и сохранения видео.
3. Выводит сообщение об успешном сохранении видео или о неудаче.

**Примеры**:

```python
# Пример запуска функции main
if __name__ == "__main__":
    main()
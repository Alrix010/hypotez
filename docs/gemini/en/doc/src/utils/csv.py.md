# Модуль `src.utils.csv`

## Обзор

Модуль `src.utils.csv` предоставляет утилиты для работы с CSV и JSON файлами. Он включает в себя функции для сохранения данных в CSV файлы, чтения данных из CSV файлов, преобразования CSV файлов в JSON формат, а также для представления CSV данных в виде словарей.

## Более подробно

Этот модуль предоставляет набор функций для упрощения операций с CSV и JSON файлами. Он использует библиотеки `csv`, `json`, `pathlib`, `typing` и `pandas` для обеспечения функциональности. Функции модуля позволяют сохранять, читать и преобразовывать данные между форматами CSV и JSON, а также представлять CSV данные в различных структурах данных Python, таких как списки словарей и словари.

## Функции

### `save_csv_file`

```python
def save_csv_file(
    data: List[Dict[str, str]],
    file_path: Union[str, Path],
    mode: str = 'a',
    exc_info: bool = True,
) -> bool:
    """ Функция сохраняет список словарей в CSV файл.

    Args:
        data (List[Dict[str, str]]): Список словарей для сохранения.
        file_path (Union[str, Path]): Путь к CSV файлу.
        mode (str): Режим файла ('a' для добавления, 'w' для перезаписи). По умолчанию 'a'.
        exc_info (bool): Включать ли информацию об отладке в логи.

    Returns:
        bool: True, если успешно, иначе False.

    Raises:
        TypeError: Если входные данные не являются списком словарей.
        ValueError: Если входные данные пусты.
    """
    ...
```

**Назначение**: Сохраняет список словарей в CSV файл.

**Параметры**:
- `data` (List[Dict[str, str]]): Список словарей, который требуется сохранить в CSV файл. Каждый словарь представляет собой строку в CSV файле, где ключи словаря являются заголовками столбцов.
- `file_path` (Union[str, Path]): Путь к CSV файлу, в который будут сохранены данные. Может быть представлен как строкой, так и объектом `Path`.
- `mode` (str, optional): Режим открытия файла. `'a'` означает добавление данных в конец файла, если он существует, или создание нового файла, если он не существует. `'w'` означает перезапись файла, если он существует, или создание нового файла, если он не существует. По умолчанию `'a'`.
- `exc_info` (bool, optional): Флаг, определяющий, следует ли включать расширенную информацию об исключениях в логи. Если `True`, в логи будут включены трассировка стека и другие детали, полезные для отладки. По умолчанию `True`.

**Возвращает**:
- `bool`: Возвращает `True`, если данные успешно сохранены в CSV файл. Возвращает `False`, если произошла ошибка во время сохранения данных.

**Возможные исключения**:
- `TypeError`: Возникает, если входные данные (`data`) не являются списком словарей.
- `ValueError`: Возникает, если входные данные (`data`) пусты.

**Как работает функция**:
1. Проверяет, что входные данные являются списком словарей. Если это не так, вызывает исключение `TypeError`.
2. Проверяет, что входные данные не пусты. Если это так, вызывает исключение `ValueError`.
3. Преобразует путь к файлу в объект `Path`.
4. Создает родительские директории для файла, если они не существуют.
5. Открывает файл в указанном режиме (`mode`) с кодировкой UTF-8.
6. Создает объект `csv.DictWriter` для записи словарей в CSV файл.
7. Если файл открыт в режиме записи (`'w'`) или файл не существует, записывает заголовки столбцов (ключи первого словаря) в файл.
8. Записывает все строки (словари) в файл.
9. В случае возникновения исключения, логирует ошибку и возвращает `False`.

**Примеры**:

```python
from pathlib import Path
from src.utils.csv import save_csv_file

data = [{'name': 'Alice', 'age': '30'}, {'name': 'Bob', 'age': '25'}]
file_path = Path('output.csv')
result = save_csv_file(data, file_path, mode='w')
print(result)  # Вывод: True

data = [{'name': 'Charlie', 'age': '35'}]
file_path = Path('output.csv')
result = save_csv_file(data, file_path, mode='a')
print(result)  # Вывод: True
```

### `read_csv_file`

```python
def read_csv_file(file_path: Union[str, Path], exc_info: bool = True) -> List[Dict[str, str]] | None:
    """ Функция читает содержимое CSV файла в виде списка словарей.

    Args:
        file_path (Union[str, Path]): Путь к CSV файлу.
        exc_info (bool): Включать ли информацию об отладке в логи.

    Returns:
        List[Dict[str, str]] | None: Список словарей или None, если чтение не удалось.

    Raises:
        FileNotFoundError: Если файл не найден.
    """
    ...
```

**Назначение**: Читает содержимое CSV файла и возвращает его в виде списка словарей.

**Параметры**:
- `file_path` (Union[str, Path]): Путь к CSV файлу, который требуется прочитать. Может быть представлен как строкой, так и объектом `Path`.
- `exc_info` (bool, optional): Флаг, определяющий, следует ли включать расширенную информацию об исключениях в логи. Если `True`, в логи будут включены трассировка стека и другие детали, полезные для отладки. По умолчанию `True`.

**Возвращает**:
- `List[Dict[str, str]] | None`: Возвращает список словарей, где каждый словарь представляет собой строку из CSV файла. Ключи словаря соответствуют заголовкам столбцов в CSV файле. Если файл не найден или произошла ошибка во время чтения, возвращает `None`.

**Возможные исключения**:
- `FileNotFoundError`: Возникает, если файл, указанный в `file_path`, не существует.

**Как работает функция**:
1. Открывает файл, указанный в `file_path`, в режиме чтения с кодировкой UTF-8.
2. Создает объект `csv.DictReader` для чтения CSV файла как списка словарей.
3. Преобразует и возвращает содержимое файла в виде списка словарей.
4. Если возникает исключение `FileNotFoundError`, логирует ошибку и возвращает `None`.
5. В случае возникновения другого исключения, логирует ошибку и возвращает `None`.

**Примеры**:

```python
from pathlib import Path
from src.utils.csv import read_csv_file

file_path = Path('output.csv')
data = read_csv_file(file_path)
print(data)
# Вывод:
# [{'name': 'Alice', 'age': '30'}, {'name': 'Bob', 'age': '25'}, {'name': 'Charlie', 'age': '35'}]
```

### `read_csv_as_json`

```python
def read_csv_as_json(csv_file_path: Union[str, Path], json_file_path: Union[str, Path], exc_info: bool = True) -> bool:
    """ Функция преобразует CSV файл в JSON формат и сохраняет его.

    Args:
        csv_file_path (Union[str, Path]): Путь к CSV файлу.
        json_file_path (Union[str, Path]): Путь для сохранения JSON файла.
        exc_info (bool): Включать ли информацию об отладке в логи.

    Returns:
        bool: True, если преобразование успешно, иначе False.
    """
    ...
```

**Назначение**: Преобразует CSV файл в JSON формат и сохраняет его в указанный файл.

**Параметры**:
- `csv_file_path` (Union[str, Path]): Путь к CSV файлу, который требуется преобразовать. Может быть представлен как строкой, так и объектом `Path`.
- `json_file_path` (Union[str, Path]): Путь к файлу, в который будет сохранен JSON. Может быть представлен как строкой, так и объектом `Path`.
- `exc_info` (bool, optional): Флаг, определяющий, следует ли включать расширенную информацию об исключениях в логи. Если `True`, в логи будут включены трассировка стека и другие детали, полезные для отладки. По умолчанию `True`.

**Возвращает**:
- `bool`: Возвращает `True`, если преобразование и сохранение JSON файла прошли успешно. Возвращает `False`, если произошла ошибка во время преобразования или сохранения.

**Как работает функция**:
1. Читает CSV файл с помощью функции `read_csv_file`.
2. Если чтение CSV файла не удалось (функция `read_csv_file` вернула `None`), возвращает `False`.
3. Открывает файл, указанный в `json_file_path`, в режиме записи с кодировкой UTF-8.
4. Записывает данные в файл в формате JSON с отступами для читаемости.
5. В случае возникновения исключения, логирует ошибку и возвращает `False`.

**Примеры**:

```python
from pathlib import Path
from src.utils.csv import read_csv_as_json

csv_file_path = Path('output.csv')
json_file_path = Path('output.json')
result = read_csv_as_json(csv_file_path, json_file_path)
print(result)  # Вывод: True
```

### `read_csv_as_dict`

```python
def read_csv_as_dict(csv_file: Union[str, Path]) -> dict | None:
    """ Функция преобразует содержимое CSV файла в словарь.

    Args:
        csv_file (Union[str, Path]): Путь к CSV файлу.

    Returns:
        dict | None: Словарь, представляющий содержимое CSV файла, или None, если чтение не удалось.
    """
    ...
```

**Назначение**: Читает содержимое CSV файла и возвращает его в виде словаря, где ключ `"data"` содержит список словарей, представляющих строки CSV файла.

**Параметры**:
- `csv_file` (Union[str, Path]): Путь к CSV файлу, который требуется прочитать. Может быть представлен как строкой, так и объектом `Path`.

**Возвращает**:
- `dict | None`: Возвращает словарь, содержащий ключ `"data"`, значением которого является список словарей, представляющих строки из CSV файла. Ключи словарей соответствуют заголовкам столбцов в CSV файле. Если файл не найден или произошла ошибка во время чтения, возвращает `None`.

**Как работает функция**:
1. Открывает файл, указанный в `csv_file`, в режиме чтения с кодировкой UTF-8.
2. Создает объект `csv.DictReader` для чтения CSV файла как списка словарей.
3. Преобразует и возвращает содержимое файла в виде словаря с ключом `"data"` и списком словарей в качестве значения.
4. В случае возникновения исключения, логирует ошибку и возвращает `None`.

**Примеры**:

```python
from pathlib import Path
from src.utils.csv import read_csv_as_dict

csv_file = Path('output.csv')
data = read_csv_as_dict(csv_file)
print(data)
# Вывод:
# {'data': [{'name': 'Alice', 'age': '30'}, {'name': 'Bob', 'age': '25'}, {'name': 'Charlie', 'age': '35'}]}
```

### `read_csv_as_ns`

```python
def read_csv_as_ns(file_path: Union[str, Path]) -> List[dict]:
    """!
    Функция загружает CSV данные в список словарей, используя Pandas.

    Args:
        file_path (Union[str, Path]): Путь к CSV файлу.

    Returns:
        List[dict]: Список словарей, представляющий содержимое CSV файла.

    Raises:
        FileNotFoundError: Если файл не найден.
    """
    ...
```

**Назначение**: Загружает CSV данные в список словарей, используя библиотеку `pandas`.

**Параметры**:
- `file_path` (Union[str, Path]): Путь к CSV файлу, который требуется прочитать. Может быть представлен как строкой, так и объектом `Path`.

**Возвращает**:
- `List[dict]`: Возвращает список словарей, где каждый словарь представляет строку из CSV файла. Ключи словаря соответствуют заголовкам столбцов в CSV файле. Если файл не найден или произошла ошибка во время чтения, возвращает пустой список `[]`.

**Возможные исключения**:
- `FileNotFoundError`: Возникает, если файл, указанный в `file_path`, не существует.

**Как работает функция**:
1. Читает CSV файл с помощью функции `pd.read_csv` из библиотеки `pandas`.
2. Преобразует данные в список словарей с помощью метода `to_dict(orient='records')`.
3. В случае возникновения исключения `FileNotFoundError`, логирует ошибку и возвращает пустой список `[]`.
4. В случае возникновения другого исключения, логирует ошибку и возвращает пустой список `[]`.

**Примеры**:

```python
from pathlib import Path
from src.utils.csv import read_csv_as_ns

file_path = Path('output.csv')
data = read_csv_as_ns(file_path)
print(data)
# Вывод:
# [{'name': 'Alice', 'age': '30'}, {'name': 'Bob', 'age': '25'}, {'name': 'Charlie', 'age': '35'}]
# Модуль user_router

## Обзор

Этот модуль отвечает за обработку запросов от пользователей бота.

## Details

Модуль содержит набор функций-обработчиков, которые активируются при получении определенных команд или нажатиях на кнопки. 
В нем реализованы следующие действия:

- **Обработка команды /start**: При запуске бота пользователь регистрируется и получает приветственное сообщение с основным меню.
- **Обработка кнопки "Главная"**: Возвращает пользователя на главную страницу с основным меню.
- **Обработка кнопки "О магазине"**: Выводит информацию о магазине, разработчике и тестовые данные для оплаты.
- **Обработка кнопки "Профиль"**: Выводит информацию о профиле пользователя, включая количество покупок и общую сумму.
- **Обработка кнопки "Мои покупки"**: Показывает список покупок пользователя, а также информацию о каждом товаре, включая название, описание, цену и, если есть, файл товара.

## Классы

### `user_router`

**Описание**: Роутер для обработки запросов от пользователей бота.

**Атрибуты**:

- `user_router` (Router): Объект роутера, используемый для определения маршрутов и обработчиков.

**Методы**:

- `cmd_start(message: Message, session_with_commit: AsyncSession)`: Обрабатывает команду `/start`. 
- `page_home(call: CallbackQuery)`: Обрабатывает кнопку "Главная".
- `page_about(call: CallbackQuery)`: Обрабатывает кнопку "О магазине".
- `page_about(call: CallbackQuery, session_without_commit: AsyncSession)`: Обрабатывает кнопку "Профиль".
- `page_user_purchases(call: CallbackQuery, session_without_commit: AsyncSession)`: Обрабатывает кнопку "Мои покупки".

## Функции

### `cmd_start`

**Описание**: Обрабатывает команду `/start`.

**Параметры**:

- `message` (Message): Объект сообщения от Telegram.
- `session_with_commit` (AsyncSession): Объект сессии базы данных.

**Returns**:

- `None`

**Описание работы**:

- Проверяет наличие записи о пользователе в базе данных по Telegram ID.
- Если запись существует, выводит приветственное сообщение с основным меню.
- Если запись не существует, создает новую запись о пользователе в базе данных и выводит приветственное сообщение с основным меню.

### `page_home`

**Описание**: Обрабатывает кнопку "Главная".

**Параметры**:

- `call` (CallbackQuery): Объект запроса на изменение сообщения.

**Returns**:

- `None`

**Описание работы**:

- Отправляет пользователю сообщение "Главная страница".
- Выводит приветственное сообщение с основным меню.

### `page_about`

**Описание**: Обрабатывает кнопку "О магазине".

**Параметры**:

- `call` (CallbackQuery): Объект запроса на изменение сообщения.

**Returns**:

- `None`

**Описание работы**:

- Отправляет пользователю сообщение "О магазине".
- Выводит информацию о магазине, разработчике и тестовые данные для оплаты.

### `page_about`

**Описание**: Обрабатывает кнопку "Профиль".

**Параметры**:

- `call` (CallbackQuery): Объект запроса на изменение сообщения.
- `session_without_commit` (AsyncSession): Объект сессии базы данных без автоматического коммита.

**Returns**:

- `None`

**Описание работы**:

- Отправляет пользователю сообщение "Профиль".
- Извлекает информацию о статистике покупок пользователя из базы данных.
- Формирует сообщение с информацией о профиле пользователя в зависимости от наличия покупок.

### `page_user_purchases`

**Описание**: Обрабатывает кнопку "Мои покупки".

**Параметры**:

- `call` (CallbackQuery): Объект запроса на изменение сообщения.
- `session_without_commit` (AsyncSession): Объект сессии базы данных без автоматического коммита.

**Returns**:

- `None`

**Описание работы**:

- Отправляет пользователю сообщение "Мои покупки".
- Удаляет предыдущее сообщение.
- Извлекает список покупок пользователя из базы данных.
- Если покупок нет, выводит сообщение об отсутствии покупок и возвращается.
- Для каждой покупки отправляет информацию о товаре, включая название, описание, цену и, если есть, файл товара.
- Выводит сообщение с благодарностью за доверие и основным меню.

## Parameter Details

- `message` (Message): Объект сообщения от Telegram, содержащий информацию о пользователе, тексте сообщения, команде и т. д.
- `session_with_commit` (AsyncSession): Объект сессии базы данных для взаимодействия с данными.
- `call` (CallbackQuery): Объект запроса на изменение сообщения, полученного от пользователя после нажатия на кнопку.
- `session_without_commit` (AsyncSession): Объект сессии базы данных без автоматического коммита для взаимодействия с данными без сохранения изменений.

## Examples

### Пример использования `cmd_start`

```python
# Вызов функции при получении команды /start
@user_router.message(CommandStart())
async def cmd_start(message: Message, session_with_commit: AsyncSession):
    ...
```

### Пример использования `page_home`

```python
# Вызов функции при нажатии на кнопку "Главная"
@user_router.callback_query(F.data == "home")
async def page_home(call: CallbackQuery):
    ...
```

### Пример использования `page_about`

```python
# Вызов функции при нажатии на кнопку "О магазине"
@user_router.callback_query(F.data == "about")
async def page_about(call: CallbackQuery):
    ...
```

### Пример использования `page_about`

```python
# Вызов функции при нажатии на кнопку "Профиль"
@user_router.callback_query(F.data == "my_profile")
async def page_about(call: CallbackQuery, session_without_commit: AsyncSession):
    ...
```

### Пример использования `page_user_purchases`

```python
# Вызов функции при нажатии на кнопку "Мои покупки"
@user_router.callback_query(F.data == "purchases")
async def page_user_purchases(call: CallbackQuery, session_without_commit: AsyncSession):
    ...
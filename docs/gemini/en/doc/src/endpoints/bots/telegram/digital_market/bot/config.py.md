# Документация модуля `config.py`

## Обзор

Модуль `config.py` предназначен для управления настройками Telegram-бота для цифрового рынка. Он использует `pydantic-settings` для загрузки переменных окружения из файла `.env` и предоставляет доступ к этим настройкам через класс `Settings`. Модуль также инициализирует бота `aiogram` и диспетчер, а также настраивает логирование.

## Подробнее

Этот модуль является центральным местом для хранения конфигурации бота, что позволяет легко управлять параметрами, такими как токен бота, идентификаторы администраторов, URL-адреса сайта и учетные данные для доступа к внешним сервисам. Использование `pydantic-settings` обеспечивает проверку типов и автоматическое преобразование переменных окружения, что снижает вероятность ошибок конфигурации.

## Классы

### `Settings`

**Описание**: Класс `Settings` наследуется от `BaseSettings` и предоставляет доступ к настройкам бота через атрибуты. Он также содержит методы для динамического формирования URL-адресов вебхуков.

**Наследует**:
- `BaseSettings` из `pydantic_settings`

**Атрибуты**:
- `BOT_TOKEN` (str): Токен Telegram-бота.
- `ADMIN_IDS` (List[int]): Список идентификаторов администраторов бота.
- `PROVIDER_TOKEN` (str): Токен провайдера платежей (например, Robokassa).
- `FORMAT_LOG` (str): Формат записи логов (по умолчанию "{time:YYYY-MM-DD at HH:mm:ss} | {level} | {message}").
- `LOG_ROTATION` (str): Параметры ротации логов (по умолчанию "10 MB").
- `DB_URL` (str): URL-адрес базы данных (по умолчанию 'sqlite+aiosqlite:///data/db.sqlite3').
- `SITE_URL` (str): URL-адрес сайта.
- `SITE_HOST` (str): Хост сайта.
- `SITE_PORT` (int): Порт сайта.
- `MRH_LOGIN` (str): Логин для доступа к <инструкция для gemini model: укажите название сервиса, например, "сервису мерчанта">.
- `MRH_PASS_1` (str): Пароль 1 для доступа к <инструкция для gemini model: укажите название сервиса, например, "сервису мерчанта">.
- `MRH_PASS_2` (str): Пароль 2 для доступа к <инструкция для gemini model: укажите название сервиса, например, "сервису мерчанта">.
- `IN_TEST` (int): Флаг, указывающий на тестовый режим (1 - включен, 0 - выключен).
- `model_config` (SettingsConfigDict): Конфигурация для `pydantic-settings`, указывающая на расположение файла `.env`.

**Принцип работы**:
Класс `Settings` использует `pydantic-settings` для автоматической загрузки и проверки переменных окружения из файла `.env`. Файл `.env` должен находиться в директории на уровень выше текущей (`config.py`).  При создании экземпляра класса `Settings`, `pydantic-settings` автоматически считывает переменные из `.env` и присваивает их соответствующим атрибутам класса. Это позволяет избежать ручного чтения переменных окружения и обеспечивает проверку их типов.

## Методы класса

### `get_webhook_url`

```python
def get_webhook_url(self) -> str:
    """Динамически формирует путь для вебхука на основе токена и URL сайта."""
```

**Назначение**: Формирует URL-адрес для вебхука Telegram-бота.

**Параметры**:
- `self` (Settings): Экземпляр класса `Settings`.

**Возвращает**:
- `str`: URL-адрес вебхука, сформированный как `f"{self.SITE_URL}/{self.BOT_TOKEN}"`.

**Принцип работы**:
Метод `get_webhook_url` составляет URL вебхука, объединяя `SITE_URL` и `BOT_TOKEN` из настроек.

**Пример**:
```python
settings = Settings()
webhook_url = settings.get_webhook_url
print(webhook_url)
```

### `get_provider_hook_url`

```python
def get_provider_hook_url(self) -> str:
    """Динамически формирует путь для вебхука на основе токена и URL сайта."""
```

**Назначение**: Формирует URL-адрес для вебхука провайдера платежей (например, Robokassa).

**Параметры**:
- `self` (Settings): Экземпляр класса `Settings`.

**Возвращает**:
- `str`: URL-адрес вебхука провайдера, сформированный как `f"{self.SITE_URL}/robokassa"`.

**Принцип работы**:
Метод `get_provider_hook_url` составляет URL вебхука для провайдера платежей, объединяя `SITE_URL` и фиксированный путь `/robokassa`.

**Пример**:
```python
settings = Settings()
provider_hook_url = settings.get_provider_hook_url
print(provider_hook_url)
```

## Переменные модуля

- `settings` (Settings): Экземпляр класса `Settings`, содержащий все настройки бота.
- `bot` (Bot): Экземпляр класса `Bot` из `aiogram`, инициализированный с токеном бота и режимом парсинга HTML.
- `dp` (Dispatcher): Диспетчер из `aiogram`, используемый для обработки входящих обновлений.
- `admins` (List[int]): Список идентификаторов администраторов бота.
- `log_file_path` (str): Путь к файлу логов.
- `database_url` (str): URL-адрес базы данных.

## Примеры

### Инициализация настроек и бота
```python
settings = Settings()
bot = Bot(token=settings.BOT_TOKEN, default=DefaultBotProperties(parse_mode=ParseMode.HTML))
dp = Dispatcher(storage=MemoryStorage())
admins = settings.ADMIN_IDS
```

В этом примере создается экземпляр класса `Settings`, который автоматически загружает переменные окружения из файла `.env`. Затем создается экземпляр класса `Bot` с использованием токена бота из настроек. Также инициализируется диспетчер `dp` для обработки обновлений и список `admins` с идентификаторами администраторов.

### Использование URL вебхука
```python
settings = Settings()
webhook_url = settings.get_webhook_url
print(webhook_url)
```

В этом примере создается экземпляр класса `Settings` и вызывается метод `get_webhook_url` для получения URL-адреса вебхука. Затем URL выводится в консоль.
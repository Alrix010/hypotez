# Модуль для миграции базы данных: добавление колонки `payment_id`

## Обзор

Этот модуль содержит скрипт миграции базы данных, используемый инструментом Alembic. Он добавляет колонку `payment_id` в таблицу `purchases`, если она еще не существует. Также создается уникальный constraint для этой колонки. Если колонка уже существует, скрипт пропускает добавление.

## Детали

Этот код используется для автоматического изменения структуры базы данных при обновлении версии приложения. Он гарантирует, что необходимые изменения будут внесены в базу данных согласованно и надежно.

## Функции

### `upgrade`

```python
def upgrade() -> None:
    """
    Функция выполняет обновление базы данных, добавляя колонку `payment_id` в таблицу `purchases`, если она еще не существует.
    Также создает уникальный constraint для этой колонки.

    Args:
        None

    Returns:
        None

    """
```

**Как работает функция**:

1.  Получает соединение с базой данных, используя `op.get_bind()`.
2.  Проверяет, существует ли колонка `payment_id` в таблице `purchases` с помощью запроса `PRAGMA table_info('purchases')`.
3.  Если колонки `payment_id` не существует, добавляет ее в таблицу `purchases` с типом `String` и атрибутом `nullable=False`.
4.  Создает уникальный constraint `uq_purchases_payment_id` для колонки `payment_id` в таблице `purchases`.
5.  Если колонка `payment_id` уже существует, выводит сообщение в консоль и пропускает добавление.

### `downgrade`

```python
def downgrade() -> None:
    """
    Функция выполняет откат обновления базы данных, удаляя колонку `payment_id` из таблицы `purchases`, если она существует.
    Также удаляет уникальный constraint для этой колонки.

    Args:
        None

    Returns:
        None

    """
```

**Как работает функция**:

1.  Получает соединение с базой данных, используя `op.get_bind()`.
2.  Проверяет, существует ли колонка `payment_id` в таблице `purchases` с помощью запроса `PRAGMA table_info('purchases')`.
3.  Если колонка `payment_id` существует, удаляет уникальный constraint `uq_purchases_payment_id` из таблицы `purchases`.
4.  Удаляет колонку `payment_id` из таблицы `purchases`.
5.  Если колонка `payment_id` не существует, выводит сообщение в консоль и пропускает удаление.
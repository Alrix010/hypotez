# Документация для `apps.hendlers.py`

## Обзор

Файл `apps/hendlers.py` содержит обработчики (handlers) для Telegram-бота, отвечающие за обработку команд пользователя, таких как старт и поиск фильмов. Используются `aiogram` для создания и управления Telegram-ботом, а также конечные автоматы (FSM) для управления состоянием диалога с пользователем.

## Более детально

Файл определяет роутер (`router`) для обработки входящих сообщений и запросов обратного вызова от Telegram. Он обрабатывает команду `/start`, запросы на поиск фильмов и сериалов, а также ввод названия фильма пользователем. Используется FSM (`aiogram.fsm`) для управления состоянием поиска фильма: тип фильма (фильм или сериал) и название.

## Классы

### `Params`

**Описание**: Класс состояний для конечного автомата, используется для хранения состояния поиска фильма.

**Наследует**:
- `StatesGroup` из `aiogram.fsm.state`

**Атрибуты**:
- `type_movie` (State): Состояние для хранения типа фильма (фильм или сериал).
- `name` (State): Состояние для хранения названия фильма.

**Принцип работы**:
Класс определяет два состояния: `type_movie` и `name`. `type_movie` хранит тип искомого контента (фильм или сериал), а `name` — название искомого фильма или сериала. Эти состояния используются для последовательного получения информации от пользователя.

## Функции

### `command_start_handler`

```python
async def command_start_handler(message: Message) -> None:
    """
    Приветствует пользователя при вводе команды /start и предлагает начать поиск фильма.

    Args:
        message (Message): Объект сообщения от Telegram.

    Returns:
        None

    Example:
        Пользователь вводит /start.
    """
```

**Назначение**:
Обработчик команды `/start`. Отправляет приветственное сообщение пользователю и предлагает начать поиск фильма.

**Параметры**:
- `message` (Message): Объект сообщения от Telegram.

**Возвращает**:
- `None`

**Как работает функция**:
1. Отправляет приветственное сообщение пользователю с его именем.
2. Предлагает пользователю начать поиск фильма, используя клавиатуру `kb.find_movie`.

### `movie_handler`

```python
async def movie_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обрабатывает запрос на поиск нового фильма, устанавливает состояние `type_movie` и предлагает выбрать тип фильма.

    Args:
        callback (CallbackQuery): Объект обратного вызова от Telegram.
        state (FSMContext): Контекст конечного автомата.

    Returns:
        None

    Example:
        Пользователь нажимает кнопку "Найти фильм".
    """
```

**Назначение**:
Обработчик запроса на поиск нового фильма. Устанавливает состояние `Params.type_movie` и предлагает пользователю выбрать тип фильма (фильм или сериал).

**Параметры**:
- `callback` (CallbackQuery): Объект обратного вызова от Telegram.
- `state` (FSMContext): Контекст конечного автомата.

**Возвращает**:
- `None`

**Как работает функция**:
1. Устанавливает состояние `Params.type_movie` для ожидания выбора типа фильма.
2. Отправляет пользователю сообщение с предложением выбрать тип фильма, используя клавиатуру `kb.choice`.

### `series_handler`

```python
async def series_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обрабатывает выбор типа "сериал", удаляет предыдущее сообщение, обновляет данные состояния и запрашивает название сериала.

    Args:
        callback (CallbackQuery): Объект обратного вызова от Telegram.
        state (FSMContext): Контекст конечного автомата.

    Returns:
        None

    Example:
        Пользователь выбирает "Сериал".
    """
```

**Назначение**:
Обработчик выбора типа "сериал". Удаляет предыдущее сообщение, обновляет данные состояния и запрашивает название сериала.

**Параметры**:
- `callback` (CallbackQuery): Объект обратного вызова от Telegram.
- `state` (FSMContext): Контекст конечного автомата.

**Возвращает**:
- `None`

**Как работает функция**:
1. Удаляет предыдущее сообщение пользователя.
2. Обновляет данные состояния, устанавливая `type_movie` в `series`.
3. Устанавливает состояние `Params.name` для ожидания ввода названия сериала.
4. Отправляет пользователю сообщение с запросом названия сериала.

### `film_handler`

```python
async def film_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """
    Обрабатывает выбор типа "фильм", удаляет предыдущее сообщение, обновляет данные состояния и запрашивает название фильма.

    Args:
        callback (CallbackQuery): Объект обратного вызова от Telegram.
        state (FSMContext): Контекст конечного автомата.

    Returns:
        None

    Example:
        Пользователь выбирает "Фильм".
    """
```

**Назначение**:
Обработчик выбора типа "фильм". Удаляет предыдущее сообщение, обновляет данные состояния и запрашивает название фильма.

**Параметры**:
- `callback` (CallbackQuery): Объект обратного вызова от Telegram.
- `state` (FSMContext): Контекст конечного автомата.

**Возвращает**:
- `None`

**Как работает функция**:
1. Удаляет предыдущее сообщение пользователя.
2. Обновляет данные состояния, устанавливая `type_movie` в `film`.
3. Устанавливает состояние `Params.name` для ожидания ввода названия фильма.
4. Отправляет пользователю сообщение с запросом названия фильма.

### `name_handler`

```python
async def name_handler(message: Message, state: FSMContext) -> None:
    """
    Обрабатывает ввод названия фильма, выполняет поиск фильма и отправляет результат пользователю.

    Args:
        message (Message): Объект сообщения от Telegram.
        state (FSMContext): Контекст конечного автомата.

    Returns:
        None

    Example:
        Пользователь вводит название фильма.
    """
```

**Назначение**:
Обработчик ввода названия фильма. Выполняет поиск фильма и отправляет результат пользователю.

**Параметры**:
- `message` (Message): Объект сообщения от Telegram.
- `state` (FSMContext): Контекст конечного автомата.

**Возвращает**:
- `None`

**Как работает функция**:
1. Обновляет данные состояния, устанавливая `name` в введенное пользователем название.
2. Получает данные из состояния (`name` и `type_movie`).
3. Выполняет поиск фильма, используя функцию `search_query`.
4. Отправляет пользователю информацию о запросе (название и тип фильма).
5. Если фильм найден, отправляет информацию о фильме (название, описание и ссылку).
6. Если фильм не найден, отправляет сообщение об отсутствии фильма.
7. Предлагает пользователю начать новый поиск фильма, используя клавиатуру `kb.find_movie`.
8. Очищает состояние конечного автомата.

## Переменные

- `router` (Router): Роутер для обработки сообщений и запросов обратного вызова.
- `type_movies` (dict): Словарь, содержащий соответствия между типом фильма (ключ) и его отображаемым названием (значение).

## Table of Contents

- [Обзор](#обзор)
- [Более детально](#более-детально)
- [Классы](#классы)
  - [`Params`](#params)
- [Функции](#функции)
  - [`command_start_handler`](#command_start_handler)
  - [`movie_handler`](#movie_handler)
  - [`series_handler`](#series_handler)
  - [`film_handler`](#film_handler)
  - [`name_handler`](#name_handler)
- [Переменные](#переменные)
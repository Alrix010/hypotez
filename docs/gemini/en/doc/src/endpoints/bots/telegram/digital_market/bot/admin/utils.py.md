# Модуль `utils.py`

## Обзор

Модуль содержит утилиты для административных задач Telegram-бота, включая функцию для удаления сообщений.

## Функции

### `process_dell_text_msg`

```python
async def process_dell_text_msg(message: Message, state: FSMContext):
    """
    Обрабатывает текстовое сообщение для удаления последнего сообщения и текущего сообщения пользователя.

    Args:
        message (Message): Объект сообщения от пользователя.
        state (FSMContext): Объект состояния FSM для хранения данных.

    Returns:
        None

    Raises:
        Exception: Если происходит ошибка при удалении сообщения.

    Пример:
        Предположим, у нас есть объект `message` и объект `state`, содержащий `last_msg_id`.
        >>> await process_dell_text_msg(message, state)
    """
```

**Описание**:
Функция `process_dell_text_msg` предназначена для удаления последнего сообщения, отправленного ботом пользователю, а также текущего сообщения пользователя. Она использует `FSMContext` для получения идентификатора последнего сообщения и `bot` для удаления сообщений.

**Параметры**:
- `message` (Message): Объект сообщения от пользователя, содержащий информацию о сообщении, включая идентификатор пользователя.
- `state` (FSMContext): Объект состояния конечного автомата (FSM), используемый для хранения и получения данных о состоянии пользователя.

**Логика работы**:
1. **Извлечение данных из состояния**: Функция извлекает данные из состояния FSM, используя `await state.get_data()`.
2. **Получение идентификатора последнего сообщения**: Извлечение идентификатора последнего сообщения (`last_msg_id`) из полученных данных.
3. **Удаление последнего сообщения (если существует)**:
   - Проверка, существует ли `last_msg_id`.
   - Если `last_msg_id` существует, функция пытается удалить сообщение с этим идентификатором из чата пользователя, используя `await bot.delete_message(chat_id=message.from_user.id, message_id=last_msg_id)`.
   - Если `last_msg_id` не найден, регистрируется предупреждение с использованием `logger.warning("Ошибка: Не удалось найти идентификатор последнего сообщения для удаления.")`.
4. **Удаление текущего сообщения пользователя**: Функция пытается удалить текущее сообщение пользователя, используя `await message.delete()`.
5. **Обработка исключений**:
   - Если во время удаления сообщения происходит исключение, оно перехватывается.
   - Регистрируется сообщение об ошибке с использованием `logger.error(f"Произошла ошибка при удалении сообщения: {str(ex)}")`.

**Примеры**:

1. Пример успешного удаления сообщений:
   ```python
   message = Message(...)  # Объект сообщения пользователя
   state = FSMContext(...)  # Объект состояния FSM с сохраненным last_msg_id
   await process_dell_text_msg(message, state)
   ```

2. Пример, когда `last_msg_id` не найден:
   ```python
   message = Message(...)  # Объект сообщения пользователя
   state = FSMContext(...)  # Объект состояния FSM без сохраненного last_msg_id
   await process_dell_text_msg(message, state)
   # В логах будет предупреждение: "Ошибка: Не удалось найти идентификатор последнего сообщения для удаления."
   ```

3. Пример обработки ошибки при удалении сообщения:
   ```python
   message = Message(...)  # Объект сообщения пользователя
   state = FSMContext(...)  # Объект состояния FSM
   await process_dell_text_msg(message, state)
   # Если произойдет ошибка при удалении, в логах будет сообщение об ошибке.
   ```
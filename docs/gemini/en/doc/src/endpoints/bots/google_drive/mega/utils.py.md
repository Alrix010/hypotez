# Модуль utils для работы с Google Drive Mega

## Обзор

Этот модуль содержит набор утилитных функций, используемых для работы с API Google Drive Mega. 
Он предоставляет функции для:

- Шифрования и дешифрования данных с использованием AES в режиме CBC;
- Преобразования данных между различными форматами, такими как A32, Base64URL;
- Разделения данных на фрагменты определенного размера.

## Подробности

Модуль utils для работы с Google Drive Mega является неотъемлемой частью проекта hypotez. 
Он обеспечивает безопасное шифрование и дешифрование данных, что необходимо для 
защиты информации, передаваемой через API Google Drive Mega. Функции преобразования 
данных позволяют использовать различные форматы данных в зависимости от конкретных 
требований API. Разделение данных на фрагменты (chunks) позволяет оптимизировать 
передачу больших объемов данных.

## Функции

### `a32_to_str`

**Цель**: Преобразование списка 32-битных целых чисел в строку байтов.

**Параметры**:

- `a` (list): Список 32-битных целых чисел.

**Возвращает**:

- `bytes`: Строка байтов, представляющая список 32-битных целых чисел.

**Как работает**:

- Функция использует модуль `struct` для преобразования списка 32-битных 
  целых чисел в строку байтов.

**Примеры**:

```python
>>> a32_to_str([1, 2, 3, 4])
b'\x01\x00\x00\x00\x02\x00\x00\x00\x03\x00\x00\x00\x04\x00\x00\x00'
```


### `aes_cbc_encrypt`

**Цель**: Шифрование данных с использованием AES в режиме CBC.

**Параметры**:

- `data` (bytes): Данные, которые необходимо зашифровать.
- `key` (bytes): Ключ для шифрования.

**Возвращает**:

- `bytes`: Зашифрованные данные.

**Как работает**:

- Функция использует модуль `Crypto.Cipher` для создания объекта шифрования 
  AES в режиме CBC.
- Затем функция шифрует данные с помощью объекта шифрования.

**Примеры**:

```python
>>> key = b'0123456789abcdef'
>>> data = b'Hello, world!'
>>> aes_cbc_encrypt(data, key)
b'\x9c\xf7\x0f\xe9\xc3\xa4\x6d\xb8\xf6\x0b\x95\xa2\xd7\x19\xd5\xbc'
```


### `aes_cbc_encrypt_a32`

**Цель**: Шифрование списка 32-битных целых чисел с использованием AES в режиме CBC.

**Параметры**:

- `data` (list): Список 32-битных целых чисел, которые необходимо зашифровать.
- `key` (list): Ключ для шифрования, представленный в виде списка 32-битных целых чисел.

**Возвращает**:

- `list`: Список 32-битных целых чисел, представляющий зашифрованные данные.

**Как работает**:

- Функция преобразует список 32-битных целых чисел в строку байтов с помощью 
  функции `a32_to_str`.
- Затем функция шифрует данные с помощью функции `aes_cbc_encrypt`.
- После этого функция преобразует зашифрованные данные обратно в список 
  32-битных целых чисел с помощью функции `str_to_a32`.

**Примеры**:

```python
>>> key = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
>>> data = [1, 2, 3, 4, 5, 6, 7, 8]
>>> aes_cbc_encrypt_a32(data, key)
[2847842932, 3792908601, 1253583304, 1743108894, 1753563678, 940036149, 1920709610, 4286398596]
```


### `str_to_a32`

**Цель**: Преобразование строки байтов в список 32-битных целых чисел.

**Параметры**:

- `b` (bytes): Строка байтов, которую необходимо преобразовать.

**Возвращает**:

- `list`: Список 32-битных целых чисел, представляющий строку байтов.

**Как работает**:

- Функция сначала проверяет, является ли длина строки байтов кратной 4. 
  Если нет, то функция добавляет нулевые байты в конец строки, чтобы 
  сделать ее длину кратной 4.
- Затем функция использует модуль `struct` для преобразования строки байтов 
  в список 32-битных целых чисел.

**Примеры**:

```python
>>> str_to_a32(b'\x01\x00\x00\x00\x02\x00\x00\x00\x03\x00\x00\x00\x04\x00\x00\x00')
[1, 2, 3, 4]
```

### `mpi2int`

**Цель**: Преобразование MPI-кодированного числа в целое число.

**Параметры**:

- `s` (bytes): MPI-кодированное число.

**Возвращает**:

- `int`: Целое число, представляющее MPI-кодированное число.

**Как работает**:

- Функция сначала удаляет первые два байта из MPI-кодированного числа. 
- Затем функция использует модуль `binascii` для преобразования 
  оставшихся байтов в шестнадцатеричное представление.
- Наконец, функция преобразует шестнадцатеричное представление в целое 
  число с помощью функции `int`.

**Примеры**:

```python
>>> mpi2int(b'\x02\x01\x01')
1
```

### `aes_cbc_decrypt`

**Цель**: Дешифрование данных с использованием AES в режиме CBC.

**Параметры**:

- `data` (bytes): Зашифрованные данные, которые необходимо расшифровать.
- `key` (bytes): Ключ для дешифрования.

**Возвращает**:

- `bytes`: Расшифрованные данные.

**Как работает**:

- Функция использует модуль `Crypto.Cipher` для создания объекта 
  дешифрования AES в режиме CBC.
- Затем функция расшифровывает данные с помощью объекта дешифрования.

**Примеры**:

```python
>>> key = b'0123456789abcdef'
>>> data = b'\x9c\xf7\x0f\xe9\xc3\xa4\x6d\xb8\xf6\x0b\x95\xa2\xd7\x19\xd5\xbc'
>>> aes_cbc_decrypt(data, key)
b'Hello, world!'
```

### `aes_cbc_decrypt_a32`

**Цель**: Дешифрование списка 32-битных целых чисел с использованием AES в режиме CBC.

**Параметры**:

- `data` (list): Список 32-битных целых чисел, представляющий зашифрованные данные.
- `key` (list): Ключ для дешифрования, представленный в виде списка 32-битных целых чисел.

**Возвращает**:

- `list`: Список 32-битных целых чисел, представляющий расшифрованные данные.

**Как работает**:

- Функция преобразует список 32-битных целых чисел в строку байтов с помощью 
  функции `a32_to_str`.
- Затем функция расшифровывает данные с помощью функции `aes_cbc_decrypt`.
- После этого функция преобразует расшифрованные данные обратно в список 
  32-битных целых чисел с помощью функции `str_to_a32`.

**Примеры**:

```python
>>> key = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
>>> data = [2847842932, 3792908601, 1253583304, 1743108894, 1753563678, 940036149, 1920709610, 4286398596]
>>> aes_cbc_decrypt_a32(data, key)
[1, 2, 3, 4, 5, 6, 7, 8]
```


### `base64urldecode`

**Цель**: Декодирование строки данных, закодированной с использованием Base64URL.

**Параметры**:

- `data` (str): Строка данных, закодированная с использованием Base64URL.

**Возвращает**:

- `bytes`: Декодированные данные.

**Как работает**:

- Функция сначала добавляет недостающие символы '=' в конец строки данных, 
  чтобы сделать ее длину кратной 4.
- Затем функция заменяет символы '-', '_', ',' на '+', '/', '=' соответственно.
- После этого функция использует модуль `base64` для декодирования строки 
  данных с помощью функции `b64decode`.

**Примеры**:

```python
>>> base64urldecode('aGVsbG8gd29ybGQ_')
b'hello world!'
```


### `base64_to_a32`

**Цель**: Преобразование строки данных, закодированной с использованием Base64URL, в список 32-битных целых чисел.

**Параметры**:

- `s` (str): Строка данных, закодированная с использованием Base64URL.

**Возвращает**:

- `list`: Список 32-битных целых чисел, представляющий декодированные данные.

**Как работает**:

- Функция сначала декодирует строку данных с помощью функции 
  `base64urldecode`.
- Затем функция преобразует декодированные данные в список 32-битных 
  целых чисел с помощью функции `str_to_a32`.

**Примеры**:

```python
>>> base64_to_a32('aGVsbG8gd29ybGQ_')
[1634876904, 1953207639, 1442906856, 1768628170]
```


### `base64urlencode`

**Цель**: Кодирование данных с использованием Base64URL.

**Параметры**:

- `data` (bytes): Данные, которые необходимо закодировать.

**Возвращает**:

- `str`: Строка данных, закодированная с использованием Base64URL.

**Как работает**:

- Функция сначала кодирует данные с помощью функции `b64encode` модуля 
  `base64`.
- Затем функция преобразует закодированные данные в строку с помощью 
  функции `decode` и кодировки `utf-8`.
- После этого функция заменяет символы '+', '/', '=' на '-', '_', '' 
  соответственно.

**Примеры**:

```python
>>> base64urlencode(b'hello world!')
'aGVsbG8gd29ybGQ'
```


### `a32_to_base64`

**Цель**: Преобразование списка 32-битных целых чисел в строку данных, 
закодированную с использованием Base64URL.

**Параметры**:

- `a` (list): Список 32-битных целых чисел.

**Возвращает**:

- `str`: Строка данных, закодированная с использованием Base64URL.

**Как работает**:

- Функция сначала преобразует список 32-битных целых чисел в строку 
  байтов с помощью функции `a32_to_str`.
- Затем функция кодирует строку байтов с помощью функции 
  `base64urlencode`.

**Примеры**:

```python
>>> a32_to_base64([1, 2, 3, 4])
'AQIDBA=='
```


### `get_chunks`

**Цель**: Разделение данных на фрагменты (chunks) определенного размера.

**Параметры**:

- `size` (int): Размер данных в байтах.

**Возвращает**:

- `dict`: Словарь, где ключ - это начальный индекс фрагмента, а значение - 
  это размер фрагмента.

**Как работает**:

- Функция сначала создает словарь для хранения фрагментов.
- Затем функция разбивает данные на фрагменты, начиная с 0x20000 байт 
  и увеличивая размер каждого последующего фрагмента до 0x100000 байт.
- Наконец, функция возвращает словарь, содержащий информацию о каждом 
  фрагменте.

**Примеры**:

```python
>>> get_chunks(1000000)
{0: 81920, 81920: 163840, 245760: 245760, 491520: 491520, 737280: 737280, 983040: 16960, 983040: 16960}
```
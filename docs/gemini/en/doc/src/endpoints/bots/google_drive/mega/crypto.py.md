# Модуль crypto.py

## Обзор

Модуль `crypto.py` предоставляет функции для шифрования и дешифрования данных, используемые в контексте работы с Mega.co.nz, включая функции для шифрования/дешифрования AES, хеширования строк и подготовки ключей.

## Подробнее

Этот модуль содержит набор криптографических функций, используемых для обеспечения безопасности данных при работе с сервисом Mega.co.nz. Он включает в себя функции шифрования и расшифровки с использованием AES, хеширования строк, подготовки ключей, а также шифрования и расшифровки атрибутов.

## Функции

### `aes_cbc_encrypt`

```python
def aes_cbc_encrypt(data, key):
    """
    Функция шифрует данные с использованием алгоритма AES в режиме CBC.

    Args:
        data (bytes): Данные для шифрования.
        key (bytes): Ключ шифрования.

    Returns:
        bytes: Зашифрованные данные.
    """
    ...
```

**Как работает функция:**

1. Создается объект шифрования AES в режиме CBC с нулевым вектором инициализации (IV).
2. Функция шифрует входные данные с использованием предоставленного ключа.
3. Возвращаются зашифрованные данные.

### `aes_cbc_decrypt`

```python
def aes_cbc_decrypt(data, key):
    """
    Функция расшифровывает данные, зашифрованные с использованием алгоритма AES в режиме CBC.

    Args:
        data (bytes): Зашифрованные данные.
        key (bytes): Ключ шифрования.

    Returns:
        bytes: Расшифрованные данные.
    """
    ...
```

**Как работает функция:**

1. Создается объект дешифрования AES в режиме CBC с нулевым вектором инициализации (IV).
2. Функция расшифровывает входные данные с использованием предоставленного ключа.
3. Возвращаются расшифрованные данные.

### `aes_cbc_encrypt_a32`

```python
def aes_cbc_encrypt_a32(data, key):
    """
    Функция шифрует данные, представленные в формате a32, с использованием алгоритма AES в режиме CBC.

    Args:
        data (list[int]): Данные для шифрования в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        list[int]: Зашифрованные данные в формате a32.
    """
    ...
```

**Как работает функция:**

1. Преобразует данные и ключ из формата a32 в строку.
2. Шифрует данные с использованием `aes_cbc_encrypt`.
3. Преобразует зашифрованные данные обратно в формат a32.
4. Возвращает зашифрованные данные в формате a32.

### `aes_cbc_decrypt_a32`

```python
def aes_cbc_decrypt_a32(data, key):
    """
    Функция расшифровывает данные, представленные в формате a32, с использованием алгоритма AES в режиме CBC.

    Args:
        data (list[int]): Зашифрованные данные в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        list[int]: Расшифрованные данные в формате a32.
    """
    ...
```

**Как работает функция:**

1. Преобразует данные и ключ из формата a32 в строку.
2. Расшифровывает данные с использованием `aes_cbc_decrypt`.
3. Преобразует расшифрованные данные обратно в формат a32.
4. Возвращает расшифрованные данные в формате a32.

### `stringhash`

```python
def stringhash(s, aeskey):
    """
    Функция вычисляет хеш строки с использованием AES.

    Args:
        s (str): Строка для хеширования.
        aeskey (list[int]): Ключ AES для хеширования.

    Returns:
        str: Хеш строки в формате base64.
    """
    ...
```

**Как работает функция:**

1. Преобразует входную строку в формат a32.
2. Инициализирует хеш-значение.
3. Выполняет XOR для каждого элемента строки с хеш-значением.
4. Выполняет несколько раундов шифрования AES для полученного хеш-значения.
5. Преобразует результат в формат base64 и возвращает его.

### `prepare_key`

```python
def prepare_key(a):
    """
    Функция подготавливает ключ для шифрования.

    Args:
        a (list[int]): Входной ключ в формате a32.

    Returns:
        list[int]: Подготовленный ключ в формате a32.
    """
    ...
```

**Как работает функция:**

1. Инициализирует предварительный ключ.
2. Выполняет несколько раундов шифрования AES для предварительного ключа с использованием частей входного ключа.
3. Возвращает подготовленный ключ.

### `encrypt_key`

```python
def encrypt_key(a, key):
    """
    Функция шифрует ключ с использованием AES.

    Args:
        a (list[int]): Ключ для шифрования в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        list[int]: Зашифрованный ключ в формате a32.
    """
    ...
```

**Как работает функция:**

1. Шифрует части ключа `a` с использованием ключа `key` посредством AES в режиме CBC.
2. Объединяет зашифрованные части.
3. Возвращает зашифрованный ключ.

### `decrypt_key`

```python
def decrypt_key(a, key):
    """
    Функция расшифровывает ключ с использованием AES.

    Args:
        a (list[int]): Зашифрованный ключ в формате a32.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        list[int]: Расшифрованный ключ в формате a32.
    """
    ...
```

**Как работает функция:**

1. Расшифровывает части ключа `a` с использованием ключа `key` посредством AES в режиме CBC.
2. Объединяет расшифрованные части.
3. Возвращает расшифрованный ключ.

### `enc_attr`

```python
def enc_attr(attr, key):
    """
    Функция шифрует атрибуты с использованием AES.

    Args:
        attr (dict): Атрибуты для шифрования.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        bytes: Зашифрованные атрибуты.
    """
    ...
```

**Как работает функция:**

1. Преобразует атрибуты в JSON-строку и добавляет префикс 'MEGA'.
2. Дополняет строку нулевыми символами до кратности 16.
3. Шифрует строку с использованием AES в режиме CBC.
4. Возвращает зашифрованные атрибуты.

### `dec_attr`

```python
def dec_attr(attr, key):
    """
    Функция расшифровывает атрибуты, зашифрованные с использованием AES.

    Args:
        attr (bytes): Зашифрованные атрибуты.
        key (list[int]): Ключ шифрования в формате a32.

    Returns:
        dict: Расшифрованные атрибуты.
    """
    ...
```

**Как работает функция:**

1. Расшифровывает входные данные с использованием AES в режиме CBC.
2. Декодирует строку из формата UTF-8 и удаляет нулевые символы.
3. Удаляет префикс 'MEGA' и преобразует JSON-строку в словарь.
4. Возвращает расшифрованные атрибуты.
# Модуль для преобразования словаря в XML-строку
## Обзор
Модуль предоставляет функцию `dict2xml`, которая преобразует словарь в XML-строку. 

Этот модуль используется для преобразования данных в формат XML, который часто используется в веб-сервисах и для обмена данными между приложениями.

## Детали
Модуль `dict2xml` основан на коде из проекта `lhammer` (https://github.com/nkchenz/lhammer/blob/master/lhammer/dict2xml_old.py). 

Он адаптирован для использования в проекте Prestapyt, предоставляя функциональность для преобразования данных в формат XML, совместимый с API PrestaShop.

## Классы
### `_process`
**Описание**:  Вспомогательная функция для генерации DOM-объекта для заданного тега и значения.
**Входные параметры**:
- `doc` (xml.dom.minidom.Document): объект XML-документа.
- `tag` (str): имя тега.
- `tag_value` (Any): значение тега (может быть строкой, числом, списком или словарем).

**Возвращаемое значение**:
- node or nodelist:  возвращает DOM-узел или список узлов в зависимости от типа значения тега.

**Принцип работы**:
- Функция обрабатывает разные типы значений тегов: строки, числа, списки и словари.
- Для простых типов (строка, число) функция создает DOM-узел с текстовым содержимым.
- Для списков функция создает список узлов с одинаковым именем тега.
- Для словарей функция создает новый DOM-узел, добавляет дочерние узлы для ключей словаря и атрибуты, если они определены.

### `_process_complex`
**Описание**: Вспомогательная функция для генерации нескольких узлов для списков и словарей.

**Входные параметры**:
- `doc` (xml.dom.minidom.Document): объект XML-документа.
- `children` (list of tuples): список кортежей, где каждый кортеж представляет собой пару (имя тега, значение).

**Возвращаемое значение**:
- tuple: кортеж, содержащий список узлов и список атрибутов.

**Принцип работы**:
- Функция итерирует по списку кортежей `children`.
- Для каждого кортежа она вызывает функцию `_process` для создания узла или списка узлов.
- Если тег `children` равен `attrs`, все узлы добавляются в список атрибутов.
- Возвращает список узлов и список атрибутов.

### `_process_attr`
**Описание**: Вспомогательная функция для генерации атрибутов элемента.

**Входные параметры**:
- `doc` (xml.dom.minidom.Document): объект XML-документа.
- `attr_value` (dict): словарь, представляющий атрибуты.

**Возвращаемое значение**:
- list: список атрибутов.

**Принцип работы**:
- Функция итерирует по ключам-значениям словаря `attr_value`.
- Для каждого ключа она создает объект `xml.dom.minidom.Attr` с именем ключа и значением.
- Возвращает список созданных атрибутов.

### `_process_simple`
**Описание**: Вспомогательная функция для генерации узла для простых типов (int, str).

**Входные параметры**:
- `doc` (xml.dom.minidom.Document): объект XML-документа.
- `tag` (str): имя тега.
- `tag_value` (Any): значение тега.

**Возвращаемое значение**:
- node: DOM-узел.

**Принцип работы**:
- Функция создает DOM-узел с именем `tag` и добавляет к нему текстовое содержимое, преобразованное в строку.
- Возвращает созданный узел.

## Функции
### `dict2xml`
**Описание**: Преобразует словарь в XML-строку.
**Входные параметры**:
- `data` (dict): словарь, который нужно преобразовать в XML.
- `encoding` (str, optional): кодировка данных, по умолчанию UTF-8.

**Возвращаемое значение**:
- str:  XML-строка.

**Исключения**:
- Exception: Если входной словарь содержит более одного корневого узла.

**Принцип работы**:
- Создает объект XML-документа с помощью `getDOMImplementation()`.
- Проверяет, что в словаре `data` только один корневой узел.
- Вызывает функцию `_process_complex` для обработки элементов словаря `data`.
- Добавляет корневой узел к XML-документу.
- Преобразует XML-документ в строку с помощью `toxml()`.
- Возвращает полученную XML-строку.

**Примеры**:
```python
# Example 1
x = {'prestashop': {'addresses': {'address': [
        {'attrs': {'href': {'value': 'http://localhost:8080/api/addresses/1', 'xmlns': 'http://www.w3.org/1999/xlink'}, 'id': '1'}, 'value': None},
        {'attrs': {'href': {'value': 'http://localhost:8080/api/addresses/2', 'xmlns': 'http://www.w3.org/1999/xlink'}, 'id': '2'}, 'value': None}
    ]}}}

print(dict2xml(x))

# Example 2
x = {'prestashop': {'address': {
        'address1': '1 Infinite Loop',
        'address2': None,
        'alias': 'manufacturer',
        'city': 'Cupertino',
        'company': None,
        'date_add': '2012-02-06 09:33:52',
        'date_upd': '2012-02-07 11:18:48',
        'deleted': '0',
        'dni': None,
        'firstname': 'STEVEN',
        'id': 1,
        'id_country': 21,
        'id_customer': None,
        'id_manufacturer': 1,
        'id_state': 5,
        'id_supplier': None,
        'lastname': 'JOBS',
        'other': None,
        'phone': '(800) 275-2273',
        'phone_mobile': None,
        'postcode': '95014',
        'vat_number': 'XXX',
        'description': {'language': [
            {'attrs': {'id': '1', 'href': {'value': 'http://localhost:8080/api/languages/1', 'xmlns': 'http://www.w3.org/1999/xlink'}}, 'value': 'test description english'},
            {'attrs': {'id': '2', 'href': {'value': 'http://localhost:8080/api/languages/1', 'xmlns': 'http://www.w3.org/1999/xlink'}}, 'value': 'test description french'}
        ]}
    }}}

print(dict2xml(x))
```
## Параметры
- `data` (dict): Данные в виде словаря. 
- `encoding` (str, optional): Кодировка данных, по умолчанию UTF-8.
## Примеры
- `dict2xml(x)`: Преобразует словарь `x` в XML-строку.
- `dict2xml(y, encoding='latin-1')`: Преобразует словарь `y` в XML-строку с кодировкой `latin-1`.

## Как работает функция
- Функция `dict2xml` сначала проверяет, что в словаре `data` только один корневой узел. Это ограничение гарантирует, что создается корректная XML-структура.
- Затем функция использует вспомогательные функции (`_process_complex`, `_process`, `_process_attr`, `_process_simple`) для рекурсивной обработки элементов словаря `data` и создания узлов XML-документа.
- После создания узлов XML-документа функция возвращает строковое представление XML-документа с помощью метода `toxml()`.
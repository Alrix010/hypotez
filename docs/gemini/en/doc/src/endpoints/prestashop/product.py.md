# Модуль для взаимодействия с товарами в PrestaShop

## Обзор

Модуль `product.py` предназначен для взаимодействия с API PrestaShop для управления товарами. Он предоставляет классы и методы для получения информации о товарах, добавления новых товаров и выполнения других операций, связанных с товарами.

## Более подробно

Модуль содержит класс `PrestaProduct`, который наследуется от класса `PrestaShop` и реализует методы для работы с товарами. Он также использует другие модули, такие как `ProductFields` и `dict2xml`, для преобразования данных и взаимодействия с API PrestaShop.

## Содержание

1.  [Классы](#Классы)
    *   [Config](#Config)
    *   [PrestaProduct](#PrestaProduct)
2.  [Функции](#Функции)
    *   [example_add_new_product](#example_add_new_product)
    *   [example_get_product](#example_get_product)

## Классы

### `Config`

Класс конфигурации для настроек товаров PrestaShop.

**Атрибуты:**

*   `MODE` (str): Режим работы (по умолчанию `'dev'`).
*   `API_DOMAIN` (str): Домен API PrestaShop (инициализируется из переменных окружения или настроек).
*   `API_KEY` (str): Ключ API PrestaShop (инициализируется из переменных окружения или настроек).

**Принцип работы:**

Класс `Config` предназначен для хранения параметров конфигурации, необходимых для подключения к API PrestaShop. Значения параметров могут быть заданы через переменные окружения (`USE_ENV = True`) или через атрибуты класса в зависимости от режима работы (`MODE`). Если `USE_ENV = True`, то используются переменные окружения `HOST` и `API_KEY`. В противном случае используются значения из `gs.credentials.presta.client`.

### `PrestaProduct`

Класс для манипуляций с товарами.

**Описание:**

Изначально, класс предназначен для получения данных со страницы товара, а затем для работы с API PrestaShop.

**Наследует:**

*   `PrestaShop`: Класс для взаимодействия с API PrestaShop.

**Параметры:**

*   `api_key` (Optional[str], optional): Ключ API PrestaShop. По умолчанию ''.
*   `api_domain` (Optional[str], optional): Домен API PrestaShop. По умолчанию ''.

**Методы:**

*   `get_product_schema(resource_id: Optional[str | int] = None, schema: Optional[str] = None) -> dict`: Возвращает схему ресурса товара из PrestaShop.
*   `get_parent_category(id_category: int) -> Optional[int]`: Извлекает родительские категории из PrestaShop для указанной категории рекурсивно.
*   `_add_parent_categories(f: ProductFields) -> None`: Вычисляет и добавляет все уникальные родительские категории для списка ID категорий в объект `ProductFields`.
*   `get_product(id_product: int, **kwargs) -> dict`: Возвращает словарь полей товара из магазина PrestaShop.
*   `add_new_product(self, f: ProductFields) -> dict`: Добавляет новый товар в PrestaShop.

**Принцип работы:**

Класс `PrestaProduct` предоставляет методы для взаимодействия с API PrestaShop для выполнения различных операций с товарами. Он использует класс `PrestaShop` для выполнения HTTP-запросов к API PrestaShop и другие вспомогательные классы и функции для преобразования данных и обработки ответов API.

## Функции

### `example_add_new_product`

```python
def example_add_new_product() -> None:
    """Пример для добавления товара в Prestashop"""
```

**Назначение**:
Пример добавления товара в PrestaShop.

**Как работает**:

1.  Создается экземпляр класса `PrestaProduct` с использованием ключа API и домена API из класса `Config`.
2.  Загружаются примерные данные из JSON-файла, представляющие структуру товара в формате, близком к XML.
3.  Если файл не существует или имеет неправильный формат, регистрируется ошибка и функция завершается.
4.  Данные преобразуются в XML с использованием функции `dict2xml`.
5.  XML сохраняется в файл для отладки.
6.  Выполняется POST-запрос к API PrestaShop для добавления товара, используя либо JSON, либо XML в качестве данных.
7.  Ответ от сервера выводится на экран.

**Пример вызова**:

```python
example_add_new_product()
```

### `example_get_product`

```python
def example_get_product(id_product: int, **kwargs) -> None:
    """ """
```

**Назначение**:

Получение товара из PrestaShop по его ID.

**Параметры**:

*   `id_product` (int): ID товара в PrestaShop.
*   `**kwargs`: Дополнительные параметры запроса.

**Как работает**:

1.  Создается экземпляр класса `PrestaProduct` с использованием ключа API и домена API из класса `Config`.
2.  Вызывается метод `get_product` для получения информации о товаре по его ID.
3.  Если возвращается список, берется первый элемент.
4.  Информация о товаре сохраняется в JSON-файл для отладки.

**Пример вызова**:

```python
example_get_product(2191)
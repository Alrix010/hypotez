# Модуль `you.py`

## Обзор

Данный модуль реализует взаимодействие с сервером `you.com` для получения ответов от модели `youchat` в формате `JSON`. 

## Детали

Модуль `you.py` находится в `hypotez/src/endpoints/juliana/freegpt-webui-ru/g4f/Provider/Providers/helpers/you.py` 

Модуль  содержит функцию `output`, которая  обрабатывает JSON-ответ от `you.com`, а также функцию `transform`, которая  преобразует список сообщений в формат, понятный `you.com`. Модуль использует библиотеку `curl_cffi` для взаимодействия с `you.com` через HTTP-запросы.

## Функции

### `transform(messages: list) -> list`

**Цель:** Преобразование списка сообщений в формат, понятный `you.com`.

**Параметры:**

- `messages` (list): Список сообщений в формате  `[{'role': 'user', 'content': '...',}, ...]`.

**Возвращает:**

- `list`: Список сообщений в формате  `[{'question': '...', 'answer': '...',}, ...]`.

**Пример:**

```python
>>> messages = [{'role': 'user', 'content': 'Привет!'}, {'role': 'assistant', 'content': 'Привет! Как дела?'}]
>>> transform(messages)
[{'question': 'Привет!', 'answer': 'Привет! Как дела?'}]
```

### `output(chunk)`

**Цель:** Обработка JSON-ответа от `you.com`, извлечение токена `youChatToken`.

**Параметры:**

- `chunk` (bytes): Часть JSON-ответа от `you.com`.

**Возвращает:**

- `None`: Функция не возвращает значение.

**Как работает функция:**

Функция `output` принимает на вход часть JSON-ответа от `you.com` в формате `bytes`. Она проверяет, содержит ли эта часть `youChatToken`. Если да, функция извлекает значение `youChatToken` из JSON-объекта и выводит его на консоль.

**Пример:**

```python
>>> chunk = b'data: {"youChatToken": "your_token"}'
>>> output(chunk)
your_token
```

## Основная логика работы модуля

Модуль `you.py` выполняет следующие действия:

1. **Инициализация**:
   -  Загружает конфигурационные данные из  `sys.argv[1]`.
   -  Извлекает список сообщений  `messages` из конфигурационных данных.
   -  Инициализирует заголовок `headers` HTTP-запроса.

2. **Преобразование сообщений**:
   - Вызывает функцию  `transform` для преобразования списка сообщений  `messages` в формат, понятный `you.com`.

3. **Формирование запроса**:
   -  Создает строку запроса `params`, используя  `urllib.parse.urlencode` для кодирования данных в `URL`.

4. **Отправка запроса**:
   -  Использует библиотеку `curl_cffi` для отправки HTTP-запроса на  `you.com/api/streamingSearch`.
   -  В качестве callback-функции для обработки ответа использует `output`.

5. **Обработка ответа**:
   -  Функция `output` обрабатывает полученные  `chunk` данных.
   -  Извлекает `youChatToken`  из  `chunk` и выводит его на консоль.

## Примеры вызова

**Пример 1:** Вызов функции `transform` с простым списком сообщений:

```python
>>> messages = [{'role': 'user', 'content': 'Привет!'}, {'role': 'assistant', 'content': 'Привет! Как дела?'}]
>>> transform(messages)
[{'question': 'Привет!', 'answer': 'Привет! Как дела?'}]
```

**Пример 2:** Отправка запроса на `you.com` и вывод `youChatToken` на консоль:

```python
>>> config = {'messages': [{'role': 'user', 'content': 'Привет!'}, {'role': 'assistant', 'content': 'Привет! Как дела?'}]}
>>> sys.argv[1] = json.dumps(config) # Эмулируем передачу конфигурации через аргументы командной строки
>>> # Вызываем модуль 
>>> import you
>>> you.output(b'data: {"youChatToken": "your_token"}')
your_token 
```

## Дополнительные замечания

- Модуль  `you.py`  использует библиотеку `curl_cffi` для выполнения HTTP-запросов.
- Модуль  `you.py`  обрабатывает JSON-ответ от `you.com` и извлекает  `youChatToken`.
- Модуль  `you.py`  преобразует список сообщений в формат, понятный `you.com`.
# Модуль автоматического прокси-сервера

## Обзор

Модуль `auto_proxy.py` реализует механизм автоматического получения и обновления списка рабочих прокси-серверов. Он используется для оптимизации работы с внешними API, такими как GPT-3,  увеличивая скорость и стабильность соединения. 

## Детали

Модуль `auto_proxy.py` обеспечивает следующие возможности:

- **Получение прокси-серверов:** Функция `fetch_proxies()` извлекает список прокси-серверов с сайта `proxyscrape.com`.
- **Тестирование прокси-серверов:** Функция `test_proxy()` проверяет работоспособность прокси-сервера, отправляя тестовый запрос с заданным `prompt` и таймаутом.
- **Создание списка рабочих прокси:** Функция `get_working_proxies()` получает список прокси-серверов, тестирует их и добавляет работающие прокси в глобальный список `working_proxies`.
- **Обновление списка рабочих прокси:** Функция `update_working_proxies()` периодически обновляет список `working_proxies`, тестируя новые прокси и удаляя неработающие.
- **Выбор случайного прокси:** Функция `get_random_proxy()` возвращает случайный рабочий прокси-сервер из списка `working_proxies`.

## Функции

### `fetch_proxies()`

**Цель**: Получение списка прокси-серверов с сайта `proxyscrape.com`.

**Параметры**: 

- **`None`**: 

**Возвращает**: 

- **`list`**: Список прокси-серверов в формате "IP:Port".

**Исключения**: 

- **`None`**:

**Пример**:

```python
>>> fetch_proxies()
['1.1.1.1:8080', '2.2.2.2:8080', ...]
```

### `test_proxy()`

**Цель**: Проверка работоспособности прокси-сервера, отправляя тестовый запрос.

**Параметры**:

- **`proxy` (str)**: Прокси-сервер в формате "IP:Port".
- **`prompt` (str)**: Тестовый запрос для проверки.
- **`timeout` (int)**: Максимальное время ожидания ответа в секундах.

**Возвращает**: 

- **`None`**: 

**Исключения**: 

- **`Exception`**: Возникает при ошибке отправки запроса или получения ответа.

**Пример**:

```python
>>> test_proxy('1.1.1.1:8080', 'What is the capital of France?', 5)
```

### `add_working_proxy()`

**Цель**: Добавление рабочего прокси-сервера в глобальный список `working_proxies`.

**Параметры**:

- **`proxy` (str)**: Прокси-сервер в формате "IP:Port".

**Возвращает**: 

- **`None`**: 

**Исключения**: 

- **`None`**:

**Пример**:

```python
>>> add_working_proxy('1.1.1.1:8080')
```

### `remove_proxy()`

**Цель**: Удаление прокси-сервера из глобального списка `working_proxies`.

**Параметры**:

- **`proxy` (str)**: Прокси-сервер в формате "IP:Port".

**Возвращает**: 

- **`None`**: 

**Исключения**: 

- **`None`**:

**Пример**:

```python
>>> remove_proxy('1.1.1.1:8080')
```

### `get_working_proxies()`

**Цель**: Получение и тестирование прокси-серверов, добавление рабочих прокси в глобальный список `working_proxies`.

**Параметры**:

- **`prompt` (str)**: Тестовый запрос для проверки.
- **`timeout` (int, optional)**: Максимальное время ожидания ответа в секундах. По умолчанию 5.

**Возвращает**: 

- **`None`**: 

**Исключения**: 

- **`None`**:

**Пример**:

```python
>>> get_working_proxies('What is the capital of France?', 5)
```

### `update_working_proxies()`

**Цель**: Периодическое обновление глобального списка `working_proxies`.

**Параметры**: 

- **`None`**: 

**Возвращает**: 

- **`None`**: 

**Исключения**: 

- **`None`**:

**Пример**:

```python
>>> update_working_proxies()
```

### `get_random_proxy()`

**Цель**: Выбор случайного рабочего прокси-сервера из глобального списка `working_proxies`.

**Параметры**: 

- **`None`**: 

**Возвращает**: 

- **`str`**: Случайный рабочий прокси-сервер в формате "IP:Port".

**Исключения**: 

- **`None`**:

**Пример**:

```python
>>> get_random_proxy()
'1.1.1.1:8080'
```

## Принципы работы

Модуль `auto_proxy.py` использует многопоточность для ускорения процесса тестирования прокси-серверов. Функция `get_working_proxies()` создает отдельный поток для каждого прокси-сервера, что позволяет одновременно проверять несколько серверов. После завершения тестирования список рабочих прокси обновляется. Функция `update_working_proxies()` периодически запускает процесс обновления списка рабочих прокси, что обеспечивает постоянное наличие актуальных прокси-серверов. 

## Примеры

```python
# Получение списка прокси-серверов
proxy_list = fetch_proxies()

# Тестирование прокси-серверов
test_proxy('1.1.1.1:8080', 'What is the capital of France?', 5)

# Обновление списка рабочих прокси
update_working_proxies()

# Получение случайного рабочего прокси
random_proxy = get_random_proxy()

# Использование полученного прокси
# (Пример с библиотекой 'requests')
response = requests.get('https://example.com', proxies={'http': random_proxy})
```
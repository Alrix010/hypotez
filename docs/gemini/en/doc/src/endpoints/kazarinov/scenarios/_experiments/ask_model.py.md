# Модуль для проверки валидности ответов от модели

## Обзор

Модуль `ask_model.py` используется для проверки валидности ответов, полученных от модели. Он взаимодействует с моделью Google Gemini, отправляет запросы с заданным системным и командным инструктажем, а затем обрабатывает полученные ответы.

## Детали

В этом модуле реализована функция `model_ask`, которая отправляет запросы модели Google Gemini и обрабатывает полученные ответы. Она принимает язык (`lang`) и количество попыток (`attempts`) в качестве параметров. Модель получает системный и командный инструктаж, а также список товаров для обработки. Функция `model_ask` проверяет наличие ответа от модели, парсит полученные данные в формат JSON и записывает результаты в файлы с соответствующими именами, в которых указывается язык и дата.

## Функции

### `model_ask`

**Цель**: Отправить запрос модели Google Gemini и обработать ответ.

**Параметры**:

- `lang` (str): Язык запроса.
- `attempts` (int): Количество попыток отправки запроса.

**Возвращает**:

- `dict`: Словарь с ответом от модели или пустой словарь в случае ошибки.

**Исключения**:

- `Exception`: Возникает, если происходит ошибка при обработке ответа от модели.

**Как работает функция**:

1. Функция устанавливает глобальные переменные `model`, `q_ru` и `q_he`, которые содержат модель Google Gemini, русский и ивритский запросы соответственно.
2. Она отправляет запрос модели Google Gemini на основе указанного языка (`lang`).
3. В случае, если нет ответа от модели, функция записывает ошибку в лог и возвращает пустой словарь.
4. Если ответ получен, функция парсит его в формат JSON.
5. В случае ошибки парсинга функция записывает ошибку в лог, проверяет количество попыток и, если оно больше 1, вызывает саму себя с уменьшенным количеством попыток.
6. Если ответ успешно распарсен, функция возвращает словарь с ответом от модели.

**Пример**:

```python
# Пример вызова функции:
response_ru_dict = model_ask('ru')
# Получение словаря с ответом от модели на русском языке

response_he_dict = model_ask('he')
# Получение словаря с ответом от модели на иврите
```

## Примеры

```python
response_ru_dict = model_ask('ru')
# Получение словаря с ответом от модели на русском языке

response_he_dict = model_ask('he')
# Получение словаря с ответом от модели на иврите
```

## Дополнительные сведения

В этом модуле используется драйвер Selenium для работы с веб-страницами, но он не используется в функции `model_ask`. Модуль `driver` из проекта `hypotez` содержит все необходимые настройки Selenium.

**Дополнительные сведения о драйвере Selenium**:

```python
from src.webdirver import Driver, Chrome, Firefox, Playwright
driver = Driver(Chrome)

close_banner = {
  "attribute": null,
  "by": "XPATH",
  "selector": "//button[@id = 'closeXButton']",
  "if_list": "first",
  "use_mouse": false,
  "mandatory": false,
  "timeout": 0,
  "timeout_for_event": "presence_of_element_located",
  "event": "click()",
  "locator_description": "Закрываю pop-up окно, если оно не появилось - не страшно (`mandatory`:`false`)"
}

result = driver.execute_locator(close_banner)
```

**Важно**:

- В модуле используются глобальные переменные `model`, `q_ru` и `q_he`. 
- Все комментарии и docstrings должны быть на русском языке.
- В модуле используется функция `logger` из модуля `src.logger.logger` для ведения логов.
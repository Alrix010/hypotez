# Модуль ReportGenerator: Генерация HTML и PDF для мехиронов Казаринова

## Обзор

Модуль `report_generator.py` реализует класс `ReportGenerator`, который используется для генерации отчетов в формате HTML и PDF, основанных на данных, хранящихся в JSON-файлах. 

## Детали

- **Цель**: Модуль обеспечивает функциональность создания отчетов для мехиронов Казаринова, предоставляя пользователю возможность получить отчеты в различных форматах.
- **Местоположение**: `hypotez/src/endpoints/kazarinov/react/report_generator.py`
- **Связь с другими модулями**: 
    - `src.utils.jjson`:  Используется для чтения JSON-файлов с данными.
    - `src.utils.file`: Обеспечивает операции с файлами: чтение и запись.
    - `src.utils.convertors.html`:  Преобразует HTML в PDF.
    - `src.utils.image`:  Генерирует случайные изображения.
    - `src.logger.logger`: Используется для записи логов.
    - `src.gs`:  Предоставляет доступ к конфигурационным данным, таким как пути к файлам.
- **Основная функциональность**:
    - Загрузка данных из JSON-файла.
    - Генерация HTML-отчета с использованием Jinja2.
    - Сохранение HTML-файла.
    - Преобразование HTML в PDF.
    - Отправка отчета в Telegram-чат (опционально).

## Классы

### `class ReportGenerator`

**Описание**: Класс `ReportGenerator` реализует логику генерации отчетов в разных форматах.

**Атрибуты**:

- `if_need_html` (bool):  Флаг, указывающий на необходимость генерации HTML-файла.
- `if_need_pdf` (bool): Флаг, указывающий на необходимость генерации PDF-файла.
- `if_need_docx` (bool): Флаг, указывающий на необходимость генерации DOCX-файла.
- `storage_path` (Path): Путь к директории для сохранения отчетов.
- `html_path` (Path|str):  Путь к HTML-файлу.
- `pdf_path` (Path|str): Путь к PDF-файлу.
- `docs_path` (Path|str): Путь к DOCX-файлу.
- `html_content` (str): Содержимое HTML-отчета.
- `data` (dict):  Словарь с данными для отчета.
- `lang` (str): Язык отчета.
- `mexiron_name` (str):  Название мехирона.
- `env` (Environment):  Объект Jinja2 для обработки шаблонов.

**Методы**:

#### `__init__(self, if_need_pdf:Optional[bool] = True, if_need_docx:Optional[bool] = True)`

**Описание**: Конструктор класса `ReportGenerator`. 

**Параметры**:

- `if_need_pdf` (Optional[bool]):  Флаг, указывающий на необходимость генерации PDF-файла (по умолчанию `True`).
- `if_need_docx` (Optional[bool]):  Флаг, указывающий на необходимость генерации DOCX-файла (по умолчанию `True`).

**Возвращает**:  None

#### `async def create_reports_async(self, bot: telebot.TeleBot, chat_id: int, data:dict, lang:str, mexiron_name:str) -> tuple`

**Описание**: Асинхронный метод для создания отчетов во всех форматах (HTML, PDF, DOCX).

**Параметры**:

- `bot` (telebot.TeleBot): Объект телеграм-бота.
- `chat_id` (int):  ID чата для отправки отчета.
- `data` (dict):  Словарь с данными для отчета.
- `lang` (str): Язык отчета.
- `mexiron_name` (str):  Название мехирона.

**Возвращает**:  tuple: Кортеж, содержащий результаты генерации отчетов.

#### `service_apendix(self, lang:str) -> dict`

**Описание**: Метод для добавления информации о сервисе в отчет.

**Параметры**:

- `lang` (str): Язык отчета.

**Возвращает**:  dict: Словарь с информацией о сервисе.

#### `async def create_html_report_async(self, data:dict, lang:str, html_path:Optional[ str|Path] ) -> str`

**Описание**:  Асинхронный метод для генерации HTML-отчета.

**Параметры**:

- `data` (dict):  Словарь с данными для отчета.
- `lang` (str): Язык отчета.
- `html_path` (Optional[str|Path]):  Путь к HTML-файлу.

**Возвращает**:  str:  HTML-контент.

#### `async def create_pdf_report_async(self, data: dict, lang:str, pdf_path:str |Path) -> bool`

**Описание**:  Асинхронный метод для генерации PDF-отчета.

**Параметры**:

- `data` (dict):  Словарь с данными для отчета.
- `lang` (str): Язык отчета.
- `pdf_path` (str |Path):  Путь к PDF-файлу.

**Возвращает**:  bool:  `True`, если PDF-файл успешно сгенерирован, `False` в противном случае.

#### `async def create_docx_report_async(self, html_path:str|Path, docx_path:str|Path) -> bool `

**Описание**:  Асинхронный метод для создания DOCX-файла.

**Параметры**:

- `html_path` (str|Path): Путь к HTML-файлу.
- `docx_path` (str|Path):  Путь к DOCX-файлу.

**Возвращает**:  bool:  `True`, если DOCX-файл успешно сгенерирован, `False` в противном случае.

## Функции

### `def main(maxiron_name:str, lang:str) ->bool`

**Описание**:  Функция для запуска процесса генерации отчетов.

**Параметры**:

- `maxiron_name` (str):  Название мехирона.
- `lang` (str): Язык отчета.

**Возвращает**:  bool:  `True`, если процесс генерации отчетов завершен успешно, `False` в противном случае.

**Принцип работы**:
-  Функция `main`  загружает данные из JSON-файла, определяет пути к выходным файлам и создает экземпляр класса `ReportGenerator`.
-  Затем она запускает асинхронный метод `create_reports_async` для создания отчетов в разных форматах.

**Примеры**:
```python
# Запуск генерации отчета для мехирона с именем '250127221657987' на русском языке
main('250127221657987', 'ru')
```

##  Дополнительные замечания:

- В коде используются стандартные библиотеки Python, такие как `json`, `pathlib`, `jinja2` и `pdfkit`, для обработки данных, генерации HTML и PDF.
- Модуль использует библиотеку `telebot` для отправки отчетов в Telegram.
- Модуль `gs` обеспечивает доступ к конфигурационным данным, включая пути к файлам и другим ресурсам.
- Модуль `logger` используется для записи логов в консоль и файл.
- Модуль предоставляет возможность настроить, какие типы файлов нужно генерировать (HTML, PDF, DOCX).
- Модуль `src.utils.image`  используется для генерации случайных изображений.
- Модуль `src.utils.convertors.html` используется для преобразования HTML в PDF.
- Модуль `src.utils.file`  используется для чтения и записи файлов.
- Модуль `src.utils.jjson`  используется для чтения JSON-файлов.
- Модуль `header`  используется для хранения глобальных констант.
- Модуль `src.utils.printer`  используется для красивого вывода данных в консоль.
# Модуль TinyFactory

## Обзор

Этот модуль содержит класс `TinyFactory`, который представляет собой базовый класс для различных типов фабрик. 
Он используется для создания агентов, таких как виртуальные пользователи, в различных сценариях, например, для имитации 
поведения пользователей на веб-сайте.

## Детали

`TinyFactory` предоставляет методы для создания и управления фабриками, а также для кеширования состояния 
фабрики. 
Этот модуль является важным элементом системы, так как он позволяет создавать и управлять агентами в 
различных типах симуляций.

## Классы

### `TinyFactory`

**Описание**: Базовый класс для различных типов фабрик. 
**Наследование**: Нет.

**Атрибуты**:

- `name` (str): Уникальное имя фабрики.
- `simulation_id` (str): Идентификатор симуляции, к которой принадлежит фабрика.

**Методы**:

#### `__init__`

**Цель**: Инициализирует экземпляр `TinyFactory`.

**Параметры**:

- `simulation_id` (str, optional): Идентификатор симуляции. По умолчанию `None`.

**Возвращает**: 
- `None`

**Исключения**:
- `ValueError`: если фабрика с таким именем уже существует.

**Как работает**:

- При инициализации `TinyFactory` создает уникальное имя с помощью `utils.fresh_id()`.
- Если `simulation_id` не указан, он остается `None`.
- Добавляет фабрику в глобальный список `TinyFactory.all_factories`.

**Примеры**:

```python
# Создание фабрики
factory = TinyFactory()

# Создание фабрики с указанием идентификатора симуляции
factory = TinyFactory(simulation_id='simulation_1')
```

#### `__repr__`

**Цель**: Возвращает строковое представление объекта `TinyFactory`.

**Параметры**:
- `None`

**Возвращает**:
- `str`: строковое представление объекта.

**Как работает**:
- Возвращает строку формата `TinyFactory(name='<имя_фабрики>')`.

**Примеры**:

```python
# Вывод строкового представления фабрики
print(factory)
```

#### `set_simulation_for_free_factories`

**Цель**: Устанавливает симуляцию для свободных фабрик, которые не привязаны к конкретной симуляции.

**Параметры**:

- `simulation`: Объект симуляции.

**Возвращает**: 
- `None`

**Как работает**:
- Проходит по всем фабрикам в `TinyFactory.all_factories`.
- Если фабрика не привязана к симуляции (т.е. `factory.simulation_id` равен `None`), добавляет ее в список фабрик симуляции.

**Примеры**:

```python
# Установка симуляции для свободных фабрик
from tinytroupe.simulation import Simulation
simulation = Simulation()

TinyFactory.set_simulation_for_free_factories(simulation)
```

#### `add_factory`

**Цель**: Добавляет фабрику в глобальный список `TinyFactory.all_factories`.

**Параметры**:

- `factory`: Экземпляр `TinyFactory`, который необходимо добавить.

**Возвращает**: 
- `None`

**Исключения**:
- `ValueError`: если фабрика с таким именем уже существует.

**Как работает**:
- Проверяет, есть ли в `TinyFactory.all_factories` фабрика с таким же именем.
- Если фабрика уже существует, выдает ошибку.
- В противном случае добавляет фабрику в список.

**Примеры**:

```python
# Добавление фабрики в список
factory = TinyFactory()
TinyFactory.add_factory(factory)
```

#### `clear_factories`

**Цель**: Очищает глобальный список `TinyFactory.all_factories`.

**Параметры**:
- `None`

**Возвращает**: 
- `None`

**Как работает**:
- Устанавливает значение `TinyFactory.all_factories` в пустой словарь.

**Примеры**:

```python
# Очистка списка фабрик
TinyFactory.clear_factories()
```

#### `encode_complete_state`

**Цель**: Кодирует полное состояние фабрики в словарь.

**Параметры**:
- `None`

**Возвращает**: 
- `dict`: словарь с полным состоянием фабрики.

**Как работает**:
- Создает копию словаря `self.__dict__` (включая все атрибуты фабрики).
- Возвращает эту копию.

**Примеры**:

```python
# Кодировка состояния фабрики
factory = TinyFactory()
state = factory.encode_complete_state()
```

#### `decode_complete_state`

**Цель**: Декодирует состояние фабрики из словаря.

**Параметры**:

- `state`: Словарь с состоянием фабрики.

**Возвращает**: 
- `TinyFactory`: объект `TinyFactory` с декодированным состоянием.

**Как работает**:
- Создает копию входного словаря `state`.
- Обновляет `self.__dict__` с помощью скопированного словаря.
- Возвращает `self` (т.е. объект фабрики с декодированным состоянием).

**Примеры**:

```python
# Декодировка состояния фабрики
factory = TinyFactory()
state = factory.encode_complete_state()
factory = TinyFactory.decode_complete_state(state)
```

## Класс Methods

### `add_factory`

**Цель**: Добавляет фабрику в глобальный список `TinyFactory.all_factories`.

**Параметры**:

- `factory`: Экземпляр `TinyFactory`, который необходимо добавить.

**Возвращает**: 
- `None`

**Исключения**:
- `ValueError`: если фабрика с таким именем уже существует.

**Как работает**:
- Проверяет, есть ли в `TinyFactory.all_factories` фабрика с таким же именем.
- Если фабрика уже существует, выдает ошибку.
- В противном случае добавляет фабрику в список.

**Примеры**:

```python
# Добавление фабрики в список
factory = TinyFactory()
TinyFactory.add_factory(factory)
```

### `clear_factories`

**Цель**: Очищает глобальный список `TinyFactory.all_factories`.

**Параметры**:
- `None`

**Возвращает**: 
- `None`

**Как работает**:
- Устанавливает значение `TinyFactory.all_factories` в пустой словарь.

**Примеры**:

```python
# Очистка списка фабрик
TinyFactory.clear_factories()
```

## Примеры

```python
from tinytroupe.factory import TinyFactory
from tinytroupe.simulation import Simulation

# Создание симуляции
simulation = Simulation()

# Создание фабрики 
factory = TinyFactory(simulation_id='simulation_1')

# Добавление фабрики в список фабрик симуляции
simulation.add_factory(factory)

# Кодировка состояния фабрики
state = factory.encode_complete_state()

# Создание новой фабрики с декодированным состоянием
new_factory = TinyFactory.decode_complete_state(state)

# Очистка списка фабрик
TinyFactory.clear_factories()
```

## Детали параметров

- `simulation_id` (str): Идентификатор симуляции, к которой принадлежит фабрика. Используется для группирования фабрик 
в рамках конкретной симуляции.

## Использование

`TinyFactory` используется для создания и управления агентами в различных типах симуляций. 
Он предоставляет методы для кодирования и декодирования состояния фабрики, что позволяет сохранять и восстанавливать 
состояние фабрики, например, при кешировании.

## Дополнительная информация

- `TinyFactory`  - это базовый класс, который может быть расширен для создания специализированных типов фабрик.
- `utils.fresh_id()` - функция для генерации уникальных идентификаторов.
- `TinyFactory.all_factories` - глобальный словарь, который хранит все созданные фабрики.
# Модуль `experimentation.py`

## Обзор

Этот модуль содержит классы `ABRandomizer` и `Intervention`, которые используются для проведения экспериментов, а также для рандомизации и дерандомизации вариантов лечения.

## Детали

**ABRandomizer:**
Этот класс позволяет рандомизировать варианты лечения для участников эксперимента. Он позволяет задать реальные имена вариантов лечения, их «слепые» имена (те, которые видны пользователю) и имена, которые не нужно рандомизировать. При инициализации класса можно задать случайное зерно для воспроизводимости результатов.

**Intervention:**
Этот класс представляет собой интервенцию в эксперименте. Интервенция может быть применена к агентам (например, участникам) или к среде (например, условиям эксперимента). Интервенция может иметь определенные предусловия, которые должны быть выполнены, чтобы интервенция была применена. Интервенция также имеет определенные эффекты, которые будут применены при ее реализации.

## Классы

### `ABRandomizer`

**Описание**: Класс для рандомизации вариантов лечения в эксперименте.

**Атрибуты**:

- `choices (dict)`: Словарь, хранящий соответствия между индексом элемента и парой (0, 1) или (1, 0), что указывает на то, были ли варианты лечения переключены для данного элемента.
- `real_name_1 (str)`: Название первого варианта лечения, как он представлен в данных.
- `real_name_2 (str)`: Название второго варианта лечения, как он представлен в данных.
- `blind_name_a (str)`: Название первого варианта лечения, как он представлен пользователю.
- `blind_name_b (str)`: Название второго варианта лечения, как он представлен пользователю.
- `passtrough_name (list)`: Список имен, которые не нужно рандомизировать.
- `random_seed (int)`: Случайное зерно для воспроизводимости результатов.

**Методы**:

#### `randomize`

**Описание**: Рандомизирует варианты лечения для элемента `i`.

**Параметры**:

- `i (int)`: Индекс элемента.
- `a (str)`: Первый вариант лечения.
- `b (str)`: Второй вариант лечения.

**Возвращаемое значение**:

- `tuple(str, str)`: Кортеж из двух вариантов лечения, которые могут быть переключены.

#### `derandomize`

**Описание**: Дерандомизирует варианты лечения для элемента `i`.

**Параметры**:

- `i (int)`: Индекс элемента.
- `a (str)`: Первый вариант лечения.
- `b (str)`: Второй вариант лечения.

**Возвращаемое значение**:

- `tuple(str, str)`: Кортеж из двух вариантов лечения, которые были рандомизированы.

#### `derandomize_name`

**Описание**: Декодирует название выбранного пользователем варианта лечения.

**Параметры**:

- `i (int)`: Индекс элемента.
- `blind_name (str)`: Название варианта лечения, выбранного пользователем.

**Возвращаемое значение**:

- `str`: Название варианта лечения, как он представлен в данных.

### `Intervention`

**Описание**: Класс, представляющий интервенцию в эксперименте.

**Атрибуты**:

- `agents (list)`: Список агентов, к которым должна быть применена интервенция.
- `environments (list)`: Список сред, к которым должна быть применена интервенция.
- `text_precondition (str)`: Текстовое описание предусловий интервенции.
- `precondition_func (function)`: Функция, которая проверяет, выполняются ли предусловия интервенции.
- `effect_func (function)`: Функция, которая реализует эффект интервенции.

**Методы**:

#### `check_precondition`

**Описание**: Проверяет, выполняются ли предусловия интервенции.

**Возвращаемое значение**:

- `bool`: True, если предусловия выполнены, False в противном случае.

#### `apply`

**Описание**: Применяет интервенцию.

**Возвращаемое значение**:

- `None`

#### `set_textual_precondition`

**Описание**: Задает текстовое описание предусловий интервенции.

**Параметры**:

- `text (str)`: Текстовое описание предусловий интервенции.

**Возвращаемое значение**:

- `None`

#### `set_functional_precondition`

**Описание**: Задает функцию, которая проверяет, выполняются ли предусловия интервенции.

**Параметры**:

- `func (function)`: Функция, которая проверяет, выполняются ли предусловия интервенции.

**Возвращаемое значение**:

- `None`

#### `set_effect`

**Описание**: Задает функцию, которая реализует эффект интервенции.

**Параметры**:

- `effect_func (function)`: Функция, которая реализует эффект интервенции.

**Возвращаемое значение**:

- `None`

## Примеры

```python
# Создание экземпляра ABRandomizer
randomizer = ABRandomizer(real_name_1="control", real_name_2="treatment",
                         blind_name_a="A", blind_name_b="B",
                         passtrough_name=["gender"],
                         random_seed=42)

# Рандомизация вариантов лечения для элемента с индексом 0
a, b = randomizer.randomize(0, "control", "treatment")

# Дерандомизация вариантов лечения для элемента с индексом 0
a, b = randomizer.derandomize(0, "control", "treatment")

# Декодирование названия выбранного пользователем варианта лечения
real_name = randomizer.derandomize_name(0, "A")

# Создание экземпляра Intervention
intervention = Intervention(agent=TinyPerson(name="Alice"),
                           environment=TinyWorld(name="Shop"))

# Задание текстового описания предусловий интервенции
intervention.set_textual_precondition("Alice is in the shop.")

# Задание функции, которая проверяет, выполняются ли предусловия интервенции
intervention.set_functional_precondition(lambda agent, environment: agent.location == environment)

# Задание функции, которая реализует эффект интервенции
intervention.set_effect(lambda agent, environment: agent.buy_product("apple"))

# Проверка, выполняются ли предусловия интервенции
if intervention.check_precondition():
    # Применение интервенции
    intervention.apply()
```
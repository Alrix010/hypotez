# Модуль `auto_proxy.py`

## Обзор

Модуль предоставляет функциональность для автоматического получения и тестирования HTTP-прокси-серверов. Он включает в себя функции для получения списка прокси-серверов из внешнего источника, проверки их работоспособности и добавления рабочих прокси в глобальный список. Также модуль содержит функции для периодического обновления списка рабочих прокси и выбора случайного рабочего прокси из этого списка.

## Детали

Этот код используется для автоматического обновления списка рабочих прокси-серверов, которые могут быть использованы для обхода ограничений доступа или повышения анонимности при выполнении HTTP-запросов. Это особенно полезно в приложениях, взаимодействующих с API или веб-сайтами, которые могут блокировать запросы с определенных IP-адресов.

## Функции

### `fetch_proxies`

```python
def fetch_proxies() -> list:
    """
    Функция получает список прокси-серверов из proxyscrape.com.

    Returns:
        list: Список прокси-серверов в формате "IP:Port".
    """
    ...
```

**Возвращаемое значение**:
- `list`: Список прокси-серверов в формате "IP:Port".

**Как работает**:
- Функция выполняет HTTP-запрос к URL `https://www.proxy-list.download/api/v1/get?type=http`.
- В случае успешного ответа (status_code == 200), функция разделяет текст ответа на строки, удаляя последнюю пустую строку, и возвращает полученный список прокси-серверов.
- В случае ошибки при выполнении запроса, функция выводит сообщение об ошибке и возвращает пустой список.

**Пример**:
```python
proxies = fetch_proxies()
if proxies:
    print(f"Получено {len(proxies)} прокси-серверов.")
else:
    print("Не удалось получить прокси-серверы.")
```

### `test_proxy`

```python
def test_proxy(proxy: str, prompt: str, timeout: int) -> None:
    """
    Функция тестирует заданный прокси-сервер с использованием указанного запроса и времени ожидания.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
        prompt (str): Тестовый запрос для проверки прокси-сервера.
        timeout (int): Максимальное время в секундах, отведенное на тест.
    """
    ...
```

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".
- `prompt` (str): Тестовый запрос для проверки прокси-сервера.
- `timeout` (int): Максимальное время в секундах, отведенное на тест.

**Как работает**:
- Функция измеряет время от начала отправки запроса через прокси-сервер до получения ответа.
- Если время ответа меньше заданного `timeout`, функция выводит сообщение об успешной проверке прокси и добавляет его в список рабочих прокси-серверов с помощью функции `add_working_proxy`.
- В случае возникновения исключения во время проверки прокси, функция просто пропускает его.

**Пример**:
```python
test_proxy("127.0.0.1:8080", "What is the capital of France?", 5)
```

### `add_working_proxy`

```python
def add_working_proxy(proxy: str) -> None:
    """
    Функция добавляет рабочий прокси-сервер в глобальный список `working_proxies`.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
    """
    ...
```

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает**:
- Функция добавляет переданный прокси-сервер в глобальный список `working_proxies`.

**Пример**:
```python
add_working_proxy("127.0.0.1:8080")
```

### `remove_proxy`

```python
def remove_proxy(proxy: str) -> None:
    """
    Функция удаляет прокси-сервер из глобального списка `working_proxies`.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
    """
    ...
```

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает**:
- Функция проверяет, присутствует ли указанный прокси-сервер в глобальном списке `working_proxies`, и если да, то удаляет его из списка.

**Пример**:
```python
remove_proxy("127.0.0.1:8080")
```

### `get_working_proxies`

```python
def get_working_proxies(prompt: str, timeout: int = 5) -> None:
    """
    Функция получает и тестирует прокси-серверы, добавляя рабочие прокси в глобальный список `working_proxies`.

    Args:
        prompt (str): Тестовый запрос для проверки прокси-серверов.
        timeout (int, optional): Максимальное время в секундах, отведенное на тестирование. По умолчанию 5.
    """
    ...
```

**Параметры**:
- `prompt` (str): Тестовый запрос для проверки прокси-серверов.
- `timeout` (int, optional): Максимальное время в секундах, отведенное на тестирование. По умолчанию 5.

**Как работает**:
- Функция получает список прокси-серверов с помощью функции `fetch_proxies`.
- Для каждого прокси-сервера создается отдельный поток, который выполняет функцию `test_proxy` для проверки работоспособности прокси.
- После запуска всех потоков функция ожидает завершения каждого потока в течение заданного времени `timeout`.

**Пример**:
```python
get_working_proxies("What is the capital of France?", timeout=5)
```

### `update_working_proxies`

```python
def update_working_proxies() -> None:
    """
    Функция непрерывно обновляет глобальный список `working_proxies` рабочими прокси-серверами.
    """
    ...
```

**Как работает**:
- Функция в бесконечном цикле выполняет следующие действия:
  - Очищает глобальный список `working_proxies`.
  - Получает и тестирует прокси-серверы с помощью функции `get_working_proxies`.
  - Выводит сообщение "proxies updated".
  - Приостанавливает выполнение на 1800 секунд (30 минут).

**Пример**:
```python
update_working_proxies()
```

### `get_random_proxy`

```python
def get_random_proxy() -> str:
    """
    Функция получает случайный рабочий прокси-сервер из глобального списка `working_proxies`.

    Returns:
        str: Случайный рабочий прокси-сервер в формате "IP:Port".
    """
    ...
```

**Возвращаемое значение**:
- `str`: Случайный рабочий прокси-сервер в формате "IP:Port".

**Как работает**:
- Функция выбирает случайный элемент из глобального списка `working_proxies` и возвращает его.

**Пример**:
```python
proxy = get_random_proxy()
if proxy:
    print(f"Случайный рабочий прокси: {proxy}")
else:
    print("Нет рабочих прокси-серверов в списке.")
```
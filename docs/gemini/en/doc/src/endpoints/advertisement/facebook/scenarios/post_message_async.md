# src.endpoints.advertisement.facebook.post_message_async

## Обзор

Этот скрипт является частью директории `hypotez/src/endpoints/advertisement/facebook/scenarios` и предназначен для автоматизации процесса публикации сообщений в Facebook. Скрипт взаимодействует со страницей Facebook, используя локаторы для выполнения различных действий, таких как отправка сообщений, загрузка медиафайлов и обновление подписей.

## Подробнее

Более подробное описание. Объяснение, как и зачем этот код используется в проекте. Анализ ранее предоставленного кода.

## Основные возможности

1. **Отправка заголовка и описания**: Отправляет заголовок и описание кампании в поле сообщения Facebook.
2. **Загрузка медиафайлов**: Загружает медиафайлы (изображения и видео) в пост Facebook и обновляет их подписи.
3. **Продвижение поста**: Управляет всем процессом продвижения поста с заголовком, описанием и медиафайлами.

## Структура модуля

```mermaid
graph TD
    Start[Start] --> InitDriver[Инициализация драйвера]
    InitDriver --> LoadCategoryAndProducts[Загрузка категории и товаров]
    LoadCategoryAndProducts --> SendTitle[Отправка заголовка]
    SendTitle --> CheckTitleSuccess{Успешно?}
    CheckTitleSuccess -->|Да| UploadMediaAndPromotePost[Загрузка медиа и продвижение поста]
    CheckTitleSuccess -->|Нет| TitleError[Ошибка: не удалось отправить заголовок]
    UploadMediaAndPromotePost --> UploadMedia[Загрузка медиа]
    UploadMedia --> CheckMediaSuccess{Успешно?}
    CheckMediaSuccess -->|Да| UpdateCaptions[Обновление подписей изображений]
    CheckMediaSuccess -->|Нет| MediaError[Ошибка: не удалось загрузить медиа]
    UpdateCaptions --> PromotePost[Продвижение поста]
    PromotePost --> CheckPromoteSuccess{Успешно?}
    CheckPromoteSuccess -->|Да| End[Конец]
    CheckPromoteSuccess -->|Нет| PromoteError[Ошибка: не удалось продвинуть пост]
```

## Обозначения

1. **Start**: Начало выполнения скрипта.
2. **InitDriver**: Создание экземпляра класса `Driver`.
3. **LoadCategoryAndProducts**: Загрузка данных категории и товаров.
4. **SendTitle**: Вызов функции `post_title` для отправки заголовка.
5. **CheckTitleSuccess**: Проверка, был ли заголовок отправлен успешно.
   - **Да**: Перейти к загрузке медиа и продвижению поста.
   - **Нет**: Вывод ошибки "Не удалось отправить заголовок".
6. **UploadMediaAndPromotePost**: Вызов функции `promote_post`.
7. **UploadMedia**: Вызов функции `upload_media` для загрузки медиафайлов.
8. **CheckMediaSuccess**: Проверка, были ли медиафайлы загружены успешно.
   - **Да**: Перейти к обновлению подписей изображений.
   - **Нет**: Вывод ошибки "Не удалось загрузить медиа".
9. **UpdateCaptions**: Вызов функции `update_images_captions` для обновления подписей.
10. **PromotePost**: Завершение процесса продвижения поста.
11. **CheckPromoteSuccess**: Проверка, был ли пост продвинут успешно.
    - **Да**: Конец выполнения скрипта.
    - **Нет**: Вывод ошибки "Не удалось продвинуть пост".

-----------------------

## Функции

- **`post_title(d: Driver, category: SimpleNamespace) -> bool`**:
  - **Назначение**: Отправляет заголовок и описание кампании в поле сообщения Facebook.
  - **Параметры**:
    - `d` (`Driver`): Экземпляр класса `Driver`, используемый для взаимодействия с веб-страницей.
    - `category` (`SimpleNamespace`): Категория, содержащая заголовок и описание для отправки.
  - **Возвращает**: `True`, если заголовок и описание были отправлены успешно, иначе `None`.

- **`upload_media(d: Driver, products: List[SimpleNamespace], no_video: bool = False) -> bool`**:
  - **Назначение**: Загружает медиафайлы в пост Facebook и обновляет их подписи.
  - **Параметры**:
    - `d` (`Driver`): Экземпляр класса `Driver`, используемый для взаимодействия с веб-страницей.
    - `products` (`List[SimpleNamespace]`): Список товаров, содержащих пути к медиафайлам.
    - `no_video` (`bool`, optional): Флаг, указывающий, следует ли пропускать загрузку видео. По умолчанию `False`.
  - **Возвращает**: `True`, если медиафайлы были загружены успешно, иначе `None`.

- **`update_images_captions(d: Driver, products: List[SimpleNamespace], textarea_list: List[WebElement]) -> None`**:
  - **Назначение**: Асинхронно добавляет описания к загруженным медиафайлам.
  - **Параметры**:
    - `d` (`Driver`): Экземпляр класса `Driver`, используемый для взаимодействия с веб-страницей.
    - `products` (`List[SimpleNamespace]`): Список товаров с деталями для обновления.
    - `textarea_list` (`List[WebElement]`): Список текстовых полей, в которые добавляются подписи.

- **`promote_post(d: Driver, category: SimpleNamespace, products: List[SimpleNamespace], no_video: bool = False) -> bool`**:
  - **Назначение**: Управляет процессом продвижения поста с заголовком, описанием и медиафайлами.
  - **Параметры**:
    - `d` (`Driver`): Экземпляр класса `Driver`, используемый для взаимодействия с веб-страницей.
    - `category` (`SimpleNamespace`): Детали категории, используемые для заголовка и описания поста.
    - `products` (`List[SimpleNamespace]`): Список товаров, содержащих медиа и детали для публикации.
    - `no_video` (`bool`, optional): Флаг, указывающий, следует ли пропускать загрузку видео. По умолчанию `False`.
  - **Возвращает**: `True`, если пост был продвинут успешно, иначе `None`.

### Использование

Чтобы использовать этот скрипт, выполните следующие шаги:

1. **Инициализация драйвера**: Создайте экземпляр класса `Driver`.
2. **Загрузка локаторов**: Загрузите локаторы из JSON-файла.
3. **Вызов функций**: Используйте предоставленные функции для отправки заголовка, загрузки медиа и продвижения поста.

#### Пример

```python
from src.webdriver.driver import Driver
from types import SimpleNamespace

# Инициализация драйвера
driver = Driver(...)

# Загрузка категории и товаров
category = SimpleNamespace(title="Заголовок кампании", description="Описание кампании")
products = [SimpleNamespace(local_image_path='path/to/image.jpg', ...)]

# Отправка заголовка
post_title(driver, category)

# Загрузка медиа и продвижение поста
await promote_post(driver, category, products)
```

### Зависимости

- `selenium`: Для автоматизации веб-интерфейса.
- `asyncio`: Для асинхронных операций.
- `pathlib`: Для обработки путей к файлам.
- `types`: Для создания простых пространств имен.
- `typing`: Для аннотаций типов.

### Обработка ошибок

Скрипт включает надежную обработку ошибок, чтобы обеспечить продолжение выполнения, даже если определенные элементы не найдены или возникли проблемы с веб-страницей. Это особенно полезно для обработки динамических или нестабильных веб-страниц.

### Вклад

Приветствуются вклады в этот скрипт. Убедитесь, что любые изменения хорошо задокументированы и включают соответствующие тесты.

### Лицензия

Этот скрипт распространяется под лицензией MIT. Подробности см. в файле `LICENSE`.
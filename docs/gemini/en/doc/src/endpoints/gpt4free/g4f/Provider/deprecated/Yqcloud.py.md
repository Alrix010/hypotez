# Модуль `Yqcloud.py`

## Обзор

Модуль `Yqcloud.py` предоставляет асинхронный генератор для взаимодействия с сервисом `chat9.yqcloud.top`. Он позволяет отправлять запросы к API `aichatos.cloud` для генерации текста в потоковом режиме. Модуль поддерживает модель `gpt-3.5-turbo` и предоставляет возможность использования прокси.

## Более подробно

Модуль содержит класс `Yqcloud`, который наследуется от `AsyncGeneratorProvider` и реализует метод `create_async_generator` для создания асинхронного генератора. Также в модуле определены две вспомогательные функции: `_create_header` для создания заголовков запроса и `_create_payload` для формирования полезной нагрузки запроса.

## Классы

### `Yqcloud`

**Описание**:
Класс `Yqcloud` предоставляет функциональность для взаимодействия с сервисом `chat9.yqcloud.top`. Он позволяет отправлять запросы к API `aichatos.cloud` для генерации текста в потоковом режиме.

**Наследует**:
- `AsyncGeneratorProvider`: Базовый класс для асинхронных провайдеров генераторов.

**Атрибуты**:
- `url` (str): URL сервиса `chat9.yqcloud.top`.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели `gpt-3.5-turbo`.

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от API.

## Методы класса

### `create_async_generator`

```python
    async def create_async_generator(
        model: str,
        messages: Messages,
        proxy: str = None,
        timeout: int = 120,
        **kwargs,
    ) -> AsyncResult:
        """Создает асинхронный генератор для получения ответов от API.

        Args:
            model (str): Модель, используемая для генерации текста.
            messages (Messages): Список сообщений для отправки в API.
            proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
            timeout (int, optional): Время ожидания ответа от API в секундах. По умолчанию 120.
            **kwargs: Дополнительные аргументы, которые будут переданы в функцию `_create_payload`.

        Returns:
            AsyncResult: Асинхронный генератор, выдающий части ответа от API.

        Raises:
            RuntimeError: Если IP-адрес заблокирован из-за обнаружения злоупотреблений.

        Как работает функция:
        1. Создается асинхронная сессия `StreamSession` с заданными заголовками, прокси и временем ожидания.
        2. Формируется полезная нагрузка запроса с помощью функции `_create_payload`.
        3. Отправляется POST-запрос к API `https://api.aichatos.cloud/api/generateStream` с полезной нагрузкой.
        4. В цикле читаются чанки ответа от API.
        5. Каждый чанк декодируется и проверяется на наличие сообщения о блокировке IP-адреса.
        6. Если IP-адрес заблокирован, выбрасывается исключение `RuntimeError`.
        7. Каждый чанк выдается из генератора.
        """
```

## Функции

### `_create_header`

```python
def _create_header() -> dict:
    """Создает словарь с заголовками запроса.

    Returns:
        dict: Словарь с заголовками запроса.

    Как работает функция:
    Функция создает и возвращает словарь, содержащий заголовки, необходимые для отправки запроса к API.
    В заголовках указывается тип принимаемого и отправляемого контента, а также origin и referer.
    """
```

### `_create_payload`

```python
def _create_payload(
    messages: Messages,
    system_message: str = "",
    user_id: int = None,
    **kwargs
) -> dict:
    """Создает словарь с полезной нагрузкой запроса.

    Args:
        messages (Messages): Список сообщений для отправки в API.
        system_message (str, optional): Системное сообщение для API. По умолчанию "".
        user_id (int, optional): ID пользователя. Если не указан, генерируется случайный ID. По умолчанию None.
        **kwargs: Дополнительные аргументы.

    Returns:
        dict: Словарь с полезной нагрузкой запроса.

    Как работает функция:
    1. Если `user_id` не указан, генерируется случайный ID пользователя.
    2. Формируется словарь с полезной нагрузкой, включающий:
        - `prompt`: Сформированный промпт из списка сообщений.
        - `network`: Флаг, указывающий на использование сети.
        - `system`: Системное сообщение.
        - `withoutContext`: Флаг, указывающий на отсутствие контекста.
        - `stream`: Флаг, указывающий на потоковый режим.
        - `userId`: ID пользователя в формате `#/chat/{user_id}`.
    """
# Документация для модуля `Chatgpt4o.py`

## Обзор

Модуль `Chatgpt4o.py` предназначен для асинхронного взаимодействия с провайдером ChatGPT4o. Он предоставляет функциональность для отправки сообщений и получения ответов, используя при этом асинхронные запросы. Модуль включает в себя определение URL, статуса работоспособности, идентификатора поста, nonce, модели по умолчанию, списка поддерживаемых моделей и псевдонимов моделей.

## Подробнее

Модуль предназначен для интеграции с другими частями проекта `hypotez`, обеспечивая возможность использования ChatGPT4o в качестве одного из провайдеров для обработки и генерации текста.

## Классы

### `Chatgpt4o`

**Описание**: Класс `Chatgpt4o` является асинхронным провайдером и предоставляет методы для взаимодействия с моделью ChatGPT4o.

**Наследует**:
- `AsyncProvider`: Обеспечивает асинхронное взаимодействие.
- `ProviderModelMixin`: Предоставляет общие методы для работы с моделями провайдеров.

**Атрибуты**:
- `url` (str): URL-адрес провайдера ChatGPT4o.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `_post_id` (str | None): Идентификатор поста, необходимый для запросов.
- `_nonce` (str | None): Nonce, используемый для защиты от CSRF.
- `default_model` (str): Модель, используемая по умолчанию (`gpt-4o-mini-2024-07-18`).
- `models` (list[str]): Список поддерживаемых моделей.
- `model_aliases` (dict[str, str]): Псевдонимы моделей для удобства использования.

**Принцип работы**:
Класс использует асинхронные сессии для отправки запросов к ChatGPT4o. Он получает `post_id` и `nonce` из главной страницы, если они еще не установлены, а затем отправляет сообщения, используя полученные данные.

## Методы класса

### `create_async`

```python
@classmethod
async def create_async(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    timeout: int = 120,
    cookies: dict = None,
    **kwargs
) -> str:
    """ Асинхронно создает запрос к ChatGPT4o и возвращает ответ.

    Args:
        cls (Chatgpt4o): Класс.
        model (str): Название используемой модели.
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        timeout (int, optional): Время ожидания запроса в секундах. По умолчанию 120.
        cookies (dict, optional): Куки для отправки с запросом. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        str: Ответ от ChatGPT4o.

    Raises:
        RuntimeError: Если не удается найти `post_id` или `nonce`, или если структура ответа неожиданная.

    Как работает функция:
    - Функция сначала проверяет, установлены ли `_post_id` и `_nonce`. Если нет, она выполняет GET-запрос к главной странице, извлекает `post_id` и `nonce` с использованием регулярных выражений и сохраняет их.
    - Затем функция форматирует сообщения в строку, используя функцию `format_prompt`.
    - После этого она формирует данные для POST-запроса, включая `_wpnonce`, `post_id`, `url`, `action`, `message` и `bot_id`.
    - Функция отправляет POST-запрос к `/wp-admin/admin-ajax.php` с данными и куками.
    - Полученный JSON-ответ проверяется на наличие поля `data`, и его значение возвращается.

    Пример:
        >>> messages = [{"role": "user", "content": "Hello!"}]
        >>> Chatgpt4o.create_async(model="gpt-4o-mini-2024-07-18", messages=messages)
        "ответ от ChatGPT4o"
    """
```

## Параметры класса

- `cls`: Ссылка на класс `Chatgpt4o`.
- `model` (str): Имя используемой модели.
- `messages` (Messages): Список сообщений для отправки.
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
- `timeout` (int, optional): Время ожидания запроса в секундах. По умолчанию 120.
- `cookies` (dict, optional): Куки для отправки с запросом. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

## Примеры

```python
messages = [{"role": "user", "content": "Hello!"}]
Chatgpt4o.create_async(model="gpt-4o-mini-2024-07-18", messages=messages)
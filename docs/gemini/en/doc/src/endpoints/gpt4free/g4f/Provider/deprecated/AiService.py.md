# Документация для `AiService.py`

## Обзор

Файл `AiService.py` является частью проекта `hypotez` и содержит класс `AiService`, который является устаревшим поставщиком (Provider) для взаимодействия с сервисом AiService. Класс наследуется от `AbstractProvider` и предоставляет функциональность для создания завершений (completions) на основе предоставленных сообщений.

## Более детально

Этот файл определяет интеграцию с сервисом AiService, предоставляя способ создания и получения ответов от модели, используя HTTP-запросы. В классе `AiService` реализован метод `create_completion`, который отправляет POST-запрос к API сервиса и возвращает сгенерированный ответ.

## Классы

### `AiService`

**Описание**:
Класс `AiService` является поставщиком, реализующим взаимодействие с сервисом AiService для генерации текстовых завершений на основе входных сообщений.

**Наследует**:
- `AbstractProvider`: Абстрактный базовый класс для всех поставщиков.

**Атрибуты**:
- `url` (str): URL сервиса AiService.
- `working` (bool): Флаг, указывающий на работоспособность сервиса (в данном случае `False`).
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели `gpt-35-turbo` (в данном случае `True`).

**Принцип работы**:
Класс `AiService` отправляет POST-запросы к API сервиса AiService для генерации ответов на основе предоставленных сообщений. Метод `create_completion` формирует запрос, отправляет его и возвращает ответ в виде генератора.

## Методы класса

### `create_completion`

```python
def create_completion(
    model: str,
    messages: Messages,
    stream: bool,
    **kwargs: Any,
) -> CreateResult:
    """
    Создает завершение текста на основе предоставленных сообщений, используя API сервиса AiService.

    Args:
        model (str): Идентификатор модели, используемой для генерации завершения.
        messages (Messages): Список сообщений, используемых в качестве контекста для генерации завершения.
        stream (bool): Флаг, указывающий, следует ли возвращать ответ в потоковом режиме.
        **kwargs (Any): Дополнительные аргументы.

    Returns:
        CreateResult: Генератор, возвращающий части завершенного текста.

    Raises:
        requests.exceptions.RequestException: Если возникает ошибка при выполнении HTTP-запроса.
    """
```

**Описание**:
Метод `create_completion` отправляет запрос к API сервиса AiService и возвращает сгенерированный ответ.

**Параметры**:
- `model` (str): Идентификатор модели, используемой для генерации завершения.
- `messages` (Messages): Список сообщений, используемых в качестве контекста для генерации завершения.
- `stream` (bool): Флаг, указывающий, следует ли возвращать ответ в потоковом режиме.
- `**kwargs` (Any): Дополнительные аргументы.

**Внутренние функции**:
Внутри данной функции нету внутренних функций.

**Как работает функция**:
1. Формирует строку `base` из списка сообщений, объединяя роль и содержимое каждого сообщения.
2. Определяет заголовки HTTP-запроса, включая `accept`, `content-type`, `sec-fetch-dest`, `sec-fetch-mode`, `sec-fetch-site` и `Referer`.
3. Формирует словарь `data` с входными данными (`input`), содержащими строку `base`.
4. Отправляет POST-запрос к API сервиса AiService по URL `https://aiservice.vercel.app/api/chat/answer` с указанными заголовками и данными.
5. Проверяет статус ответа и вызывает исключение `HTTPError`, если статус код указывает на ошибку.
6. Извлекает данные из JSON-ответа и возвращает их в виде генератора.

**Примеры**:

```python
# Пример вызова функции create_completion
messages = [
    {"role": "user", "content": "Привет, как дела?"},
    {"role": "assistant", "content": "У меня все хорошо, спасибо!"}
]
model = "gpt-3.5-turbo"
stream = False
kwargs = {}

result = AiService.create_completion(model, messages, stream, **kwargs)
for chunk in result:
    print(chunk)
```
```python
# Другой пример вызова функции create_completion
messages = [
    {"role": "user", "content": "Что такое машинное обучение?"}
]
model = "gpt-3.5-turbo"
stream = True
kwargs = {}

result = AiService.create_completion(model, messages, stream, **kwargs)
for chunk in result:
    print(chunk)
```
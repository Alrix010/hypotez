# Модуль crypt.py

## Обзор

Модуль `crypt.py` содержит функции для шифрования и генерации заголовков, используемых для взаимодействия с API mini_max.
Он включает функции для имитации хеширования MD5, генерации специальных заголовков и подготовки тела запроса в формате JSON.

## Более подробно

Этот модуль предоставляет инструменты, необходимые для безопасного взаимодействия с API mini_max.
Он содержит функции, которые имитируют логику шифрования и подготовки данных, используемую на стороне клиента.

## Функции

### `hash_function`

```python
def hash_function(base_string: str) -> str:
    """
    Функция имитирует хеш-функцию с использованием MD5.

    Args:
        base_string (str): Строка для хеширования.

    Returns:
        str: MD5 хеш строки.

    Example:
        >>> hash_function('example')
        '5f9c2a33de9bb9c1ca4187284317a6fd'
    """
    ...
```

**Назначение**: Имитирует хеш-функцию, используемую в JavaScript коде, используя алгоритм MD5.

**Параметры**:
- `base_string` (str): Строка, которую необходимо хешировать.

**Возвращает**:
- `str`: MD5 хеш переданной строки.

**Принцип работы**:
- Кодирует входную строку в байты.
- Вычисляет MD5 хеш закодированной строки.
- Возвращает полученный хеш в шестнадцатеричном формате.

**Пример использования**:
Вызов функции `hash_function` для хеширования строки:
```python
result = hash_function("test_string")
print(result)
```

### `generate_yy_header`

```python
def generate_yy_header(has_search_params_path: str, body_to_yy: dict, time: int) -> str:
    """
    Функция, эквивалентная generateYYHeader на Python.
    """
    ...
```

**Назначение**: Генерирует заголовок `yy` на основе пути с параметрами поиска, тела запроса и временной метки.

**Параметры**:
- `has_search_params_path` (str): Путь с параметрами поиска.
- `body_to_yy` (dict): Тело запроса.
- `time` (int): Временная метка.

**Возвращает**:
- `str`: Сгенерированный хеш-заголовок.

**Принцип работы**:
- Кодирует путь с параметрами поиска с использованием `urllib.parse.quote`.
- Вычисляет хеш от временной метки.
- Объединяет закодированный путь, тело запроса и хеш временной метки в одну строку.
- Вычисляет хеш от объединенной строки и возвращает его.

**Пример использования**:
Вызов функции `generate_yy_header` для генерации заголовка:
```python
path = "/v4/api/chat/msg"
body = {"key": "value"}
timestamp = 1678886400
result = generate_yy_header(path, body, timestamp)
print(result)
```

### `get_body_to_yy`

```python
def get_body_to_yy(l):
    """
    Функция для получения тела запроса для yy.
    """
    ...
```

**Назначение**: Подготавливает тело запроса для заголовка `yy`, заменяя символы новой строки и вычисляя хеши.

**Параметры**:
- `l` (dict): Словарь, содержащий данные для формирования тела запроса.

**Возвращает**:
- `str`: Сгенерированное тело запроса для `yy`.

**Принцип работы**:
- Извлекает `msgContent` из входного словаря и удаляет символы новой строки.
- Вычисляет хеши для `characterID`, `msgContent` и `chatID`.
- Объединяет полученные хеши и возвращает результат.

**Пример использования**:
Вызов функции `get_body_to_yy` для подготовки тела запроса:
```python
data = {"msgContent": "test message", "characterID": "123", "chatID": "456"}
result = get_body_to_yy(data)
print(result)
```

### `get_body_json`

```python
def get_body_json(s):
    """
    Функция для преобразования данных в JSON формат.
    """
    ...
```

**Назначение**: Преобразует переданные данные в JSON-формат с обеспечением кодировки ASCII и сортировкой ключей.

**Параметры**:
- `s` (any): Данные для преобразования в JSON.

**Возвращает**:
- `str`: JSON-представление данных.

**Принцип работы**:
- Использует `json.dumps` для преобразования входных данных в JSON-формат.
- Устанавливает `ensure_ascii=True`, чтобы гарантировать, что все символы будут представлены в ASCII.
- Устанавливает `sort_keys=True`, чтобы ключи в JSON были отсортированы.

**Пример использования**:
Вызов функции `get_body_json` для преобразования данных в JSON:
```python
data = {"key": "value"}
result = get_body_json(data)
print(result)
```

### `get_browser_callback`

```python
async def get_browser_callback(auth_result: CallbackResults):
    """
    Функция для получения callback-функции браузера.
    """
    ...
```

**Назначение**: Генерирует функцию обратного вызова для браузера, которая получает токен аутентификации и параметры запроса.

**Параметры**:
- `auth_result` (CallbackResults): Объект `CallbackResults` для хранения результатов аутентификации.

**Возвращает**:
- `callback` (function): Асинхронная функция обратного вызова.

**Принцип работы**:
- Определяет асинхронную функцию `callback`, которая будет выполняться в контексте браузера.
- Внутри `callback` происходит следующее:
  - Ожидание получения токена аутентификации из `localStorage`.
  - Получение параметров устройства и пользователя из `localStorage` и `navigator`.
  - Формирование строки запроса с параметрами и сохранение её в `auth_result`.

**Пример использования**:
Вызов функции `get_browser_callback` для получения callback-функции:
```python
auth_result = CallbackResults()
callback = await get_browser_callback(auth_result)
# Далее callback может быть использована с Playwright для взаимодействия с браузером.
```
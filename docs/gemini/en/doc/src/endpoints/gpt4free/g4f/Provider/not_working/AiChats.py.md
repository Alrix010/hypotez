# AiChats Provider

## Overview

This module implements the `AiChats` class, which provides an asynchronous generator for interacting with the AiChats.org API. It allows users to send messages to the AiChats chatbot and receive responses, including images generated by DALL-E.

## Details

The `AiChats` class extends the `AsyncGeneratorProvider` and `ProviderModelMixin` classes, inheriting their functionality. It defines a series of methods for sending messages to the AiChats API and handling the responses. 

The provider supports both text-based chat and image generation using the DALL-E model. The `models` attribute defines the supported models: `gpt-4` and `dalle`.

## Classes

### `class AiChats`

**Description**: This class provides an asynchronous generator for interacting with the AiChats.org API. It allows users to send messages to the AiChats chatbot and receive responses, including images generated by DALL-E.

**Inherits**: `AsyncGeneratorProvider`, `ProviderModelMixin`

**Attributes**:

- `url (str)`: The base URL for the AiChats.org website.
- `api_endpoint (str)`: The URL for the AiChats API endpoint.
- `working (bool)`: Indicates whether the provider is currently working.
- `supports_message_history (bool)`: Whether the provider supports message history.
- `default_model (str)`: The default model used by the provider.
- `models (list)`: A list of supported models.

**Methods**:

- `create_async_generator(model: str, messages: Messages, proxy: str = None, **kwargs) -> AsyncResult`: Creates an asynchronous generator that sends messages to the AiChats API and yields responses.
- `create_async(model: str, messages: Messages, proxy: str = None, **kwargs) -> str`: Sends a message to the AiChats API and returns the response.

#### `create_async_generator(model: str, messages: Messages, proxy: str = None, **kwargs) -> AsyncResult`

**Purpose**: This method creates an asynchronous generator that sends messages to the AiChats API and yields responses.

**Parameters**:

- `model (str)`: The model to use for the request (e.g., 'gpt-4', 'dalle').
- `messages (Messages)`: A list of messages to send to the chatbot.
- `proxy (str)`: Optional proxy server to use for the request.
- `**kwargs`: Additional keyword arguments for the request.

**Returns**:

- `AsyncResult`: An asynchronous generator that yields responses from the AiChats API.

**Raises Exceptions**:

- `Exception`: If an error occurs during the API request or response processing.

**How the Function Works**:

1. Creates a new `ClientSession` with the specified headers.
2. Prepares the message data for the request based on the selected model.
3. Sends a POST request to the API endpoint with the message data.
4. Handles the response depending on the model:
    - For DALL-E, retrieves the image URL, downloads the image, and yields a `ImageResponse` object containing the base64-encoded image data.
    - For chat models, processes the response text and yields the extracted message.

**Examples**:

```python
# Example with GPT-4 model
messages = [
    {"from": "you", "content": "Hello!"},
    {"from": "bot", "content": "Hello, how can I help you?"},
]
async for response in AiChats.create_async_generator(model="gpt-4", messages=messages):
    print(response)

# Example with DALL-E model
messages = [
    {"from": "you", "content": "A photo of a cat sitting on a chair."},
]
async for response in AiChats.create_async_generator(model="dalle", messages=messages):
    if isinstance(response, ImageResponse):
        print(f"Generated image URL: {response.images[0]}")
    else:
        print(response)
```

#### `create_async(model: str, messages: Messages, proxy: str = None, **kwargs) -> str`

**Purpose**: This method sends a message to the AiChats API and returns the response.

**Parameters**:

- `model (str)`: The model to use for the request (e.g., 'gpt-4', 'dalle').
- `messages (Messages)`: A list of messages to send to the chatbot.
- `proxy (str)`: Optional proxy server to use for the request.
- `**kwargs`: Additional keyword arguments for the request.

**Returns**:

- `str`: The response from the AiChats API.

**Raises Exceptions**:

- `Exception`: If an error occurs during the API request or response processing.

**How the Function Works**:

1. Calls the `create_async_generator` method to obtain an asynchronous generator.
2. Iterates through the generator and returns the first response.

**Examples**:

```python
# Example with GPT-4 model
response = await AiChats.create_async(model="gpt-4", messages=messages)
print(response)

# Example with DALL-E model
response = await AiChats.create_async(model="dalle", messages=messages)
print(response)
```
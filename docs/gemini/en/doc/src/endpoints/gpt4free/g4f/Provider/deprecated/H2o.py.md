# Модуль `H2o.py`

## Обзор

Модуль `H2o.py` предназначен для обеспечения взаимодействия с сервисом H2o AI для генерации текста на основе предоставленных сообщений. Он использует асинхронные запросы для обмена данными с сервером H2o AI и предоставляет результаты в виде асинхронного генератора.

## Подробнее

Модуль содержит класс `H2o`, который является асинхронным генераторным провайдером. Этот класс отвечает за форматирование запросов, отправку их на сервер H2o AI и получение ответов в виде потока текста. Модуль использует библиотеки `aiohttp` для асинхронных HTTP-запросов и `uuid` для генерации уникальных идентификаторов.

## Классы

### `H2o`

**Описание**: Класс `H2o` предоставляет интерфейс для взаимодействия с H2o AI. Он отправляет запросы на генерацию текста и возвращает результаты в виде асинхронного генератора.
**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает базовую функциональность для асинхронных генераторов.

**Атрибуты**:
- `url` (str): URL-адрес сервиса H2o AI (`"https://gpt-gm.h2o.ai"`).
- `model` (str): Используемая модель (`"h2oai/h2ogpt-gm-oasst1-en-2048-falcon-40b-v1"`).

**Принцип работы**:
1. Класс инициализируется с URL-адресом и названием модели.
2. Метод `create_async_generator` создает асинхронный генератор, который отправляет запросы к H2o AI и возвращает результаты в виде потока текста.
3. Для отправки запросов используется `aiohttp.ClientSession`.
4. Запросы включают принятие условий использования, настройку модели и создание диалога.
5. Сгенерированный текст возвращается как поток данных, разделенных по токенам.
6. После завершения генерации диалог удаляется.

## Методы класса

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для взаимодействия с H2o AI.

    Args:
        cls (H2o): Класс H2o.
        model (str): Название модели для генерации текста. Если `None`, используется значение по умолчанию из атрибута `cls.model`.
        messages (Messages): Список сообщений для отправки в H2o AI.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные параметры для передачи в H2o AI.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий сгенерированный текст.

    Raises:
        aiohttp.ClientResponseError: Если возникает ошибка при выполнении HTTP-запроса.

    Как работает функция:
    1.  Функция принимает название модели, список сообщений и, при необходимости, URL прокси-сервера и дополнительные параметры.
    2.  Если название модели не указано, используется значение по умолчанию из атрибута `cls.model`.
    3.  Создается сессия `aiohttp.ClientSession` с необходимыми заголовками.
    4.  Выполняются POST-запросы для принятия условий использования, настройки модели и создания диалога.
    5.  Затем выполняется POST-запрос для отправки сообщений и получения сгенерированного текста.
    6.  Текст возвращается как поток данных, разделенных по токенам.
    7.  После завершения генерации выполняется DELETE-запрос для удаления диалога.
    8.  В случае ошибки при выполнении HTTP-запроса выбрасывается исключение `aiohttp.ClientResponseError`.

    Пример:
        messages = [{"role": "user", "content": "Hello, H2o AI!"}]
        async for token in H2o.create_async_generator(model="h2oai/h2ogpt-gm-oasst1-en-2048-falcon-40b-v1", messages=messages):
            print(token, end="")
    """
    ...
```

## Параметры класса

- `url` (str): URL-адрес сервиса H2o AI.
- `model` (str): Используемая модель.

## Примеры

Пример использования класса `H2o` для генерации текста на основе предоставленных сообщений:

```python
messages = [{"role": "user", "content": "Расскажи мне о компании Hypotez."}]
async for token in H2o.create_async_generator(model="h2oai/h2ogpt-gm-oasst1-en-2048-falcon-40b-v1", messages=messages):
    print(token, end="")
# Module `GPTalk.py`

## Обзор

Модуль `GPTalk.py` предоставляет асинхронный генератор для взаимодействия с моделью GPT через API GPTalk. Он включает в себя аутентификацию, формирование запросов и обработку потоковых ответов.

## Подробнее

Этот модуль предназначен для использования в проекте `hypotez` для обеспечения доступа к возможностям GPT через провайдера GPTalk. Он обрабатывает аутентификацию, формирует запросы к API и обрабатывает потоковые ответы, предоставляя асинхронный генератор текста.

## Классы

### `GPTalk`

**Описание**: Класс `GPTalk` является асинхронным провайдером генератора, который взаимодействует с API GPTalk для генерации текста на основе предоставленных сообщений.
**Наследует**:
    - `AsyncGeneratorProvider`: Этот класс наследуется от `AsyncGeneratorProvider` и реализует методы для асинхронной генерации ответов.

**Атрибуты**:
    - `url` (str): URL-адрес API GPTalk.
    - `working` (bool): Флаг, указывающий, работает ли провайдер в данный момент.
    - `supports_gpt_35_turbo` (bool): Флаг, указывающий, поддерживает ли провайдер модель `gpt-3.5-turbo`.
    - `_auth` (Optional[dict]): Аутентификационные данные для доступа к API.
    - `used_times` (int): Количество использований API.

**Принцип работы**:
    - Класс использует URL-адрес `https://gptalk.net` для взаимодействия с API GPTalk.
    - Перед отправкой запросов проверяет и обновляет аутентификационные данные.
    - Формирует запросы к API с использованием предоставленных сообщений и параметров модели.
    - Обрабатывает потоковые ответы от API и генерирует текст.

## Методы класса

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """ Создает асинхронный генератор для взаимодействия с API GPTalk.

    Args:
        cls (GPTalk): Ссылка на класс.
        model (str): Имя модели для использования.
        messages (Messages): Список сообщений для отправки в API.
        proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий текст от API.

    Как работает функция:
        - Проверяет наличие модели, если она не указана, использует `gpt-3.5-turbo`.
        - Получает текущую метку времени.
        - Определяет заголовки для запроса, включая информацию о браузере и платформе.
        - Создает асинхронную сессию клиента с заданными заголовками.
        - Проверяет необходимость обновления аутентификационных данных.
        - Если аутентификация отсутствует или устарела, выполняет запрос на вход в систему.
        - Формирует данные для запроса на генерацию текста, включая содержимое сообщений, параметры модели и другие настройки.
        - Отправляет запрос на генерацию текста в API.
        - Извлекает токен из ответа.
        - Создает новый запрос для получения потоковых данных.
        - Итерируется по потоковым данным, извлекая содержимое сообщений и передавая их в генератор.
        - Завершает генерацию, когда получает сообщение `data: [DONE]`.
    """
    ...
```

## Параметры класса

- `cls`: Ссылка на класс `GPTalk`.
- `model` (str): Имя модели для использования. Если не указано, используется `gpt-3.5-turbo`.
- `messages` (Messages): Список сообщений для отправки в API.
- `proxy` (str, optional): URL прокси-сервера. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы, которые могут быть переданы в API.

## Примеры

Пример использования класса `GPTalk` для создания асинхронного генератора:

```python
messages = [
    {"role": "user", "content": "Привет, как дела?"}
]
async for message in GPTalk.create_async_generator(model="gpt-3.5-turbo", messages=messages):
    print(message)
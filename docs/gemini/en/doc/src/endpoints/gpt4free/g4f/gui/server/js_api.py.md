# Документация для `js_api.py`

## Обзор

Файл `js_api.py` является частью проекта `hypotez` и содержит класс `JsApi`, который расширяет класс `Api`. Этот файл предоставляет API для взаимодействия с веб-интерфейсом, включая получение ответов, выбор изображений, работу с камерой и установку выбранных элементов.

## Подробности

В этом файле реализован класс `JsApi`, который наследуется от класса `Api`. Он предназначен для обработки запросов от JavaScript-клиента и выполнения соответствующих действий, таких как получение сообщений, выбор изображений и управление камерой.

## Классы

### `JsApi`

**Описание**: Класс `JsApi` расширяет класс `Api` и предоставляет API для взаимодействия с веб-интерфейсом.

**Наследует**:
- `Api`: Описывает базовый API.

**Атрибуты**:
- Нет специфических атрибутов, кроме наследованных от `Api`.

**Методы**:
- `get_conversation(options: dict, message_id: str = None, scroll: bool = None) -> Iterator`: Получает разговор.
- `choose_image()`: Открывает диалоговое окно выбора изображения.
- `take_picture()`: Делает снимок с камеры.
- `on_image_selection(filename)`: Обрабатывает выбор изображения пользователем.
- `on_camera(filename)`: Обрабатывает снимок, сделанный камерой.
- `set_selected(input_id: str = None)`: Устанавливает выбранный элемент в интерфейсе.
- `get_version()`: Возвращает версию API.
- `get_models()`: Возвращает список доступных моделей.
- `get_providers()`: Возвращает список доступных провайдеров.
- `get_provider_models(provider: str, **kwargs)`: Возвращает список моделей для указанного провайдера.

#### `get_conversation`

```python
def get_conversation(self, options: dict, message_id: str = None, scroll: bool = None) -> Iterator:
    """
    Функция получает разговор, отправляя чанки сообщений в веб-интерфейс.

    Args:
        options (dict): Параметры для создания ответа.
        message_id (str, optional): Идентификатор сообщения. По умолчанию `None`.
        scroll (bool, optional): Нужно ли прокручивать окно. По умолчанию `None`.

    Returns:
        Iterator: Итератор по сообщениям.
    """
```

**Как работает функция**:
- Функция `get_conversation` получает параметры разговора из аргумента `options`. Если у экземпляра класса есть атрибут `image`, он открывается в бинарном режиме и добавляется в `options`.
- Затем вызывается функция `_create_response_stream` для получения сообщений.
- Для каждого сообщения вызывается JavaScript-функция `add_message_chunk` для добавления чанка сообщения в веб-интерфейс.
- Если `is_stopped()` возвращает `true`, цикл прерывается.

#### `choose_image`

```python
def choose_image(self):
    """
    Функция открывает диалоговое окно выбора изображения.
    """
```

**Как работает функция**:
- Функция `choose_image` вызывает функцию `user_select_image`, которая открывает диалоговое окно для выбора файла изображения. После выбора изображения вызывается функция `on_image_selection`.

#### `take_picture`

```python
def take_picture(self):
    """
    Функция делает снимок с камеры.
    """
```

**Как работает функция**:
- Функция `take_picture` создает имя файла для снимка и вызывает функцию `camera.take_picture` для захвата изображения с камеры. После завершения вызывается функция `on_camera`.

#### `on_image_selection`

```python
def on_image_selection(self, filename):
    """
    Функция обрабатывает выбор изображения пользователем.

    Args:
        filename: Имя выбранного файла.
    """
```

**Как работает функция**:
- Функция `on_image_selection` получает имя файла, выбранного пользователем. Если файл существует, он устанавливается в качестве атрибута `image` экземпляра класса. Затем вызывается функция `set_selected` для обновления выбранного элемента в интерфейсе.

#### `on_camera`

```python
def on_camera(self, filename):
    """
    Функция обрабатывает снимок, сделанный камерой.

    Args:
        filename: Имя файла снимка.
    """
```

**Как работает функция**:
- Функция `on_camera` получает имя файла, созданного камерой. Если файл существует, он устанавливается в качестве атрибута `image` экземпляра класса. Затем вызывается функция `set_selected` для обновления выбранного элемента в интерфейсе.

#### `set_selected`

```python
def set_selected(self, input_id: str = None):
    """
    Функция устанавливает выбранный элемент в интерфейсе.

    Args:
        input_id (str, optional): Идентификатор выбранного элемента. По умолчанию `None`.
    """
```

**Как работает функция**:
- Функция `set_selected` удаляет класс `selected` у всех элементов с классом `image-label.selected`. Если `input_id` имеет значение "image" или "camera", добавляет класс `selected` к соответствующему элементу `label` в интерфейсе.

#### `get_version`

```python
def get_version(self):
    """
    Функция возвращает версию API.
    """
```

**Как работает функция**:
- Функция `get_version` вызывает метод `get_version` родительского класса `Api` и возвращает его результат.

#### `get_models`

```python
def get_models(self):
    """
    Функция возвращает список доступных моделей.
    """
```

**Как работает функция**:
- Функция `get_models` вызывает метод `get_models` родительского класса `Api` и возвращает его результат.

#### `get_providers`

```python
def get_providers(self):
    """
    Функция возвращает список доступных провайдеров.
    """
```

**Как работает функция**:
- Функция `get_providers` вызывает метод `get_providers` родительского класса `Api` и возвращает его результат.

#### `get_provider_models`

```python
def get_provider_models(self, provider: str, **kwargs):
    """
    Функция возвращает список моделей для указанного провайдера.

    Args:
        provider (str): Имя провайдера.
        **kwargs: Дополнительные аргументы.
    """
```

**Как работает функция**:
- Функция `get_provider_models` вызывает метод `get_provider_models` родительского класса `Api` с переданными аргументами и возвращает его результат.

## Примеры

Примеры использования методов класса `JsApi` можно увидеть в коде веб-интерфейса, где вызываются эти методы для выполнения различных действий, таких как получение сообщений, выбор изображений и управление камерой.
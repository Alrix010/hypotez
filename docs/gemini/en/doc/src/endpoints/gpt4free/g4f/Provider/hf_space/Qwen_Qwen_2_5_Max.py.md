# Модуль `Qwen_Qwen_2_5_Max`

## Обзор

Модуль `Qwen_Qwen_2_5_Max` предоставляет асинхронный генератор для взаимодействия с моделью Qwen Qwen-2.5-Max через API. Он поддерживает потоковую передачу данных и системные сообщения, а также предоставляет средства для форматирования запросов.

## Подробнее

Этот модуль предназначен для интеграции с API Qwen Qwen-2.5-Max, размещенным на платформе Hugging Face Space. Он использует асинхронные запросы для получения ответов от модели и поддерживает как потоковую передачу данных, так и передачу системных сообщений. Модуль включает в себя функции для генерации уникальных идентификаторов сессий и форматирования запросов для API.

## Классы

### `Qwen_Qwen_2_5_Max`

**Описание**: Класс предоставляет функциональность асинхронного генератора для взаимодействия с моделью Qwen Qwen-2.5-Max.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает базовую функциональность для асинхронных генераторов.
- `ProviderModelMixin`: Предоставляет общие методы для работы с моделями провайдеров.

**Атрибуты**:
- `label` (str): Метка провайдера, `"Qwen Qwen-2.5-Max"`.
- `url` (str): URL API, `"https://qwen-qwen2-5-max-demo.hf.space"`.
- `api_endpoint` (str): URL конечной точки API для присоединения к очереди, `"https://qwen-qwen2-5-max-demo.hf.space/gradio_api/queue/join?"`.
- `working` (bool): Указывает, работает ли провайдер, `True`.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу, `True`.
- `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения, `True`.
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений, `False`.
- `default_model` (str): Модель по умолчанию, `"qwen-qwen2-5-max"`.
- `model_aliases` (dict): Псевдонимы моделей, `{"qwen-2-5-max": default_model}`.
- `models` (list): Список поддерживаемых моделей, полученный из ключей `model_aliases`.

**Принцип работы**:
Класс использует асинхронные HTTP-запросы для взаимодействия с API Qwen Qwen-2.5-Max. Он генерирует уникальные идентификаторы сессий для каждого запроса и форматирует сообщения в соответствии с требованиями API. Поддерживается потоковая передача данных, что позволяет получать ответы от модели по частям.

## Методы класса

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для взаимодействия с моделью Qwen Qwen-2.5-Max.

    Args:
        cls (Qwen_Qwen_2_5_Max): Класс, для которого создается генератор.
        model (str): Название модели.
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий ответы от модели.

    Как работает функция:
    - Генерирует уникальный идентификатор сессии (`session_hash`).
    - Формирует заголовки (`headers_join`) и полезную нагрузку (`payload_join`) для отправки запроса на присоединение к очереди.
    - Отправляет POST-запрос к `api_endpoint` для присоединения к очереди и получает `event_id`.
    - Формирует заголовки (`headers_data`) и параметры (`params_data`) для запроса потока данных.
    - Отправляет GET-запрос к `url_data` для получения потока данных и обрабатывает каждый фрагмент ответа.
    - Извлекает и обрабатывает данные JSON из каждого фрагмента, ища этапы генерации (`process_generating`) и завершения (`process_completed`).
    - Выдает фрагменты сгенерированного текста по мере их поступления.
    - Очищает и выдает оставшуюся часть ответа после завершения генерации.

    Внутренние функции:
        - `generate_session_hash()`: генерирует уникальный session_hash для каждого запроса.

    Примеры:
        Пример вызова функции:
        ```python
        model = "qwen-2-5-max"
        messages = [{"role": "system", "content": "You are a helpful assistant."}, {"role": "user", "content": "Hello!"}]
        generator = await Qwen_Qwen_2_5_Max.create_async_generator(model=model, messages=messages)
        async for fragment in generator:
            print(fragment)
        ```
    """

```

### `generate_session_hash` (внутренняя функция)

```python
def generate_session_hash():
    """Generate a unique session hash."""
    return str(uuid.uuid4()).replace('-', '')[:8] + str(uuid.uuid4()).replace('-', '')[:4]
```

## Параметры класса

- `label` (str): Метка провайдера.
- `url` (str): URL API.
- `api_endpoint` (str): URL конечной точки API для присоединения к очереди.
- `working` (bool): Указывает, работает ли провайдер.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу.
- `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения.
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений.
- `default_model` (str): Модель по умолчанию.
- `model_aliases` (dict): Псевдонимы моделей.
- `models` (list): Список поддерживаемых моделей.
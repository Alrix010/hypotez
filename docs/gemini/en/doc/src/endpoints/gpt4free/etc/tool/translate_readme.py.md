# Модуль translate_readme.py

## Обзор

Модуль предназначен для перевода документов Markdown на указанный язык. В частности, он переводит файл `README.md` на немецкий язык и сохраняет результат в файле `README-GE.md`. Он использует библиотеку `g4f` для взаимодействия с языковой моделью, в данном случае `OpenaiChat`.

## Более подробная информация

Модуль разбивает исходный файл `README.md` на части, переводит каждую часть, а затем объединяет переведенные части обратно в один документ. При переводе учитываются определенные блоки, которые не нужно переводить, и обеспечивается сохранение форматирования кода.

## Функции

### `read_text`

```python
def read_text(text):
    """ Функция извлекает текстовое содержимое из блока Markdown, исключая строки, содержащие символы форматирования кода.

    Args:
        text (str): Текст для извлечения.

    Returns:
        str: Извлеченный текст, очищенный от символов форматирования кода.

    Принцип работы:
    Функция разбивает входной текст на строки и ищет блоки кода, ограниченные символами ```. Она возвращает текст, находящийся между этими блоками, тем самым исключая примеры кода из перевода.
    """
```

### `translate`

```python
async def translate(text):
    """ Функция выполняет асинхронный перевод заданного текста с использованием указанного провайдера.

    Args:
        text (str): Текст для перевода.

    Returns:
        str: Переведенный текст.

    Принцип работы:
    Функция добавляет к входному тексту префикс с инструкцией по переводу на немецкий язык. Затем она использует асинхронный метод `create_async` провайдера `OpenaiChat` для выполнения перевода. Если в тексте встречается "[!Note]", к запросу добавляется инструкция по его сохранению. Функция также проверяет и добавляет закрывающие символы ```, если они отсутствуют в результате.
    """
```

### `translate_part`

```python
async def translate_part(part, i):
    """ Функция асинхронно переводит часть текста, исключая определенные блоки из перевода.

    Args:
        part (str): Часть текста для перевода.
        i (int): Индекс части текста.

    Returns:
        str: Переведенная часть текста.

    Принцип работы:
    Функция проверяет, входит ли часть текста в список `blocklist`. Если это так, переводится только первая строка (заголовок), а затем переводится содержимое из `allowlist`. Если часть текста не входит в `blocklist`, она переводится целиком.
    """
```

### `translate_readme`

```python
async def translate_readme(readme) -> str:
    """ Функция переводит содержимое файла README.md, разделяя его на части.

    Args:
        readme (str): Содержимое файла README.md.

    Returns:
        str: Полностью переведенное содержимое файла README.md.

    Принцип работы:
    Функция разбивает README на части, используя разделитель '## '. Затем она асинхронно переводит каждую часть с помощью функции `translate_part` и объединяет переведенные части обратно в один документ.
    """
```

## Переменные

-   `iso` (str): Код страны ("GE" для Германии).
-   `language` (str): Язык перевода ("german").
-   `translate_prompt` (str): Строка, содержащая инструкцию для модели перевода.
-   `keep_note` (str): Строка, содержащая инструкцию по сохранению блоков "[!Note]".
-   `blocklist` (list): Список строк, которые не нужно переводить.
-   `allowlist` (list): Список строк, которые нужно переводить даже в заблокированных частях.

## Как работает функция

1.  Чтение содержимого `README.md`.
2.  Разделение содержимого на части по заголовкам второго уровня (`##`).
3.  Асинхронный перевод каждой части с использованием `translate_part`, который проверяет наличие части в `blocklist` и соответствующим образом переводит текст.
4.  Объединение переведенных частей обратно в один документ.
5.  Запись переведенного содержимого в файл `README-{iso}.md`.

## Примеры

```python
import asyncio
from translate_readme import translate_readme

async def main():
    with open("README.md", "r") as fp:
        readme = fp.read()

    translated_readme = await translate_readme(readme)

    with open("README-GE.md", "w") as fp:
        fp.write(translated_readme)

if __name__ == "__main__":
    asyncio.run(main())
```
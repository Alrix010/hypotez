# Модуль `gemini_simplechat`

## Обзор

Модуль `gemini_simplechat` предоставляет простой интерфейс для взаимодействия с моделью Google Gemini, используя библиотеку `fastapi`. Он обеспечивает возможность отправки текстовых запросов к модели Gemini и получения ответов. 

## Детали

Данный модуль реализует веб-сервис с использованием `fastapi`, который позволяет отправлять текстовые запросы к модели Google Gemini и получать ответы.

## Классы

### `Config`

**Описание**:  Класс `Config` хранит конфигурационные параметры для работы с сервером и моделью Gemini.

**Атрибуты**:

- `ENDPOINT` (Path): Путь к директории с конфигурационным файлом.
- `config` (SimpleNamespace):  Объект `SimpleNamespace`, содержащий данные, загруженные из конфигурационного файла.
- `HOST` (str): Хост, на котором запускается сервер.
- `PORTS_RANGE` (list[int]): Диапазон портов для поиска свободного порта.
- `GEMINI_API_KEY` (str): API-ключ для доступа к модели Gemini.
- `GEMINI_MODEL_NAME` (str):  Имя модели Google Gemini.
- `system_instruction_path` (Path):  Путь к файлу с системными инструкциями для модели.
- `SYSTEM_INSTRUCTION` (str):  Содержимое файла с системными инструкциями.

**Принцип работы**:

Класс инициализирует свои атрибуты, запрашивая данные из конфигурационного файла `gemini_simplechat.json` и из модуля `gs`. В случае ошибки загрузки конфигурации регистрируется ошибка в логге.

### `ChatRequest`

**Описание**: Класс `ChatRequest` моделирует данные запроса к модели Gemini.

**Атрибуты**:

- `message` (str): Текстовый запрос к модели Gemini.

**Принцип работы**:

Класс предоставляет структуру для приема текстового запроса от пользователя, который будет отправлен к модели Gemini.

## Функции

### `root()`

**Цель**:  Функция, отвечающая за маршрут `/`  (корневой маршрут) сервера. 

**Параметры**: None

**Возвращает**: HTMLResponse: Возвращает HTML-страницу с контентом из файла `index.html`.

**Возвращает исключения**: HTTPException: Возвращает ошибку 500, если произошла ошибка при чтении шаблона.

**Как работает**:

Функция `root()` читает HTML-код из файла `index.html` и возвращает его в формате `HTMLResponse`.

### `chat()`

**Цель**:  Функция, отвечающая за маршрут `/api/chat`  и обработку запросов к модели Gemini.

**Параметры**:

- `request` (ChatRequest):  Объект запроса, содержащий текстовый запрос к модели Gemini.

**Возвращает**: dict:  Возвращает словарь с ответом модели Gemini.

**Возвращает исключения**:  HTTPException: Возвращает ошибку 500, если произошла ошибка при взаимодействии с моделью Gemini.

**Как работает**:

Функция `chat()` получает текстовый запрос из объекта `request`, использует глобальный объект `model`  (GoogleGenerativeAi) для вызова метода `chat` и возвращает полученный ответ модели Gemini.

## Внутренние функции

Нет.

## Примеры

```python
# Запуск сервера:
uvicorn.run(app, host = Config.HOST, port = port)

# Отправка запроса к модели Gemini через веб-сервис:
# POST /api/chat 
# Body: {"message": "Привет, как дела?"} 
# Ответ: {"response": "Привет! У меня все хорошо."}

# Доступ к корневому маршруту:
# GET /
# Ответ: HTML-страница из файла index.html
```

## Примечания

- Модуль `gemini_simplechat`  использует `uvicorn` для запуска веб-сервера.
- Модель Google Gemini инициализируется с использованием класса `GoogleGenerativeAi`, который импортируется из модуля `src.llm.gemini`.
- Для обработки JSON-файлов используется функция `j_loads_ns` из модуля `src.utils.jjson`.
- Для работы с логгированием используется модуль `logger`  из `src.logger`.
- Данный модуль использует `fastapi` для создания веб-сервиса, что позволяет обрабатывать запросы от клиентов через HTTP.
- Код использует `Driver` из `src.webdriver`

## Дополнительная информация

- **Логгирование**: Для записи ошибок и событий используется `logger` из `src.logger`.
- **CORS**:  Настроен для разрешения кросс-доменных запросов.
- **Конфигурационные параметры**: Загружаются из файла `gemini_simplechat.json`.

## Ссылки

- [Документация fastapi](https://fastapi.tiangolo.com/)
- [Документация Google Gemini](https://cloud.google.com/generative-ai)
- [Документация uvicorn](https://www.uvicorn.org/)
# Модуль для проверки исполнения сценариев HB
## Обзор
Модуль `src/suppliers/hb/_experiments/ide_experiments_grabber.py` предназначен для проверки исполнения сценариев для поставщика HB. 
Он включает в себя набор функций и классов, которые позволяют:

- Получить заполненный словарь `product_fields` с атрибутами товара.
- Отправить этот словарь на сервер.
- Выполнить сценарии (описанные в файлах сценариев) на сайте поставщика.
- Собрать информацию с страницы товара, а также связаные с товаром товары (cross-selling, up-selling)
## Детали
Модуль `src/suppliers/hb/_experiments/ide_experiments_grabber.py` является частью проекта `hypotez`, который отвечает за автоматизацию сбора информации о товарах с сайтов поставщиков. 
Этот конкретный модуль фокусируется на проверке и оптимизации сценариев для поставщика HB. 
Сценарии представляют собой набор действий, которые необходимо выполнить на сайте поставщика для получения информации о товаре. 
Модуль `src/suppliers/hb/_experiments/ide_experiments_grabber.py` обеспечивает работу со сценариями и обработку полученной информации.
## Классы
### `Supplier`
**Описание**: Класс `Supplier`  представляет поставщика HB и содержит информацию о его сайте, локаторах элементов сайта, настройках водителя (webdriver) и  сценариях.
**Атрибуты**:
- `supplier_prefix` (str): Префикс, используемый для идентификации поставщика (например, 'hb').
- `locators` (dict): Словарь локаторов элементов сайта, определенный в файле `src/suppliers/hb/locators.py`.
- `driver` (Driver): Объект `Driver` для взаимодействия с браузером.
- `current_scenario` (dict): Текущий сценарий, который выполняется.
- `product_fields` (dict): Словарь атрибутов товара.
- `related_modules` (dict): Словарь модулей, которые могут быть использованы в сценариях. 
**Методы**:
- `get_url(url: str) -> None`: Метод для открытия URL-адреса в браузере.
- `grab_product_page(self) -> Dict`: Метод для сбора информации о товаре с страницы товара. 
- `execute_locator(l: Dict) -> Union[WebElement, str, None]`: Метод для выполнения локатора (например, клик по кнопке или получение текста элемента).
- `run_scenarios(s: Supplier, scenario: Dict) -> Dict`: Метод для запуска сценариев на сайте.


### `Product`
**Описание**: Класс `Product` представляет товар и содержит информацию о его атрибутах.
**Атрибуты**:
- `supplier` (Supplier): Объект `Supplier`, к которому принадлежит товар.
- `product_fields` (ProductFields): Объект `ProductFields`, содержащий  атрибуты товара.
**Методы**:
- `update_product_fields(self, fields: Dict) -> None`: Метод для обновления атрибутов товара.
- `get_product_fields(self) -> Dict`: Метод для получения словаря атрибутов товара.

### `ProductFields`
**Описание**: Класс `ProductFields`  представляет словарь атрибутов товара и  предоставляет методы для работы с атрибутами.
**Атрибуты**:
- `supplier` (Supplier): Объект `Supplier`, к которому принадлежит товар.
- `product_fields` (dict): Словарь атрибутов товара.
**Методы**:
- `get_product_fields(self) -> Dict`: Метод для получения словаря атрибутов товара.
- `update_product_fields(self, fields: Dict) -> None`: Метод для обновления атрибутов товара.
- `get_field_value(self, field: str) -> Union[str, int, float, None]`: Метод для получения значения атрибута.
- `set_field_value(self, field: str, value: Union[str, int, float]) -> None`: Метод для установки значения атрибута.

## Функции
### `run_scenarios`
**Описание**: Функция `run_scenarios` запускает сценарии на сайте поставщика. 
**Параметры**:
- `s` (Supplier): Объект `Supplier`.
- `scenario` (Dict): Текущий сценарий.
**Возвращаемое значение**:
- `Dict`: Возвращает словарь с результатами выполнения сценариев.
**Пример**:
```python
# Инициализация объекта Supplier
s: Supplier = Supplier(supplier_prefix='hb')

# Задание текущего сценария
s.current_scenario: Dict = {
    "url": "https://hbdeadsea.co.il/product-category/bodyspa/feet-hand-treatment/",
    "name": "טיפוח כפות ידיים ורגליים",
    "condition": "new",
    "presta_categories": {
        "default_category": 11259,
        "additional_categories": []
    }
}

# Запуск сценариев
ret = run_scenarios(s, s.current_scenario)
```
**Как работает функция**: 
- Функция `run_scenarios` принимает два аргумента: объект `Supplier` и словарь `scenario`.
- Функция  инициализирует драйвер браузера, переходит на указанный URL-адрес в `scenario` и запускает сценарии в `scenario`.
- Для каждого сценария выполняется последовательность действий, указанных в  `scenario`. 
- Для получения информации об элементах сайта используется метод `execute_locator()`, который ищет элемент на странице, используя локторы, описанные в `locators`.
- Функция `run_scenarios`  возвращает словарь, содержащий результаты выполнения каждого сценария.
## Параметры
- `s` (Supplier): Объект `Supplier`  содержит  информацию о  поставщике, локаторы,  сценарии и  методы работы с ними.
- `scenario` (Dict): Текущий сценарий,  который  выполняется.
- `l` (Dict): Локатор,  который  используется  для  поиска  элемента  на  странице. 
- `url` (str): URL-адрес,  на  который  переходит  драйвер  браузера.
- `fields` (Dict): Словарь атрибутов товара,  который  используется  для  обновления  информации  о  товаре.
- `field` (str):  Имя  атрибута  товара. 
- `value` (Union[str, int, float]):  Значение  атрибута  товара.
## Примеры
- **Пример создания объекта `Supplier`**
```python
s: Supplier = Supplier(supplier_prefix='hb')
```
- **Пример запуска сценариев**
```python
# Задание текущего сценария
s.current_scenario: Dict = {
    "url": "https://hbdeadsea.co.il/product-category/bodyspa/feet-hand-treatment/",
    "name": "טיפוח כפות ידיים ורגליים",
    "condition": "new",
    "presta_categories": {
        "default_category": 11259,
        "additional_categories": []
    }
}
# Запуск сценариев
ret = run_scenarios(s, s.current_scenario)
```
- **Пример получения информации о товаре**
```python
s.related_modules.grab_product_page(s)
```
## Дополнительная информация
-  Модуль использует  `driver.execute_locator(l:dict)` для  взаимодействия  с  элементами  сайта  по  локаторам.
-  Локаторы  хранятся  в  файле  `src/suppliers/hb/locators.py`.
-  Сценарии  определены  в  файлах  сценариев.
-  Модуль  использует  `logger`  для  логгирования  информации  и  ошибок. 
-  Модуль  использует  `ProductFields`  для  работы  с  атрибутами  товара.
-  `ProductFields`  предоставляет  методы  для  получения,  установки  и  обновления  значений  атрибутов  товара.
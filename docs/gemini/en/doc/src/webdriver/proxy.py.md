# Модуль для работы с прокси

## Обзор

Модуль `proxy.py` предназначен для работы с прокси-серверами. Он включает в себя функции для загрузки списка прокси из текстового файла, проверки работоспособности прокси и распределения прокси по категориям.

## Подробности

Модуль `proxy.py` использует внешние ресурсы для получения списка прокси. Он загружает текстовый файл с прокси-адресами с веб-сайта `https://raw.githubusercontent.com/proxifly/free-proxy-list/main/proxies/all/data.txt` и сохраняет его в файл `proxies.txt` в каталоге `src/webdriver`. Далее, этот файл анализируется и прокси распределяются по типам: `http`, `socks4` и `socks5`.

## Классы

### `class Driver`

**Описание**: Класс `Driver` используется для работы с веб-драйверами, такими как Chrome, Firefox и Playwright. 

**Наследует**: 
  - `None`

**Атрибуты**:
  - `browser_type`: Тип браузера, который будет использоваться. 

**Методы**:
  - `execute_locator(l:dict)`: Выполняет поиск по локатору и возвращает значение найденного веб-элемента.

## Функции

### `download_proxies_list(url: str = url, save_path: Path = proxies_list_path) -> bool`

**Описание**: Функция загружает файл с прокси-адресами по указанному URL и сохраняет его в заданный путь. 

**Параметры**:
  - `url`: URL файла для загрузки.
  - `save_path`: Путь для сохранения загруженного файла. 

**Возвращает**:
  - `bool`: `True`, если загрузка была успешной, иначе `False`.

**Исключения**:
  - `Exception`: Если возникает ошибка при загрузке файла.

**Как работает функция**:
  - Функция отправляет запрос к заданному URL, чтобы получить текстовый файл с прокси-адресами. 
  - Затем она сохраняет полученный файл в указанный путь, используя поток для чтения и записи данных.

**Пример**:

```python
>>> from src.webdriver.proxy import download_proxies_list
>>> download_proxies_list()
```

### `get_proxies_dict(file_path: Path = proxies_list_path) -> Dict[str, List[Dict[str, Any]]]`

**Описание**: Функция парсит файл с прокси-адресами и распределяет их по категориям. 

**Параметры**:
  - `file_path`: Путь к файлу с прокси.

**Возвращает**:
  - `Dict[str, List[Dict[str, Any]]]`: Словарь, где ключи - это типы прокси (`http`, `socks4`, `socks5`), а значения - списки словарей с информацией о каждом прокси.

**Исключения**:
  - `FileNotFoundError`: Если файл не найден.
  - `Exception`: Если возникает ошибка при парсинге файла.

**Как работает функция**:
  - Функция открывает файл с прокси-адресами и читает его построчно. 
  - Для каждой строки она использует регулярное выражение, чтобы извлечь информацию о типе прокси (`http`, `socks4`, `socks5`), хосте и порте. 
  - Затем она создает словарь, где ключ - это тип прокси, а значение - список словарей с информацией о каждом прокси этого типа.

**Пример**:

```python
>>> from src.webdriver.proxy import get_proxies_dict
>>> proxies = get_proxies_dict()
>>> proxies['http']
[{'protocol': 'http', 'host': '123.123.123.123', 'port': '8080'}, ...]
```

### `check_proxy(proxy: dict) -> bool`

**Описание**: Функция проверяет работоспособность прокси-сервера. 

**Параметры**:
  - `proxy`: Словарь с данными прокси (хост, порт, тип).

**Возвращает**:
  - `bool`: `True`, если прокси работает, иначе `False`.

**Исключения**:
  - `ProxyError`: Если возникает ошибка при подключении к прокси-серверу.
  - `RequestException`: Если возникает ошибка при отправке HTTP-запроса через прокси.

**Как работает функция**:
  - Функция отправляет HTTP-запрос к веб-сайту `https://httpbin.org/ip` через заданный прокси.
  - Она проверяет код ответа сервера. Если код ответа равен 200, то прокси работает, иначе прокси не работает.

**Пример**:

```python
>>> from src.webdriver.proxy import check_proxy
>>> proxy = {'protocol': 'http', 'host': '123.123.123.123', 'port': '8080'}
>>> check_proxy(proxy)
```

## Примеры

```python
# Загрузка и парсинг списка прокси
if download_proxies_list():
    parsed_proxies = get_proxies_dict()
    logger.info(f'Обработано {sum(len(v) for v in parsed_proxies.values())} прокси.')

# Проверка работоспособности прокси
proxy = {'protocol': 'http', 'host': '123.123.123.123', 'port': '8080'}
if check_proxy(proxy):
    logger.info(f"Прокси {proxy['host']}:{proxy['port']} работает.")
```
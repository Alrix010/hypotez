# Модуль для работы с прокси

## Обзор

Модуль определяет функции для загрузки, парсинга и проверки списка прокси-серверов. Он загружает текстовый файл, содержащий список прокси-адресов, и распределяет их по категориям (HTTP, SOCKS4, SOCKS5).

## Подробнее

Этот модуль предоставляет функциональность для автоматической загрузки и обработки списка прокси-серверов, что может быть полезно для задач, требующих анонимности или обхода географических ограничений.

## Классы

В данном модуле классы отсутствуют.

## Функции

### `download_proxies_list`

```python
def download_proxies_list(url: str = url, save_path: Path = proxies_list_path) -> bool:
    """
    Загружает файл по указанному URL и сохраняет его в заданный путь.

    Args:
        url (str): URL файла для загрузки. По умолчанию используется глобальная переменная `url`.
        save_path (Path): Путь для сохранения загруженного файла. По умолчанию используется глобальная переменная `proxies_list_path`.

    Returns:
        bool: `True` в случае успешной загрузки и сохранения файла, `False` в случае ошибки.
    """
    ...
```

**Назначение**: Загружает файл со списком прокси-серверов по указанному URL-адресу и сохраняет его в локальный файл.

**Параметры**:
- `url` (str): URL-адрес, по которому расположен файл со списком прокси. По умолчанию используется значение глобальной переменной `url`.
- `save_path` (Path): Путь к файлу, в который будет сохранен загруженный список прокси. По умолчанию используется значение глобальной переменной `proxies_list_path`.

**Возвращает**:
- `bool`: Возвращает `True`, если файл успешно загружен и сохранен, и `False` в случае возникновения ошибки.

**Как работает**:
- Функция отправляет HTTP-запрос к указанному `url` для загрузки файла.
- В случае успешного ответа (status code 200), содержимое файла сохраняется по указанному пути `save_path`.
- В случае возникновения HTTP-ошибок или других исключений, функция логирует ошибку и возвращает `False`.

**Примеры**:
```python
from pathlib import Path
# Пример использования с параметрами по умолчанию
result = download_proxies_list()
print(f"Результат загрузки: {result}")

# Пример использования с указанием URL и пути сохранения
custom_url = "https://example.com/proxies.txt"
custom_path = Path("/tmp/proxies.txt")
result = download_proxies_list(url=custom_url, save_path=custom_path)
print(f"Результат загрузки: {result}")
```

### `get_proxies_dict`

```python
def get_proxies_dict(file_path: Path = proxies_list_path) -> Dict[str, List[Dict[str, Any]]]:
    """
    Парсит файл с прокси-адресами и распределяет их по категориям.

    Args:
        file_path (Path): Путь к файлу с прокси. По умолчанию используется `proxies_list_path`.

    Returns:
        Dict[str, List[Dict[str, Any]]]: Словарь, где ключи - типы прокси ('http', 'socks4', 'socks5'),
        а значения - списки словарей с информацией о каждом прокси (protocol, host, port).
    """
    ...
```

**Назначение**: Читает файл со списком прокси-серверов и анализирует его содержимое, разделяя прокси по типам (http, socks4, socks5) и сохраняя информацию о каждом прокси в виде словаря.

**Параметры**:
- `file_path` (Path): Путь к файлу со списком прокси-серверов. По умолчанию используется значение глобальной переменной `proxies_list_path`.

**Возвращает**:
- `Dict[str, List[Dict[str, Any]]]`: Словарь, где ключами являются типы прокси-серверов (http, socks4, socks5), а значениями - списки словарей. Каждый словарь в списке содержит информацию о прокси-сервере, такую как протокол, хост и порт.

**Как работает**:
- Сначала вызывает функцию `download_proxies_list()` для загрузки актуального списка прокси-серверов.
- Открывает файл, указанный в `file_path`, и построчно читает его содержимое.
- Использует регулярное выражение для извлечения информации о протоколе, хосте и порте из каждой строки.
- Распределяет прокси-серверы по типам (http, socks4, socks5) и сохраняет информацию о них в словаре.
- В случае возникновения ошибок, таких как отсутствие файла или ошибки при парсинге, функция логирует ошибку.

**Примеры**:
```python
from pathlib import Path

# Пример использования с параметром по умолчанию
proxies = get_proxies_dict()
print(f"Список прокси: {proxies}")

# Пример использования с указанием пути к файлу
custom_path = Path("/tmp/proxies.txt")
proxies = get_proxies_dict(file_path=custom_path)
print(f"Список прокси: {proxies}")
```

### `check_proxy`

```python
def check_proxy(proxy: dict) -> bool:
    """
    Проверяет работоспособность прокси-сервера.
    
    Args:
        proxy (dict): Словарь с данными прокси (host, port, protocol).
    Returns:
        bool: True, если прокси работает, иначе False.
    """
    ...
```

**Назначение**: Проверяет работоспособность прокси-сервера, отправляя HTTP-запрос через указанный прокси и анализируя ответ.

**Параметры**:
- `proxy` (dict): Словарь, содержащий информацию о прокси-сервере, такую как хост, порт и протокол.

**Возвращает**:
- `bool`: Возвращает `True`, если прокси-сервер успешно обработал запрос, и `False` в противном случае.

**Как работает**:
- Функция пытается установить соединение с `https://httpbin.org/ip` через указанный прокси-сервер.
- Если прокси-сервер отвечает с кодом 200, функция считает, что прокси-сервер работает, и возвращает `True`.
- Если возникает ошибка подключения или прокси-сервер возвращает другой код ответа, функция логирует ошибку и возвращает `False`.

**Примеры**:
```python
# Пример использования
proxy_data = {'protocol': 'http', 'host': '127.0.0.1', 'port': '8080'}
is_working = check_proxy(proxy_data)
print(f"Прокси работает: {is_working}")
```

## Переменные

- `url` (str): URL-адрес для загрузки списка прокси-серверов.
- `proxies_list_path` (Path): Путь к файлу, в котором будет сохранен список прокси-серверов.
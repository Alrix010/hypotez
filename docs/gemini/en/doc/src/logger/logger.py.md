# Модуль логгера

## Обзор

Модуль `src.logger.logger` предоставляет класс `Logger` для логирования сообщений в консоль, файлы и в формате JSON. Он использует паттерн Singleton для обеспечения единственного экземпляра логгера в приложении. Модуль также поддерживает цветовое оформление сообщений в консоли.

## Более детально

Этот модуль предоставляет централизованный механизм логирования для всего проекта `hypotez`. Логи могут быть записаны в файлы различных уровней (info, debug, errors) и в JSON-файл для дальнейшего анализа. Класс `Logger` использует паттерн Singleton, что гарантирует наличие только одного экземпляра логгера во всем приложении. Цветовое оформление консольных сообщений облегчает восприятие и разделение различных уровней логирования.

## Классы

### `SingletonMeta`

**Описание**: Метакласс для реализации паттерна Singleton.

**Наследует**:

**Атрибуты**:

- `_instances` (dict): Словарь для хранения экземпляров классов-синглтонов.
- `_lock` (threading.Lock): Блокировка для обеспечения потокобезопасности при создании экземпляров.

**Принцип работы**:
Метакласс `SingletonMeta` гарантирует, что у класса будет только один экземпляр. Это достигается за счет использования словаря `_instances`, в котором хранятся созданные экземпляры, и блокировки `_lock`, чтобы избежать проблем с многопоточностью при создании экземпляров.

### `JsonFormatter`

**Описание**: Пользовательский форматтер для логирования в формате JSON.

**Наследует**: `logging.Formatter`

**Методы**:

- `format(record)`: Форматирует запись лога в JSON.

### `Logger`

**Описание**: Класс логгера, реализующий паттерн Singleton с возможностью логирования в консоль, файлы и JSON.

**Наследует**:

**Атрибуты**:

- `log_files_path` (Path): Путь к директории с файлами логов.
- `info_log_path` (Path): Путь к файлу информационных логов.
- `debug_log_path` (Path): Путь к файлу дебаг логов.
- `errors_log_path` (Path): Путь к файлу логов ошибок.
- `json_log_path` (Path): Путь к файлу JSON логов.
- `logger_console` (logging.Logger): Логгер для консоли.
- `logger_file_info` (logging.Logger): Логгер для информационного файла.
- `logger_file_debug` (logging.Logger): Логгер для файла дебага.
- `logger_file_errors` (logging.Logger): Логгер для файла ошибок.
- `logger_file_json` (logging.Logger): Логгер для JSON-файла.

**Параметры**:

- `info_log_path` (Optional[str], optional): Путь к файлу информационных логов. По умолчанию `None`.
- `debug_log_path` (Optional[str], optional): Путь к файлу дебаг логов. По умолчанию `None`.
- `errors_log_path` (Optional[str], optional): Путь к файлу логов ошибок. По умолчанию `None`.
- `json_log_path` (Optional[str], optional): Путь к файлу JSON логов. По умолчанию `None`.

**Принцип работы**:
Класс `Logger` инициализирует пути к файлам логов, создает директории и файлы, а также настраивает различные логгеры для консоли и файлов. Он использует `JsonFormatter` для форматирования логов в JSON. Паттерн Singleton гарантирует, что все компоненты приложения используют один и тот же экземпляр логгера.

## Методы класса

### `__init__`

```python
def __init__(
    self,
    info_log_path: Optional[str] = None,
    debug_log_path: Optional[str] = None,
    errors_log_path: Optional[str] = None,
    json_log_path: Optional[str] = None,
):
    """Инициализирует экземпляр Logger."""
```

**Назначение**: Инициализирует экземпляр класса `Logger`, настраивая пути к файлам логов, создавая необходимые директории и файлы, а также инициализируя логгеры для консоли и файлов.

**Параметры**:

- `info_log_path` (Optional[str], optional): Имя файла для информационных логов. Если не указано, используется "info.log". По умолчанию `None`.
- `debug_log_path` (Optional[str], optional): Имя файла для дебаг логов. Если не указано, используется "debug.log". По умолчанию `None`.
- `errors_log_path` (Optional[str], optional): Имя файла для логов ошибок. Если не указано, используется "errors.log". По умолчанию `None`.
- `json_log_path` (Optional[str], optional): Имя файла для JSON логов. Если не указано, используется имя файла с временной меткой. По умолчанию `None`.

**Как работает**:

1. **Определение путей к файлам**:
   - Загружает конфигурацию из файла `config.json`.
   - Формирует пути к директориям и файлам логов на основе текущей временной метки и конфигурации.

2. **Создание директорий и файлов**:
   - Создает директорию для логов, если она не существует.
   - Создает файлы логов, если они не существуют.

3. **Настройка логгеров**:
   - Инициализирует логгеры для консоли, информационного файла, файла дебага, файла ошибок и JSON-файла.
   - Устанавливает уровни логирования для каждого логгера.
   - Добавляет обработчики (handlers) к логгерам для записи сообщений в соответствующие файлы.
   - Для JSON-логгера используется кастомный форматтер `JsonFormatter`.

**Примеры**:

```python
logger = Logger(info_log_path='info.log', debug_log_path='debug.log', errors_log_path='errors.log', json_log_path='log.json')
```

### `_format_message`

```python
def _format_message(self, message, ex=None, color: Optional[Tuple[str, str]] = None, level=None):
    """Возвращает отформатированное сообщение с опциональным цветом и информацией об исключении."""
```

**Назначение**: Форматирует сообщение лога, добавляя к нему опциональный цвет и информацию об исключении.

**Параметры**:

- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Исключение, информация о котором добавляется к сообщению. По умолчанию `None`.
- `color` (Optional[Tuple[str, str]], optional): Кортеж, содержащий цвет текста и фона. По умолчанию `None`.
- `level` (int, optional): Уровень логирования. Используется для определения символа лога. По умолчанию `None`.

**Возвращает**:

- `str`: Отформатированное сообщение лога.

**Как работает**:

1. **Определение символа лога**:
   - На основе уровня логирования определяет соответствующий символ из словаря `LOG_SYMBOLS`.

2. **Форматирование сообщения с цветом**:
   - Если указан цвет, применяет цвет текста и фона к сообщению.

3. **Добавление информации об исключении**:
   - Добавляет информацию об исключении к сообщению.

4. **Возврат отформатированного сообщения**:
   - Возвращает отформатированное сообщение.

**Примеры**:

```python
formatted_message = logger._format_message("Сообщение об ошибке", ex=ValueError("Неверное значение"), color=("red", "light_gray"), level=logging.ERROR)
```

### `_ex_full_info`

```python
def _ex_full_info(self, ex):
    """Возвращает полную информацию об исключении вместе с деталями о предыдущей функции, файле и строке."""
```

**Назначение**: Возвращает полную информацию об исключении, включая имя файла, имя функции и номер строки, где произошло исключение.

**Параметры**:

- `ex` (Exception): Исключение, информацию о котором необходимо получить.

**Возвращает**:

- `str`: Полная информация об исключении.

**Как работает**:

1. **Получение информации о фрейме стека**:
   - Использует `inspect.stack()` для получения информации о фрейме стека вызовов.

2. **Извлечение имени файла, имени функции и номера строки**:
   - Извлекает имя файла, имя функции и номер строки из информации о фрейме стека.

3. **Форматирование информации об исключении**:
   - Форматирует информацию об исключении, добавляя к ней имя файла, имя функции и номер строки.

4. **Возврат отформатированной информации об исключении**:
   - Возвращает отформатированную информацию об исключении.

**Примеры**:

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    full_info = logger._ex_full_info(ex)
    print(full_info)
```

### `log`

```python
def log(self, level, message, ex=None, exc_info=False, color: Optional[Tuple[str, str]] = None):
    """Общий метод для логирования сообщений на указанном уровне с опциональным цветом."""
```

**Назначение**: Общий метод для логирования сообщений на указанном уровне с возможностью добавления цвета и информации об исключении.

**Параметры**:

- `level` (int): Уровень логирования (например, `logging.INFO`, `logging.ERROR`).
- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Исключение, которое нужно залогировать. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли логировать информацию об исключении. По умолчанию `False`.
- `color` (Optional[Tuple[str, str]], optional): Кортеж, содержащий цвет текста и фона. По умолчанию `None`.

**Как работает**:

1. **Форматирование сообщения**:
   - Вызывает метод `_format_message` для форматирования сообщения с учетом цвета и информации об исключении.

2. **Логирование сообщения**:
   - Логирует отформатированное сообщение с использованием `self.logger_console`.
   - Если `exc_info` равно `True` и исключение `ex` присутствует, логирует информацию об исключении.

**Примеры**:

```python
logger.log(logging.INFO, "Информационное сообщение")
logger.log(logging.ERROR, "Сообщение об ошибке", ex=ValueError("Неверное значение"), exc_info=True, color=("red", "light_gray"))
```

### `info`

```python
def info(self, message, ex=None, exc_info=False, text_color: str = "green", bg_color: str = ""):
    """Логирует информационное сообщение с опциональным цветом текста и фона."""
```

**Назначение**: Логирует информационное сообщение с возможностью указания цвета текста и фона.

**Параметры**:

- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Исключение, которое нужно залогировать. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли логировать информацию об исключении. По умолчанию `False`.
- `text_color` (str, optional): Цвет текста. По умолчанию "green".
- `bg_color` (str, optional): Цвет фона. По умолчанию "".

**Как работает**:

1. **Определение цвета**:
   - Формирует кортеж `color` из `text_color` и `bg_color`.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.INFO` и указанным цветом.

**Примеры**:

```python
logger.info("Информационное сообщение", text_color="blue", bg_color="light_gray")
```

### `success`

```python
def success(self, message, ex=None, exc_info=False, text_color: str = "yellow", bg_color: str = ""):
    """Логирует сообщение об успехе с опциональным цветом текста и фона."""
```

**Назначение**: Логирует сообщение об успехе с возможностью указания цвета текста и фона.

**Параметры**:

- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Исключение, которое нужно залогировать. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли логировать информацию об исключении. По умолчанию `False`.
- `text_color` (str, optional): Цвет текста. По умолчанию "yellow".
- `bg_color` (str, optional): Цвет фона. По умолчанию "".

**Как работает**:

1. **Определение цвета**:
   - Формирует кортеж `color` из `text_color` и `bg_color`.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.INFO` и указанным цветом.

**Примеры**:

```python
logger.success("Операция успешно завершена", text_color="green")
```

### `warning`

```python
def warning(self, message, ex=None, exc_info=False, text_color: str = "light_red", bg_color: str = ""):
    """Логирует предупреждающее сообщение с опциональным цветом текста и фона."""
```

**Назначение**: Логирует предупреждающее сообщение с возможностью указания цвета текста и фона.

**Параметры**:

- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Исключение, которое нужно залогировать. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли логировать информацию об исключении. По умолчанию `False`.
- `text_color` (str, optional): Цвет текста. По умолчанию "light_red".
- `bg_color` (str, optional): Цвет фона. По умолчанию "".

**Как работает**:

1. **Определение цвета**:
   - Формирует кортеж `color` из `text_color` и `bg_color`.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.WARNING` и указанным цветом.

**Примеры**:

```python
logger.warning("Предупреждение: возможно неверные данные", text_color="yellow")
```

### `debug`

```python
def debug(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = ""):
    """Логирует отладочное сообщение с опциональным цветом текста и фона."""
```

**Назначение**: Логирует отладочное сообщение с возможностью указания цвета текста и фона.

**Параметры**:

- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Исключение, которое нужно залогировать. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли логировать информацию об исключении. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию "cyan".
- `bg_color` (str, optional): Цвет фона. По умолчанию "".

**Как работает**:

1. **Определение цвета**:
   - Формирует кортеж `color` из `text_color` и `bg_color`.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.DEBUG` и указанным цветом.

**Примеры**:

```python
logger.debug("Отладочное сообщение: значение переменной = 5", text_color="blue")
```

### `exception`

```python
def exception(self, message, ex=None, exc_info=True, text_color: str = "cyan", bg_color: str = "light_gray"):
    """Логирует сообщение об исключении с опциональным цветом текста и фона."""
```

**Назначение**: Логирует сообщение об исключении с возможностью указания цвета текста и фона.

**Параметры**:

- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Исключение, которое нужно залогировать. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли логировать информацию об исключении. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию "cyan".
- `bg_color` (str, optional): Цвет фона. По умолчанию "light_gray".

**Как работает**:

1. **Определение цвета**:
   - Формирует кортеж `color` из `text_color` и `bg_color`.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.ERROR` и указанным цветом.

**Примеры**:

```python
try:
    raise ValueError("Неверное значение")
except ValueError as ex:
    logger.exception("Произошло исключение", ex=ex)
```

### `error`

```python
def error(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = ""):
    """Логирует сообщение об ошибке с опциональным цветом текста и фона."""
```

**Назначение**: Логирует сообщение об ошибке с возможностью указания цвета текста и фона.

**Параметры**:

- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Исключение, которое нужно залогировать. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли логировать информацию об исключении. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию "red".
- `bg_color` (str, optional): Цвет фона. По умолчанию "".

**Как работает**:

1. **Определение цвета**:
   - Формирует кортеж `color` из `text_color` и `bg_color`.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.ERROR` и указанным цветом.

**Примеры**:

```python
logger.error("Произошла ошибка при выполнении операции", ex=IOError("Файл не найден"))
```

### `critical`

```python
def critical(self, message, ex=None, exc_info=True, text_color: str = "red", bg_color: str = "white"):
    """Логирует критическое сообщение с опциональным цветом текста и фона."""
```

**Назначение**: Логирует критическое сообщение с возможностью указания цвета текста и фона.

**Параметры**:

- `message` (str): Сообщение лога.
- `ex` (Exception, optional): Исключение, которое нужно залогировать. По умолчанию `None`.
- `exc_info` (bool, optional): Флаг, указывающий, нужно ли логировать информацию об исключении. По умолчанию `True`.
- `text_color` (str, optional): Цвет текста. По умолчанию "red".
- `bg_color` (str, optional): Цвет фона. По умолчанию "white".

**Как работает**:

1. **Определение цвета**:
   - Формирует кортеж `color` из `text_color` и `bg_color`.

2. **Логирование сообщения**:
   - Вызывает метод `log` с уровнем `logging.CRITICAL` и указанным цветом.

**Примеры**:

```python
logger.critical("Критическая ошибка: приложение будет остановлено", ex=SystemExit("Невозможно продолжить работу"))
```

## Параметры класса

- `info_log_path` (Optional[str], optional): Путь к файлу информационных логов. По умолчанию `None`.
- `debug_log_path` (Optional[str], optional): Путь к файлу дебаг логов. По умолчанию `None`.
- `errors_log_path` (Optional[str], optional): Путь к файлу логов ошибок. По умолчанию `None`.
- `json_log_path` (Optional[str], optional): Путь к файлу JSON логов. По умолчанию `None`.

**Примеры**:

```python
logger = Logger(info_log_path='info.log', debug_log_path='debug.log', errors_log_path='errors.log', json_log_path='log.json')
# Модуль для звуковых оповещений

## Обзор

Модуль `beeper.py` предназначен для воспроизведения звуковых сигналов различных уровней важности для оповещения пользователя о происходящих событиях в системе. Он использует библиотеку `winsound` для воспроизведения звуков в Windows и предоставляет возможность настройки частоты и длительности сигналов.

## Более подробно

Этот модуль позволяет визуально уведомлять пользователя о различных событиях, происходящих в системе, с помощью звуковых сигналов. Он определяет различные уровни событий, такие как `SUCCESS`, `INFO`, `WARNING`, `ERROR` и другие, и связывает их с определенными мелодиями или звуками.

## Классы

### `BeepLevel`

**Описание**: Класс-перечисление, определяющий типы событий, которые могут быть оповещены звуковым сигналом.

**Наследует**: `Enum`

**Атрибуты**:
- `SUCCESS`: Список кортежей, содержащих ноту и длительность для события `SUCCESS`.
- `INFO_LONG`: Список кортежей, содержащих ноту и длительность для события `INFO_LONG`.
- `INFO`: Список кортежей, содержащих ноту и длительность для события `INFO`.
- `ATTENTION`: Список кортежей, содержащих ноту и длительность для события `ATTENTION`.
- `WARNING`: Список кортежей, содержащих ноту и длительность для события `WARNING`.
- `DEBUG`: Список кортежей, содержащих ноту и длительность для события `DEBUG`.
- `ERROR`: Список кортежей, содержащих ноту и длительность для события `ERROR`.
- `LONG_ERROR`: Список кортежей, содержащих ноту и длительность для события `LONG_ERROR`.
- `CRITICAL`: Список кортежей, содержащих ноту и длительность для события `CRITICAL`.
- `BELL`: Список кортежей, содержащих ноту и длительность для события `BELL`.

**Принцип работы**:
Класс `BeepLevel` использует перечисление `Enum` для определения различных уровней событий. Каждому уровню события соответствует список кортежей, где каждый кортеж содержит ноту и длительность звукового сигнала. Это позволяет задавать разные мелодии для разных типов событий.

### `BeepHandler`

**Описание**: Класс для обработки звуковых сигналов на основе записей логов.

**Атрибуты**:
- Отсутствуют явно заданные атрибуты.

**Методы**:
- `emit(self, record)`: Воспроизводит звук в зависимости от уровня записи лога.
- `beep(self, level: BeepLevel | str = BeepLevel.INFO, frequency: int = 400, duration: int = 1000)`: Воспроизводит звуковой сигнал с заданной частотой и длительностью.

### `Beeper`

**Описание**: Класс для воспроизведения звуковых сигналов.

**Атрибуты**:
- `silent`: Флаг, определяющий, включен ли беззвучный режим. По умолчанию `False`.

**Методы**:
- `beep(level: BeepLevel | str = BeepLevel.INFO, frequency: int = 400, duration: int = 1000)`: Статический асинхронный метод для воспроизведения звукового сигнала.

## Функции

### `silent_mode`

```python
def silent_mode(func):
    """
     Функция-декоратор для управления режимом "беззвучия".
    
    @details Принимает один аргумент - функцию, которую нужно декорировать.
    
    @param func: Функция для декорирования.
    
    @return: Обернутая функция, добавляющая проверку режима "беззвучия".
    """
    def wrapper(*args, **kwargs):
        """
         Внутренняя функция-обертка для проверки режима "беззвучия" перед выполнением функции.
        
        @details Если режим "беззвучия" включен, выводит сообщение о пропуске воспроизведения звука и завершает выполнение функции beep.
        В противном случае вызывает оригинальную функцию, переданную как аргумент (func(*args, **kwargs)).
        
        @param args: Позиционные аргументы, переданные в оборачиваемую функцию.
        @param kwargs: Именованные аргументы, переданные в оборачиваемую функцию.
        
        @return: Результат выполнения оборачиваемой функции или None, если режим "беззвучия" включен.
        """
        if Beeper.silent:
            print("Silent mode is enabled. Skipping beep.")
            return
        return func(*args, **kwargs)
    return wrapper
```

**Назначение**: Функция-декоратор для управления режимом "беззвучия".

**Параметры**:
- `func`: Функция для декорирования.

**Возвращает**:
- Обернутая функция, добавляющая проверку режима "беззвучия".

**Внутренние функции**:
- `wrapper(*args, **kwargs)`: Внутренняя функция-обертка для проверки режима "беззвучия" перед выполнением функции.

**Принцип работы**:
Декоратор `silent_mode` принимает функцию в качестве аргумента и возвращает новую функцию (`wrapper`), которая оборачивает исходную. Внутри `wrapper` проверяется, включен ли режим "беззвучия" (`Beeper.silent`). Если режим включен, выводится сообщение о пропуске воспроизведения звука и возвращается `None`. В противном случае вызывается оригинальная функция с переданными аргументами и возвращается результат ее выполнения.

**Примеры**:
```python
@silent_mode
async def beep(level: BeepLevel | str = BeepLevel.INFO, frequency: int = 400, duration: int = 1000) -> None:
    ...
```

## Методы класса `BeepHandler`

### `emit`

```python
 def emit(self, record):
        try:
            level = record["level"].name
            if level == 'ERROR':
                self.play_sound(880, 500)  # Проиграть "бип" для ошибок
            elif level == 'WARNING':
                self.play_sound(500, 300)  # Проиграть другой звук для предупреждений
            elif level == 'INFO':
                self.play_sound(300, 200)  # И так далее...
            else:
                self.play_default_sound()  # Дефолтный звук для других уровней логгирования
        except Exception as ex:
            print(f'Ошибка воспроизведения звука: {ex}' )
```

**Назначение**: Обрабатывает запись лога и воспроизводит соответствующий звук.

**Параметры**:
- `record`: Запись лога, содержащая информацию об уровне события.

**Принцип работы**:
Метод `emit` извлекает уровень события из записи лога и воспроизводит соответствующий звук с помощью метода `play_sound`. Если уровень события равен `ERROR`, `WARNING` или `INFO`, воспроизводится соответствующий звук. В противном случае воспроизводится звук по умолчанию. Если возникает ошибка при воспроизведении звука, выводится сообщение об ошибке.

### `beep`

```python
def beep(self, level: BeepLevel | str = BeepLevel.INFO, frequency: int = 400, duration: int = 1000):
        Beeper.beep(level, frequency, duration)
```

**Назначение**: Воспроизводит звуковой сигнал с заданной частотой и длительностью.

**Параметры**:
- `level` (BeepLevel | str): Уровень сигнала (по умолчанию `BeepLevel.INFO`).
- `frequency` (int): Частота сигнала (по умолчанию 400 Гц).
- `duration` (int): Длительность сигнала (по умолчанию 1000 мс).

**Принцип работы**:
Метод `beep` вызывает статический метод `beep` класса `Beeper` с переданными параметрами. Это позволяет воспроизвести звуковой сигнал с заданной частотой и длительностью.

## Методы класса `Beeper`

### `beep`

```python
    @staticmethod
    @silent_mode
    async def beep(level: BeepLevel | str = BeepLevel.INFO, frequency: int = 400, duration: int = 1000) -> None:
        """  
         Звуковой сигнал оповещения 
        @details дает мне возможность на слух определить, что происходит в системе
        @param mode `BeepLevel | str`  :  тип события: `info`, `attention`, `warning`, `debug`, `error`, `long_error`, `critical`, `bell`  
        /t /t или `Beep.SUCCESS`, `Beep.INFO`, `Beep.ATTENTION`, `Beep.WARNING`, `Beep.DEBUG`, `Beep.ERROR`, `Beep.LONG_ERROR`, `Beep.CRITICAL`, `Beep.BELL`
        @param frequency частота сигнала в значениях от 37 до 32000
        @param duration длительность сигнала
        """
        
        if isinstance(level, str):
            if level == 'success':
                melody = BeepLevel.SUCCESS.value[0]
            # ... остальные условия ...
        elif isinstance(level, BeepLevel):
            melody = level.value[0]

        for note, duration in melody:
            frequency = note_freq[note]
            try:
                winsound.Beep(int(frequency), duration)
            except Exception as ex:
                print(f'''Не бибикает :| 
                              Ошибка - {ex}, 
                              нота - {note},
                              продолжительность - {duration}
                                мелодия - {melody}
                    ''')
                return
            time.sleep(0.0)
```

**Назначение**: Воспроизводит звуковой сигнал оповещения.

**Параметры**:
- `level` (BeepLevel | str): Тип события (`info`, `attention`, `warning`, `debug`, `error`, `long_error`, `critical`, `bell`) или соответствующая константа `BeepLevel`. По умолчанию `BeepLevel.INFO`.
- `frequency` (int): Частота сигнала в диапазоне от 37 до 32000 Гц.
- `duration` (int): Длительность сигнала в миллисекундах.

**Принцип работы**:
Метод `beep` воспроизводит звуковой сигнал оповещения. Он принимает тип события (`level`), частоту (`frequency`) и длительность (`duration`) сигнала в качестве параметров. В зависимости от типа события выбирается соответствующая мелодия из перечисления `BeepLevel`. Затем для каждой ноты в мелодии воспроизводится звук с заданной частотой и длительностью с помощью функции `winsound.Beep`. Если возникает ошибка при воспроизведении звука, выводится сообщение об ошибке.

## Переменные

- `note_freq`: словарь, содержащий соответствия между названиями нот и их частотами.

**Пример использования**:
```python
from src.logger.beeper import Beeper, BeepLevel

# Воспроизведение звукового сигнала уровня INFO
Beeper.beep(level=BeepLevel.INFO)

# Воспроизведение звукового сигнала уровня ERROR
Beeper.beep(level=BeepLevel.ERROR)

# Воспроизведение звукового сигнала с заданной частотой и длительностью
Beeper.beep(frequency=800, duration=500)
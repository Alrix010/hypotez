**Instructions for Generating Code Documentation**

1. **Analyze the Code**: Understand the logic and actions performed by the code snippet.

2. **Create a Step-by-Step Guide**:
    - **Description**: Explain what the code block does.
    - **Execution Steps**: Describe the sequence of actions in the code.
    - **Usage Example**: Provide a code example of how to use the snippet in the project.

3. **Example**:

How to Use This Code Block
=========================================================================================

Description
-------------------------
This code defines functions for composing and handling LLM model messages, extracting JSON and code blocks from text, and managing LLM interactions. 

Execution Steps
-------------------------
1. **`compose_initial_LLM_messages_with_templates`**:
   - Composes initial messages for the LLM model call.
   - Reads templates from specified paths based on the `system_template_name` and optional `user_template_name`.
   - Renders the templates using the provided `rendering_configs`.
   - Creates a list of messages with "role" and "content" keys.
   - Appends the system message and an optional user message to the list.
2. **`llm`**:
   - Decorator that turns the decorated function into an LLM-based function.
   - Uses the decorated function's return value as the instruction for the LLM or uses function parameters if the return value is not a string.
   - Calls the LLM with system and user prompts constructed from function documentation and function parameters.
   - Coerces the LLM response to the function's annotated return type.
3. **`extract_json`**:
   - Extracts a JSON object from a string, handling cases where the string might include text before the opening brace or Markdown code tags.
   - Removes extraneous text before and after the JSON structure.
   - Cleans up invalid escape sequences.
   - Uses `json.loads` to parse the cleaned JSON string.
4. **`extract_code_block`**:
   - Extracts a code block from a string, removing text before the first opening triple backticks and after the closing triple backticks.
5. **`repeat_on_error`**:
   - Decorator that retries the specified function call if an exception occurs within a list of specified exceptions, up to a set number of retries.
   - Raises the exception if the retry limit is exceeded.
   - Logs retries and exceptions.
6. **`add_rai_template_variables_if_enabled`**:
   - Adds RAI (Responsible AI) template variables to a dictionary if RAI disclaimers are enabled in the project's configuration.
   - Reads RAI disclaimer content from files based on configuration settings.
7. **`truncate_actions_or_stimuli`**:
   - Truncates the content of actions or stimuli within a list at a specified maximum length.
   - Clones the list to avoid modifying the original.
   - Iterates through elements, searching for "action" or "stimulus" keys.
   - Truncates content within those keys using `break_text_at_length`.


Usage Example
-------------------------

```python
    from tinytroupe.utils.llm import llm

    @llm(model="gpt-4-0613", temperature=0.5, max_tokens=100)
    def joke():
        """
        Tell me a funny joke.
        """
        return "Tell me a joke."

    print(joke()) # Outputs a joke generated by the LLM

```

4. **Avoid Vague Terms** like "getting" or "doing". Be specific about what the code does, for example: "checks", "validates", or "sends".
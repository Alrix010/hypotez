### Анализ кода `hypotez/src/endpoints/prestashop/product_fields/product_fields_translator.py.md`

## Обзор

Модуль предназначен для перевода полей товара на языки клиентской базы данных.

## Подробнее

Этот модуль предоставляет функции для преобразования мультиязычных полей товара в PrestaShop в соответствии со схемой языков клиентской базы данных. Он позволяет обновлять идентификаторы языка в словаре полей товара и извлекать переводы из таблицы переводов PrestaShop.

## Функции

### `rearrange_language_keys`

```python
def rearrange_language_keys(presta_fields_dict: dict, client_langs_schema: dict | List[dict], page_lang: str) -> dict:
    """Функция обновляет идентификатор языка в словаре presta_fields_dict на соответствующий идентификатор
    из схемы клиентских языков при совпадении языка страницы.

    Args:
        presta_fields_dict (dict): Словарь полей товара.
        page_lang (str): Язык страницы.
        client_langs_schema (list | dict): Схема языков клиента.

    Returns:
        dict: Обновленный словарь presta_fields_dict.
    """
    ...
```

**Назначение**:
Обновляет идентификатор языка в словаре `presta_fields_dict` на соответствующий идентификатор из схемы клиентских языков при совпадении языка страницы.

**Параметры**:

*   `presta_fields_dict` (dict): Словарь полей товара.
*   `client_langs_schema` (list | dict): Схема языков клиента.
*   `page_lang` (str): Язык страницы.

**Возвращает**:

*   `dict`: Обновленный словарь `presta_fields_dict`.

**Как работает функция**:

1.  Находит соответствующий идентификатор языка в схеме клиентских языков.
2.  Если идентификатор языка найден, обновляет значение атрибута `id` в словаре `presta_fields_dict` для каждого мультиязычного поля.

### `translate_presta_fields_dict`

```python
def translate_presta_fields_dict (presta_fields_dict: dict, 
                                  client_langs_schema: list | dict, 
                                  page_lang: str = None) -> dict:
    """ @Перевод мультиязычных полей в соответствии со схемой значений `id` языка в базе данных клиента
	    Функция получает на вход заполненный словарь полей. Мультиязычные поля содржат значения,
	    полученные с сайта поставщика в виде словаря 
	    ```
	    {
		    'language':[
					    {'attrs':{'id':'1'}, 'value':value},
					    ]
	    }
	    ```
	    У клиента язык с ключом `id=1` Может быть любым в зависимости от того на каком языке была 
	    изначально установлена PrestaShop. Чаще всего это английский, но это не правило.
	    Точные соответствия я получаю в схеме языков клиента 
	    locator_description
	    Самый быстрый способ узнать схему API языков - набрать в адресной строке браузера
	    https://API_KEY@mypresta.com/api/languages?display=full&io_format=JSON
	  
    @param client_langs_schema `dict` словарь актуальных языков на клиенте
    @param presta_fields_dict `dict` словарь полей товара собранный со страницы поставщика
    @param page_lang `str` язык страницы поставщика в коде en-US, ru-RU, he_HE. 
    Если не задан - функция пытается определить п тексту
    @returns presta_fields_dict переведенный словарь полей товара
    """
    ...
```

**Назначение**:
Переводит мультиязычные поля в соответствии со схемой значений `id` языка в базе данных клиента.

**Параметры**:

*   `presta_fields_dict` (dict): Словарь полей товара, собранный со страницы поставщика.
*   `client_langs_schema` (list | dict): Словарь актуальных языков на клиенте.
*   `page_lang` (str, optional): Язык страницы поставщика в коде en-US, ru-RU, he\_HE. Если не задан - функция пытается определить по тексту.

**Возвращает**:

*   `presta_fields_dict`: Переведенный словарь полей товара.

**Как работает функция**:

1.  Переупорядочивает ключи таблицы с помощью функции `rearrange_language_keys`.
2.  Извлекает переводы из таблицы `presta_translations_table` по артикулу товара.
3.  Если в таблице переводов нет такого товара, добавляет текущий товар как новый перевод.
4.  Для каждого языка клиента и переведенной записи из таблицы:

    *   Проверяет, соответствует ли ISO-код языка клиента локали переведенной записи.
    *   Если соответствует, записывает перевод из таблицы в мультиязычные поля товара.

## Переменные

Отсутствуют

## Примеры использования

В предоставленном коде отсутствуют примеры использования.

## Зависимости

*   `re`: Для работы с регулярными выражениями.
*   `typing.Dict, typing.List, typing.Any, typing.Optional`: Для аннотаций типов.
*   `hypotez.src.logger.logger`: Для логирования.
*   Использует модули  `src.utils.jjson.j_dumps`
* `from src.utils.printer import pprint`: используется для форматированного вывода в консоль.

## Взаимосвязи с другими частями проекта

*   Модуль `product_fields_translator.py` используется для преобразования данных о товарах в PrestaShop и может использоваться в других частях проекта `hypotez`, где требуется обработка данных, полученных из различных источников и приведение их к единому формату.  В коде используются   `re`, `typing`, `src.logger.logger`  и тд
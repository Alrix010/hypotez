# Модуль для работы с Google Sheets API
## Обзор

Модуль `reach_spreadsheet.py` предназначен для работы с Google Sheets API v4 и Google Drive API v3. Он предоставляет функциональность для создания, управления и обмена данными в Google Sheets. Модуль включает в себя класс `ReachSpreadsheet`, который облегчает взаимодействие с Google Sheets, позволяя создавать новые таблицы, делиться ими, устанавливать параметры форматирования и добавлять данные.

## Подробнее

Модуль использует библиотеку `googleapiclient` для взаимодействия с Google Sheets API и Google Drive API. Аутентификация происходит через сервисный аккаунт с использованием JSON-ключа. Основной класс `ReachSpreadsheet` предоставляет методы для выполнения различных операций, таких как создание таблиц, добавление листов, установка ширины столбцов и высоты строк, форматирование ячеек и добавление данных.

## Классы

### `SpreadsheetError`

**Описание**: Базовый класс исключений для модуля `reach_spreadsheet`.

### `SpreadsheetNotSetError`

**Описание**: Исключение, которое вызывается, когда отсутствует идентификатор таблицы.
**Наследует**: `SpreadsheetError`

### `SheetNotSetError`

**Описание**: Исключение, которое вызывается, когда отсутствует идентификатор листа.
**Наследует**: `SpreadsheetError`

### `ReachSpreadsheet`

**Описание**: Класс для взаимодействия с Google Sheets API. Предоставляет методы для создания, чтения, обновления и обмена данными в Google Sheets.

**Атрибуты**:

-   `debugMode` (bool): Режим отладки, определяющий, нужно ли выводить дополнительную информацию в консоль.
-   `credentials` (ServiceAccountCredentials): Учетные данные сервисного аккаунта для аутентификации в Google API.
-   `httpAuth` (httplib2.Http): Авторизованный HTTP-объект для выполнения запросов к Google API.
-   `service` (googleapiclient.discovery.Resource): Объект сервиса Google Sheets API v4.
-   `driveService` (googleapiclient.discovery.Resource): Объект сервиса Google Drive API v3.
-   `spreadsheetId` (str): Идентификатор таблицы.
-   `sheetId` (str): Идентификатор листа.
-   `sheetTitle` (str): Заголовок листа.
-   `requests` (list): Список запросов для пакетного обновления таблицы.
-   `valueRanges` (list): Список диапазонов значений для пакетного обновления данных в таблице.

**Методы**:

-   `__init__(debugMode=False)`: Инициализирует объект `ReachSpreadsheet`, загружает учетные данные и создает сервисные объекты для Google Sheets и Drive API.
-   `create(title, sheetTitle, rows=1000, cols=26, locale='en-US', timeZone='Etc/GMT')`: Создает новую таблицу с указанными параметрами.
-   `share(shareRequestBody)`: Предоставляет общий доступ к таблице на основе предоставленного тела запроса.
-   `shareWithEmailForReading(email)`: Предоставляет доступ на чтение к таблице для указанного email.
-   `shareWithEmailForWriting(email)`: Предоставляет доступ на запись к таблице для указанного email.
-   `shareWithAnybodyForReading()`: Предоставляет публичный доступ на чтение к таблице.
-   `shareWithAnybodyForWriting()`: Предоставляет публичный доступ на запись к таблице.
-   `getSheetURL()`: Возвращает URL текущего листа в таблице.
-   `setSpreadsheetById(spreadsheetId)`: Устанавливает текущую таблицу по ID и устанавливает текущий лист как первый лист в этой таблице.
-   `runPrepared(valueInputOption="USER_ENTERED")`: Выполняет подготовленные запросы на обновление таблицы и данных.
-   `prepare_addSheet(sheetTitle, rows=1000, cols=26)`: Подготавливает запрос на добавление нового листа в таблицу.
-   `addSheet(sheetTitle, rows=1000, cols=26)`: Добавляет новый лист в текущую таблицу и устанавливает его как текущий.
-   `toGridRange(cellsRange)`: Преобразует строковый диапазон ячеек в объект `GridRange` для текущего листа.
-   `prepare_setDimensionPixelSize(dimension, startIndex, endIndex, pixelSize)`: Подготавливает запрос на установку размера в пикселях для указанного измерения (столбца или строки).
-   `prepare_setColumnsWidth(startCol, endCol, width)`: Подготавливает запрос на установку ширины столбцов в пикселях.
-   `prepare_setColumnWidth(col, width)`: Подготавливает запрос на установку ширины одного столбца в пикселях.
-   `prepare_setRowsHeight(startRow, endRow, height)`: Подготавливает запрос на установку высоты строк в пикселях.
-   `prepare_setRowHeight(row, height)`: Подготавливает запрос на установку высоты одной строки в пикселях.
-   `prepare_setValues(cellsRange, values, majorDimension="ROWS")`: Подготавливает запрос на установку значений в указанном диапазоне ячеек.
-   `prepare_mergeCells(cellsRange, mergeType="MERGE_ALL")`: Подготавливает запрос на объединение ячеек в указанном диапазоне.
-   `prepare_setCellStringFormatterormat(cellsRange, formatJSON, fields="userEnteredFormat")`: Подготавливает запрос на установку формата ячеек в указанном диапазоне.
-   `prepare_setCellStringFormatterormats(cellsRange, formatsJSON, fields="userEnteredFormat")`: Подготавливает запрос на установку форматов ячеек в указанном диапазоне на основе списка форматов.

## Функции

### `htmlColorToJSON(htmlColor)`

**Назначение**: Преобразует HTML-цвет в формате `#RRGGBB` в JSON-представление цвета для Google Sheets API.

**Параметры**:

-   `htmlColor` (str): Строка, представляющая HTML-цвет.

**Возвращает**:

-   `dict`: Словарь с ключами `'red'`, `'green'` и `'blue'`, значения которых находятся в диапазоне от 0.0 до 1.0.

**Как работает функция**:

1.  Функция принимает HTML-цвет в формате строки.
2.  Если строка начинается с `#`, она удаляет этот символ.
3.  Затем она извлекает значения красного, зеленого и синего компонентов цвета из строки, преобразует их из шестнадцатеричного формата в десятичный и делит на 255.0, чтобы получить значения в диапазоне от 0.0 до 1.0.
4.  В конце функция возвращает словарь, содержащий значения красного, зеленого и синего компонентов цвета.

**Примеры**:

```python
htmlColorToJSON("#FF0000")  # Возвращает {'red': 1.0, 'green': 0.0, 'blue': 0.0}
htmlColorToJSON("00FF00")  # Возвращает {'red': 0.0, 'green': 1.0, 'blue': 0.0}
```

### `create_pricelist(docTitle, sheetTitle, values: list)`

**Назначение**: Создает новую таблицу с заданным заголовком и листом, заполняя ее переданными значениями.

**Параметры**:

-   `docTitle` (str): Заголовок документа Google Sheets.
-   `sheetTitle` (str): Заголовок листа Google Sheets.
-   `values` (list): Список значений для заполнения таблицы.

**Как работает функция**:

1.  Определяет количество строк на основе длины списка `values`.
2.  Создает экземпляр класса `Spreadsheet` в режиме отладки.
3.  Вызывает метод `create` для создания новой таблицы с заданными параметрами (заголовок документа и листа, количество строк и столбцов).
4.  Вызывает метод `shareWithAnybodyForWriting`, чтобы предоставить любому пользователю доступ на запись к таблице.
5.  Вызывает метод `prepare_setValues` для подготовки запроса на установку значений в указанном диапазоне ячеек.

```python
values = [["Заголовок 1", "Заголовок 2"], ["Значение 1", "Значение 2"]]
create_pricelist("Новый прайс-лист", "Лист 1", values)
```

## Тестовые функции (не включены в основную документацию)

В модуле также присутствуют тестовые функции, которые демонстрируют использование класса `Spreadsheet` и его методов. Эти функции служат для проверки работоспособности класса и могут быть полезны при разработке и отладке.

-   `testCreateSpreadsheet()`: Создает новую таблицу и предоставляет доступ на запись для указанного email.
-   `testSetSpreadsheet()`: Устанавливает текущую таблицу по ID.
-   `testAddSheet()`: Добавляет новый лист в текущую таблицу.
-   `testSetDimensions()`: Устанавливает ширину столбцов и высоту строк.
-   `testGridRangeForStr()`: Преобразует строковый диапазон ячеек в объект `GridRange`.
-   `testSetCellStringFormatterormat()`: Устанавливает формат ячеек.
-   `testPureBlackBorder()`: Устанавливает черную границу для ячеек.
-   `testUpdateCellStringFormatterieldsArg()`: Обновляет формат ячеек с указанием полей для обновления.
-   `testCreateTimeManagementReport()`: Создает таблицу для отчета по управлению временем.
# Модуль `src.utils.csv`

## Обзор

Модуль `src.utils.csv` предоставляет набор утилит для работы с файлами в формате CSV и JSON. Он включает функции для сохранения данных в CSV-файл, чтения данных из CSV-файла, конвертации CSV-файла в JSON-формат и представления CSV-данных в виде словаря.

## Подробнее

Модуль предназначен для упрощения операций чтения и записи данных в формате CSV и JSON. Он использует встроенные библиотеки `csv` и `json`, а также библиотеку `pandas` для более удобной работы с данными. Модуль также включает функциональность логирования ошибок с использованием модуля `src.logger.logger`.

## Функции

### `save_csv_file`

**Назначение**: Сохраняет список словарей в CSV-файл.

**Параметры**:
- `data` (List[Dict[str, str]]): Список словарей для сохранения.
- `file_path` (Union[str, Path]): Путь к CSV-файлу.
- `mode` (str): Режим файла ('a' для добавления, 'w' для перезаписи). По умолчанию 'a'.
- `exc_info` (bool): Включать ли информацию об отладке в логи.

**Возвращает**:
- `bool`: `True`, если сохранение прошло успешно, `False` в противном случае.

**Вызывает исключения**:
- `TypeError`: Если входные данные не являются списком словарей.
- `ValueError`: Если входные данные пусты.

**Как работает функция**:
1. Проверяет, является ли входной параметр `data` списком. Если нет, вызывает исключение `TypeError`.
2. Проверяет, является ли список `data` пустым. Если да, вызывает исключение `ValueError`.
3. Преобразует `file_path` в объект `Path`.
4. Создает родительские директории, если они не существуют.
5. Открывает файл в указанном режиме.
6. Создает объект `csv.DictWriter` для записи данных в формате словаря.
7. Записывает заголовок, если файл был только что создан или открыт в режиме перезаписи.
8. Записывает строки данных в файл.
9. Возвращает `True` в случае успеха, `False` в случае ошибки.

**Примеры**:

```python
data = [{'name': 'Alice', 'age': '30'}, {'name': 'Bob', 'age': '25'}]
file_path = 'output.csv'
result = save_csv_file(data, file_path, mode='w')
print(result)  # Вывод: True

data = [{'name': 'Charlie', 'age': '35'}]
file_path = 'output.csv'
result = save_csv_file(data, file_path, mode='a')
print(result)  # Вывод: True
```

### `read_csv_file`

**Назначение**: Читает содержимое CSV-файла в виде списка словарей.

**Параметры**:
- `file_path` (Union[str, Path]): Путь к CSV-файлу.
- `exc_info` (bool): Включать ли информацию об отладке в логи.

**Возвращает**:
- `List[Dict[str, str]] | None`: Список словарей, представляющих содержимое CSV-файла, или `None`, если чтение не удалось.

**Вызывает исключения**:
- `FileNotFoundError`: Если файл не найден.

**Как работает функция**:
1. Открывает CSV-файл для чтения.
2. Создает объект `csv.DictReader` для чтения данных в формате словаря.
3. Преобразует данные из CSV-файла в список словарей.
4. Возвращает список словарей, или `None`, если файл не найден или возникла другая ошибка.

**Примеры**:

```python
file_path = 'output.csv'
data = read_csv_file(file_path)
print(data)
# Вывод: [{'name': 'Alice', 'age': '30'}, {'name': 'Bob', 'age': '25'}, {'name': 'Charlie', 'age': '35'}]
```

### `read_csv_as_json`

**Назначение**: Конвертирует CSV-файл в JSON-формат и сохраняет его.

**Параметры**:
- `csv_file_path` (Union[str, Path]): Путь к CSV-файлу.
- `json_file_path` (Union[str, Path]): Путь для сохранения JSON-файла.
- `exc_info` (bool): Включать ли информацию об отладке в логи.

**Возвращает**:
- `bool`: `True`, если конвертация прошла успешно, `False` в противном случае.

**Как работает функция**:
1. Читает данные из CSV-файла с использованием функции `read_csv_file`.
2. Если данные не были успешно прочитаны (т.е. функция вернула `None`), возвращает `False`.
3. Открывает JSON-файл для записи.
4. Записывает данные в JSON-файл с отступами для читаемости.
5. Возвращает `True` в случае успеха, `False` в случае ошибки.

**Примеры**:

```python
csv_file_path = 'output.csv'
json_file_path = 'output.json'
result = read_csv_as_json(csv_file_path, json_file_path)
print(result)  # Вывод: True
```

### `read_csv_as_dict`

**Назначение**: Конвертирует содержимое CSV-файла в словарь.

**Параметры**:
- `csv_file` (Union[str, Path]): Путь к CSV-файлу.

**Возвращает**:
- `dict | None`: Словарь, представляющий содержимое CSV-файла, или `None`, если преобразование не удалось.

**Как работает функция**:
1. Открывает CSV-файл для чтения.
2. Создает объект `csv.DictReader` для чтения данных в формате словаря.
3. Преобразует данные из CSV-файла в словарь, где ключ `"data"` содержит список словарей.
4. Возвращает словарь, или `None`, если произошла ошибка.

**Примеры**:

```python
csv_file = 'output.csv'
data = read_csv_as_dict(csv_file)
print(data)
# Вывод: {'data': [{'name': 'Alice', 'age': '30'}, {'name': 'Bob', 'age': '25'}, {'name': 'Charlie', 'age': '35'}]}
```

### `read_csv_as_ns`

**Назначение**: Загружает данные CSV в список словарей, используя Pandas.

**Параметры**:
- `file_path` (Union[str, Path]): Путь к CSV-файлу.

**Возвращает**:
- `List[dict]`: Список словарей, представляющих содержимое CSV-файла.

**Вызывает исключения**:
- `FileNotFoundError`: Если файл не найден.

**Как работает функция**:
1. Использует библиотеку `pandas` для чтения CSV-файла в DataFrame.
2. Преобразует DataFrame в список словарей, где каждый словарь представляет строку из CSV-файла.
3. Обрабатывает исключение `FileNotFoundError`, логируя ошибку и возвращая пустой список.
4. Обрабатывает другие исключения, логируя ошибку и возвращая пустой список.

**Примеры**:

```python
file_path = 'output.csv'
data = read_csv_as_ns(file_path)
print(data)
# Вывод: [{'name': 'Alice', 'age': '30'}, {'name': 'Bob', 'age': '25'}, {'name': 'Charlie', 'age': '35'}]
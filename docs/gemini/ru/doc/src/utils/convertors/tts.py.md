# Модуль для преобразования речи в текст и текста в речь

## Обзор

Модуль предоставляет функциональность для распознавания речи из аудиофайлов и преобразования текста в речь. Он использует библиотеки `speech_recognition` для распознавания речи и `gTTS` для преобразования текста в речь. Модуль также использует `pydub` для конвертации аудиоформатов.

## Подробней

Модуль содержит две основные функции: `speech_recognizer` и `text2speech`. Первая функция принимает URL или путь к аудиофайлу и распознает речь в нем, используя Google Speech Recognition. Вторая функция преобразует текст в речь и сохраняет его в виде аудиофайла.

## Функции

### `speech_recognizer`

**Назначение**: Загрузка аудиофайла и распознавание речи в нем.

**Параметры**:

- `audio_url` (str, optional): URL аудиофайла для загрузки. По умолчанию `None`.
- `audio_file_path` (Path, optional): Локальный путь к аудиофайлу. По умолчанию `None`.
- `language` (str): Языковой код для распознавания (например, 'ru-RU'). По умолчанию 'ru-RU'.

**Возвращает**:

- `str`: Распознанный текст из аудио или сообщение об ошибке.

**Вызывает исключения**:

- `sr.UnknownValueError`: Возникает, когда Google Speech Recognition не может понять аудио.
- `sr.RequestError`: Возникает, когда не удается запросить результаты от сервиса Google Speech Recognition.
- `Exception`: Возникает при других ошибках в процессе распознавания речи.

**Как работает функция**:

1.  **Проверка источника аудио**: Проверяется, предоставлен ли URL или локальный путь к аудиофайлу. Если предоставлен URL, файл скачивается и сохраняется во временную директорию.
2.  **Преобразование формата OGG в WAV**: Аудиофайл конвертируется из формата OGG в WAV с использованием библиотеки `pydub`.
3.  **Распознавание речи**: Используется библиотека `speech_recognition` для распознавания речи в аудиофайле. Функция пытается распознать речь, используя Google Speech Recognition.
4.  **Обработка результатов**: В случае успешного распознавания, функция возвращает распознанный текст. Если возникают ошибки, функция логирует их и возвращает соответствующие сообщения об ошибках.

**Примеры**:

```python
recognized_text = speech_recognizer(audio_url='https://example.com/audio.ogg')
print(recognized_text)  # Вывод: "Привет"

recognized_text = speech_recognizer(audio_file_path=Path('/path/to/audio.ogg'), language='en-US')
print(recognized_text)  # Вывод: "Hello"
```

### `text2speech`

**Назначение**: Преобразование текста в речь и сохранение его в виде аудиофайла.

**Параметры**:

- `text` (str): Текст для преобразования в речь.
- `lang` (str, optional): Языковой код для речи (например, 'ru'). По умолчанию 'ru'.

**Возвращает**:

- `str`: Путь к сгенерированному аудиофайлу.

**Вызывает исключения**:

- `Exception`: Возникает при ошибках в процессе преобразования текста в речь.

**Как работает функция**:

1.  **Генерация речи**: Используется библиотека `gTTS` для генерации речи из заданного текста на указанном языке.
2.  **Сохранение аудиофайла**: Сгенерированный аудиофайл сохраняется во временную директорию в формате MP3.
3.  **Преобразование формата MP3 в WAV**: Аудиофайл конвертируется из формата MP3 в WAV с использованием библиотеки `pydub`.
4.  **Логирование и возврат пути**: Функция логирует путь к сохраненному аудиофайлу и возвращает его.

**Примеры**:

```python
import asyncio

async def main():
    audio_path = await text2speech('Привет', lang='ru')
    print(audio_path)  # Вывод: "/tmp/response.mp3"

    audio_path = await text2speech('Hello', lang='en')
    print(audio_path)

asyncio.run(main())
# Модуль для преобразования речи в текст и текста в речь

## Обзор

Модуль `tts.py` предоставляет функции для распознавания речи из аудиофайлов и преобразования текста в речь. Он использует библиотеки `speech_recognition` для распознавания речи и `gTTS` для преобразования текста в речь.

## Подробней

Этот модуль содержит две основные функции: `speech_recognizer` и `text2speech`. Функция `speech_recognizer` позволяет распознавать речь из аудиофайла, расположенного по URL-адресу или локальному пути. Функция `text2speech` преобразует заданный текст в речь и сохраняет его в виде аудиофайла.
Распознование и преобразование необходимо для реализации голосового ассистента

## Функции

### `speech_recognizer`

**Назначение**: Распознавание речи из аудиофайла по URL или локальному пути.

**Параметры**:

-   `audio_url` (str, optional): URL-адрес аудиофайла для скачивания. По умолчанию `None`.
-   `audio_file_path` (Path, optional): Локальный путь к аудиофайлу. По умолчанию `None`.
-   `language` (str): Языковой код для распознавания (например, 'ru-RU'). По умолчанию 'ru-RU'.

**Возвращает**:

-   `str`: Распознанный текст из аудио или сообщение об ошибке.

**Вызывает исключения**:

-   `sr.UnknownValueError`: Если Google Speech Recognition не может понять аудио.
-   `sr.RequestError`: Если не удается получить результаты от сервиса Google Speech Recognition.
-   `Exception`: При возникновении ошибки в процессе распознавания речи.

**Как работает функция**:

1.  Функция `speech_recognizer` принимает URL-адрес или локальный путь к аудиофайлу, который необходимо распознать.
2.  Если предоставлен URL-адрес, функция скачивает аудиофайл и сохраняет его во временном каталоге.
3.  Затем аудиофайл конвертируется из формата OGG в формат WAV, который поддерживается библиотекой `speech_recognition`.
4.  Инициализируется объект `Recognizer` из библиотеки `speech_recognition`.
5.  Аудиофайл открывается как источник аудиоданных, и функция записывает аудиоданные с помощью метода `record()`.
6.  Функция пытается распознать речь, используя Google Speech Recognition, передавая аудиоданные и языковой код.
7.  Если распознавание прошло успешно, функция возвращает распознанный текст.
8.  Если Google Speech Recognition не может понять аудио, функция регистрирует ошибку и возвращает сообщение об ошибке.
9.  Если не удается получить результаты от сервиса Google Speech Recognition, функция регистрирует ошибку и возвращает сообщение об ошибке.
10. Если во время процесса возникает какое-либо другое исключение, функция регистрирует ошибку и возвращает сообщение об ошибке.

**Примеры**:

```python
from pathlib import Path
from src.utils.convertors.tts import speech_recognizer

# Пример с использованием URL-адреса аудиофайла
recognized_text = speech_recognizer(audio_url='https://example.com/audio.ogg')
print(recognized_text)

# Пример с использованием локального пути к аудиофайлу
recognized_text = speech_recognizer(audio_file_path=Path('/path/to/audio.ogg'))
print(recognized_text)
```

### `text2speech`

**Назначение**: Преобразование текста в речь и сохранение его в виде аудиофайла.

**Параметры**:

-   `text` (str): Текст для преобразования в речь.
-   `lang` (str, optional): Языковой код для речи (например, 'ru'). По умолчанию 'ru'.

**Возвращает**:

-   `str`: Путь к сгенерированному аудиофайлу.

**Вызывает исключения**:

-   `Exception`: При возникновении ошибки в процессе преобразования текста в речь.

**Как работает функция**:

1.  Функция `text2speech` принимает текст, который необходимо преобразовать в речь, и языковой код.
2.  Создается объект `gTTS` из библиотеки `gTTS` с заданным текстом и языковым кодом.
3.  Функция сохраняет сгенерированную речь в виде аудиофайла в формате MP3 во временном каталоге.
4.  Затем аудиофайл загружается с использованием `AudioSegment` из библиотеки `pydub`.
5.  Аудиофайл конвертируется из формата MP3 в формат WAV.
6.  Функция регистрирует информацию о том, где сохранен аудиофайл, и возвращает путь к аудиофайлу.
7.  Если во время процесса возникает какое-либо исключение, функция регистрирует ошибку и возвращает сообщение об ошибке.

**Примеры**:

```python
import asyncio
from src.utils.convertors.tts import text2speech

# Пример преобразования текста в речь
async def main():
    audio_path = await text2speech('Привет', lang='ru')
    print(audio_path)

asyncio.run(main())
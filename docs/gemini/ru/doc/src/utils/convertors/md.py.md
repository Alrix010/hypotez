# Модуль `md2dict`

## Обзор

Модуль предназначен для конвертации Markdown-строк в структурированные словари, а также для преобразования Markdown в HTML. Он использует библиотеку `markdown2` для обработки Markdown-разметки и `re` для работы с регулярными выражениями при извлечении информации.

## Подробней

Этот модуль предоставляет функциональность для преобразования Markdown-текста в HTML и структурированный словарь. Он полезен для обработки и анализа Markdown-контента, позволяя извлекать информацию о структуре документа, такую как заголовки и содержимое разделов. Модуль использует библиотеку `markdown2` для конвертации Markdown в HTML и регулярные выражения для извлечения структуры документа.

## Функции

### `md2html`

**Назначение**: Преобразует строку в формате Markdown в HTML-формат.

```python
def md2html(md_string: str, extras: List[str] = None) -> str:
    """
    Конвертирует строку Markdown в HTML.

    Args:
        md_string (str): Строка Markdown для конвертации.
        extras (list, optional): Список расширений markdown2. Defaults to None.

    Returns:
        str: HTML-представление Markdown.
    """
    ...
```

**Параметры**:

-   `md_string` (str): Строка, содержащая текст в формате Markdown, который необходимо преобразовать в HTML.
-   `extras` (List[str], optional): Список расширений, используемых библиотекой `markdown2` для расширения функциональности преобразования Markdown. По умолчанию `None`.

**Возвращает**:

-   `str`: Строка, содержащая HTML-представление входной Markdown-строки. В случае возникновения ошибки возвращает пустую строку.

**Вызывает исключения**:

-   `Exception`: Если происходит ошибка во время преобразования Markdown в HTML. Информация об ошибке логируется с использованием `logger.error`.

**Как работает функция**:

1.  Функция принимает Markdown-строку и необязательный список расширений для `markdown2`.
2.  Пытается преобразовать Markdown-строку в HTML с использованием функции `markdown` из библиотеки `markdown2`.
3.  В случае успеха возвращает HTML-представление Markdown.
4.  Если происходит ошибка, логирует сообщение об ошибке и возвращает пустую строку.

**Примеры**:

```python
from src.utils.convertors.md import md2html
# Пример 1: Преобразование простой Markdown-строки в HTML
markdown_text = "# Заголовок 1\nЭто простой текст."
html_output = md2html(markdown_text)
print(html_output)
# Вывод: '<h1 id="заголовок-1">Заголовок 1</h1>\n<p>Это простой текст.</p>\n'

# Пример 2: Преобразование Markdown-строки с использованием расширений
markdown_text = "```python\nprint('Hello, World!')\n```"
html_output = md2html(markdown_text, extras=['fenced-code-blocks'])
print(html_output)
# Вывод: '<div class="codehilite"><pre><span></span><code>print(\'Hello, World!\')\n</code></pre></div>\n'
```

### `md2dict`

**Назначение**: Преобразует строку в формате Markdown в структурированный словарь, где ключами являются заголовки, а значениями - списки содержимого разделов.

```python
def md2dict(md_string: str, extras: List[str] = None) -> Dict[str, list[str]]:
    """
    Конвертирует строку Markdown в структурированный словарь.

    Args:
        md_string (str): Строка Markdown для конвертации.
        extras (list, optional): Список расширений markdown2 для md2html. Defaults to None.

    Returns:
         Dict[str, list[str]]: Структурированное представление Markdown содержимого.
    """
    ...
```

**Параметры**:

-   `md_string` (str): Строка, содержащая текст в формате Markdown, который необходимо преобразовать в словарь.
-   `extras` (List[str], optional): Список расширений, используемых `markdown2` для расширения функциональности преобразования Markdown. Используется при преобразовании Markdown в HTML. По умолчанию `None`.

**Возвращает**:

-   `Dict[str, list[str]]`: Словарь, где ключи - это заголовки разделов (строки), а значения - списки строк, представляющих содержимое этих разделов. В случае ошибки возвращает пустой словарь.

**Вызывает исключения**:

-   `Exception`: Если происходит ошибка во время парсинга Markdown в структурированный словарь. Информация об ошибке логируется с использованием `logger.error`.

**Как работает функция**:

1.  Функция принимает Markdown-строку и необязательный список расширений для `markdown2`.
2.  Преобразует Markdown-строку в HTML с использованием функции `md2html`.
3.  Инициализирует пустой словарь `sections` для хранения структуры документа.
4.  Разбивает HTML-код на строки и итерируется по ним.
5.  Если строка начинается с тега заголовка (`<h`), извлекает уровень заголовка и текст заголовка.
6.  Если уровень заголовка равен 1, создает новый раздел в словаре `sections` с текстом заголовка в качестве ключа.
7.  Если уровень заголовка больше 1, добавляет текст заголовка в список содержимого текущего раздела.
8.  Если строка содержит текст и находится внутри текущего раздела, очищает строку от HTML-тегов и добавляет её в список содержимого текущего раздела.
9.  Возвращает структурированный словарь, представляющий Markdown-содержимое.
10. В случае возникновения ошибки, информация об ошибке записывается в лог, и возвращается пустой словарь.

**Примеры**:

```python
from src.utils.convertors.md import md2dict

# Пример 1: Преобразование простой Markdown-строки в словарь
markdown_text = """
# Заголовок 1
Это текст раздела 1.

## Заголовок 2
Это текст подраздела.
"""
dict_output = md2dict(markdown_text)
print(dict_output)
# Вывод: {'Заголовок 1': ['Это текст раздела 1.', 'Заголовок 2', 'Это текст подраздела.']}

# Пример 2: Преобразование Markdown-строки с различными элементами
markdown_text = """
# Основной заголовок
Это абзац текста.

## Подзаголовок
- Элемент списка 1
- Элемент списка 2
"""
dict_output = md2dict(markdown_text)
print(dict_output)
# Вывод: {'Основной заголовок': ['Это абзац текста.', 'Подзаголовок', '- Элемент списка 1', '- Элемент списка 2']}
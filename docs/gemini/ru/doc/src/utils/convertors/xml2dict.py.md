# Модуль для преобразования XML в словарь

## Обзор

Модуль `src.utils.convertors.xml2dict.py` предоставляет набор функций для преобразования данных XML в словари. Он включает в себя функции для разбора строк XML и преобразования деревьев элементов XML в представления словарей.

## Описание

Этот модуль используется для обработки и преобразования XML-данных в более удобный для работы формат - словари. 

- `xml2dict` - функция, которая принимает строку XML в качестве входных данных и возвращает словарь, представляющий структуру XML-документа.
- `ET2dict` - функция, которая принимает дерево элементов XML (ET.Element) в качестве входных данных и возвращает словарь, представляющий структуру XML-документа.
- `_parse_node` - рекурсивная функция, которая разбирает узел XML и возвращает словарь, представляющий этот узел. 
- `_make_dict` - функция, которая создает новый словарь с тегом и значением.

## Классы

### Нет классов

## Функции

### `_parse_node`

**Назначение**: Парсинг узла XML в словарь.

**Параметры**:
- `node` (ET.Element): Узел XML для разбора.

**Возвращает**:
- `dict | str`: Словарь, представляющий узел XML, или строка, если узел не имеет атрибутов или дочерних элементов.

**Вызывает исключения**:
- Нет

**Принцип работы**:
- Функция `_parse_node` принимает узел XML и разбирает его в словарь.
- Она сначала создает пустой словарь `tree` для хранения результатов разбора. 
- Далее она обрабатывает атрибуты узла. 
- Она пропускает атрибуты `href`, так как они не поддерживаются при преобразовании в словарь. 
- Функция использует функцию `_make_dict` для создания словаря атрибутов. 
- Если у узла есть текст, она извлекает его и записывает в словарь.
- Затем она обрабатывает дочерние элементы узла, рекурсивно вызывая себя.
- Для каждого дочернего элемента она вызывает функцию `_parse_node`, чтобы получить словарь, представляющий этот дочерний элемент.
- Если дочерний элемент имеет атрибуты или дочерние элементы, она записывает их в словарь `tree`. 
- Если дочерний элемент не имеет атрибутов или дочерних элементов, она записывает его значение в словарь `tree`.
- После обработки всех дочерних элементов она возвращает словарь `tree`.

**Пример**:
```python
from xml.etree.ElementTree import fromstring

xml_string = """
<root>
  <child1 attr1="value1" attr2="value2">
    <child2>Value 2</child2>
  </child1>
  <child3>Value 3</child3>
</root>
"""

element_tree = fromstring(xml_string)
tree = _parse_node(element_tree)

pprint(tree, text_color='green')
```

### `_make_dict`

**Назначение**: Создание нового словаря с тегом и значением.

**Параметры**:
- `tag` (str): Имя тега элемента XML.
- `value` (any): Значение, связанное с тегом.

**Возвращает**:
- `dict`: Словарь с именем тега в качестве ключа и значением в качестве значения словаря.

**Вызывает исключения**:
- Нет

**Принцип работы**:
- Функция `_make_dict` принимает имя тега и значение и создает новый словарь. 
- Если тег содержит пространство имен, она извлекает пространство имен и имя тега. 
- Затем она создает словарь, где ключ - это имя тега, а значение - это значение, связанное с тегом.
- Если тег содержит пространство имен, она добавляет в словарь ключ `xmlns` с пространством имен.
- Функция возвращает созданный словарь.

**Пример**:
```python
tag = '{http://www.w3.org/1999/xlink}href'
value = 'https://example.com'
tree = _make_dict(tag, value)

pprint(tree, text_color='green')
```

### `xml2dict`

**Назначение**: Преобразование строки XML в словарь.

**Параметры**:
- `xml` (str): Строка XML для разбора.

**Возвращает**:
- `dict`: Словарь, представляющий XML.

**Вызывает исключения**:
- Нет

**Принцип работы**:
- Функция `xml2dict` принимает строку XML и преобразует ее в словарь. 
- Она сначала использует `ET.fromstring` для создания дерева элементов XML из строки XML.
- Затем она вызывает функцию `ET2dict`, чтобы преобразовать дерево элементов в словарь.
- Функция возвращает полученный словарь.

**Пример**:
```python
xml_string = """
<root>
  <child1 attr1="value1" attr2="value2">
    <child2>Value 2</child2>
  </child1>
  <child3>Value 3</child3>
</root>
"""

tree = xml2dict(xml_string)
pprint(tree, text_color='green')
```

### `ET2dict`

**Назначение**: Преобразование дерева элементов XML в словарь.

**Параметры**:
- `element_tree` (ET.Element): Дерево элементов XML.

**Возвращает**:
- `dict`: Словарь, представляющий дерево элементов XML.

**Вызывает исключения**:
- Нет

**Принцип работы**:
- Функция `ET2dict` принимает дерево элементов XML и преобразует его в словарь.
- Она использует функцию `_make_dict` для создания словаря с именем тега и значениями, полученными с помощью функции `_parse_node`.
- Функция возвращает полученный словарь.

**Пример**:
```python
from xml.etree.ElementTree import fromstring

xml_string = """
<root>
  <child1 attr1="value1" attr2="value2">
    <child2>Value 2</child2>
  </child1>
  <child3>Value 3</child3>
</root>
"""

element_tree = fromstring(xml_string)
tree = ET2dict(element_tree)

pprint(tree, text_color='green')
```

## Примеры

```python
from xml.etree.ElementTree import fromstring
from src.utils.convertors.xml2dict import xml2dict

xml_string = """
<root>
  <child1 attr1="value1" attr2="value2">
    <child2>Value 2</child2>
  </child1>
  <child3>Value 3</child3>
</root>
"""

tree = xml2dict(xml_string)
pprint(tree, text_color='green')
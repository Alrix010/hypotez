# Модуль преобразования PNG изображений

## Обзор

Модуль `src.utils.convertors.png` предоставляет набор инструментов для генерации PNG изображений из текстовых строк. В его основе лежит класс `TextToImageGenerator`, который позволяет настраивать различные параметры изображения, такие как размер, цвет фона, цвет текста, шрифт и т. д. Модуль также включает функцию `webp2png` для преобразования изображений WEBP в PNG. 

## Подробности

Модуль `src.utils.convertors.png` предназначен для преобразования текстовых данных в PNG изображения. Он используется для создания визуальных представлений текста, где каждая строка текста отображается на отдельном изображении. 

## Классы

### `TextToImageGenerator`

**Описание**: Класс `TextToImageGenerator` обеспечивает функциональность для генерации PNG изображений из текстовых строк. Он предлагает различные настройки для настройки внешнего вида изображения, такие как размер, отступы, цвет фона, цвет текста, шрифт и т. д.

**Атрибуты**:

- `default_output_dir` (Path): Путь по умолчанию для сохранения выходных PNG файлов.
- `default_canvas_size` (Tuple[int, int]): Размер холста по умолчанию в пикселях.
- `default_padding` (float): Процентное соотношение размера холста, которое используется в качестве пустого поля.
- `default_background` (str): Цвет фона по умолчанию.
- `default_text_color` (str): Цвет текста по умолчанию.
- `default_log_level` (str): Уровень ведения журнала по умолчанию.

**Методы**:

- `assign_path`: Определяет правильный путь для выходных PNG файлов, создавая каталог, если это необходимо.
- `center_text_position`: Вычисляет позицию для центрирования текста на холсте.
- `generate_png`: Создает PNG изображение с заданным текстом, шрифтом, цветами и т. д.
- `not_comment_or_blank`: Проверяет, является ли строка ни комментарием, ни пустой.
- `which_exist`: Проверяет, какие имена файлов уже существуют в каталоге.
- `get_characters`: Извлекает строки текста из входного файла или списка, отфильтровывая комментарии и пустые строки.
- `parse_size`: Разбирает строку в объект `Size`.
- `get_max_text_size`: Вычисляет максимальный размер текста на основе шрифта и строк текста.
- `get_font`: Определяет размер шрифта на основе размера холста и отступов.
- `setup_logging`: Настраивает ведение журнала на основе заданного уровня ведения журнала.
- `error`: Записывает сообщение об ошибке в журнал и вызывает исключение.
- `overlay_images`: Накладывает одно PNG изображение поверх другого.

**Принцип работы**:

Класс `TextToImageGenerator` работает следующим образом:

1. **Инициализация**: При создании экземпляра класса `TextToImageGenerator` устанавливаются значения по умолчанию для различных параметров.
2. **Генерация изображений**: Метод `generate_images` принимает список строк, а также необязательные параметры для настройки внешнего вида изображения, такие как размер холста, отступы, цвета фона и текста, шрифт и т. д. Он создает отдельный PNG файл для каждой строки текста, используя метод `generate_png`.
3. **Создание изображения**: Метод `generate_png` создает новое изображение, задавая размер холста и цвет фона. Затем он рассчитывает позицию для центрирования текста на холсте, используя метод `center_text_position`. Наконец, он добавляет текст на изображение, используя метод `ImageDraw.Draw.text`.
4. **Центрирование текста**: Метод `center_text_position` вычисляет позицию, чтобы центрировать текст на холсте. Он использует метод `ImageDraw.Draw.textsize` для получения размера текста и затем вычисляет координаты, которые будут использоваться для центрирования текста на холсте.
5. **Накладывание изображений**: Метод `overlay_images` позволяет накладывать одно PNG изображение поверх другого. Он принимает пути к фоновому изображению и накладываемому изображению, а также необязательные параметры для определения позиции и прозрачности накладываемого изображения. Он использует метод `Image.paste` для объединения двух изображений.

**Примеры**:

```python
from src.utils.convertors.png import TextToImageGenerator

# Создание экземпляра класса
generator = TextToImageGenerator()

# Генерация изображений
lines = ["Text 1", "Text 2", "Text 3"]
output_dir = "./output"
images = await generator.generate_images(lines, output_dir=output_dir)
print(images)
# Вывод: [PosixPath('./output/Text 1.png'), PosixPath('./output/Text 2.png'), PosixPath('./output/Text 3.png')]
```

## Функции

### `webp2png`

**Назначение**: Функция `webp2png` преобразует изображение WEBP в формат PNG.

**Параметры**:

- `webp_path` (str): Путь к входному файлу WEBP.
- `png_path` (str): Путь для сохранения преобразованного PNG файла.

**Возвращает**:

- `bool`: Возвращает `True`, если преобразование прошло успешно, иначе `False`.

**Вызывает исключения**:

- `Exception`: Если возникает ошибка во время преобразования.

**Как работает функция**:

Функция `webp2png` открывает изображение WEBP с помощью модуля `PIL.Image` и затем сохраняет его в формате PNG с помощью метода `Image.save`. 

**Примеры**:

```python
from src.utils.convertors.png import webp2png

# Преобразование файла WEBP в PNG
webp2png('image.webp', 'image.png')
```

## Параметры

- `lines` (List[str]): Список строк, из которых будут сгенерированы изображения.
- `output_dir` (str | Path): Путь к каталогу для сохранения выходных изображений.
- `font` (str | ImageFont.ImageFont): Шрифт, который будет использоваться для текста.
- `canvas_size` (Tuple[int, int]): Размер холста в пикселях.
- `padding` (float): Процентное соотношение размера холста, которое используется в качестве пустого поля.
- `background_color` (str): Цвет фона для изображений.
- `text_color` (str): Цвет текста.
- `log_level` (int | str | bool): Уровень ведения журнала.
- `clobber` (bool): Если `True`, перезаписывает существующие файлы.


## Примеры

```python
from src.utils.convertors.png import TextToImageGenerator

# Создание экземпляра класса TextToImageGenerator
generator = TextToImageGenerator()

# Список строк для преобразования
lines = ["Text 1", "Text 2", "Text 3"]

# Каталог для сохранения выходных изображений
output_dir = "./output"

# Генерация изображений
images = await generator.generate_images(lines, output_dir=output_dir)
print(images)
# Вывод: [PosixPath('./output/Text 1.png'), PosixPath('./output/Text 2.png'), PosixPath('./output/Text 3.png')]
```

```python
from src.utils.convertors.png import webp2png

# Преобразование файла WEBP в PNG
webp2png('image.webp', 'image.png')
```

```python
from src.utils.convertors.png import TextToImageGenerator

# Создание экземпляра класса TextToImageGenerator
generator = TextToImageGenerator()

# Список строк для преобразования
lines = ["Text 1", "Text 2", "Text 3"]

# Каталог для сохранения выходных изображений
output_dir = "./output"

# Создание изображений с заданными параметрами
images = await generator.generate_images(
    lines,
    output_dir=output_dir,
    canvas_size=(512, 512),
    padding=0.2,
    background_color="lightblue",
    text_color="darkblue",
    font="arial.ttf",
)
print(images)
# Вывод: [PosixPath('./output/Text 1.png'), PosixPath('./output/Text 2.png'), PosixPath('./output/Text 3.png')]
```
```markdown
# Модуль `ai_string_utils.py`

## Обзор

Модуль предоставляет утилиты для обработки и нормализации строк, используемых при обучении моделей искусственного интеллекта и обработки ответов от этих моделей. Включает функции для подготовки текстовых данных к обучению (например, экранирование кавычек и удаление лишних пробелов) и для нормализации ответов, полученных от языковых моделей (например, удаление обрамляющих блоков кода).

## Подробней

Этот модуль содержит функции для очистки и подготовки текстовых данных, используемых в задачах машинного обучения и обработки естественного языка. Он включает в себя инструменты для экранирования специальных символов, удаления избыточных пробелов и нормализации структуры текста. Модуль предназначен для упрощения процесса подготовки данных и обеспечения их соответствия требованиям различных алгоритмов и моделей.

## Функции

### `string_for_train`

```python
def string_for_train(data: Union[str, List[str]]) -> str:
    """
    Очищает и форматирует данные для обучения. Удаляет повторяющиеся пробелы.

    Экранирует двойные кавычки (`"`) символом обратной косой черты (`\\\\`)
    и заменяет множественные пробельные символы одним пробелом.
    Удаляет начальные и конечные пробелы.

    Args:
        data (Union[str, List[str]]): Входные данные. Могут быть строкой или
                                      списком строк.

    Returns:
        str: Очищенная и объединенная строка (если на входе был список),
             готовая для использования в обучении. Возвращает пустую строку,
             если тип входных данных не строка и не список строк.

    Examples:
        >>> string_for_train('   Это  строка   с "кавычками"   и    пробелами. ')
        'Это строка с \\\\"кавычками\\\\" и пробелами.'
        >>> string_for_train(['Первая строка.', '   Вторая "строка"   с пробелами.'])
        'Первая строка. Вторая \\\\"строка\\\\" с пробелами.'
        >>> string_for_train(None)
        ''
        >>> string_for_train(123)
        ''
    """
    ...
```

**Назначение**: Функция `string_for_train` предназначена для очистки и подготовки текстовых данных, используемых для обучения моделей машинного обучения. Она выполняет экранирование двойных кавычек, удаление лишних пробелов и нормализацию входных данных, чтобы обеспечить их пригодность для использования в обучающих наборах.

**Параметры**:

-   `data` (Union[str, List[str]]): Входные данные, которые могут быть строкой или списком строк.

**Возвращает**:

-   `str`: Очищенная и отформатированная строка, готовая для использования в обучении. Если на входе был список строк, функция объединяет их в одну строку. В случае некорректного типа входных данных возвращает пустую строку.

**Как работает функция**:

1.  **Проверка типа данных**: Функция проверяет, является ли входной параметр `data` строкой или списком строк.
2.  **Обработка строки**: Если `data` является строкой, функция экранирует двойные кавычки символом обратной косой черты (`\\\\`), заменяет множественные пробелы одним пробелом и удаляет начальные и конечные пробелы.
3.  **Обработка списка строк**: Если `data` является списком строк, функция обрабатывает каждый элемент списка, выполняя экранирование кавычек и нормализацию пробелов. Затем объединяет все элементы списка в одну строку, разделяя их пробелами.
4.  **Обработка некорректных данных**: Если `data` не является строкой или списком строк, функция возвращает пустую строку.

**Примеры**:

```python
>>> string_for_train('   Это  строка   с "кавычками"   и    пробелами. ')
'Это строка с \\\\"кавычками\\\\" и пробелами.'
>>> string_for_train(['Первая строка.', '   Вторая "строка"   с пробелами.'])
'Первая строка. Вторая \\\\"строка\\\\" с пробелами.'
>>> string_for_train(None)
''
>>> string_for_train(123)
''
```

### `normalize_answer`

```python
def normalize_answer(text: str) -> str:
    """
    Нормализует текстовый ответ, удаляя обрамляющие блоки кода markdown.

    Проверяет, начинается ли строка `text` одним из префиксов из списка
    `_NORMALIZER_PREFIXES` (например, '```html\\\\n', '```markdown', '```')
    и заканчивается ли она суффиксом `_NORMALIZER_SUFFIX` ('```').
    Если оба условия выполняются, удаляет соответствующий префикс и суффикс.
    В противном случае возвращает исходную строку без изменений.

    Args:
        text (str): Исходная строка текста, потенциально содержащая
                    обрамляющие блоки кода.

    Returns:
        str: Нормализованная строка без начального и конечного блоков кода,
             либо исходная строка, если блоки не найдены.

    Examples:
        >>> normalize_answer("```html\\\\n<p>Пример</p>\\\\n```")
        '<p>Пример</p>\\\\n'
        >>> normalize_answer("```markdown\\n# Заголовок\\nТекст.\\n```")
        '# Заголовок\\\\nТекст.\\\\n'
        >>> normalize_answer("```\\nПросто текст\\n```")
        'Просто текст\\\\n'
        >>> normalize_answer("Обычный текст без блоков.")
        'Обычный текст без блоков.'
        >>> normalize_answer("```Неполный блок")
        '```Неполный блок'
        >>> normalize_answer("Блок в конце```")
        'Блок в конце```'
        >>> normalize_answer("```json\\n{\\"key\\": \\"value\\"}\\n```")
        '{\\"key\\": \\"value\\"}\\n'
        >>> normalize_answer("```md Текст```") # Пример с пробелом после md
        'Текст'
    """
    ...
```

**Назначение**: Функция `normalize_answer` предназначена для нормализации текстовых ответов, полученных от языковых моделей. Она удаляет обрамляющие блоки кода Markdown, такие как `` `html\n` ``, чтобы выделить полезное содержимое ответа.

**Параметры**:

-   `text` (str): Исходная строка текста, которая может содержать обрамляющие блоки кода.

**Возвращает**:

-   `str`: Нормализованная строка без начальных и конечных блоков кода, либо исходная строка, если блоки не найдены.

**Как работает функция**:

1.  **Проверка типа данных**: Функция проверяет, является ли входной параметр `text` строкой. Если нет, возвращает пустую строку.
2.  **Удаление префиксов и суффиксов**: Функция итерируется по списку префиксов `_NORMALIZER_PREFIXES` и проверяет, начинается ли строка `text` с одного из этих префиксов и заканчивается ли суффиксом `_NORMALIZER_SUFFIX`. Если оба условия выполняются, функция удаляет соответствующий префикс и суффикс из строки.
3.  **Возврат результата**: Функция возвращает нормализованную строку без обрамляющих блоков кода или исходную строку, если блоки не были найдены.

**Примеры**:

```python
>>> normalize_answer("```html\\n<p>Пример</p>\\n```")
'<p>Пример</p>\\n'
>>> normalize_answer("```markdown\\n# Заголовок\\nТекст.\\n```")
'# Заголовок\\\\nТекст.\\\\n'
>>> normalize_answer("```\\nПросто текст\\n```")
'Просто текст\\\\n'
>>> normalize_answer("Обычный текст без блоков.")
'Обычный текст без блоков.'
>>> normalize_answer("```Неполный блок")
'```Неполный блок'
>>> normalize_answer("Блок в конце```")
'Блок в конце```'
>>> normalize_answer("```json\\n{\\"key\\": \\"value\\"}\\n```")
'{\\"key\\": \\"value\\"}\\n'
>>> normalize_answer("```md Текст```") # Пример с пробелом после md
'Текст'
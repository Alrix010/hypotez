# Модуль для работы с XML
==========================

Модуль содержит функции для очистки, форматирования и сохранения XML-данных.

## Обзор

Модуль `src.utils.xml` предоставляет инструменты для работы с XML-данными, включая очистку от пустых элементов и CDATA-секций, а также сохранение XML в файл с отступами для улучшения читаемости.

## Подробней

Этот модуль предназначен для обработки XML-данных, которые могут содержать лишние пробелы или пустые элементы, затрудняющие их обработку и анализ. Функции модуля позволяют очистить XML от ненужной информации и сохранить его в удобном для чтения формате.

## Функции

### `clean_empty_cdata`

```python
def clean_empty_cdata(xml_string: str) -> str:
    """ Функция очищает пустые CDATA секции и лишние пробелы в XML строке.

    Args:
        xml_string (str): XML контент в виде строки.

    Returns:
        str: Очищенный и форматированный XML контент.
    """
```

**Назначение**: Очистка XML от пустых элементов и лишних пробелов.

**Параметры**:
- `xml_string` (str): XML контент в виде строки.

**Возвращает**:
- `str`: Очищенный и форматированный XML контент.

**Как работает функция**:
1.  Парсит XML-строку в дерево элементов с помощью `ET.fromstring()`.
2.  Определяет внутреннюю рекурсивную функцию `remove_empty_elements`, которая обходит дерево элементов и удаляет пустые элементы. Элемент считается пустым, если у него нет текста (или текст состоит только из пробелов), нет атрибутов и нет дочерних элементов.
3.  Вызывает функцию `remove_empty_elements` для корневого элемента дерева.
4.  Преобразует очищенное дерево элементов обратно в XML-строку с помощью `ET.tostring()`.
5.  Удаляет лишние пробелы между тегами с помощью регулярного выражения `re.sub(r">\s+<", "><", cleaned_xml)`.
6.  Возвращает очищенную и отформатированную XML-строку.

**Внутренние функции**:

### `remove_empty_elements`
```python
    def remove_empty_elements(element):
        """ Функция удаляет пустые элементы из XML.

            Args:
                element: Элемент XML.

            Returns:
                None
        """
```
**Назначение**: Рекурсивно удаляет пустые элементы из XML-дерева.

**Параметры**:

*   `element`: XML элемент для проверки.

**Как работает функция**:

1.  Функция рекурсивно обходит всех детей переданного элемента
2.  Если элемент не содержит текста, атрибутов и дочерних элементов - он удаляется из дерева.

**Примеры**:

```python
xml_data = "<root><item>Value</item><empty></empty></root>"
cleaned_xml = clean_empty_cdata(xml_data)
print(cleaned_xml)  # Вывод: <root><item>Value</item></root>
```

### `save_xml`

```python
def save_xml(xml_string: str, file_path: str) -> None:
    """ Функция сохраняет очищенные XML данные из строки в файл с отступами.

    Args:
        xml_string (str): XML контент в виде строки.
        file_path (str): Путь к выходному файлу.

    Returns:
        None
    """
```

**Назначение**: Сохранение XML-данных в файл с отступами.

**Параметры**:
- `xml_string` (str): XML контент в виде строки.
- `file_path` (str): Путь к выходному файлу.

**Как работает функция**:
1.  Очищает XML-строку от пустых элементов с помощью функции `clean_empty_cdata()`.
2.  Парсит очищенную XML-строку в дерево элементов с помощью `ET.fromstring()`.
3.  Преобразует дерево элементов в строку с отступами с помощью `minidom.parseString()` и `toprettyxml()`.
4.  Записывает отформатированную XML-строку в файл, указанный в параметре `file_path`.

**Примеры**:

```python
xml_data = "<root><item>Value</item><item attr="test">Another</item></root>"
save_xml(xml_data, "output.xml")
```
В результате выполнения данного кода будет создан файл `output.xml` с отформатированным XML-содержимым.
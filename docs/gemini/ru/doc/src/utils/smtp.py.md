# Модуль SMTP: отправка и получение email

## Обзор

Модуль `src/utils/smtp.py` предоставляет функции для отправки и получения email с использованием серверов SMTP и IMAP.

## Подробнее

Модуль `src/utils/smtp.py` содержит две основные функции:
  - `send(subject: str = '', body: str = '', to: str = 'one.last.bit@gmail.com') -> bool`: отправляет email с использованием сервера SMTP, указанного в словаре `_connection`. Возвращает `True` в случае успеха, `False` в случае ошибки.
  - `receive(imap_server: str, user: str, password: str, folder: str = 'inbox') -> Optional[List[Dict[str, str]]]`: получает email с сервера IMAP и возвращает их в виде списка словарей. Возвращает `None` в случае ошибки.

## Классы

### `_connection`

**Описание**: Словарь, содержащий настройки для подключения к SMTP-серверу.

**Атрибуты**:

- `server` (str): Адрес SMTP-сервера.
- `port` (int): Порт SMTP-сервера.
- `user` (str): Имя пользователя SMTP-сервера.
- `password` (str): Пароль SMTP-сервера.
- `receiver` (str): Адрес получателя email.

**Важно**: Не храните конфиденциальные данные, такие как имя пользователя и пароль, напрямую в коде. Используйте переменные окружения для безопасного хранения этих данных.

## Функции

### `send(subject: str = '', body: str = '', to: str = 'one.last.bit@gmail.com') -> bool`

**Назначение**: Отправляет email с использованием сервера SMTP.

**Параметры**:

- `subject` (str): Тема email.
- `body` (str): Содержимое email.
- `to` (str): Адрес получателя email.

**Возвращает**:

- `bool`: `True` в случае успешной отправки, `False` в случае ошибки.

**Вызывает исключения**:

- `Exception`: Возникает в случае возникновения ошибки при отправке email.

**Принцип работы**:

1. Создает соединение с SMTP-сервером, используя данные из словаря `_connection`.
2. Устанавливает безопасное соединение TLS.
3. Авторизуется на SMTP-сервере с помощью имени пользователя и пароля.
4. Создает объект `MIMEText` для email, содержащий тему, текст и адрес отправителя.
5. Отправляет email.
6. Закрывает соединение с SMTP-сервером.

**Примеры**:

```python
# Отправка простого email
send(subject='Тестовое сообщение', body='Привет, мир!', to='example@example.com')

# Отправка email с несколькими получателями
send(subject='Тестовое сообщение', body='Привет, мир!', to=['example@example.com', 'another@example.com'])
```

### `receive(imap_server: str, user: str, password: str, folder: str = 'inbox') -> Optional[List[Dict[str, str]]]`

**Назначение**: Получает email с сервера IMAP.

**Параметры**:

- `imap_server` (str): Адрес IMAP-сервера.
- `user` (str): Имя пользователя IMAP-сервера.
- `password` (str): Пароль IMAP-сервера.
- `folder` (str): Папка IMAP-сервера, с которой будут получены email. По умолчанию `inbox`.

**Возвращает**:

- `Optional[List[Dict[str, str]]]`: Список словарей, представляющих email. Возвращает `None` в случае ошибки.

**Вызывает исключения**:

- `Exception`: Возникает в случае возникновения ошибки при получении email.

**Принцип работы**:

1. Создает соединение с IMAP-сервером.
2. Авторизуется на IMAP-сервере с помощью имени пользователя и пароля.
3. Выбирает папку IMAP-сервера, с которой нужно получить email.
4. Получает список идентификаторов email.
5. Для каждого идентификатора email:
  - Получает содержимое email.
  - Парсит полученное содержимое и извлекает тему, отправителя и текст email.
  - Сохраняет информацию об email в виде словаря.
6. Возвращает список словарей, представляющих email.

**Примеры**:

```python
# Получение email из папки "inbox"
emails = receive(imap_server='imap.example.com', user='username', password='password')
if emails:
    for email in emails:
        print(f"Тема: {email['subject']}")
        print(f"Отправитель: {email['from']}")
        print(f"Текст: {email['body']}")
```
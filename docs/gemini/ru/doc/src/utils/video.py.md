# Модуль для работы с видео
==========================

Модуль `src.utils.video` предоставляет асинхронные функции для скачивания и сохранения видеофайлов, а также для получения видеоданных. Он включает обработку ошибок и логирование для обеспечения надежной работы.

## Оглавление
- [Обзор](#обзор)
- [Подробнее](#подробнее)
- [Функции](#функции)
    - [`save_video_from_url`](#save_video_from_url)
    - [`get_video_data`](#get_video_data)
    - [`main`](#main)

## Обзор

Модуль предназначен для работы с видеофайлами, включая их асинхронную загрузку и сохранение, а также чтение данных из видеофайлов.

## Подробнее

Этот модуль предоставляет набор функций для работы с видеофайлами, включая скачивание видео по URL-адресу и сохранение его локально, а также получение данных из видеофайла. Он использует асинхронные операции для повышения эффективности и включает обработку ошибок и логирование для обеспечения надежной работы.

## Функции

### `save_video_from_url`

```python
async def save_video_from_url(url: str, save_path: str) -> Optional[Path]:
    """Скачивает видео по URL-адресу и сохраняет его локально асинхронно.

    Args:
        url (str): URL-адрес, по которому нужно скачать видео.
        save_path (str): Путь для сохранения скачанного видео.

    Returns:
        Optional[Path]: Путь к сохраненному файлу или `None`, если операция не удалась. Возвращает `None` при ошибках и если размер файла равен 0 байт.

    Raises:
        aiohttp.ClientError: При сетевых проблемах во время скачивания.
    """
```

**Назначение**: Функция `save_video_from_url` асинхронно скачивает видеофайл из интернета по предоставленному URL и сохраняет его по указанному пути на локальной файловой системе.

**Параметры**:
- `url` (str): URL-адрес видео, которое требуется скачать.
- `save_path` (str): Локальный путь для сохранения скачанного видеофайла.

**Возвращает**:
- `Optional[Path]`: В случае успешного скачивания и сохранения возвращает объект `Path`, представляющий путь к сохраненному файлу. Если в процессе возникают ошибки (например, сетевые проблемы, ошибки сохранения файла, файл нулевого размера), функция возвращает `None`.

**Вызывает исключения**:
- `aiohttp.ClientError`: Вызывается при возникновении проблем с сетью в процессе скачивания видео.

**Как работает функция**:
1. Функция принимает URL-адрес видео и путь для сохранения.
2. Создает асинхронную сессию с помощью `aiohttp.ClientSession()`.
3. Отправляет GET-запрос по указанному URL-адресу.
4. Проверяет статус ответа на наличие HTTP-ошибок.
5. Создает родительские каталоги, если они не существуют.
6. Открывает файл по указанному пути для записи в бинарном режиме.
7. Читает содержимое ответа частями (размером 8192 байта) и записывает в файл.
8. После завершения скачивания проверяет, был ли файл успешно сохранен и не является ли он пустым.
9. В случае успеха возвращает путь к сохраненному файлу. Если возникают ошибки, логирует их и возвращает `None`.

**Примеры**:

```python
import asyncio
from pathlib import Path
from src.utils.video import save_video_from_url

async def main():
    url = "https://example.com/video.mp4"  # Замените на реальный URL
    save_path = "local_video.mp4"
    result = await save_video_from_url(url, save_path)
    if result:
        print(f"Видео успешно сохранено в {result}")
    else:
        print("Не удалось сохранить видео")

if __name__ == "__main__":
    asyncio.run(main())
```

---

### `get_video_data`

```python
def get_video_data(file_name: str) -> Optional[bytes]:
    """Извлекает бинарные данные видеофайла, если он существует.

    Args:
        file_name (str): Путь к видеофайлу для чтения.

    Returns:
        Optional[bytes]: Бинарные данные файла, если он существует, или `None`, если файл не найден или произошла ошибка.
    """
```

**Назначение**: Функция `get_video_data` предназначена для чтения бинарных данных из указанного видеофайла.

**Параметры**:
- `file_name` (str): Строка, представляющая путь к видеофайлу, который необходимо прочитать.

**Возвращает**:
- `Optional[bytes]`: Если файл существует и успешно прочитан, функция возвращает его содержимое в виде байтовой строки (`bytes`). В случае, если файл не найден или возникает ошибка при чтении, функция возвращает `None`.

**Как работает функция**:
1. Функция принимает путь к файлу.
2. Проверяет существование файла по указанному пути.
3. Если файл не существует, логирует ошибку и возвращает `None`.
4. Если файл существует, пытается открыть его в режиме чтения бинарных данных.
5. Читает все содержимое файла в виде байтовой строки и возвращает его.
6. В случае возникновения ошибки при чтении файла, логирует ошибку и возвращает `None`.

**Примеры**:

```python
from src.utils.video import get_video_data
from pathlib import Path

# Пример использования функции
file_path = "local_video.mp4"  # Замените на путь к существующему видеофайлу

if Path(file_path).exists():
    video_data = get_video_data(file_path)

    if video_data:
        print(f"Длина видеоданных: {len(video_data)} байт")
    else:
        print("Не удалось получить данные из видеофайла")
else:
    print(f"Файл {file_path} не существует")
```

---

### `main`

```python
def main():
    """Функция main для демонстрации работы модуля."""
```

**Назначение**: Функция `main` предназначена для демонстрации работы функций `save_video_from_url`.

**Как работает функция**:
1. Определяет URL-адрес видео и путь для сохранения.
2. Запускает асинхронную функцию `save_video_from_url` для скачивания и сохранения видео.
3. Выводит сообщение об успешном сохранении видео или об ошибке.

**Примеры**:

```python
if __name__ == "__main__":
    main()
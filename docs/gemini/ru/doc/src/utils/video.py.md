# Модуль `src.utils.video`

## Обзор

Модуль `src.utils.video` предоставляет асинхронные функции для загрузки и сохранения видеофайлов, а также для получения видеоданных. Он включает обработку ошибок и логирование для обеспечения надежной работы.

## Подробней

Модуль предоставляет функции для асинхронной загрузки и сохранения видеофайлов, а также для получения данных из видеофайлов. Он предназначен для использования в проектах, где требуется обработка видеоконтента, например, скачивание видео с URL-адреса и сохранение его локально.

## Функции

### `save_video_from_url`

```python
async def save_video_from_url(
    url: str,
    save_path: str
) -> Optional[Path]:
    """Скачивает видео с URL-адреса и асинхронно сохраняет его локально.

    Args:
        url (str): URL-адрес, с которого необходимо скачать видео.
        save_path (str): Путь для сохранения скачанного видео.

    Returns:
        Optional[Path]: Путь к сохраненному файлу или `None`, если операция завершилась неудачно. Возвращает `None` в случае ошибок и если размер файла равен 0 байт.

    Raises:
        aiohttp.ClientError: При сетевых проблемах во время скачивания.

    Как работает функция:
    - Функция принимает URL-адрес видео и путь для сохранения.
    - Создает асинхронную сессию клиента с помощью `aiohttp.ClientSession`.
    - Выполняет GET-запрос к указанному URL-адресу.
    - Проверяет статус ответа HTTP на наличие ошибок.
    - Создает родительские каталоги, если они не существуют.
    - Открывает файл по указанному пути для записи в бинарном режиме.
    - Читает содержимое ответа чанками размером 8192 байта и записывает их в файл.
    - После завершения скачивания проверяет, был ли файл успешно сохранен и не является ли он пустым.
    - Логгирует ошибки, если файл не был сохранен или является пустым.
    - Возвращает путь к сохраненному файлу или `None` в случае ошибки.
    """
    ...
```

**Параметры**:

*   `url` (str): URL-адрес видео для скачивания.
*   `save_path` (str): Локальный путь для сохранения видео.

**Возвращает**:

*   `Optional[Path]`: Путь к сохраненному видеофайлу или `None` в случае неудачи.

**Вызывает исключения**:

*   `aiohttp.ClientError`: При ошибках, связанных с сетью, во время загрузки.

**Примеры**:

```python
import asyncio
async def main():
    url = "https://example.com/video.mp4"  # Замените на актуальный URL
    save_path = "local_video.mp4"
    result = await save_video_from_url(url, save_path)
    if result:
        print(f"Видео сохранено в {result}")
    else:
        print("Не удалось сохранить видео")
asyncio.run(main())
```

### `get_video_data`

```python
def get_video_data(file_name: str) -> Optional[bytes]:
    """Извлекает бинарные данные видеофайла, если он существует.

    Args:
        file_name (str): Путь к видеофайлу для чтения.

    Returns:
        Optional[bytes]: Бинарные данные файла, если он существует, или `None`, если файл не найден или произошла ошибка.

    Как работает функция:
    - Функция принимает путь к видеофайлу.
    - Проверяет существование файла по указанному пути.
    - Открывает файл в бинарном режиме для чтения.
    - Читает все содержимое файла и возвращает его в виде байтовой строки.
    - Логгирует ошибки, если файл не найден или не может быть прочитан.
    - Возвращает `None`, если файл не найден или произошла ошибка.
    """
    ...
```

**Параметры**:

*   `file_name` (str): Путь к видеофайлу.

**Возвращает**:

*   `Optional[bytes]`: Бинарные данные видеофайла или `None` в случае ошибки.

**Примеры**:

```python
data = get_video_data("local_video.mp4")
if data:
    print(data[:10])  # Вывод первых 10 байт для проверки
else:
    print("Не удалось получить данные видео")
```
```python
def main():
    url = "https://example.com/video.mp4"  # Replace with a valid URL!
    save_path = "local_video.mp4"
    result = asyncio.run(save_video_from_url(url, save_path))
    if result:
        print(f"Video saved to {result}")

if __name__ == "__main__":
    main()
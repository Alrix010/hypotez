# Документация FastAPI RPC 

## Обзор

Этот модуль реализует систему удаленного управления FastAPI сервером с использованием XML-RPC. 

## Основные компоненты

### `fast_api_rpc.py` (серверная часть)

#### `FastApiServer`

* **Описание**: Класс, отвечающий за запуск FastAPI сервера.
* **Наследует**: Не наследует.
* **Атрибуты**:
    * `app`: Объект FastAPI, хранящий приложение FastAPI.
    * `port`: Порт, на котором работает сервер.
    * `host`: Хост, на котором работает сервер.
    * `name`: Имя сервера.
* **Методы**:
    * `start_server()`: Запускает FastAPI сервер.
    * `stop_server()`: Останавливает FastAPI сервер.
    * `status_servers()`: Возвращает статус серверов.
    * `add_new_route(url: str, function: Callable)`: Добавляет новый маршрут в FastAPI приложение.

#### `CommandHandler`

* **Описание**: Класс, управляющий вызовами функций управления сервером.
* **Наследует**: Не наследует.
* **Атрибуты**:
    * `rpc_server`: Объект `SimpleXMLRPCServer`, обрабатывающий XML-RPC запросы.
    * `server_list`: Список запущенных серверов.
    * `host`: Хост, на котором работает сервер.
    * `port`: Порт, на котором работает сервер.
* **Методы**:
    * `__init__(self, port: int = 9000, host: str = "0.0.0.0")`: Инициализирует класс.
    * `register_instance(self)`: Регистрирует все методы класса для удаленного вызова через XML-RPC.
    * `start_server(port: int = 8000, host: str = "0.0.0.0")`: Запускает FastAPI сервер.
    * `stop_server(port: int = 8000, host: str = "0.0.0.0")`: Останавливает FastAPI сервер.
    * `stop_all_servers()`: Останавливает все запущенные серверы.
    * `status_servers()`: Возвращает статус всех запущенных серверов.
    * `add_new_route(url: str, function: Callable)`: Добавляет новый маршрут в FastAPI приложение.
    * `shutdown()`: Завершает работу сервера.

### `main.py` (клиентская часть)

#### `ServerProxy`

* **Описание**: Класс из библиотеки `xmlrpc.client`, используемый для создания объекта, через который можно вызывать методы XML-RPC сервера.
* **Наследует**: Не наследует.
* **Атрибуты**: 
    * `rpc_client`: Объект `ServerProxy`, подключенный к XML-RPC серверу.
* **Методы**:
    * `__init__(self)`: Инициализирует класс.
    * `start_server(port: int, host: str)`: Запускает FastAPI сервер.
    * `stop_server(port: int, host: str)`: Останавливает FastAPI сервер.
    * `stop_all_servers()`: Останавливает все запущенные серверы.
    * `status_servers()`: Возвращает статус всех запущенных серверов.
    * `add_new_route(url: str, function: Callable)`: Добавляет новый маршрут в FastAPI приложение.

## Взаимодействие между компонентами

1. **Запуск `fast_api_rpc.py`:**
    * Создается экземпляр `CommandHandler`.
    * В конструкторе `CommandHandler` создается XML-RPC сервер, который начинает слушать порт `9000`.
    * Запускается FastAPI сервер(ы) в соответствии с кодом, который мы создали.
2. **Запуск `main.py`:**
    * Создается экземпляр `ServerProxy`, который подключается к XML-RPC серверу по адресу `http://localhost:9000`.
    * `main.py` начинает показывать меню и ожидать ввода пользователя.
3. **Ввод команды:**
    * `main.py` анализирует введенную строку, выделяет команду и ее аргументы.
    * `main.py` вызывает соответствующий метод RPC-сервера через объект `rpc_client`.
4. **Обработка запроса на сервере:** 
    * XML-RPC сервер в `fast_api_rpc.py` получает этот запрос.
    * Он понимает, что нужно вызвать метод `start_server` у объекта `CommandHandler`.
    * Вызывается метод `start_server`, который запускает FastAPI сервер.
5. **Возврат ответа:** 
    * XML-RPC сервер формирует ответ.
    * Этот ответ отправляется обратно клиенту `main.py`.
6. **Отображение результата:** `main.py` может отобразить результат в консоль.
7. **Повторение цикла:** `main.py` возвращается к началу цикла, отображая меню и ожидая ввода следующей команды.

## Ключевые моменты

* **Разделение ответственности:** `fast_api_rpc.py` отвечает за управление сервером, `main.py` отвечает за взаимодействие с пользователем.
* **XML-RPC:** Используется для организации связи между двумя процессами.
* **Потоки:** XML-RPC сервер запущен в отдельном потоке.
* **Удаленный вызов:** `ServerProxy` позволяет вызывать методы, как если бы они были частью локального кода.

## Преимущества данного подхода

* **Управление сервером из другой программы:** Мы можем контролировать запущенный сервер через другой процесс или даже с другой машины.
* **Разделение кода:** Логика управления сервером и пользовательский интерфейс разделены.
* **Гибкость:** Мы можем добавить новые методы управления сервером.

## Примеры

### Запуск сервера

```python
# main.py
from xmlrpc.client import ServerProxy

rpc_client = ServerProxy("http://localhost:9000", allow_none=True)
rpc_client.start_server(port=8000, host="0.0.0.0") 
```

### Остановка сервера

```python
# main.py
from xmlrpc.client import ServerProxy

rpc_client = ServerProxy("http://localhost:9000", allow_none=True)
rpc_client.stop_server(port=8000, host="0.0.0.0")
```

## Дополнительные сведения

* **`src.utils.string.html_simplification.py`**: Модуль для очистки HTML-тегов из текста и упрощения HTML-кода.
* **`src.logger.logger.py`**: Модуль для логгирования.
* **`src.webdirver`**: Модуль, содержащий классы для работы с веб-драйвером.
* **`src.utils.printer.py`**: Модуль для удобной печати информации.

## Автор 

[Имя автора]
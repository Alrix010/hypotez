# Модуль src.fast_api.external_client

## Обзор

Модуль предоставляет пример XML-RPC клиента для управления Fast API сервером из внешнего кода. Он позволяет запускать, останавливать сервер, добавлять новые маршруты и получать статус серверов через RPC.

## Подробней

Этот модуль используется для взаимодействия с Fast API сервером из внешних приложений, позволяя управлять сервером и его маршрутами удаленно. Это полезно для автоматизации задач, таких как развертывание новых версий API, мониторинг состояния сервера и динамическое изменение маршрутов.

## Функции

### `main`

```python
def main():
    """Основная функция для управления сервером через RPC из внешнего кода."""
```

**Назначение**: 
Функция `main` является основной точкой входа для управления сервером Fast API через XML-RPC. Она создает RPC клиент, выполняет последовательность операций, таких как запуск и остановка сервера, добавление маршрутов и получение статуса, а затем завершает работу RPC сервера.

**Параметры**:
- Отсутствуют

**Возвращает**:
- Ничего (None)

**Вызывает исключения**:
- `Exception`: В случае возникновения каких-либо ошибок при взаимодействии с RPC сервером.

**Как работает функция**:
1. **Инициализация RPC клиента**: Создает экземпляр `ServerProxy` для подключения к RPC серверу по адресу `http://localhost:9000`. Параметр `allow_none=True` позволяет передавать значения `None` в RPC вызовах.
2. **Запуск сервера**: Вызывает метод `start_server` на RPC сервере, чтобы запустить сервер на порту 8001 и IP-адресе "127.0.0.1". После запуска делает паузу в 1 секунду.
3. **Добавление маршрута**: Вызывает метод `add_new_route` для добавления нового маршрута `/test_route`. Маршрут возвращает JSON с сообщением "Hello from test_route".  После добавления маршрута делает паузу в 1 секунду.
4. **Получение статуса сервера**: Вызывает метод `status_servers` для получения текущего статуса серверов. После получения статуса делает паузу в 1 секунду.
5. **Остановка сервера**: Вызывает метод `stop_server` для остановки сервера на порту 8001. После остановки делает паузу в 1 секунду.
6. **Повторное получение статуса сервера**: Повторно вызывает метод `status_servers` для проверки, что сервер был успешно остановлен. После получения статуса делает паузу в 1 секунду.
7. **Обработка исключений**: В случае возникновения исключения, информация об ошибке выводится в консоль.
8. **Завершение работы RPC сервера**: В блоке `finally` вызывается метод `shutdown` для корректного завершения работы RPC сервера, даже если произошла ошибка.

**Примеры**:

Пример запуска клиента для управления сервером:

```python
# Пример вызова функции main
main()
```

В результате выполнения этого кода будут выполнены следующие действия:
- Запуск сервера на порту 8001
- Добавление нового маршрута /test_route
- Получение статуса серверов
- Остановка сервера на порту 8001
- Повторное получение статуса серверов
- Завершение работы RPC сервера
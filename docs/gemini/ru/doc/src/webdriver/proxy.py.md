# Модуль для работы с прокси

## Обзор

Модуль определяет функции для загрузки, парсинга списка прокси и проверки их работоспособности. Он загружает текстовый файл с прокси-адресами и распределяет их по категориям (HTTP, SOCKS4, SOCKS5).

## Подробней

Этот модуль предоставляет функциональность для работы с прокси-серверами, что может быть полезно для обхода географических ограничений, повышения анонимности или балансировки нагрузки при выполнении сетевых запросов. Он включает в себя загрузку списка прокси, парсинг и проверку их доступности.

## Классы

В данном модуле классы не определены. Модуль состоит только из функций.

## Функции

### `download_proxies_list`

```python
def download_proxies_list(url: str = url, save_path: Path = proxies_list_path) -> bool:
    """
    Загружает файл по указанному URL и сохраняет его в заданный путь.

    Args:
        url (str): URL файла для загрузки. По умолчанию используется глобальная переменная `url`.
        save_path (Path): Путь для сохранения загруженного файла. По умолчанию используется глобальная переменная `proxies_list_path`.

    Returns:
        bool: `True`, если операция выполнена успешно, иначе `False`.

    Raises:
        Exception: В случае возникновения ошибки при загрузке или сохранении файла.

    """
```

**Назначение**: Загружает файл со списком прокси-серверов по указанному URL и сохраняет его в локальный файл.

**Параметры**:
- `url` (str): URL-адрес, по которому расположен список прокси-серверов.
- `save_path` (Path): Путь к файлу, в который будет сохранен список прокси-серверов.

**Возвращает**:
- `bool`: Возвращает `True`, если загрузка и сохранение прошли успешно, и `False` в противном случае.

**Вызывает исключения**:
- `requests.exceptions.RequestException`: Возникает при проблемах с HTTP-запросом.
- `IOError`: Возникает при проблемах с записью в файл.

**Как работает функция**:
1. Функция отправляет GET-запрос по указанному URL-адресу для загрузки файла со списком прокси.
2. Проверяется статус ответа HTTP, и в случае ошибки генерируется исключение.
3. Если запрос успешен, содержимое ответа записывается в файл по указанному пути.
4. В случае возникновения каких-либо исключений, они перехватываются, логируются, и функция возвращает `False`.

### `get_proxies_dict`

```python
def get_proxies_dict(file_path: Path = proxies_list_path) -> Dict[str, List[Dict[str, Any]]]:
    """
    Парсит файл с прокси-адресами и распределяет их по категориям.

    Args:
        file_path (Path): Путь к файлу с прокси. По умолчанию используется глобальная переменная `proxies_list_path`.

    Returns:
        Dict[str, List[Dict[str, Any]]]: Словарь, где ключи - типы прокси ('http', 'socks4', 'socks5'), а значения - списки словарей с данными прокси.

    Raises:
        FileNotFoundError: Если файл не найден.
        Exception: В случае возникновения ошибки при парсинге прокси.

    """
```

**Назначение**: Функция парсит файл со списком прокси-серверов, разделяя их по протоколам (http, socks4, socks5) и возвращает словарь, содержащий списки прокси для каждого протокола.

**Параметры**:
- `file_path` (Path): Путь к файлу, содержащему список прокси-серверов. По умолчанию используется глобальная переменная `proxies_list_path`.

**Возвращает**:
- `Dict[str, List[Dict[str, Any]]]`: Словарь, где ключи - это типы прокси ('http', 'socks4', 'socks5'), а значения - списки словарей, каждый из которых содержит информацию о прокси (протокол, хост, порт).

**Вызывает исключения**:
- `FileNotFoundError`: Если указанный файл не существует.
- `Exception`: Если во время парсинга файла произошла ошибка.

**Как работает функция**:
1.  Вызывается функция `download_proxies_list()` для загрузки актуального списка прокси.
2.  Инициализируется пустой словарь `proxies` для хранения распарсенных прокси по категориям.
3.  Функция открывает файл, путь к которому указан в параметре `file_path`, и читает его построчно.
4.  Для каждой строки применяется регулярное выражение для извлечения протокола, хоста и порта прокси-сервера.
5.  Если строка соответствует формату прокси, информация о прокси добавляется в соответствующий список в словаре `proxies`.
6.  В случае возникновения исключений (например, если файл не найден или возникла ошибка при парсинге), они перехватываются и логируются.
7.  После обработки всех строк функция возвращает словарь `proxies`.

### `check_proxy`

```python
def check_proxy(proxy: dict) -> bool:
    """
    Проверяет работоспособность прокси-сервера.
    
    Args:
        proxy (dict): Словарь с данными прокси (host, port, protocol).

    Returns:
        bool: True, если прокси работает, иначе False.

    Raises:
        ProxyError: Если возникает ошибка при подключении к прокси-серверу.
        RequestException: Если возникает ошибка при выполнении запроса.

    """
```

**Назначение**: Проверяет работоспособность указанного прокси-сервера путем отправки запроса на `https://httpbin.org/ip` через этот прокси.

**Параметры**:
- `proxy` (dict): Словарь, содержащий информацию о прокси-сервере, включая `host`, `port` и `protocol`.

**Возвращает**:
- `bool`: Возвращает `True`, если прокси-сервер успешно обрабатывает запрос, и `False` в противном случае.

**Вызывает исключения**:
- `requests.exceptions.ProxyError`: Если возникает ошибка при подключении к прокси-серверу.
- `requests.exceptions.RequestException`: Если возникает другая ошибка при выполнении запроса.

**Как работает функция**:
1. Функция пытается отправить GET-запрос на `https://httpbin.org/ip` через указанный прокси-сервер.
2. Если запрос выполнен успешно и получен ответ со статусом 200, функция логирует информацию об успешной проверке прокси и возвращает `True`.
3. Если запрос не удался (например, получен ответ с другим кодом статуса или возникла ошибка подключения), функция логирует информацию о неудачной проверке и возвращает `False`.
4. В случае возникновения исключений `ProxyError` или `RequestException`, они перехватываются, логируются, и функция возвращает `False`.

**Примеры**:

```python
proxy_data = {'protocol': 'http', 'host': '1.2.3.4', 'port': '8080'}
is_working = check_proxy(proxy_data)
if is_working:
    print("Прокси работает")
else:
    print("Прокси не работает")
```
## Примеры

Пример использования:

```python
from src.webdriver.proxy import download_proxies_list, get_proxies_dict, check_proxy
from pathlib import Path

# Загрузка списка прокси
download_proxies_list()

# Парсинг списка прокси
proxies = get_proxies_dict()

# Проверка работоспособности прокси
if proxies['http']:
    proxy_to_check = proxies['http'][0]
    if check_proxy(proxy_to_check):
        print(f"Прокси {proxy_to_check['host']}:{proxy_to_check['port']} работает")
    else:
        print(f"Прокси {proxy_to_check['host']}:{proxy_to_check['port']} не работает")
```
# Модуль для работы с прокси

## Обзор

Модуль `src/webdriver/proxy.py` предоставляет функции для загрузки и парсинга списка прокси-серверов. Он предназначен для использования в проекте `hypotez` для работы с веб-драйверами.

## Подробнее

Модуль загружает текстовый файл со списком прокси-серверов из сети интернет. 
После этого, данные прокси-серверов разбиваются на категории (HTTP, SOCKS4, SOCKS5) и  сохраняются в словарь. 
Также модуль реализует функцию проверки работоспособности прокси-серверов.

## Классы

### `class None` 

**Описание**: Модуль не содержит классов.


## Функции

### `download_proxies_list`

**Назначение**: Загружает файл с прокси-серверами по указанному URL и сохраняет его в заданный путь.

**Параметры**:

- `url` (str, optional): URL файла с прокси. По умолчанию: `https://raw.githubusercontent.com/proxifly/free-proxy-list/main/proxies/all/data.txt`.
- `save_path` (Path, optional): Путь для сохранения загруженного файла. По умолчанию: `Path(__root__ / 'src' / 'webdriver' / 'proxies.txt')`.

**Возвращает**:

- `bool`: `True` в случае успешной загрузки файла, `False` в случае ошибки.

**Вызывает исключения**:

- `Exception`: Если возникла ошибка при загрузке файла (например,  неверный URL).

**Пример**:

```python
>>> download_proxies_list()
True
```

**Как работает**:

- Функция отправляет запрос к серверу с помощью `requests.get` и проверяет, что запрос был успешен.
- Если запрос успешен, файл записывается в указанный файл `save_path`.
- Если запрос не удался, то `logger.error` выводит информацию об ошибке.

### `get_proxies_dict`

**Назначение**: Парсит файл с прокси-серверами и распределяет их по категориям.

**Параметры**:

- `file_path` (Path, optional): Путь к файлу с прокси. По умолчанию: `Path(__root__ / 'src' / 'webdriver' / 'proxies.txt')`.

**Возвращает**:

- `Dict[str, List[Dict[str, Any]]]`: Словарь с распределёнными по типам прокси.

**Вызывает исключения**:

- `FileNotFoundError`: Если файл с прокси не найден.
- `Exception`: Если возникла ошибка при парсинге файла.

**Пример**:

```python
>>> get_proxies_dict()
{'http': [{'protocol': 'http', 'host': '103.132.137.10', 'port': '8080'}, {'protocol': 'http', 'host': '103.132.145.210', 'port': '8080'}, ...], 'socks4': [], 'socks5': []}
```

**Как работает**:

- Функция сначала вызывает `download_proxies_list()` для загрузки файла с прокси, если он не существует.
- Затем функция считывает файл с помощью `open` и ищет совпадения с регулярным выражением, чтобы извлечь информацию о прокси.
- Извлеченные данные сохраняются в словарь, который используется в качестве возвращаемого значения.

### `check_proxy`

**Назначение**: Проверяет работоспособность прокси-сервера.

**Параметры**:

- `proxy` (dict): Словарь с данными прокси (host, port, protocol).

**Возвращает**:

- `bool`: `True`, если прокси работает, иначе `False`.

**Вызывает исключения**:

- `(ProxyError, RequestException)`: Если возникла ошибка при подключении к прокси.

**Пример**:

```python
>>> check_proxy({'protocol': 'http', 'host': '103.132.137.10', 'port': '8080'})
True
```

**Как работает**:

- Функция отправляет запрос к серверу `https://httpbin.org/ip` через указанный прокси-сервер.
- Если запрос успешен и возвращает код ответа 200, то прокси считается работоспособным.
- Если запрос не удался или код ответа отличается от 200, то прокси считается нерабочим.
- `logger.info` и `logger.warning` выводит информацию о проверке.

## Параметры модуля

- `url` (str): URL источника списка прокси.
- `proxies_list_path` (Path): Путь к файлу для сохранения списка прокси.

## Примеры

```python
# Загрузка списка прокси и парсинг
if download_proxies_list():
    parsed_proxies = parse_proxies()
    logger.info(f'Обработано {sum(len(v) for v in parsed_proxies.values())} прокси.')

# Проверка работоспособности прокси
proxy = {'protocol': 'http', 'host': '103.132.137.10', 'port': '8080'}
if check_proxy(proxy):
    logger.info(f'Прокси {proxy["host"]}:{proxy["port"]} работает.')
```
# Модуль для работы с прокси

## Обзор

Модуль определяет функции для загрузки, парсинга и проверки списка прокси-серверов. Он загружает текстовый файл с прокси-адресами из указанного URL, распределяет их по категориям (HTTP, SOCKS4, SOCKS5) и предоставляет возможность проверки работоспособности каждого прокси-сервера.

## Подробней

Этот модуль предоставляет функциональность для автоматической загрузки и обработки списка прокси-серверов, что может быть полезно для задач, требующих анонимности или обхода географических ограничений. Загруженные и проверенные прокси можно использовать для выполнения HTTP-запросов через определенный прокси-сервер.

## Функции

### `download_proxies_list`

```python
def download_proxies_list(url: str = url, save_path: Path = proxies_list_path) -> bool:
    """
    Загружает файл по указанному URL и сохраняет его в заданный путь.

    Args:
        url (str): URL файла для загрузки. По умолчанию используется глобальная переменная `url`.
        save_path (Path): Путь для сохранения загруженного файла. По умолчанию используется глобальная переменная `proxies_list_path`.

    Returns:
        bool: `True`, если файл успешно загружен и сохранен, иначе `False`.
    """
```

**Назначение**: Загружает файл с прокси-серверами по указанному URL и сохраняет его локально по указанному пути.

**Параметры**:

-   `url` (str): URL-адрес, по которому находится список прокси-серверов.
-   `save_path` (Path): Локальный путь для сохранения загруженного списка прокси-серверов.

**Возвращает**:

-   `bool`: Возвращает `True` в случае успешной загрузки и сохранения файла, и `False` в случае ошибки.

**Как работает функция**:

1.  Функция отправляет HTTP-запрос к указанному `url` для загрузки файла.
2.  Если запрос успешен (код ответа 200), функция пытается сохранить содержимое ответа в файл по указанному `save_path`.
3.  В случае возникновения исключений при загрузке или сохранении файла, функция логирует ошибку и возвращает `False`.

**Примеры**:

```python
from pathlib import Path
# Пример использования с параметрами по умолчанию
result = download_proxies_list()
print(f"Результат загрузки: {result}")  # Выведет True или False

# Пример использования с указанием URL и пути сохранения
custom_url = 'https://example.com/proxies.txt'
custom_path = Path('/tmp/proxies.txt')
result = download_proxies_list(url=custom_url, save_path=custom_path)
print(f"Результат загрузки: {result}")  # Выведет True или False
```

### `get_proxies_dict`

```python
def get_proxies_dict(file_path: Path = proxies_list_path) -> Dict[str, List[Dict[str, Any]]]:
    """
    Парсит файл с прокси-адресами и распределяет их по категориям.

    Args:
        file_path (Path): Путь к файлу с прокси. По умолчанию используется глобальная переменная `proxies_list_path`.

    Returns:
        Dict[str, List[Dict[str, Any]]]: Словарь с распределёнными по типам прокси.
    """
```

**Назначение**: Парсит файл со списком прокси-серверов и возвращает словарь, где прокси сгруппированы по протоколам (HTTP, SOCKS4, SOCKS5).

**Параметры**:

-   `file_path` (Path): Путь к файлу со списком прокси-серверов.

**Возвращает**:

-   `Dict[str, List[Dict[str, Any]]]`: Словарь, где ключи - это протоколы (`'http'`, `'socks4'`, `'socks5'`), а значения - списки словарей, каждый из которых представляет прокси-сервер и содержит ключи `'protocol'`, `'host'` и `'port'`.

**Как работает функция**:

1.  Сначала вызывается функция `download_proxies_list()` для обновления локального файла со списком прокси-серверов.
2.  Затем функция открывает файл, указанный в `file_path`, и построчно считывает его содержимое.
3.  Для каждой строки применяется регулярное выражение для извлечения протокола, хоста и порта прокси-сервера.
4.  Если строка соответствует формату прокси, информация о прокси добавляется в соответствующий список в словаре `proxies`.
5.  В случае возникновения исключений (например, файл не найден), функция логирует ошибку.

**Примеры**:

```python
from pathlib import Path

# Пример использования с параметром по умолчанию
proxies = get_proxies_dict()
print(proxies)  # Выведет словарь с прокси, сгруппированными по протоколам

# Пример использования с указанием пути к файлу
custom_path = Path('/tmp/proxies.txt')
proxies = get_proxies_dict(file_path=custom_path)
print(proxies)  # Выведет словарь с прокси, сгруппированными по протоколам
```

### `check_proxy`

```python
def check_proxy(proxy: dict) -> bool:
    """
    Проверяет работоспособность прокси-сервера.
    
    Args:
        proxy (dict): Словарь с данными прокси (host, port, protocol).
    Returns:
        True, если прокси работает, иначе False.
    """
```

**Назначение**: Проверяет, является ли данный прокси-сервер рабочим, путем отправки запроса через него.

**Параметры**:

-   `proxy` (dict): Словарь, содержащий информацию о прокси-сервере, включая `'host'`, `'port'` и `'protocol'`.

**Возвращает**:

-   `bool`: `True`, если прокси-сервер работает и возвращает код ответа 200, иначе `False`.

**Как работает функция**:

1.  Функция пытается отправить GET-запрос к `https://httpbin.org/ip` через указанный прокси-сервер.
2.  Если запрос выполнен успешно и получен код ответа 200, функция считает прокси-сервер рабочим и возвращает `True`.
3.  В случае возникновения исключений (например, `ProxyError`, `RequestException`) или получения кода ответа, отличного от 200, функция логирует предупреждение и возвращает `False`.

**Примеры**:

```python
# Пример использования
proxy = {'protocol': 'http', 'host': '1.1.1.1', 'port': '3128'}  # Замените на реальные данные
is_working = check_proxy(proxy)
print(f"Прокси работает: {is_working}")  # Выведет True или False
```

## Переменные

-   `url` (str): URL-адрес, используемый по умолчанию для загрузки списка прокси-серверов.
-   `proxies_list_path` (Path): Путь к файлу, используемый по умолчанию для сохранения загруженного списка прокси-серверов.
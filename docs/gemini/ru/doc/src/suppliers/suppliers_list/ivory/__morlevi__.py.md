# Модуль для работы с поставщиком Morlevi
=========================================

Модуль содержит функции для логина на сайт поставщика Morlevi, сбора информации о товарах и получения списка товаров в категории.

## Обзор

Модуль `__morlevi__.py` предназначен для автоматизации взаимодействия с сайтом поставщика Morlevi. Он включает в себя функции для логина на сайт, извлечения информации о продуктах и получения списка продуктов в определенной категории. Этот модуль является частью системы автоматизированного сбора данных о товарах для проекта `hypotez`.

## Подробней

Модуль предоставляет следующие возможности:

-   Автоматический вход на сайт поставщика с использованием предоставленных учетных данных.
-   Извлечение информации о товарах, такой как ID, SKU, название, описание, цена и изображения.
-   Получение списка товаров, представленных в определенной категории на сайте поставщика, с учетом пагинации.

Этот модуль использует библиотеки `pathlib`, `requests`, `pandas` и `selenium` для выполнения HTTP-запросов, обработки данных и автоматизации действий в браузере. Он также использует модуль `settings` для загрузки конфигурации и модуль `src.suppliers.Product` для представления информации о товаре.

## Классы

В данном модуле класс отсутствует.

## Функции

### `login`

```python
def login(supplier) -> bool | None:
    """Осуществляет логин на сайт поставщика Morlevi.

    Args:
        supplier: Объект поставщика, содержащий необходимые данные для подключения, такие как драйвер и локаторы.

    Returns:
        bool | None: Возвращает `True`, если логин успешен, `None` в случае неудачи.

    Raises:
        Exception: Если происходит ошибка при попытке закрыть всплывающее окно или во время процесса логина.
    """
```

**Назначение**: Функция `login` пытается войти на сайт поставщика Morlevi, используя предоставленные учетные данные. Если вход не удался с первой попытки, она пытается закрыть модальные окна, которые могут мешать входу.

**Параметры**:

*   `supplier`: Объект поставщика, содержащий данные для подключения, такие как драйвер и локаторы.

**Возвращает**:

*   `bool | None`: Возвращает `True`, если логин успешен, `None` в случае неудачи.

**Вызывает исключения**:

*   `Exception`: Если происходит ошибка при попытке закрыть всплывающее окно или во время процесса логина.

**Как работает функция**:

1.  Функция получает URL сайта из объекта поставщика и открывает его в браузере.
2.  Вызывает внутреннюю функцию `_login` для выполнения фактического входа.
3.  Если `_login` возвращает `False`, функция пытается закрыть всплывающие окна и повторить вход.
4.  Если всплывающих окон несколько, функция перебирает их и пытается закрыть каждое.
5.  Если вход по-прежнему не удается, функция логирует ошибку и возвращает `None`.

**Внутренние функции**:

*   `_login`: Выполняет фактический вход на сайт, используя локаторы для полей ввода и кнопки входа.

```python
def _login(_s) -> bool | None:
    """Выполняет фактический вход на сайт Morlevi.

    Args:
        _s: Объект поставщика, содержащий необходимые данные для подключения, такие как драйвер и локаторы.

    Returns:
        bool | None: Возвращает `True`, если логин успешен, `None` в случае неудачи.

    Raises:
        Exception: Если происходит ошибка во время процесса логина.
    """
```

**Назначение**: Функция `_login` выполняет фактический вход на сайт, используя локаторы для полей ввода и кнопки входа.

**Параметры**:

*   `_s`: Объект поставщика, содержащий данные для подключения, такие как драйвер и локаторы.

**Возвращает**:

*   `bool | None`: Возвращает `True`, если логин успешен, `None` в случае неудачи.

**Вызывает исключения**:

*   `Exception`: Если происходит ошибка во время процесса логина.

**Как работает функция**:

1.  Обновляет текущую страницу.
2.  Использует локаторы из объекта поставщика для заполнения полей электронной почты и пароля, а также для нажатия кнопки входа.
3.  Если вход выполнен успешно, функция логирует сообщение и возвращает `True`.
4.  Если происходит ошибка, функция логирует ошибку и возвращает `None`.

**Примеры**:

```python
# Пример использования функции login
supplier = Supplier(driver=driver, locators=locators)  # Предполагается, что driver и locators определены ранее
if login(supplier):
    print("Login successful")
else:
    print("Login failed")
```

### `grab_product_page`

```python
def grab_product_page(s) -> Product | None:
    """Извлекает информацию о продукте со страницы продукта на сайте Morlevi.

    Args:
        s: Объект поставщика, содержащий драйвер, локаторы и настройки.

    Returns:
        Product | None: Возвращает объект `Product` с заполненными данными, если успешно, `None` в случае неудачи.

    Raises:
        Exception: Если не удается найти цену товара.
    """
```

**Назначение**: Функция `grab_product_page` извлекает информацию о продукте со страницы продукта на сайте Morlevi и возвращает объект `Product` с заполненными данными.

**Параметры**:

*   `s`: Объект поставщика, содержащий драйвер, локаторы и настройки.

**Возвращает**:

*   `Product | None`: Возвращает объект `Product` с заполненными данными, если успешно, `None` в случае неудачи.

**Вызывает исключения**:

*   `Exception`: Если не удается найти цену товара.

**Как работает функция**:

1.  Создает объект `Product` с указанием поставщика.
2.  Извлекает локаторы продукта из объекта поставщика.
3.  Закрывает модальное окно, если оно появляется.
4.  Определяет внутренние функции для извлечения и установки различных полей продукта, таких как ID, SKU, название, описание, цена и изображения.
5.  Вызывает эти внутренние функции для заполнения полей объекта `Product`.
6.  Возвращает объект `Product`.

**Внутренние функции**:

*   `set_id`: Извлекает и устанавливает ID продукта.
*   `set_sku_suppl`: Устанавливает SKU поставщика.
*   `set_sku_prod`: Формирует и устанавливает SKU продукта.
*   `set_title`: Устанавливает название продукта.
*   `set_summary`: Устанавливает краткое описание продукта.
*   `set_description`: Устанавливает полное описание продукта.
*   `set_cost_price`: Извлекает и устанавливает цену продукта.
*   `set_before_tax_price`: Устанавливает цену без налога.
*   `set_delivery`: Извлекает информацию о доставке продукта (TODO: перенести в комбинации).
*   `set_images`: Извлекает URL изображений продукта.
*   `set_combinations`: Устанавливает комбинации продукта (TODO).
*   `set_qty`: Устанавливает количество продукта (TODO).
*   `set_specification`: Устанавливает спецификацию продукта.
*   `set_customer_reviews`: Устанавливает отзывы клиентов (TODO).
*   `set_supplier`: Устанавливает поставщика продукта.
*   `set_rewritted_URL`: Устанавливает переписанный URL продукта (TODO).

**Примеры**:

```python
# Пример использования функции grab_product_page
supplier = Supplier(driver=driver, locators=locators, settings=settings)  # Предполагается, что driver, locators и settings определены ранее
product = grab_product_page(supplier)
if product:
    print(f"Product ID: {product.fields['id']}")
    print(f"Product Title: {product.fields['title']}")
else:
    print("Failed to grab product page")
```

### `list_products_in_category_from_pagination`

```python
def list_products_in_category_from_pagination(supplier) -> list:
    """Получает список URL продуктов в категории, используя пагинацию.

    Args:
        supplier: Объект поставщика, содержащий драйвер и локаторы.

    Returns:
        list: Список URL продуктов в категории.
    """
```

**Назначение**: Функция `list_products_in_category_from_pagination` получает список URL продуктов в категории, используя пагинацию на сайте поставщика.

**Параметры**:

*   `supplier`: Объект поставщика, содержащий драйвер и локаторы.

**Возвращает**:

*   `list`: Список URL продуктов в категории.

**Как работает функция**:

1.  Извлекает локатор ссылок на продукты из объекта поставщика.
2.  Получает список URL продуктов на текущей странице.
3.  Если список пуст, возвращает пустой список.
4.  Если список не пуст, добавляет URL продуктов в общий список.
5.  Получает список страниц пагинации.
6.  Перебирает страницы пагинации, переходит на каждую страницу, получает список URL продуктов и добавляет их в общий список.
7.  Удаляет дубликаты из списка URL продуктов.
8.  Возвращает список URL продуктов.

**Примеры**:

```python
# Пример использования функции list_products_in_category_from_pagination
supplier = Supplier(driver=driver, locators=locators)  # Предполагается, что driver и locators определены ранее
product_list = list_products_in_category_from_pagination(supplier)
if product_list:
    print(f"Found {len(product_list)} products in category")
    for product_url in product_list:
        print(product_url)
else:
    print("No products found in category")
```

### `get_list_products_in_category`

```python
def get_list_products_in_category(s, scenario, presath) -> None:
    """Получает список продуктов в категории.

    Args:
        s: Supplier
        scenario: JSON
        presath: PrestaShopWebServiceDict
    """
```

**Назначение**: Функция `get_list_products_in_category` получает список продуктов в категории.

**Параметры**:

*   `s`: Объект поставщика (Supplier).
*   `scenario`: JSON-сценарий.
*   `presath`: Объект PrestaShopWebServiceDict.

**Как работает функция**:

1.  Вызывает функцию `list_products_in_category_from_pagination` для получения списка продуктов в категории.

### `get_list_categories_from_site`

```python
def get_list_categories_from_site(s, scenario_file, brand="") -> None:
    """Получает список категорий с сайта.

    Args:
        s: Supplier
        scenario_file: JSON
        brand: str
    """
```

**Назначение**: Функция `get_list_categories_from_site` получает список категорий с сайта.

**Параметры**:

*   `s`: Объект поставщика (Supplier).
*   `scenario_file`: JSON-файл сценария.
*   `brand`: Бренд (по умолчанию пустая строка).
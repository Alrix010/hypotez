# Модуль для управления категориями Aliexpress

## Обзор

Модуль `src.suppliers.suppliers_list.aliexpress.scenario.py` предназначен для управления категориями на платформе AliExpress.  Он включает функции для сбора информации о категориях с сайта, проверки и обновления файла сценария, а также для работы с базой данных.

## Подробнее

Данный модуль используется для автоматизации процесса обновления информации о категориях товаров на AliExpress.  Он позволяет сравнивать данные о категориях, полученные с сайта, с данными, хранящимися в файле сценария, и автоматически обновлять файл сценария, добавляя новые категории или отключая удаленные.

## Классы

### `class DBAdaptor`

**Описание**: Класс `DBAdaptor` предоставляет набор методов для взаимодействия с базой данных AliExpressCategory. 

**Наследует**:  
    -  `None` 

**Атрибуты**:
    -  `None` 


**Методы**:

  -  `select(cat_id:int = None, parent_id:int = None, project_cat_id:int = None )`
      **Назначение**:  Выполняет операцию `SELECT`  для получения записей из таблицы `AliexpressCategory`.
      **Параметры**:
          -  `cat_id` (int, optional): Идентификатор категории.  По умолчанию `None`.
          -  `parent_id` (int, optional): Идентификатор родительской категории. По умолчанию `None`.
          -  `project_cat_id` (int, optional): Идентификатор категории в проекте. По умолчанию `None`.
      **Возвращает**:
          -  `None`:  Возвращает `None`.
      **Вызывает исключения**:
          -  `None`:  Не предусмотрено.
  -  `insert()`
      **Назначение**:  Выполняет операцию `INSERT` для добавления новой записи в таблицу `AliexpressCategory`.
      **Параметры**:
          -  `None`:  Не принимает параметров.
      **Возвращает**:
          -  `None`:  Возвращает `None`.
      **Вызывает исключения**:
          -  `None`:  Не предусмотрено.
  -  `update()`
      **Назначение**:  Выполняет операцию `UPDATE` для обновления записи в таблице `AliexpressCategory`.
      **Параметры**:
          -  `None`:  Не принимает параметров.
      **Возвращает**:
          -  `None`:  Возвращает `None`.
      **Вызывает исключения**:
          -  `None`:  Не предусмотрено.
  -  `delete()`
      **Назначение**:  Выполняет операцию `DELETE` для удаления записи из таблицы `AliexpressCategory`.
      **Параметры**:
          -  `None`:  Не принимает параметров.
      **Возвращает**:
          -  `None`:  Возвращает `None`.
      **Вызывает исключения**:
          -  `None`:  Не предусмотрено.

## Функции

### `get_list_products_in_category(s)`

**Назначение**:  Функция считывает URL товаров со страницы категории.

**Параметры**:
    -  `s` (`Supplier`):  Экземпляр поставщика.
    -  `run_async` (`bool`, optional):  Устанавливает синхронность/асинхронность исполнения функции `async_get_list_products_in_category()`. По умолчанию `False`.

**Возвращает**:
    -  `list_products_in_category` (`list`): Список собранных URL. Может быть пустым, если в исследуемой категории нет товаров. 

**Вызывает исключения**:
    -  `None`:  Не предусмотрено.

**Как работает функция**:
    - Функция `get_list_products_in_category` использует функцию `get_prod_urls_from_pagination` для сбора URL товаров. 

**Примеры**:
    ```python
    # Пример использования функции get_list_products_in_category
    s = Supplier() # Предполагаем, что объект Supplier уже создан
    product_urls = get_list_products_in_category(s)
    print(product_urls)
    ```

### `get_prod_urls_from_pagination(s)`

**Назначение**:  Функция собирает ссылки на товары со страницы категории с перелистыванием страниц.

**Параметры**:
    -  `s` (`Supplier`):  Экземпляр поставщика.

**Возвращает**:
    -  `list_products_in_category` (`list`):  Список ссылок, собранных со страницы категории.

**Вызывает исключения**:
    -  `None`:  Не предусмотрено.

**Как работает функция**:
    - Функция `get_prod_urls_from_pagination` использует WebDriver для навигации по страницам категории и сбора URL товаров.
    - В цикле, функция проверяет наличие кнопки "Далее" на странице и, если она присутствует, нажимает ее. 
    - В каждой итерации цикла, функция собирает URL товаров с текущей страницы и добавляет их в список `list_products_in_category`. 

**Примеры**:
    ```python
    # Пример использования функции get_prod_urls_from_pagination
    s = Supplier() # Предполагаем, что объект Supplier уже создан
    product_urls = get_prod_urls_from_pagination(s)
    print(product_urls)
    ```

### `update_categories_in_scenario_file(s, scenario_filename: str)`

**Назначение**:  Функция производит проверку изменений категорий на сайте, сравнивая файл JSON, полученный с сайта, с файлом сценария.

**Параметры**:
    -  `s` (`Supplier`):  Экземпляр поставщика.
    -  `scenario_filename` (`str`):  Имя файла сценария.

**Возвращает**:
    -  `bool`:  Возвращает `True`, если проверка успешно выполнена. 

**Вызывает исключения**:
    -  `None`:  Не предусмотрено.

**Как работает функция**:
    - Функция `update_categories_in_scenario_file` сравнивает список категорий, полученный с сайта, с текущим списком категорий в файле сценария.
    - Если в списке категорий, полученном с сайта,  обнаружены новые категории, то они добавляются в файл сценария. 
    - Если в списке категорий, полученном с сайта,  отсутствуют  категории,  которые  есть  в  файле  сценария, то такие категории помечаются  в файле сценария  как  неактивные.
    - В случае обнаружения изменений, функция отправляет уведомление.

**Примеры**:
    ```python
    # Пример использования функции update_categories_in_scenario_file
    s = Supplier() # Предполагаем, что объект Supplier уже создан
    scenario_filename = 'aliexpress_categories.json'
    result = update_categories_in_scenario_file(s, scenario_filename)
    print(result)
    ```

### `get_list_categories_from_site(s, scenario_file, brand=\'\')`

**Назначение**:  Функция собирает список категорий с сайта AliExpress.

**Параметры**:
    -  `s` (`Supplier`):  Экземпляр поставщика.
    -  `scenario_file` (`str`):  Имя файла сценария.
    -  `brand` (`str`, optional):  Название бренда. По умолчанию `''`.

**Возвращает**:
    -  `None`:  Возвращает `None`.

**Вызывает исключения**:
    -  `None`:  Не предусмотрено.

**Как работает функция**:
    - Функция `get_list_categories_from_site` использует WebDriver для навигации по странице категорий на сайте AliExpress и сбора списка категорий.

**Примеры**:
    ```python
    # Пример использования функции get_list_categories_from_site
    s = Supplier() # Предполагаем, что объект Supplier уже создан
    scenario_file = 'aliexpress_categories.json'
    categories = get_list_categories_from_site(s, scenario_file)
    print(categories)
    ```
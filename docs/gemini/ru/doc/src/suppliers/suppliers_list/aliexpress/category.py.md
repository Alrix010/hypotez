# Модуль для управления категориями Aliexpress

## Обзор

Модуль `category.py` предназначен для управления категориями товаров на сайте Aliexpress. Он включает функции для сбора URL товаров из категорий, обновления информации о категориях в файлах сценариев и адаптер для работы с базой данных категорий.

## Подробней

Этот модуль является частью системы, взаимодействующей с Aliexpress, и выполняет следующие задачи:

- Сбор ссылок на товары из страниц категорий, включая обработку пагинации.
- Обновление информации о категориях в файлах сценариев, используемых для автоматизации.
- Предоставляет интерфейс для взаимодействия с базой данных категорий.

## Функции

### `get_list_products_in_category`

**Назначение**: Считывает URL товаров со страницы категории Aliexpress.

```python
def get_list_products_in_category(s) -> list[str, str]:
    """  
     Считывает URL товаров со страницы категории.

    Args:
        s: Экземпляр класса `Supplier`.

    Returns:
        list[str, str]: Список URL товаров, найденных в категории.
    """
    ...
```

**Параметры**:
- `s` (`Supplier`): Экземпляр класса `Supplier`, содержащий информацию о поставщике и настройки для работы с веб-драйвером.

**Возвращает**:
- `list[str, str]`: Список URL товаров, найденных в категории. Может быть пустым, если товаров в категории нет.

**Как работает функция**:
Функция вызывает `get_prod_urls_from_pagination(s)` для получения списка URL товаров с учетом пагинации на странице категории.

**Примеры**:
```python
# Пример вызова функции
# s = Supplier(...)  # Предполагается, что у вас есть экземпляр класса Supplier
# product_urls = get_list_products_in_category(s)
# print(product_urls)
```

### `get_prod_urls_from_pagination`

**Назначение**: Собирает ссылки на товары со страницы категории с учетом перелистывания страниц.

```python
def get_prod_urls_from_pagination(s) -> list[str]:
    """   Функция собирает ссылки на товары со страницы категории с перелистыванием страниц 
    Args:
        s (Supplier): Экземпляр класса `Supplier`.

    Returns:
        list[str]: Список URL товаров, найденных на всех страницах категории.
    """
    ...
```

**Параметры**:
- `s` (`Supplier`): Экземпляр класса `Supplier`, содержащий информацию о поставщике и настройки веб-драйвера.

**Возвращает**:
- `list[str]`: Список URL товаров, найденных на всех страницах категории.

**Как работает функция**:
Функция использует веб-драйвер для навигации по страницам категории и извлечения ссылок на товары. Она циклически переходит на следующую страницу, пока это возможно, и добавляет новые ссылки в общий список.

**Примеры**:
```python
# Пример вызова функции
# s = Supplier(...)  # Предполагается, что у вас есть экземпляр класса Supplier
# product_urls = get_prod_urls_from_pagination(s)
# print(product_urls)
```

### `update_categories_in_scenario_file`

**Назначение**: Проверяет и обновляет информацию о категориях в файле сценария на основе данных с сайта.

```python
def update_categories_in_scenario_file(s, scenario_filename: str) -> bool:
    """  Проверка изменений категорий на сайте 
    Args:
        s (Supplier): Экземпляр класса `Supplier`.
        scenario_filename (str): Имя файла сценария.

    Returns:
        bool: `True`, если обновление прошло успешно.
    """
    ...
```

**Параметры**:
- `s` (`Supplier`): Экземпляр класса `Supplier`.
- `scenario_filename` (`str`): Имя файла сценария, который необходимо обновить.

**Возвращает**:
- `bool`: `True`, если обновление категорий в файле сценария прошло успешно.

**Как работает функция**:
Функция сравнивает список категорий, полученных с сайта, со списком категорий, хранящихся в файле сценария. Она добавляет новые категории и отключает удаленные категории в файле сценария.

**Внутренние функции**:

#### `_update_all_ids_in_file`

```python
def _update_all_ids_in_file():
    """Обновляет идентификаторы всех категорий в файле сценария."""
    ...
```

**Назначение**: Обновляет идентификаторы всех категорий в файле сценария.

**Как работает функция**:
Перебирает категории в файле сценария, извлекает идентификаторы категорий и добавляет их в список `all_ids_in_file`. Если идентификатор отсутствует, извлекает его из URL категории и добавляет в список.

**Примеры**:
```python
# Пример вызова функции
# s = Supplier(...)  # Предполагается, что у вас есть экземпляр класса Supplier
# scenario_filename = "example_scenario.json"
# update_result = update_categories_in_scenario_file(s, scenario_filename)
# print(update_result)
```

### `get_list_categories_from_site`

**Назначение**: Получает список категорий с сайта.

```python
def get_list_categories_from_site(s,scenario_file,brand='')
    """Получает список категорий с сайта."""
    ...
```

**Параметры**:
- `s`: экземпляр класса `Supplier`
- `scenario_file`: имя файла сценария
- `brand`: бренд

**Как работает функция**:
Использует веб-драйвер для получения списка категорий с сайта.

## Классы

### `DBAdaptor`

**Описание**: Адаптер для взаимодействия с базой данных категорий Aliexpress.
Класс предоставляет методы для выполнения операций CRUD (Create, Read, Update, Delete) с данными категорий в базе данных.
```python
class DBAdaptor():
    """Адаптер для взаимодействия с базой данных категорий Aliexpress."""
    def select():
        """Пример операции SELECT."""
        ...
    def insert():
        """Пример операции INSERT."""
        ...
    def update():
        """Пример операции UPDATE."""
        ...
    def delete():
        """Пример операции DELETE."""
        ...
```

**Методы**:
- `select(cat_id: int = None, parent_id: int = None, project_cat_id: int = None)`: Выбирает записи из таблицы категорий.
- `insert()`: Вставляет новую запись в таблицу категорий.
- `update()`: Обновляет запись в таблице категорий.
- `delete()`: Удаляет запись из таблицы категорий.

**Принцип работы**:
Класс использует ORM (Object-Relational Mapping) для взаимодействия с базой данных. Каждый метод выполняет соответствующую операцию CRUD с использованием ORM.

**Примеры**:
```python
# Пример использования DBAdaptor
# db_adapter = DBAdaptor()
# db_adapter.insert()
# db_adapter.update()
# db_adapter.select()
# db_adapter.delete()
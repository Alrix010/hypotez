# Руководство по Тестированию Модуля Подготовки Рекламных Кампаний на AliExpress

## Обзор

Данный документ представляет собой руководство для тестирования модуля, предназначенного для подготовки материалов для рекламных кампаний на платформе AliExpress. Модуль состоит из трех основных файлов:

1. `edit_campaign.py` - файл, отвечающий за управление рекламной кампанией.
2. `prepare_campaigns.py` - файл, отвечающий за подготовку и обработку категорий кампании.
3. `test_campaign_integration.py` - файл, содержащий тесты для проверки интеграции всех компонентов модуля.

## Подробное описание

### Модуль `edit_campaign.py`

#### Класс `AliCampaignEditor`

**Описание:**

Класс `AliCampaignEditor` является наследником класса `AliPromoCampaign`, отвечающего за управление рекламной кампанией. Этот класс расширяет функциональность родительского класса, предоставляя дополнительные методы для управления кампанией.

**Наследует:**

- `AliPromoCampaign`

**Методы:**

- `AliCampaignEditor`: Инициализация и управление кампанией.

#### Принцип работы:

Класс `AliCampaignEditor` предоставляет методы для инициализации и управления рекламной кампанией, наследуя функциональность от родительского класса `AliPromoCampaign`. Основные методы класса позволяют:

- Инициализировать кампанию.
- Управлять параметрами кампании.
- Выполнять операции над кампанией, например, запуск, остановка, редактирование.

#### Примеры:

```python
# Инициализация кампании
campaign = AliCampaignEditor(campaign_id=12345)

# Изменение названия кампании
campaign.name = "Новая рекламная кампания"

# Запуск кампании
campaign.start()
```

### Модуль `prepare_campaigns.py`

#### Функция `update_category`

**Назначение:**

Функция `update_category` обновляет информацию о категории в JSON файле.

**Параметры:**

- `category_id` (int): ID категории, которую необходимо обновить.
- `category_data` (dict): Словарь с обновленными данными о категории.

**Возвращает:**

- `bool`: `True` если обновление прошло успешно, `False` в противном случае.

**Вызывает исключения:**

- `Exception`: Если возникает ошибка при чтении или записи JSON файла.

#### Принцип работы:

Функция `update_category` читает содержимое JSON файла, обновляет данные о категории с использованием переданных параметров и записывает обновленные данные в файл.

#### Примеры:

```python
# Обновление данных о категории с ID 123
update_category(category_id=123, category_data={'name': 'Обновленное название категории'})
```

#### Функция `process_campaign_category`

**Назначение:**

Функция `process_campaign_category` обрабатывает конкретную категорию в рамках рекламной кампании.

**Параметры:**

- `campaign_id` (int): ID рекламной кампании.
- `category_id` (int): ID категории, которую необходимо обработать.

**Возвращает:**

- `dict | None`: Словарь с результатами обработки категории или `None` в случае ошибки.

**Вызывает исключения:**

- `Exception`: Если возникает ошибка при обработке категории.

#### Принцип работы:

Функция `process_campaign_category` получает данные о категории из JSON файла, выполняет необходимые операции по обработке категории, например, добавление в рекламный аккаунт, настройку параметров, и возвращает результаты обработки.

#### Примеры:

```python
# Обработка категории с ID 123 в рамках кампании с ID 456
process_campaign_category(campaign_id=456, category_id=123)
```

#### Функция `process_campaign`

**Назначение:**

Функция `process_campaign` обрабатывает все категории в рамках рекламной кампании.

**Параметры:**

- `campaign_id` (int): ID рекламной кампании.

**Возвращает:**

- `dict | None`: Словарь с результатами обработки всех категорий или `None` в случае ошибки.

**Вызывает исключения:**

- `Exception`: Если возникает ошибка при обработке кампании.

#### Принцип работы:

Функция `process_campaign` получает список категорий, связанных с кампанией, и вызывается для каждой категории функция `process_campaign_category`. Результаты обработки каждой категории сохраняются в словарь.

#### Примеры:

```python
# Обработка кампании с ID 789
process_campaign(campaign_id=789)
```

#### Функция `main`

**Назначение:**

Функция `main` - асинхронная функция, запускающая обработку рекламной кампании.

**Параметры:**

- `campaign_id` (int): ID рекламной кампании.

**Возвращает:**

- `None`

**Вызывает исключения:**

- `Exception`: Если возникает ошибка при обработке кампании.

#### Принцип работы:

Функция `main` запускает асинхронный процесс обработки рекламной кампании. Она вызывает функцию `process_campaign` для обработки всех категорий в кампании. 

#### Примеры:

```python
# Запуск обработки кампании с ID 1011
main(campaign_id=1011)
```

### Модуль `test_campaign_integration.py`

#### Тест `test_update_category_success`

**Назначение:**

Тест проверяет, что функция `update_category` успешно обновляет данные о категории в JSON файле.

#### Принцип работы:

Тест:

- Вызывает функцию `update_category` с тестовыми данными.
- Проверяет, что функция вернула `True`, что указывает на успешное обновление.
- Проверяет, что данные в JSON файле были обновлены на тестовые данные.

#### Тест `test_update_category_failure`

**Назначение:**

Тест проверяет, что функция `update_category` корректно обрабатывает ошибки при обновлении категории.

#### Принцип работы:

Тест:

- Вызывает функцию `update_category` с ошибочными данными, например, некорректным ID категории.
- Проверяет, что функция вернула `False`, что указывает на возникновение ошибки.
- Проверяет, что функция логгировала сообщение об ошибке.

#### Тест `test_process_campaign_category_success`

**Назначение:**

Тест проверяет, что функция `process_campaign_category` успешно обрабатывает категорию в рамках рекламной кампании.

#### Принцип работы:

Тест:

- Вызывает функцию `process_campaign_category` с тестовыми данными.
- Проверяет, что функция вернула словарь с результатами обработки категории, а не `None`.
- Проверяет, что данные о обработанной категории были успешно записаны.

#### Тест `test_process_campaign_category_failure`

**Назначение:**

Тест проверяет, что функция `process_campaign_category` корректно обрабатывает ошибки при обработке категории.

#### Принцип работы:

Тест:

- Вызывает функцию `process_campaign_category` с ошибочными данными, например, некорректным ID категории.
- Проверяет, что функция вернула `None`, что указывает на возникновение ошибки.
- Проверяет, что функция логгировала сообщение об ошибке.

#### Тест `test_process_campaign`

**Назначение:**

Тест проверяет, что функция `process_campaign` успешно обрабатывает все категории в рамках рекламной кампании.

#### Принцип работы:

Тест:

- Вызывает функцию `process_campaign` с тестовыми данными.
- Проверяет, что функция вернула словарь с результатами обработки всех категорий, а не `None`.
- Проверяет, что данные о обработанных категориях были успешно записаны.

#### Тест `test_main`

**Назначение:**

Тест проверяет, что функция `main` успешно запускает асинхронный процесс обработки рекламной кампании.

#### Принцип работы:

Тест:

- Вызывает функцию `main` с тестовыми данными.
- Проверяет, что функция завершила работу без ошибок.
- Проверяет, что данные о обработанных категориях были успешно записаны.

## Инструкции по Тестированию

1. **Установка зависимостей:**

    - Убедитесь, что все необходимые зависимости установлены. Выполните команду:
        ```sh
        pip install -r requirements.txt
        ```

2. **Запуск тестов:**

    - Для запуска всех тестов используйте команду:
        ```sh
        pytest test_campaign_integration.py
        ```

3. **Проверка тестов:**

    - Убедитесь, что все тесты проходят успешно. В выводе команды `pytest` должно быть указано, что все тесты пройдены (`PASSED`).

## Проверка Функциональности

1. **Проверка успешного обновления категории:**

    - Тест `test_update_category_success` проверяет, что категория успешно обновляется в JSON файле.
    - Убедитесь, что функция `update_category` правильно обновляет данные категории и логгирует успешное выполнение.

2. **Проверка обработки ошибки при обновлении категории:**

    - Тест `test_update_category_failure` проверяет обработку ошибки при обновлении категории.
    - Убедитесь, что при возникновении ошибки функция логгирует сообщение об ошибке и возвращает `False`.

3. **Проверка успешной обработки категории:**

    - Тест `test_process_campaign_category_success` проверяет успешную обработку категории в кампании.
    - Убедитесь, что функция `process_campaign_category` корректно обрабатывает категорию и возвращает результат без ошибок.

4. **Проверка обработки ошибки при обработке категории:**

    - Тест `test_process_campaign_category_failure` проверяет обработку ошибки при обработке категории.
    - Убедитесь, что при возникновении ошибки функция логгирует сообщение об ошибке и возвращает `None`.

5. **Проверка обработки всех категорий в кампании:**

    - Тест `test_process_campaign` проверяет обработку всех категорий в кампании.
    - Убедитесь, что функция `process_campaign` корректно обрабатывает все категории и возвращает результаты обработки каждой категории.

6. **Проверка основного сценария выполнения кампании:**

    - Тест `test_main` проверяет основной сценарий выполнения кампании.
    - Убедитесь, что функция `main` корректно выполняет все этапы обработки кампании асинхронно и без ошибок.

## Заключение

Убедитесь, что все тесты пройдены и функциональность модуля работает корректно. В случае возникновения проблем или ошибок, сообщите разработчикам для исправления.
# Модуль: `ali_campaign_editor_jupyter_widgets.py`

## Обзор

Модуль содержит класс `JupyterCampaignEditorWidgets`, который предоставляет Jupyter виджеты для редактирования кампаний AliExpress. Он позволяет пользователям взаимодействовать с кампаниями, выбирать категории и языки, инициализировать редакторы, сохранять кампании и просматривать товары непосредственно в Jupyter Notebook.

## Подробнее

Этот модуль предназначен для упрощения управления кампаниями AliExpress. Он предоставляет графический интерфейс в Jupyter Notebook, что делает процесс более интуитивным и удобным. Класс `JupyterCampaignEditorWidgets` включает в себя виджеты для выбора кампании, категории и языка, а также кнопки для выполнения различных действий, таких как инициализация редактора, сохранение кампании и отображение продуктов.

## Классы

### `JupyterCampaignEditorWidgets`

**Описание**: Класс предоставляет виджеты для редактирования кампаний AliExpress в Jupyter Notebook.

**Атрибуты**:
- `language` (str): Выбранный язык кампании.
- `currency` (str): Выбранная валюта кампании.
- `campaign_name` (str): Имя выбранной кампании.
- `category_name` (str): Имя выбранной категории.
- `category` (SimpleNamespace): Объект, представляющий выбранную категорию.
- `campaign_editor` (AliCampaignEditor): Экземпляр редактора кампаний AliExpress.
- `products` (list[SimpleNamespace]): Список товаров в выбранной категории.

**Методы**:
- `__init__`: Инициализирует виджеты и настраивает редактор кампаний.
- `initialize_campaign_editor`: Инициализирует редактор кампаний на основе выбранной кампании и категории.
- `update_category_dropdown`: Обновляет выпадающий список категорий на основе выбранной кампании.
- `on_campaign_name_change`: Обрабатывает изменения в выпадающем списке кампаний.
- `on_category_change`: Обрабатывает изменения в выпадающем списке категорий.
- `on_language_change`: Обрабатывает изменения в выпадающем списке языков.
- `save_campaign`: Сохраняет кампанию и ее категории.
- `show_products`: Отображает товары в выбранной категории.
- `open_spreadsheet`: Открывает Google Spreadsheet в браузере.
- `setup_callbacks`: Устанавливает обратные вызовы для виджетов.
- `display_widgets`: Отображает виджеты для взаимодействия в Jupyter Notebook.

### `__init__`

```python
def __init__(self):
    """Инициализирует виджеты и настраивает редактор кампаний.

    Устанавливает виджеты для выбора кампаний, категорий и языков. Также настраивает
    значения по умолчанию и обратные вызовы для виджетов.
    """
```

**Как работает функция**:

- Функция инициализирует класс `JupyterCampaignEditorWidgets` и настраивает виджеты Jupyter для взаимодействия с редактором кампаний AliExpress.
- Определяет путь к директории с кампаниями AliExpress на Google Drive.
- Создает выпадающие списки для выбора имени кампании, категории и языка/валюты.
- Создает кнопки для инициализации редактора кампании, сохранения кампании, отображения продуктов и открытия Google Spreadsheet.
- Устанавливает обратные вызовы для виджетов, чтобы обрабатывать изменения и события.
- Инициализирует редактор кампании со значениями по умолчанию.

**Примеры**:

```python
editor_widgets = JupyterCampaignEditorWidgets()
```

### `initialize_campaign_editor`

```python
def initialize_campaign_editor(self, _):
    """Инициализирует редактор кампаний.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    Устанавливает редактор кампаний на основе выбранной кампании и категории.
    """
```

**Как работает функция**:

- Функция инициализирует редактор кампаний AliExpress на основе выбранных значений из выпадающих списков: имени кампании, категории и языка/валюты.
- Извлекает значения из выпадающих списков.
- Обновляет выпадающий список категорий на основе выбранного имени кампании.
- Создает экземпляр класса `AliCampaignEditor` с выбранными параметрами.
- Получает информацию о выбранной категории и продуктах.
- Если имя кампании не выбрано, выводит предупреждение в лог.

**Примеры**:

```python
editor_widgets.initialize_campaign_editor(None)
```

### `update_category_dropdown`

```python
def update_category_dropdown(self, campaign_name: str):
    """Обновляет выпадающий список категорий на основе выбранной кампании.

    Args:
        campaign_name (str): Имя кампании.

    """
```

**Как работает функция**:

- Функция обновляет выпадающий список категорий в зависимости от выбранной кампании.
- Формирует путь к директории категорий внутри директории кампании.
- Получает список имен директорий (категорий) из указанного пути.
- Устанавливает полученный список в качестве опций для выпадающего списка категорий.

**Примеры**:

```python
editor_widgets.update_category_dropdown("SummerSale")
```

### `on_campaign_name_change`

```python
def on_campaign_name_change(self, change: dict[str, str]):
    """Обрабатывает изменения в выпадающем списке кампаний.

    Args:
        change (dict[str, str]): Словарь изменений, содержащий новое значение.

    """
```

**Как работает функция**:

- Функция обрабатывает событие изменения значения в выпадающем списке кампаний.
- Извлекает новое значение (имя кампании) из словаря изменений.
- Обновляет выпадающий список категорий на основе выбранного имени кампании.
- Повторно инициализирует редактор кампании с новым именем кампании.

**Примеры**:

```python
editor_widgets.on_campaign_name_change({'new': 'SummerSale'})
```

### `on_category_change`

```python
def on_category_change(self, change: dict[str, str]):
    """Обрабатывает изменения в выпадающем списке категорий.

    Args:
        change (dict[str, str]): Словарь изменений, содержащий новое значение.

    """
```

**Как работает функция**:

- Функция обрабатывает событие изменения значения в выпадающем списке категорий.
- Извлекает новое значение (имя категории) из словаря изменений.
- Повторно инициализирует редактор кампании с новой категорией.

**Примеры**:

```python
editor_widgets.on_category_change({'new': 'Electronics'})
```

### `on_language_change`

```python
def on_language_change(self, change: dict[str, str]):
    """Обрабатывает изменения в выпадающем списке языков.

    Args:
        change (dict[str, str]): Словарь изменений, содержащий новое значение.

    """
```

**Как работает функция**:

- Функция обрабатывает событие изменения значения в выпадающем списке языков.
- Извлекает новое значение (язык и валюту) из словаря изменений.
- Разбивает строку с языком и валютой на отдельные компоненты.
- Повторно инициализирует редактор кампании с новым языком и валютой.

**Примеры**:

```python
editor_widgets.on_language_change({'new': 'EN USD'})
```

### `save_campaign`

```python
def save_campaign(self, _):
    """Сохраняет кампанию и ее категории.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    """
```

**Как работает функция**:

- Функция сохраняет кампанию и ее категории, используя значения, выбранные в выпадающих списках.
- Извлекает значения имени кампании, имени категории и языка/валюты из соответствующих выпадающих списков.
- Создает экземпляр класса `AliCampaignEditor` с выбранными параметрами.
- Вызывает метод `save_categories_from_worksheet` для сохранения категорий из Google Spreadsheet.
- Обрабатывает возможные исключения при сохранении кампании и записывает ошибки в лог.
- Если имя кампании и язык не выбраны, выводит предупреждение в лог.

**Примеры**:

```python
editor_widgets.save_campaign(None)
```

### `show_products`

```python
def show_products(self, _):
    """Отображает товары в выбранной категории.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    """
```

**Как работает функция**:

- Функция отображает товары в выбранной категории, используя `AliCampaignEditor`.
- Получает имя кампании и имя категории из выпадающих списков.
- Создает экземпляр `AliCampaignEditor` с выбранными именем кампании, языком и валютой.
- Вызывает метод `set_products_worksheet` для установки рабочего листа с продуктами для выбранной категории.
- В случае ошибки при отображении товаров, записывает сообщение об ошибке в лог.

**Примеры**:

```python
editor_widgets.show_products(None)
```

### `open_spreadsheet`

```python
def open_spreadsheet(self, _):
    """Открывает Google Spreadsheet в браузере.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    """
```

**Как работает функция**:

- Функция открывает связанный Google Spreadsheet в браузере.
- Проверяет, инициализирован ли редактор кампании (`self.campaign_editor`).
- Если редактор инициализирован, формирует URL для Google Spreadsheet на основе `spreadsheet_id`.
- Открывает URL в браузере с помощью `webbrowser.open()`.
- Если редактор не инициализирован, выводит сообщение о необходимости инициализации редактора кампании.

**Примеры**:

```python
editor_widgets.open_spreadsheet(None)
```

### `setup_callbacks`

```python
def setup_callbacks(self):
    """Устанавливает обратные вызовы для виджетов."""
```

**Как работает функция**:

- Функция устанавливает обратные вызовы (callbacks) для различных виджетов, чтобы реагировать на изменения и события.
- Использует метод `observe` для выпадающих списков (`campaign_name_dropdown`, `category_name_dropdown`, `language_dropdown`), чтобы при изменении их значений вызывались соответствующие обработчики (`on_campaign_name_change`, `on_category_change`, `on_language_change`).
- Использует метод `on_click` для кнопок (`initialize_button`, `save_button`, `show_products_button`, `open_spreadsheet_button`), чтобы при нажатии на них вызывались соответствующие функции (`initialize_campaign_editor`, `save_campaign`, `show_products`, `open_spreadsheet`).

### `display_widgets`

```python
def display_widgets(self):
    """Отображает виджеты для взаимодействия в Jupyter notebook.

    Инициализирует редактор кампаний автоматически с первой выбранной кампанией.
    """
```

**Как работает функция**:

- Функция отображает все необходимые виджеты в Jupyter Notebook для взаимодействия с редактором кампаний AliExpress.
- Использует функцию `display` из библиотеки `IPython.display` для отображения виджетов: выпадающих списков (`campaign_name_dropdown`, `category_name_dropdown`, `language_dropdown`) и кнопок (`initialize_button`, `save_button`, `show_products_button`, `open_spreadsheet_button`).
- Автоматически инициализирует редактор кампаний с первой выбранной кампанией, вызывая метод `initialize_campaign_editor`.

**Примеры**:

```python
editor_widgets.display_widgets()
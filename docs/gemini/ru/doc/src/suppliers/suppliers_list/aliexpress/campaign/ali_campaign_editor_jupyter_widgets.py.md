# Модуль: ali_campaign_editor_jupyter_widgets

## Обзор

Модуль `ali_campaign_editor_jupyter_widgets.py` предоставляет Jupyter виджеты для редактора кампаний AliExpress. Он содержит класс `JupyterCampaignEditorWidgets`, который позволяет взаимодействовать с кампаниями AliExpress и управлять ими, включая выбор кампаний, категорий и языков, а также выполнение действий, таких как инициализация редакторов, сохранение кампаний и отображение товаров.

## Подробнее

Модуль предназначен для использования в Jupyter Notebook и предоставляет интерактивный интерфейс для управления кампаниями AliExpress. Он использует виджеты `ipywidgets` для создания выпадающих списков, кнопок и других элементов управления.

## Классы

### `JupyterCampaignEditorWidgets`

**Описание**: Класс `JupyterCampaignEditorWidgets` предоставляет виджеты для редактора кампаний AliExpress.

**Принцип работы**:
Класс инициализирует виджеты для выбора кампаний, категорий и языков. Он также настраивает значения по умолчанию и обратные вызовы для виджетов. При инициализации создаются выпадающие списки для выбора названия кампании, категории и языка/валюты, а также кнопки для инициализации редактора кампании, сохранения кампании, отображения товаров и открытия Google Spreadsheet.

**Атрибуты**:

- `language` (str): Выбранный язык кампании.
- `currency` (str): Выбранная валюта кампании.
- `campaign_name` (str): Выбранное название кампании.
- `category_name` (str): Выбранное название категории.
- `category` (SimpleNamespace): Выбранная категория.
- `campaign_editor` (AliCampaignEditor): Редактор кампании AliExpress.
- `products` (list[SimpleNamespace]): Список товаров в выбранной категории.
- `campaigns_directory` (str): Путь к директории с кампаниями.
- `campaign_name_dropdown` (widgets.Dropdown): Виджет выпадающего списка для выбора названия кампании.
- `category_name_dropdown` (widgets.Dropdown): Виджет выпадающего списка для выбора категории.
- `language_dropdown` (widgets.Dropdown): Виджет выпадающего списка для выбора языка/валюты.
- `initialize_button` (widgets.Button): Виджет кнопки для инициализации редактора кампании.
- `save_button` (widgets.Button): Виджет кнопки для сохранения кампании.
- `show_products_button` (widgets.Button): Виджет кнопки для отображения товаров.
- `open_spreadsheet_button` (widgets.Button): Виджет кнопки для открытия Google Spreadsheet.

**Методы**:

- `__init__`
- `initialize_campaign_editor`
- `update_category_dropdown`
- `on_campaign_name_change`
- `on_category_change`
- `on_language_change`
- `save_campaign`
- `show_products`
- `open_spreadsheet`
- `setup_callbacks`
- `display_widgets`

## Методы класса

### `__init__`

```python
def __init__(self):
    """Инициализирует виджеты и настраивает редактор кампании.

    Настраивает виджеты для выбора кампаний, категорий и языков. Также устанавливает
    значения по умолчанию и обратные вызовы для виджетов.
    """
```

**Назначение**: Инициализирует виджеты и настраивает редактор кампании.

**Как работает функция**:
Функция выполняет следующие действия:
1. Определяет путь к директории с кампаниями (`campaigns_directory`).
2. Проверяет существование директории с кампаниями. Если директория не существует, выбрасывает исключение `FileNotFoundError`.
3. Создает виджеты выпадающих списков для выбора названия кампании (`campaign_name_dropdown`), категории (`category_name_dropdown`) и языка/валюты (`language_dropdown`).
4. Создает виджеты кнопок для инициализации редактора кампании (`initialize_button`), сохранения кампании (`save_button`), отображения товаров (`show_products_button`) и открытия Google Spreadsheet (`open_spreadsheet_button`).
5. Настраивает обратные вызовы для виджетов с помощью метода `setup_callbacks`.
6. Инициализирует редактор кампании со значениями по умолчанию, вызывая метод `initialize_campaign_editor`.

### `initialize_campaign_editor`

```python
def initialize_campaign_editor(self, _):
    """Инициализирует редактор кампании.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    Настраивает редактор кампании на основе выбранной кампании и категории.
    """
```

**Назначение**: Инициализирует редактор кампании.

**Параметры**:
- `_`: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

**Как работает функция**:
Функция выполняет следующие действия:
1. Извлекает выбранные значения из выпадающих списков `campaign_name_dropdown`, `category_name_dropdown` и `language_dropdown`.
2. Разделяет значение `language_dropdown` на язык и валюту.
3. Если выбрано название кампании, вызывает метод `update_category_dropdown` для обновления выпадающего списка категорий.
4. Создает экземпляр класса `AliCampaignEditor` с выбранными параметрами.
5. Если выбрана категория, получает категорию и список товаров для выбранной категории с помощью методов `get_category` и `get_category_products` класса `AliCampaignEditor`.
6. Если название кампании не выбрано, логирует предупреждение с помощью `logger.warning`.

### `update_category_dropdown`

```python
def update_category_dropdown(self, campaign_name: str):
    """Обновляет выпадающий список категорий на основе выбранной кампании.

    Args:
        campaign_name (str): Название кампании.

    Example:
        >>> self.update_category_dropdown("SummerSale")
    """
```

**Назначение**: Обновляет выпадающий список категорий на основе выбранной кампании.

**Параметры**:
- `campaign_name` (str): Название кампании.

**Как работает функция**:
Функция выполняет следующие действия:
1. Формирует путь к директории категорий кампании.
2. Получает список названий директорий категорий с помощью функции `get_directory_names`.
3. Обновляет параметры выпадающего списка категорий `category_name_dropdown` полученным списком.

### `on_campaign_name_change`

```python
def on_campaign_name_change(self, change: dict[str, str]):
    """Обрабатывает изменения в выпадающем списке названий кампаний.

    Args:
        change (dict[str, str]): Словарь изменений, содержащий новое значение.

    Example:
        >>> self.on_campaign_name_change({'new': 'SummerSale'})
    """
```

**Назначение**: Обрабатывает изменения в выпадающем списке названий кампаний.

**Параметры**:
- `change` (dict[str, str]): Словарь изменений, содержащий новое значение.

**Как работает функция**:
Функция выполняет следующие действия:
1. Извлекает новое название кампании из словаря `change`.
2. Обновляет атрибут `campaign_name` новым значением.
3. Вызывает метод `update_category_dropdown` для обновления выпадающего списка категорий.
4. Вызывает метод `initialize_campaign_editor` для повторной инициализации редактора кампании с новым названием кампании.

### `on_category_change`

```python
def on_category_change(self, change: dict[str, str]):
    """Обрабатывает изменения в выпадающем списке категорий.

    Args:
        change (dict[str, str]): Словарь изменений, содержащий новое значение.

    Example:
        >>> self.on_category_change({'new': 'Electronics'})
    """
```

**Назначение**: Обрабатывает изменения в выпадающем списке категорий.

**Параметры**:
- `change` (dict[str, str]): Словарь изменений, содержащий новое значение.

**Как работает функция**:
Функция выполняет следующие действия:
1. Извлекает новое название категории из словаря `change`.
2. Обновляет атрибут `category_name` новым значением.
3. Вызывает метод `initialize_campaign_editor` для повторной инициализации редактора кампании с новой категорией.

### `on_language_change`

```python
def on_language_change(self, change: dict[str, str]):
    """Обрабатывает изменения в выпадающем списке языков.

    Args:
        change (dict[str, str]): Словарь изменений, содержащий новое значение.

    Example:
        >>> self.on_language_change({'new': 'EN USD'})
    """
```

**Назначение**: Обрабатывает изменения в выпадающем списке языков.

**Параметры**:
- `change` (dict[str, str]): Словарь изменений, содержащий новое значение.

**Как работает функция**:
Функция выполняет следующие действия:
1. Извлекает новое значение языка/валюты из словаря `change`.
2. Разделяет значение на язык и валюту.
3. Обновляет атрибуты `language` и `currency` новыми значениями.
4. Вызывает метод `initialize_campaign_editor` для повторной инициализации редактора кампании с новым языком/валютой.

### `save_campaign`

```python
def save_campaign(self, _):
    """Сохраняет кампанию и ее категории.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    Example:
        >>> self.save_campaign(None)
    """
```

**Назначение**: Сохраняет кампанию и ее категории.

**Параметры**:
- `_`: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

**Как работает функция**:
Функция выполняет следующие действия:
1. Извлекает выбранные значения из выпадающих списков `campaign_name_dropdown`, `category_name_dropdown` и `language_dropdown`.
2. Разделяет значение `language_dropdown` на язык и валюту.
3. Если выбраны название кампании и язык, создает экземпляр класса `AliCampaignEditor` с выбранными параметрами.
4. Вызывает метод `save_categories_from_worksheet` класса `AliCampaignEditor` для сохранения категорий из Google Spreadsheet.
5. В случае возникновения ошибки логирует ошибку с помощью `logger.error`.
6. Если название кампании или язык не выбраны, логирует предупреждение с помощью `logger.warning`.

### `show_products`

```python
def show_products(self, _):
    """Отображает товары в выбранной категории.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    Example:
        >>> self.show_products(None)
    """
```

**Назначение**: Отображает товары в выбранной категории.

**Параметры**:
- `_`: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

**Как работает функция**:
Функция выполняет следующие действия:
1. Извлекает выбранные значения из выпадающих списков `campaign_name_dropdown` и `category_name_dropdown`.
2. Создает экземпляр класса `AliCampaignEditor` с выбранными параметрами.
3. Вызывает метод `set_products_worksheet` класса `AliCampaignEditor` для отображения товаров в Google Spreadsheet.
4. В случае возникновения ошибки логирует ошибку с помощью `logger.error`.

### `open_spreadsheet`

```python
def open_spreadsheet(self, _):
    """Открывает Google Spreadsheet в браузере.

    Args:
        _: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

    Example:
        >>> self.open_spreadsheet(None)
    """
```

**Назначение**: Открывает Google Spreadsheet в браузере.

**Параметры**:
- `_`: Неиспользуемый аргумент, необходимый для обратного вызова кнопки.

**Как работает функция**:
Функция выполняет следующие действия:
1. Если редактор кампании (`campaign_editor`) инициализирован, формирует URL-адрес Google Spreadsheet.
2. Открывает URL-адрес в браузере с помощью модуля `webbrowser`.
3. Если редактор кампании не инициализирован, выводит сообщение "Please initialize the campaign editor first."

### `setup_callbacks`

```python
def setup_callbacks(self):
    """Настраивает обратные вызовы для виджетов."""
```

**Назначение**: Настраивает обратные вызовы для виджетов.

**Как работает функция**:
Функция выполняет следующие действия:
1. Настраивает обратные вызовы для виджетов выпадающих списков `campaign_name_dropdown`, `category_name_dropdown` и `language_dropdown` для обработки изменений значений.
2. Настраивает обратные вызовы для виджетов кнопок `initialize_button`, `save_button`, `show_products_button` и `open_spreadsheet_button` для обработки нажатий.

### `display_widgets`

```python
def display_widgets(self):
    """Отображает виджеты для взаимодействия в Jupyter Notebook.

    Инициализирует редактор кампании автоматически при выборе первой кампании.

    Example:
        >>> self.display_widgets()
    """
```

**Назначение**: Отображает виджеты для взаимодействия в Jupyter Notebook.

**Как работает функция**:
Функция выполняет следующие действия:
1. Отображает виджеты выпадающих списков и кнопок в Jupyter Notebook с помощью функции `display`.
2. Инициализирует редактор кампании с первой выбранной кампанией, вызывая метод `initialize_campaign_editor`.

## Примеры

```python
>>> editor_widgets: JupyterCampaignEditorWidgets = JupyterCampaignEditorWidgets()
>>> editor_widgets.display_widgets()
```
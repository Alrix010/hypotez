# Модуль CategoryEditor

## Обзор

Этот модуль содержит класс `CategoryEditor`, который представляет собой графический интерфейс (GUI) для подготовки рекламных кампаний на AliExpress. 

## Подробней

Модуль реализует класс `CategoryEditor` с графическим интерфейсом, который позволяет пользователю загрузить файл JSON с описанием рекламной кампании, просмотреть ее данные и выполнить подготовку категорий. 

Класс `CategoryEditor` использует библиотеку `PyQt6` для создания GUI. Пользовательский интерфейс включает в себя следующие элементы:

- Кнопка "Open JSON File" для открытия диалога выбора файла и загрузки JSON-файла с описанием рекламной кампании.
- Метка "File: {file_path}", отображающая имя выбранного файла.
- Кнопка "Prepare All Categories" для запуска асинхронной операции подготовки всех категорий в рекламной кампании.
- Кнопка "Prepare Category" для запуска асинхронной операции подготовки выбранной категории в рекламной кампании.

## Классы

### `CategoryEditor`

**Описание**: Класс `CategoryEditor` представляет собой основное окно GUI для подготовки рекламных кампаний. Он реализует графический интерфейс, логику загрузки JSON-файла, а также асинхронные функции для подготовки категорий.

**Наследует**: `QtWidgets.QWidget`

**Атрибуты**:

- `campaign_name` (str): Имя рекламной кампании.
- `data` (SimpleNamespace): Объект `SimpleNamespace`, хранящий данные рекламной кампании, загруженные из JSON-файла.
- `language` (str): Язык рекламной кампании.
- `currency` (str): Валюта рекламной кампании.
- `file_path` (str): Путь к JSON-файлу с описанием рекламной кампании.
- `editor` (AliCampaignEditor): Объект `AliCampaignEditor`, используемый для подготовки категорий.
- `main_app` (MainApp):  Ссылка на основной класс приложения.


**Методы**:

- `__init__(self, parent=None, main_app=None)`: Конструктор класса. Инициализирует графический интерфейс и устанавливает подключения.
- `setup_ui(self)`: Метод для настройки элементов пользовательского интерфейса.
- `setup_connections(self)`: Метод для установки соединений между сигналами и слотами.
- `open_file(self)`: Метод, вызываемый при нажатии на кнопку "Open JSON File". Отвечает за открытие диалога выбора файла и загрузку JSON-файла.
- `load_file(self, campaign_file)`: Метод для загрузки JSON-файла и инициализации данных рекламной кампании.
- `create_widgets(self, data)`: Метод для создания виджетов на основе данных, загруженных из JSON-файла.
- `prepare_all_categories_async(self)`: Асинхронный метод для подготовки всех категорий в рекламной кампании.
- `prepare_category_async(self)`: Асинхронный метод для подготовки выбранной категории в рекламной кампании.

**Принцип работы**:

Класс `CategoryEditor` работает следующим образом:

1. При создании объекта `CategoryEditor` вызывается метод `__init__`, который инициализирует GUI и устанавливает подключения между сигналами и слотами.
2. При нажатии на кнопку "Open JSON File" вызывается метод `open_file`, который открывает диалог выбора файла и позволяет пользователю выбрать JSON-файл с описанием рекламной кампании.
3. Метод `load_file` загружает выбранный JSON-файл и инициализирует данные рекламной кампании. Затем он создает объект `AliCampaignEditor` и выводит данные о рекламной кампании на экран.
4. При нажатии на кнопки "Prepare All Categories" или "Prepare Category" вызываются асинхронные методы `prepare_all_categories_async` или `prepare_category_async` соответственно, которые запускают процесс подготовки категорий с использованием объекта `AliCampaignEditor`. 
5. В методе `create_widgets` создаются виджеты на основе данных из JSON-файла, включая заголовок, имя кампании и список категорий.

## Функции

### `prepare_all_categories_async`

**Назначение**: Асинхронная функция для подготовки всех категорий в рекламной кампании.

**Параметры**: None

**Возвращает**: None

**Вызывает исключения**: `Exception`

**Пример**:

```python
# Пример вызова функции:
category_editor.prepare_all_categories_async() 
```

**Как работает функция**:

- Функция `prepare_all_categories_async` использует объект `AliCampaignEditor` для подготовки всех категорий в рекламной кампании. 
- Она вызывается асинхронно с помощью декоратора `@asyncSlot`.
- Функция пытается вызвать метод `prepare_all_categories` объекта `AliCampaignEditor`.
- Если возникает исключение, выводится диалоговое окно с сообщением об ошибке.

### `prepare_category_async`

**Назначение**: Асинхронная функция для подготовки выбранной категории в рекламной кампании.

**Параметры**: None

**Возвращает**: None

**Вызывает исключения**: `Exception`

**Пример**:

```python
# Пример вызова функции:
category_editor.prepare_category_async()
```

**Как работает функция**:

- Функция `prepare_category_async` использует объект `AliCampaignEditor` для подготовки выбранной категории.
- Она вызывается асинхронно с помощью декоратора `@asyncSlot`.
- Функция пытается вызвать метод `prepare_category` объекта `AliCampaignEditor` с передачей имени рекламной кампании (`self.data.campaign_name`).
- Если возникает исключение, выводится диалоговое окно с сообщением об ошибке.

## Параметры класса

- `campaign_name` (str): Имя рекламной кампании.
- `data` (SimpleNamespace): Объект `SimpleNamespace`, хранящий данные рекламной кампании, загруженные из JSON-файла.
- `language` (str): Язык рекламной кампании.
- `currency` (str): Валюта рекламной кампании.
- `file_path` (str): Путь к JSON-файлу с описанием рекламной кампании.
- `editor` (AliCampaignEditor): Объект `AliCampaignEditor`, используемый для подготовки категорий.
- `main_app` (MainApp):  Ссылка на основной класс приложения.

## Примеры

```python
# Создание экземпляра класса CategoryEditor
category_editor = CategoryEditor()

# Загрузка JSON-файла
category_editor.open_file()

# Подготовка всех категорий
category_editor.prepare_all_categories_async()

# Подготовка выбранной категории
category_editor.prepare_category_async()
```
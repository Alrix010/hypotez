# Модуль: `src.suppliers.suppliers_list.aliexpress.gui.campaign`

## Обзор

Модуль предоставляет графический интерфейс (GUI) для редактирования кампаний AliExpress. Он позволяет открывать, редактировать и подготавливать JSON файлы, содержащие информацию о кампании.

## Подробней

Этот модуль реализует редактор кампаний AliExpress в виде виджета PyQt6. Он позволяет пользователям загружать JSON файлы кампаний, просматривать и редактировать основные параметры, такие как заголовок, описание и название акции. После редактирования, кампания может быть подготовлена с использованием функциональности, предоставляемой классом `AliCampaignEditor`.
Модуль использует библиотеку `qasync` для асинхронного выполнения операций подготовки кампании.

## Классы

### `CampaignEditor`

**Описание**: Класс `CampaignEditor` представляет собой виджет для редактирования кампаний AliExpress.

**Наследует**: `QtWidgets.QWidget`

**Атрибуты**:
- `data` (SimpleNamespace): Пространство имен для хранения данных кампании.
- `current_campaign_file` (str): Путь к текущему файлу кампании.
- `editor` (AliCampaignEditor): Экземпляр редактора кампании.
- `main_app`: Ссылка на главный экземпляр приложения.
- `open_button`: Кнопка для открытия файла кампании.
- `file_name_label`: Метка для отображения имени выбранного файла.
- `prepare_button`: Кнопка для подготовки кампании.
- `scroll_area`: Область прокрутки для содержимого виджета.
- `scroll_content_widget`: Виджет содержимого области прокрутки.
- `layout`: Менеджер компоновки для организации виджетов.
- `title_input`: Поле ввода для заголовка кампании.
- `description_input`: Поле ввода для описания кампании.
- `promotion_name_input`: Поле ввода для названия акции.

**Принцип работы**:

Класс `CampaignEditor` создает пользовательский интерфейс для редактирования параметров кампании. Он включает в себя кнопки для открытия файла кампании, отображения имени файла, подготовки кампании, а также поля ввода для редактирования заголовка, описания и названия акции.

Когда пользователь нажимает кнопку "Open JSON File", открывается диалоговое окно выбора файла, позволяющее выбрать JSON файл кампании. После выбора файла, его содержимое загружается и отображается в соответствующих полях ввода. После внесения изменений пользователь может нажать кнопку "Prepare Campaign", чтобы подготовить кампанию.

**Методы**:

- `__init__(parent=None, main_app=None)`: Инициализирует виджет `CampaignEditor`.
- `setup_ui()`: Настраивает пользовательский интерфейс.
- `setup_connections()`: Настраивает соединения сигнал-слот.
- `open_file()`: Открывает диалоговое окно выбора файла для загрузки JSON файла.
- `load_file(campaign_file)`: Загружает JSON файл кампании и создает виджеты для редактирования данных.
- `create_widgets(data)`: Создает виджеты для отображения и редактирования данных кампании.
- `prepare_campaign()`: Асинхронно подготавливает кампанию.

## Методы класса

### `__init__`

```python
def __init__(self, parent=None, main_app=None):
    """ Initialize the CampaignEditor widget """
```

**Назначение**: Инициализирует виджет `CampaignEditor`.

**Параметры**:
- `parent` (QtWidgets.QWidget, optional): Родительский виджет. По умолчанию `None`.
- `main_app` (MainApp, optional): Экземпляр главного приложения. По умолчанию `None`.

**Возвращает**: `None`

**Как работает функция**:
- Вызывает конструктор родительского класса `QtWidgets.QWidget`.
- Сохраняет ссылку на экземпляр главного приложения `main_app`.
- Вызывает методы `setup_ui()` и `setup_connections()` для настройки пользовательского интерфейса и соединений сигнал-слот.

**Примеры**:
```python
editor = CampaignEditor(main_app=main_app_instance)
```

### `setup_ui`

```python
def setup_ui(self):
    """ Setup the user interface """
```

**Назначение**: Настраивает пользовательский интерфейс виджета.

**Параметры**:
- `self`: Ссылка на экземпляр класса.

**Возвращает**: `None`

**Как работает функция**:
- Устанавливает заголовок окна виджета.
- Устанавливает размеры окна виджета.
- Создает область прокрутки `QScrollArea` и виджет содержимого `QWidget` для размещения элементов интерфейса.
- Создает менеджер компоновки `QGridLayout` для организации виджетов.
- Создает кнопки "Open JSON File" и "Prepare Campaign", а также метку `QLabel` для отображения имени файла.
- Добавляет созданные виджеты в менеджер компоновки.
- Устанавливает менеджер компоновки для виджета.

**Примеры**:
```python
editor = CampaignEditor()
editor.setup_ui()
```

### `setup_connections`

```python
def setup_connections(self):
    """ Setup signal-slot connections """
```

**Назначение**: Настраивает соединения сигнал-слот для обработки событий пользовательского интерфейса.

**Параметры**:
- `self`: Ссылка на экземпляр класса.

**Возвращает**: `None`

**Как работает функция**:
- В текущей реализации функция пуста и не выполняет никаких действий.
- <инструкция для модели gemini:В будущем здесь можно добавить соединения для обработки событий, таких как нажатия кнопок и изменения текста в полях ввода.>

**Примеры**:
```python
editor = CampaignEditor()
editor.setup_connections()
```

### `open_file`

```python
def open_file(self):
    """ Open a file dialog to select and load a JSON file """
```

**Назначение**: Открывает диалоговое окно выбора файла для загрузки JSON файла кампании.

**Параметры**:
- `self`: Ссылка на экземпляр класса.

**Возвращает**: `None`

**Как работает функция**:
- Функция открывает диалоговое окно выбора файла с помощью `QtWidgets.QFileDialog.getOpenFileName`.
- Пользователь может выбрать JSON файл из файловой системы.
- Если файл выбран, вызывается метод `load_file` для загрузки содержимого файла.

**Примеры**:
```python
editor = CampaignEditor()
editor.open_file()
```

### `load_file`

```python
def load_file(self, campaign_file):
    """ Load a JSON file """
```

**Назначение**: Загружает JSON файл кампании и создает виджеты для редактирования данных.

**Параметры**:
- `self`: Ссылка на экземпляр класса.
- `campaign_file` (str): Путь к JSON файлу кампании.

**Возвращает**: `None`

**Как работает функция**:
- Функция пытается загрузить JSON файл, используя функцию `j_loads_ns`.
- При успешной загрузке, данные сохраняются в атрибуте `data`, а путь к файлу - в атрибуте `current_campaign_file`.
- Отображает имя файла в метке `file_name_label`.
- Вызывает метод `create_widgets` для создания виджетов на основе загруженных данных.
- Создает экземпляр класса `AliCampaignEditor` для подготовки кампании.
- В случае ошибки, отображает сообщение об ошибке с помощью `QMessageBox.critical`.

**Примеры**:
```python
editor = CampaignEditor()
editor.load_file("campaign.json")
```

### `create_widgets`

```python
def create_widgets(self, data):
    """ Create widgets based on the data loaded from the JSON file """
```

**Назначение**: Создает виджеты для отображения и редактирования данных кампании.

**Параметры**:
- `self`: Ссылка на экземпляр класса.
- `data` (SimpleNamespace): Данные кампании, загруженные из JSON файла.

**Возвращает**: `None`

**Как работает функция**:
- Функция очищает существующие виджеты из макета, за исключением кнопок "Open JSON File", "Prepare Campaign" и метки `file_name_label`.
- Создает поля ввода `QLineEdit` для редактирования заголовка, описания и названия акции.
- Добавляет метки `QLabel` для описания каждого поля ввода.
- Добавляет поля ввода и метки в макет.

**Примеры**:
```python
data = SimpleNamespace(title="Campaign Title", description="Campaign Description", promotion_name="Promotion Name")
editor = CampaignEditor()
editor.create_widgets(data)
```

### `prepare_campaign`

```python
@asyncSlot()
async def prepare_campaign(self):
    """ Asynchronously prepare the campaign """
```

**Назначение**: Асинхронно подготавливает кампанию.

**Параметры**:
- `self`: Ссылка на экземпляр класса.

**Возвращает**: `None`

**Как работает функция**:
- Функция асинхронно подготавливает кампанию, используя экземпляр класса `AliCampaignEditor`.
- Если `self.editor` существует, вызывается метод `prepare()` асинхронно.
- В случае успеха, отображается сообщение об успешной подготовке кампании.
- В случае ошибки, отображается сообщение об ошибке с помощью `QMessageBox.critical`.

**Примеры**:
```python
editor = CampaignEditor()
await editor.prepare_campaign()
```
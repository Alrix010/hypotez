# Модуль для редактирования кампаний AliExpress

## Обзор

Модуль предоставляет графический интерфейс для редактирования кампаний AliExpress. Он позволяет открывать JSON файлы с данными кампаний, редактировать их параметры и подготавливать кампании к использованию.

## Подробней

Этот модуль является частью проекта `hypotez` и предназначен для работы с кампаниями AliExpress. Он предоставляет пользователю возможность визуально редактировать файлы конфигурации кампаний через графический интерфейс, построенный на основе библиотеки PyQt6. Модуль включает в себя функции для открытия файлов, загрузки данных, создания виджетов для редактирования данных и подготовки кампаний.

## Классы

### `CampaignEditor`

**Описание**: Основной класс, представляющий виджет редактора кампаний.

**Наследует**: `QtWidgets.QWidget`

**Атрибуты**:
- `data` (SimpleNamespace): Данные кампании, загруженные из JSON файла.
- `current_campaign_file` (str): Путь к текущему открытому файлу кампании.
- `editor` (AliCampaignEditor): Экземпляр редактора кампаний AliCampaignEditor.
- `main_app`: Ссылка на главный экземпляр приложения.
- `open_button`: Кнопка для открытия файла.
- `file_name_label`:  Метка для отображения имени файла.
- `scroll_area`: Область прокрутки для содержимого.
- `scroll_content_widget`: Виджет содержимого области прокрутки.
- `layout`:  Макет сетки для размещения виджетов.
- `prepare_button`: Кнопка для подготовки кампании.
- `title_input`: Поле ввода для заголовка кампании.
- `description_input`: Поле ввода для описания кампании.
- `promotion_name_input`: Поле ввода для имени продвижения кампании.

**Принцип работы**:
Класс `CampaignEditor` создает графический интерфейс для редактирования параметров кампании. Он включает в себя кнопку для открытия JSON файла с данными кампании, поля для редактирования заголовка, описания и имени продвижения кампании, а также кнопку для подготовки кампании. При открытии файла данные из файла загружаются и отображаются в соответствующих полях ввода. При нажатии на кнопку "Prepare Campaign" вызывается метод `prepare()` объекта `AliCampaignEditor`, который выполняет подготовку кампании.

**Методы**:
- `__init__(parent=None, main_app=None)`: Инициализирует виджет `CampaignEditor`.
- `setup_ui()`: Настраивает пользовательский интерфейс.
- `setup_connections()`: Настраивает соединения между сигналами и слотами.
- `open_file()`: Открывает диалоговое окно выбора файла для загрузки JSON файла кампании.
- `load_file(campaign_file)`: Загружает JSON файл кампании.
- `create_widgets(data)`: Создает виджеты на основе данных, загруженных из JSON файла.
- `prepare_campaign()`: Асинхронно подготавливает кампанию.

## Методы класса

### `__init__`

```python
def __init__(self, parent=None, main_app=None):
    """
    Инициализирует виджет CampaignEditor.

    Args:
        parent (QWidget, optional): Родительский виджет. По умолчанию None.
        main_app (MainApp, optional): Экземпляр главного приложения. По умолчанию None.
    """
    ...
```

**Назначение**:
Инициализирует виджет `CampaignEditor`, вызывая конструктор родительского класса `QtWidgets.QWidget`, сохраняя ссылку на главный экземпляр приложения и настраивая пользовательский интерфейс и соединения.

**Параметры**:
- `parent` (QWidget, optional): Родительский виджет. По умолчанию `None`.
- `main_app` (MainApp, optional): Экземпляр главного приложения. По умолчанию `None`.

**Как работает функция**:
- Вызывается конструктор родительского класса `QtWidgets.QWidget` для инициализации базовых атрибутов виджета.
- Сохраняется ссылка на главный экземпляр приложения в атрибуте `self.main_app`.
- Вызывается метод `self.setup_ui()` для настройки пользовательского интерфейса.
- Вызывается метод `self.setup_connections()` для настройки соединений между сигналами и слотами.

**Примеры**:
```python
editor = CampaignEditor(main_app=app)
```

### `setup_ui`

```python
def setup_ui(self):
    """
    Настраивает пользовательский интерфейс виджета.
    """
    ...
```

**Назначение**:
Настраивает пользовательский интерфейс виджета `CampaignEditor`, включая создание и размещение кнопок, полей ввода и других элементов управления.

**Как работает функция**:
- Устанавливает заголовок окна виджета.
- Изменяет размер окна виджета.
- Создает область прокрутки (`QScrollArea`) и виджет содержимого области прокрутки (`QWidget`).
- Создает макет сетки (`QGridLayout`) для размещения виджетов в области прокрутки.
- Создает кнопку "Open JSON File" и устанавливает соединение с методом `self.open_file()`.
- Создает метку для отображения имени файла.
- Создает кнопку "Prepare Campaign" и устанавливает соединение с методом `self.prepare_campaign()`.
- Добавляет созданные виджеты в макет сетки.
- Добавляет область прокрутки в основной макет виджета.

**Примеры**:
```python
self.setup_ui()
```

### `setup_connections`

```python
def setup_connections(self):
    """
    Настраивает соединения между сигналами и слотами.
    """
    ...
```

**Назначение**:
Настраивает соединения между сигналами и слотами для обработки событий пользовательского интерфейса. В данном случае метод пуст, так как соединения настраиваются непосредственно при создании кнопок.

**Как работает функция**:
- В текущей реализации метод не выполняет никаких действий.

**Примеры**:
```python
self.setup_connections()
```

### `open_file`

```python
def open_file(self):
    """
    Открывает диалоговое окно выбора файла для загрузки JSON файла кампании.
    """
    ...
```

**Назначение**:
Открывает диалоговое окно выбора файла, чтобы пользователь мог выбрать JSON файл кампании для загрузки.

**Как работает функция**:
- Вызывает метод `QtWidgets.QFileDialog.getOpenFileName()` для открытия диалогового окна выбора файла.
- Если файл выбран, вызывает метод `self.load_file()` для загрузки файла.

**Примеры**:
```python
self.open_file()
```

### `load_file`

```python
def load_file(self, campaign_file):
    """
    Загружает JSON файл кампании.

    Args:
        campaign_file (str): Путь к файлу кампании.
    """
    ...
```

**Назначение**:
Загружает JSON файл кампании, используя функцию `j_loads_ns` из модуля `src.utils.jjson`, и отображает имя файла в метке.

**Параметры**:
- `campaign_file` (str): Путь к файлу кампании.

**Как работает функция**:
- Пытается загрузить JSON файл, используя функцию `j_loads_ns`.
- Сохраняет путь к файлу в атрибуте `self.current_campaign_file`.
- Отображает имя файла в метке `self.file_name_label`.
- Создает виджеты на основе загруженных данных, вызывая метод `self.create_widgets()`.
- Создает экземпляр редактора кампаний `AliCampaignEditor`.
- В случае возникновения ошибки отображает сообщение об ошибке.

**Примеры**:
```python
self.load_file('campaign.json')
```

### `create_widgets`

```python
def create_widgets(self, data):
    """
    Создает виджеты на основе данных, загруженных из JSON файла.

    Args:
        data (SimpleNamespace): Данные кампании.
    """
    ...
```

**Назначение**:
Создает виджеты для редактирования данных кампании, загруженных из JSON файла.

**Параметры**:
- `data` (SimpleNamespace): Данные кампании.

**Как работает функция**:
- Удаляет предыдущие виджеты, кроме кнопок "Open JSON File" и "Prepare Campaign", а также метки имени файла.
- Создает поля ввода для заголовка, описания и имени продвижения кампании.
- Добавляет метки и поля ввода в макет сетки.

**Примеры**:
```python
self.create_widgets(data)
```

### `prepare_campaign`

```python
async def prepare_campaign(self):
    """
    Асинхронно подготавливает кампанию.
    """
    ...
```

**Назначение**:
Асинхронно подготавливает кампанию, используя экземпляр `AliCampaignEditor`.

**Как работает функция**:
- Проверяет, существует ли экземпляр `AliCampaignEditor`.
- Вызывает метод `self.editor.prepare()` для подготовки кампании.
- Отображает сообщение об успехе или ошибке в зависимости от результата подготовки.

**Примеры**:
```python
await self.prepare_campaign()
```

## Параметры класса

- `data` (SimpleNamespace): Данные кампании, загруженные из JSON файла.
- `current_campaign_file` (str): Путь к текущему открытому файлу кампании.
- `editor` (AliCampaignEditor): Экземпляр редактора кампаний AliCampaignEditor.

**Примеры**:
```python
self.data = j_loads_ns('campaign.json')
self.current_campaign_file = 'campaign.json'
self.editor = AliCampaignEditor(campaign_file='campaign.json')
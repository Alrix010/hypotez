# Модуль для сбора данных о товарах с сайта KSP
## Обзор

Модуль `graber.py` предназначен для сбора информации о товарах с сайта `ksp.co.il`. Он содержит класс `Graber`, который наследуется от класса `Graber` (Grbr) и переопределяет некоторые его методы для обработки специфичных для KSP полей. Модуль использует веб-драйвер для взаимодействия с сайтом и извлечения данных.

## Подробнее

Этот модуль является частью системы сбора данных о товарах с различных онлайн-магазинов. Он специализируется на сборе данных с сайта `ksp.co.il`. Для каждого поля товара на странице сайта KSP предусмотрена функция обработки, которая может быть переопределена в классе `Graber`, если требуется нестандартная обработка.

## Классы

### `Graber`

**Описание**: Класс `Graber` предназначен для сбора данных о товарах с сайта `ksp.co.il`. Он наследуется от класса `Graber` (Grbr) и переопределяет некоторые его методы для обработки специфичных для KSP полей.

**Наследует**:
- `Graber` (Grbr): Родительский класс, содержащий общую логику для сбора данных о товарах.

**Атрибуты**:
- `supplier_prefix` (str): Префикс поставщика, используется для идентификации KSP.

**Методы**:
- `__init__(driver: 'Driver', lang_index: int)`: Инициализирует класс `Graber`, устанавливает префикс поставщика, вызывает конструктор родительского класса и выполняет дополнительные действия, специфичные для KSP.
- `close_pop_up(value: Any = None)`: Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

**Принцип работы**:
1. Класс инициализируется с указанием драйвера веб-браузера и индекса языка.
2. Устанавливается префикс поставщика (`ksp`).
3. Вызывается конструктор родительского класса `Graber` (Grbr) с указанием префикса поставщика, драйвера и индекса языка.
4. Проверяется, не является ли текущая версия сайта мобильной. Если это так, загружаются соответствующие локаторы для мобильной версии сайта KSP.
5. Значение `Context.locator_for_decorator` устанавливается в `None`, что означает, что декоратор `@close_pop_up` не будет выполняться по умолчанию.

## Методы класса

### `__init__`

```python
def __init__(self, driver: 'Driver', lang_index: int):
    """Инициализация класса сбора полей товара.

    Args:
        driver ('Driver'): Драйвер веб-браузера для взаимодействия с сайтом.
        lang_index (int): Индекс языка, используемый на сайте.

    Raises:
        ExecuteLocatorException: Если происходит ошибка при выполнении локатора.

    Example:
        Создание инстанса класса Graber
        >>> graber = Graber(driver, 0)
    """
    # Инициализация класса `Graber` для сбора данных о товарах с сайта `ksp.co.il`.
    # Устанавливает префикс поставщика, вызывает конструктор родительского класса и выполняет дополнительные действия, специфичные для KSP.
    ...
```

**Назначение**: Инициализирует класс `Graber` для сбора данных о товарах с сайта `ksp.co.il`.

**Параметры**:
- `driver` ('Driver'): Драйвер веб-браузера для взаимодействия с сайтом.
- `lang_index` (int): Индекс языка, используемый на сайте.

**Как работает функция**:
1. Устанавливает атрибут `supplier_prefix` равным `'ksp'`.
2. Вызывает конструктор родительского класса `Graber` (Grbr) с указанием `supplier_prefix`, `driver` и `lang_index`.
3. Приостанавливает выполнение на 3 секунды.
4. Проверяет, содержит ли текущий URL-адрес драйвера подстроку `'/mob/'`. Если да, то загружает локаторы для мобильной версии сайта KSP из файла `product_mobile_site.json` и устанавливает `Context.locator_for_decorator` в `None`.
5. Устанавливает `Context.locator_for_decorator` в `None`.

**Примеры**:
```python
# Пример создания экземпляра класса Graber
driver = Driver(Chrome)  # Создание экземпляра драйвера Chrome
graber = Graber(driver, 0)  # Создание экземпляра класса Graber с драйвером и индексом языка
```

### `close_pop_up`

```python
def close_pop_up(value: Any = None):
    """Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

    Args:
        value (Any): Дополнительное значение для декоратора.

    Returns:
        Callable: Декоратор, оборачивающий функцию.

    """
    #Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.
    ...
```

**Назначение**: Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

**Параметры**:
- `value` (Any, optional): Дополнительное значение для декоратора. По умолчанию `None`.

**Возвращает**:
- `Callable`: Декоратор, оборачивающий функцию.

**Как работает функция**:
1. Функция `close_pop_up` является декоратором, который оборачивает другую функцию.
2. Внутри декоратора определяется функция `wrapper`, которая выполняется перед основной функцией.
3. Внутри `wrapper` происходит попытка закрытия всплывающего окна с использованием локатора, хранящегося в `Context.locator.close_pop_up`.
4. Если возникает исключение `ExecuteLocatorException`, оно логируется.
5. После этого вызывается основная функция и возвращается ее результат.

**Примеры**:
```python
# Пример использования декоратора close_pop_up
@close_pop_up()
async def my_function():
    # Основная логика функции
    ...
```

## Параметры класса

- `supplier_prefix` (str): Префикс поставщика, используемый для идентификации KSP.
- `driver` ('Driver'): Драйвер веб-браузера для взаимодействия с сайтом.
- `lang_index` (int): Индекс языка, используемый на сайте.
- `Context.locator_for_decorator` (None): Указывает, будет ли выполняться декоратор `@close_pop_up`.
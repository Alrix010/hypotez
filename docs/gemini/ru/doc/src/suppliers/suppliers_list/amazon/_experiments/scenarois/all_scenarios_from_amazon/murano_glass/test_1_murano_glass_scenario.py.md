# Документация для модуля `test_1_murano_glass_scenario.py`

## Обзор

Модуль предназначен для экспериментов по сбору данных о товарах (в частности, муранском стекле) с сайта Amazon и их последующей загрузки или обновления в базе данных PrestaShop. Модуль использует веб-драйвер для взаимодействия с сайтом Amazon, извлекает информацию о товаре и, если товар уже существует в базе данных PrestaShop, обновляет его изображение, иначе создает новый товар.

## Подробней

Этот модуль является частью экспериментов по автоматизации процесса получения информации о товарах с Amazon и интеграции с PrestaShop. Он включает в себя настройку сценария, извлечение данных о товаре, проверку наличия товара в базе данных PrestaShop и выполнение соответствующих действий (обновление или создание).

## Классы

### `Supplier`

**Описание**: Класс для управления поставщиком, в данном случае Amazon.

**Наследует**: Не указано.

**Атрибуты**:
- `supplier_id` (str): Идентификатор поставщика (например, 'amazon').
- `current_scenario` (dict): Текущий сценарий, включающий URL, условие, категории PrestaShop и правило цены.
- `locators` (dict): Локаторы элементов на странице товара Amazon.
- `driver` (Driver): Драйвер для управления браузером.

**Методы**:
- `start_supplier()`: Инициализирует поставщика с заданным префиксом.
- `check_if_product_in_presta_db()`: Проверяет наличие товара в базе данных PrestaShop.
- `upload_image2presta()`: Загружает изображение товара в PrestaShop.
- `grab_product_page()`: Извлекает информацию о товаре со страницы товара Amazon.
- `execute_locator()`: Выполняет локатор для поиска элемента на странице.

### `Product`

**Описание**: Класс, представляющий товар.

**Наследует**: Не указано.

**Атрибуты**:
- `product_reference` (str): Уникальный идентификатор товара.
- `product_id` (int): Идентификатор товара в базе данных PrestaShop.

**Методы**:
- `check_if_product_in_presta_db()`: Проверяет, существует ли товар в базе данных PrestaShop по его reference.
- `upload_image2presta()`: Загружает изображение товара в PrestaShop.
- `grab_product_page()`: Извлекает информацию о товаре со страницы товара Amazon.

### `Driver`

**Описание**: Класс для управления веб-драйвером.

**Наследует**: Не указано.

**Атрибуты**:
- `driver` (webdriver): Экземпляр веб-драйвера (например, Chrome, Firefox).

**Методы**:
- `get_url()`: Открывает указанный URL в браузере.
- `execute_locator()`: Выполняет локатор для поиска элемента на странице.

## Функции

###  `start_supplier`

**Назначение**: Инициализирует поставщика с заданным префиксом.

**Параметры**:
- `supplier_prefix` (str): Префикс идентификатора поставщика.

**Возвращает**:
- `Supplier`: Объект класса `Supplier`.

**Как работает функция**:
Функция `start_supplier` создает и настраивает объект класса `Supplier`, используя переданный префикс для идентификатора поставщика. Этот объект используется для дальнейшей работы с данными поставщика, такими как сценарии, локаторы и драйверы.

**Примеры**:
```python
supplier_prefix = 'amazon'
s = start_supplier(supplier_prefix)
```

### `check_if_product_in_presta_db`

**Назначение**: Проверяет, существует ли товар в базе данных PrestaShop по его reference.

**Параметры**:
- `product_reference` (str): Уникальный идентификатор товара.

**Возвращает**:
- `int | bool`: Идентификатор товара (`id_product`) если товар найден, иначе `False`.

**Как работает функция**:
Функция `check_if_product_in_presta_db` выполняет запрос к базе данных PrestaShop для проверки наличия товара с указанным `product_reference`. Если товар найден, возвращается его идентификатор (`id_product`), иначе возвращается `False`.

**Примеры**:
```python
product_reference = f"{s.supplier_id}-{ASIN}"
product_id = Product.check_if_product_in_presta_db(product_reference)
```

### `upload_image2presta`

**Назначение**: Загружает изображение товара в PrestaShop.

**Параметры**:
- `image_url` (str): URL изображения для загрузки.
- `product_id` (int): Идентификатор товара в PrestaShop.

**Возвращает**:
- None

**Как работает функция**:
Функция `upload_image2presta` загружает изображение товара по указанному URL и связывает его с товаром в PrestaShop по идентификатору `product_id`.

**Примеры**:
```python
default_image_url = _(l['additional_images_urls'])[0]
Product.upload_image2presta(image_url = default_image_url, product_id = product_id)
```

### `grab_product_page`

**Назначение**: Извлекает информацию о товаре со страницы товара Amazon.

**Параметры**:
- `s` (Supplier): Объект класса `Supplier`, содержащий информацию о поставщике и драйвере.

**Возвращает**:
- `ProductFields`: Объект класса `ProductFields`, содержащий извлеченные данные о товаре.

**Как работает функция**:
Функция `grab_product_page` использует веб-драйвер для извлечения информации о товаре со страницы товара Amazon. Она использует локаторы, определенные в конфигурации поставщика, для поиска элементов на странице и извлечения данных, таких как название, описание, цена и изображения.

**Примеры**:
```python
product_fields: ProductFields = Product.grab_product_page(s)
```

### `get_url`

**Назначение**: Открывает указанный URL в браузере.

**Параметры**:
- `url` (str): URL для открытия.

**Возвращает**:
- None

**Как работает функция**:
Функция `get_url` использует веб-драйвер для открытия указанного URL в браузере. Это позволяет получить доступ к содержимому страницы для дальнейшего извлечения данных.

**Примеры**:
```python
d.get_url(s.current_scenario['url'])
```

### `execute_locator`

**Назначение**: Выполняет локатор для поиска элемента на странице.

**Параметры**:
- `l` (dict): Словарь, содержащий информацию о локаторе.

**Возвращает**:
- `WebElement | list[WebElement] | str | None`: Найденный веб-элемент, список веб-элементов, текст элемента или `None`, если элемент не найден.

**Как работает функция**:
Функция `execute_locator` использует веб-драйвер для поиска элемента на странице на основе предоставленного локатора. Локатор может быть определен по различным атрибутам, таким как ID, класс, XPath и т.д. Функция возвращает найденный веб-элемент или `None`, если элемент не найден.

**Примеры**:
```python
ASIN = _(l['ASIN'])
```

### `Product.grab_product_page`

**Назначение**: Извлекает данные о товаре со страницы товара и возвращает их в виде объекта `ProductFields`.

**Параметры**:
- `s` (Supplier): Объект класса `Supplier`, содержащий информацию о поставщике и драйвере.

**Возвращает**:
- `ProductFields`: Объект класса `ProductFields`, содержащий извлеченные данные о товаре.

**Как работает функция**:
Функция `Product.grab_product_page` использует веб-драйвер (`s.driver`) для навигации по странице товара и извлечения данных с использованием локаторов, определенных в `s.locators`. Она возвращает объект `ProductFields`, содержащий все извлеченные данные.

**Примеры**:
```python
product_fields: ProductFields = Product.grab_product_page(s)
```

## Переменные

- `supplier_prefix` (str): Префикс идентификатора поставщика (например, 'amazon').
- `s` (Supplier): Объект класса `Supplier`, представляющий поставщика.
- `current_scenario` (dict): Текущий сценарий, включающий URL, условие, категории PrestaShop и правило цены.
- `l` (dict): Локаторы элементов на странице товара Amazon.
- `d` (Driver): Драйвер для управления браузером.
- `ASIN` (str): Уникальный идентификатор товара на Amazon.
- `product_reference` (str): Уникальный идентификатор товара в формате "{supplier_id}-{ASIN}".
- `product_id` (int | bool): Идентификатор товара в базе данных PrestaShop, если товар найден, иначе `False`.
- `default_image_url` (str): URL изображения товара по умолчанию.
- `product_fields` (ProductFields): Объект класса `ProductFields`, содержащий извлеченные данные о товаре.
- `product_dict` (dict): Словарь, содержащий данные о товаре для добавления в PrestaShop.
- `product_name` (list[str]): Список названий товара, извлеченных со страницы.
- `res_product_name` (str): Объединенное название товара из списка `product_name`.
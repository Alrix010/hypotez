# Модуль src.logger

## Обзор

Модуль `src.logger` предоставляет гибкую систему логирования, поддерживающую логирование в консоль, файлы и в формате JSON. Он использует шаблон проектирования Singleton, чтобы обеспечить использование единственного экземпляра логгера во всем приложении. Логгер поддерживает различные уровни логирования (например, `INFO`, `ERROR`, `DEBUG`) и включает цветное отображение для вывода в консоль. Также доступны настройки форматов вывода и управление логированием в различные файлы.

## Подробнее

Модуль `src.logger` реализует логирование в консоль, файлы и в формате JSON, используя стандартный модуль `logging` Python. 

**Основные преимущества:**

- **Шаблон Singleton:** Обеспечивает использование единственного экземпляра логгера во всем приложении.
- **Различные уровни логирования:** Позволяет записывать сообщения с различными уровнями приоритета, например, `INFO`, `ERROR`, `DEBUG`.
- **Цветное отображение:** Предлагает цветное отображение сообщений в консоли для лучшей читаемости.
- **Кастомные форматы:** Поддерживает кастомные форматы вывода, например, для JSON.
- **Управление логированием в файлы:** Позволяет записывать сообщения в различные файлы с гибкой настройкой форматов и уровней.
- **Обработка исключений:** Предоставляет возможность логгировать информацию об исключениях.

## Классы

### `class SingletonMeta`

**Описание**: Метакласс, реализующий шаблон Singleton для логгера.

**Наследует**: `type`

**Атрибуты**:  

**Методы**: 

#### `__call__(cls, *args, **kwargs)`

**Описание**:  Инициализирует единственный экземпляр класса `Logger` при первом обращении к нему.

**Параметры**: 

- `cls`:  Класс `Logger`.
- `*args`:  Дополнительно передаваемые аргументы для инициализации `Logger`.
- `**kwargs`:  Дополнительно передаваемые ключевые аргументы для инициализации `Logger`.

**Возвращает**:  Единственный экземпляр класса `Logger`.

**Как работает функция**:

- Проверяет, существует ли уже экземпляр `Logger` в `cls._instance`.
- Если нет, то создает новый экземпляр `Logger` и сохраняет его в `cls._instance`.
- Возвращает экземпляр `Logger`.

**Примеры**:

- `logger = Logger()` -  Инициализирует единственный экземпляр `Logger`.
- `another_logger = Logger()` -  Возвращает тот же самый экземпляр `Logger`, что и в предыдущем вызове.


### `class JsonFormatter`

**Описание**:  Кастомный форматтер для вывода логов в формате JSON.

**Наследует**:  `logging.Formatter`

**Атрибуты**: 

**Методы**:

#### `format(record: logging.LogRecord) -> str`

**Описание**:  Форматирует сообщение для логгирования в JSON.

**Параметры**: 

- `record`:  Объект `logging.LogRecord`, содержащий информацию о событии логирования.

**Возвращает**:  Сообщение в формате JSON.

**Как работает функция**:

- Создает словарь с информацией о событии логирования, включая время, уровень, сообщение и имя логгера.
- Преобразует словарь в JSON-строку.
- Возвращает JSON-строку.

**Примеры**:

- `formatter = JsonFormatter()` -  Создает новый экземпляр форматера.
- `formatted_message = formatter.format(record)` -  Форматирует сообщение в формате JSON.


### `class Logger`

**Описание**:  Основной класс логгера, поддерживающий логирование в консоль, файлы и в формате JSON.

**Наследует**:  `metaclass=SingletonMeta`

**Атрибуты**: 

- `_info_logger: Optional[logging.Logger] = None`:  Логгер для информации.
- `_debug_logger: Optional[logging.Logger] = None`:  Логгер для отладки.
- `_errors_logger: Optional[logging.Logger] = None`:  Логгер для ошибок.
- `_json_logger: Optional[logging.Logger] = None`:  Логгер для JSON.

**Методы**:

#### `__init__(self, *args, **kwargs)`

**Описание**:  Инициализирует экземпляр класса `Logger` с плейсхолдерами для различных типов логгеров (консоль, файлы и JSON).

**Параметры**: 

- `*args`: Дополнительно передаваемые аргументы для инициализации `Logger`.
- `**kwargs`: Дополнительно передаваемые ключевые аргументы для инициализации `Logger`.

**Возвращает**:  None

**Как работает функция**:

- Инициализирует атрибуты `_info_logger`, `_debug_logger`, `_errors_logger` и `_json_logger` как `None`.

**Примеры**:

- `logger = Logger()` -  Инициализирует новый экземпляр `Logger`.


#### `_configure_logger(self, name: str, log_path: str, level: Optional[int] = logging.DEBUG, formatter: Optional[logging.Formatter] = None, mode: Optional[str] = 'a') -> logging.Logger`

**Описание**: Настраивает и возвращает экземпляр логгера.

**Параметры**:

- `name`: Имя логгера.
- `log_path`: Путь к файлу логов.
- `level`: Уровень логирования, например, `logging.DEBUG`. Значение по умолчанию — `logging.DEBUG`.
- `formatter`: Кастомный форматтер (опционально).
- `mode`: Режим работы с файлом, например, `'a'` для добавления (значение по умолчанию).

**Возвращает**:  Настроенный экземпляр `logging.Logger`.

**Как работает функция**:

- Создает новый экземпляр `logging.Logger`.
- Настраивает уровень логирования и форматтер для логгера.
- Добавляет обработчик для логгера, который записывает сообщения в файл.
- Возвращает настроенный экземпляр `logging.Logger`.

**Примеры**:

- `info_logger = _configure_logger('info', 'logs/info.log')` -  Настраивает логгер `info_logger` для записи информационных сообщений в файл `logs/info.log`.


#### `initialize_loggers(self, info_log_path: Optional[str] = '', debug_log_path: Optional[str] = '', errors_log_path: Optional[str] = '', json_log_path: Optional[str] = '')`

**Описание**:  Инициализирует логгеры для логирования в консоль и файлы (информация, отладка, ошибки и JSON).

**Параметры**: 

- `info_log_path`:  Путь к файлу логов информации (опционально).
- `debug_log_path`:  Путь к файлу логов отладки (опционально).
- `errors_log_path`:  Путь к файлу логов ошибок (опционально).
- `json_log_path`:  Путь к файлу логов в формате JSON (опционально).

**Возвращает**:  None

**Как работает функция**:

- Проверяет, были ли заданы пути к файлам для логов.
- Если да, то настраивает и инициализирует соответствующие логгеры (`_info_logger`, `_debug_logger`, `_errors_logger`, `_json_logger`).
- Инициализирует логгер для консольного вывода с цветовым форматированием.

**Примеры**:

- `logger.initialize_loggers(info_log_path='logs/info.log')` -  Инициализирует логгеры для информации, отладки, ошибок и JSON, если были заданы пути к файлам.


#### `log(self, level, message, ex=None, exc_info=False, color=None)`

**Описание**:  Логирует сообщение на указанном уровне (например, `INFO`, `DEBUG`, `ERROR`) с возможным исключением и цветовым форматированием.

**Параметры**:

- `level`:  Уровень логирования (например, `logging.INFO`, `logging.DEBUG`).
- `message`:  Логируемое сообщение.
- `ex`:  Исключение для логирования (опционально).
- `exc_info`:  Включать информацию об исключении (значение по умолчанию — `False`).
- `color`:  Кортеж цветов текста и фона для консольного вывода (опционально).

**Возвращает**:  None

**Как работает функция**:

- Определяет тип логгера (консоль, файл или JSON) в зависимости от уровня.
- Выводит сообщение в консоль или записывает его в файл.
- Если указано исключение, то логирует его с дополнительной информацией.
- Если заданы цвета, то форматирует сообщение с учетом цветов.

**Примеры**:

- `logger.log(logging.INFO, 'Это информационное сообщение')` -  Логирует информационное сообщение на уровне `INFO`.
- `logger.log(logging.ERROR, 'Это сообщение об ошибке', ex=Exception('Some error'), exc_info=True)` -  Логирует сообщение об ошибке с исключением `Exception('Some error')`.


#### `info(self, message, *args, **kwargs)`

**Описание**:  Логирует информационное сообщение.

**Параметры**:

- `message`:  Логируемое сообщение.
- `*args`:  Дополнительно передаваемые аргументы для форматирования сообщения.
- `**kwargs`:  Дополнительно передаваемые ключевые аргументы для форматирования сообщения.

**Возвращает**:  None

**Как работает функция**:

- Вызывает функцию `log` с уровнем `logging.INFO`.

**Примеры**:

- `logger.info('Это информационное сообщение')` -  Логирует информационное сообщение.


#### `success(self, message, *args, **kwargs)`

**Описание**:  Логирует сообщение об успешной операции.

**Параметры**:

- `message`:  Логируемое сообщение.
- `*args`:  Дополнительно передаваемые аргументы для форматирования сообщения.
- `**kwargs`:  Дополнительно передаваемые ключевые аргументы для форматирования сообщения.

**Возвращает**:  None

**Как работает функция**:

- Вызывает функцию `log` с уровнем `logging.INFO` и цветом `(Fore.GREEN, Back.BLACK)`.

**Примеры**:

- `logger.success('Операция выполнена успешно')` -  Логирует сообщение об успешной операции.


#### `warning(self, message, *args, **kwargs)`

**Описание**:  Логирует предупреждение.

**Параметры**:

- `message`:  Логируемое сообщение.
- `*args`:  Дополнительно передаваемые аргументы для форматирования сообщения.
- `**kwargs`:  Дополнительно передаваемые ключевые аргументы для форматирования сообщения.

**Возвращает**:  None

**Как работает функция**:

- Вызывает функцию `log` с уровнем `logging.WARNING`.

**Примеры**:

- `logger.warning('Возможные проблемы с данными')` -  Логирует предупреждение.


#### `debug(self, message, *args, **kwargs)`

**Описание**:  Логирует сообщение для отладки.

**Параметры**:

- `message`:  Логируемое сообщение.
- `*args`:  Дополнительно передаваемые аргументы для форматирования сообщения.
- `**kwargs`:  Дополнительно передаваемые ключевые аргументы для форматирования сообщения.

**Возвращает**:  None

**Как работает функция**:

- Вызывает функцию `log` с уровнем `logging.DEBUG`.

**Примеры**:

- `logger.debug('Текущее значение переменной: %s', value)` -  Логирует сообщение для отладки.


#### `error(self, message, ex=None, exc_info=False, *args, **kwargs)`

**Описание**:  Логирует сообщение об ошибке.

**Параметры**:

- `message`:  Логируемое сообщение.
- `ex`:  Исключение для логирования (опционально).
- `exc_info`:  Включать информацию об исключении (значение по умолчанию — `False`).
- `*args`:  Дополнительно передаваемые аргументы для форматирования сообщения.
- `**kwargs`:  Дополнительно передаваемые ключевые аргументы для форматирования сообщения.

**Возвращает**:  None

**Как работает функция**:

- Вызывает функцию `log` с уровнем `logging.ERROR` и цветом `(Fore.RED, Back.BLACK)`.

**Примеры**:

- `logger.error('Произошла ошибка при обработке данных', ex=Exception('Some error'), exc_info=True)` -  Логирует сообщение об ошибке с исключением.


#### `critical(self, message, *args, **kwargs)`

**Описание**:  Логирует критическое сообщение.

**Параметры**:

- `message`:  Логируемое сообщение.
- `*args`:  Дополнительно передаваемые аргументы для форматирования сообщения.
- `**kwargs`:  Дополнительно передаваемые ключевые аргументы для форматирования сообщения.

**Возвращает**:  None

**Как работает функция**:

- Вызывает функцию `log` с уровнем `logging.CRITICAL`.

**Примеры**:

- `logger.critical('Критическая ошибка: Сервер недоступен')` -  Логирует критическое сообщение.

## Параметры логгера

Класс `Logger` принимает несколько опциональных параметров для настройки поведения логирования.

- **Уровень**: Контролирует, какие сообщения будут записаны. Основные уровни:
  - `logging.DEBUG`: Подробная информация для диагностики.
  - `logging.INFO`: Общая информация, например, успешные операции.
  - `logging.WARNING`: Предупреждения, не требующие немедленного действия.
  - `logging.ERROR`: Сообщения об ошибках.
  - `logging.CRITICAL`: Критические ошибки, требующие немедленного внимания.

- **Форматтер**: Определяет формат сообщений. По умолчанию используется `'%(asctime)s - %(levelname)s - %(message)s'`. Можно задать кастомный форматтер, например для JSON.

- **Цвета**: Задают цвет текста и фона в консоли. Цвета указываются кортежем:
  - **Цвет текста**: Например, `colorama.Fore.RED`.
  - **Цвет фона**: Например, `colorama.Back.WHITE`.

## Конфигурация для логирования в файл (`config`)

Для записи сообщений в файл можно указать пути в конфигурации.

```python
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
```

## Примеры использования

#### 1. Инициализация логгера:

```python
logger: Logger = Logger()
config = {
    'info_log_path': 'logs/info.log',
    'debug_log_path': 'logs/debug.log',
    'errors_log_path': 'logs/errors.log',
    'json_log_path': 'logs/log.json'
}
logger.initialize_loggers(**config)
```

#### 2. Логирование сообщений:

```python
logger.info('Это информационное сообщение')
logger.success('Это сообщение об успешной операции')
logger.warning('Это предупреждение')
logger.debug('Это сообщение для отладки')
logger.error('Это сообщение об ошибке')
logger.critical('Это критическое сообщение')
```

#### 3. Настройка цветов:

```python
logger.info('Это сообщение будет зеленым', colors=(colorama.Fore.GREEN, colorama.Back.BLACK))
logger.error('Это сообщение с красным фоном', colors=(colorama.Fore.WHITE, colorama.Back.RED))
```

## Внутренние функции

### `_create_logger(name, log_path, level, formatter, mode)`

**Описание**:  Вспомогательная функция для создания и настройки логгера.

**Параметры**:

- `name`:  Имя логгера.
- `log_path`:  Путь к файлу логов.
- `level`:  Уровень логирования.
- `formatter`:  Форматтер для логгера.
- `mode`:  Режим работы с файлом.

**Возвращает**:  Настроенный экземпляр `logging.Logger`.

**Как работает функция**:

- Создает новый экземпляр `logging.Logger`.
- Настраивает уровень логирования и форматтер для логгера.
- Добавляет обработчик для логгера, который записывает сообщения в файл.
- Возвращает настроенный экземпляр `logging.Logger`.

## Примеры использования

#### 1. Простой пример логирования:

```python
import logging
from src.logger import Logger

# Инициализация логгера
logger = Logger()

# Логирование сообщений
logger.info('Это информационное сообщение')
logger.error('Это сообщение об ошибке')
logger.debug('Это сообщение для отладки')
```

#### 2. Логирование в файл:

```python
import logging
from src.logger import Logger

# Инициализация логгера
logger = Logger()
logger.initialize_loggers(info_log_path='logs/info.log', errors_log_path='logs/errors.log')

# Логирование сообщений
logger.info('Это информационное сообщение, которое будет записано в файл logs/info.log')
logger.error('Это сообщение об ошибке, которое будет записано в файл logs/errors.log')
```

#### 3. Логирование в формате JSON:

```python
import logging
from src.logger import Logger, JsonFormatter

# Инициализация логгера
logger = Logger()
logger.initialize_loggers(json_log_path='logs/log.json')

# Создание JSON-форматера
json_formatter = JsonFormatter()
logger.json_logger.setFormatter(json_formatter)

# Логирование сообщений
logger.info('Это информационное сообщение, которое будет записано в файл logs/log.json в формате JSON')
logger.error('Это сообщение об ошибке, которое будет записано в файл logs/log.json в формате JSON')
```

## Дополнительные сведения

- Модуль `src.logger` предоставляет полноценную систему логирования для Python-приложений.
- Вы можете настроить логирование в консоль и файлы с различными форматами и цветами, управлять уровнями логирования и обрабатывать исключения.
- Конфигурация логирования в файлы задается через словарь `config`, что позволяет легко изменять настройки.
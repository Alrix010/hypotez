# Модуль интеграции с Google Generative AI

## Обзор

Класс `GoogleGenerativeAi` предназначен для облегчения взаимодействия с моделями генеративного ИИ Google. 
Этот класс предоставляет методы для отправки запросов, обработки ответов, управления диалогами и интеграции с различными 
функциями ИИ. Он включает в себя надежную обработку ошибок, ведение журнала и настройки конфигурации для обеспечения 
бесперебойной работы.

## Оглавление

- [Ключевые функции](#ключевые-функции)
    - [`__init__(self, api_key: str, model_name: Optional[str] = None, generation_config: Optional[Dict] = None, system_instruction: Optional[str] = None, **kwargs)`](#initself-api_key-str-model_name-optionalstr--none-generation_config-optionaldict--none-system_instruction-optionalstr--none-kwargs)
    - [`config()`](#config)
    - [`_start_chat(self)`](#_start_chatself)
    - [`_save_dialogue(self, dialogue: list)`](#_save_dialogueself-dialogue-list)
    - [`ask(self, q: str, attempts: int = 15) -> Optional[str]`](#askself-q-str-attempts-int--15--optionalstr)
    - [`chat(self, q: str) -> str`](#chatself-q-str--str)
    - [`describe_image(self, image_path: Path) -> Optional[str]`](#describe_imageself-image_path-path--optionalstr)
    - [`upload_file(self, file: str | Path | IOBase, file_name: Optional[str] = None) -> bool`](#upload_fileself-file-str--path--iobase-file_name-optionalstr--none--bool)
- [Обработка ошибок](#обработка-ошибок)
- [Ведение журнала и история](#ведение-журнала-и-история)
- [Зависимости](#зависимости)
- [Пример использования](#пример-использования)

## Ключевые функции

### `__init__(self, api_key: str, model_name: Optional[str] = None, generation_config: Optional[Dict] = None, system_instruction: Optional[str] = None, **kwargs)`

**Назначение**: Инициализирует класс `GoogleGenerativeAi` необходимыми конфигурациями.

**Подробности**:

- Устанавливает ключ API, имя модели, конфигурацию генерации и системную инструкцию.
- Определяет пути для ведения журнала диалогов и хранения истории.
- Инициализирует модель Google Generative AI.

### `config()`

**Назначение**: Получает конфигурацию из файла настроек.

**Подробности**:

- Считывает и анализирует файл конфигурации, расположенный по пути `gs.path.src / \'ai\' / \'gemini\' / \'gemini.json\'`.

### `_start_chat(self)`

**Назначение**: Запускает сеанс чата с моделью ИИ.

**Подробности**:

- Инициализирует сеанс чата с пустой историей.

### `_save_dialogue(self, dialogue: list)`

**Назначение**: Сохраняет диалог в текстовые и JSON-файлы.

**Подробности**:

- Добавляет каждое сообщение в диалоге в текстовый файл.
- Добавляет каждое сообщение в формате JSON в JSON-файл.

### `ask(self, q: str, attempts: int = 15) -> Optional[str]`

**Назначение**: Отправляет текстовый запрос модели ИИ и получает ответ.

**Подробности**:

- Обрабатывает несколько попыток в случае сетевых ошибок или недоступности сервиса.
- Ведет журнал ошибок и повторяет попытки с экспоненциальным отступлением.
- Сохраняет диалог в файлы истории.

### `chat(self, q: str) -> str`

**Назначение**: Отправляет сообщение в чат модели ИИ и получает ответ.

**Подробности**:

- Использует сеанс чата, инициализированный `_start_chat`.
- Ведет журнал ошибок и возвращает текст ответа.

### `describe_image(self, image_path: Path) -> Optional[str]`

**Назначение**: Создает текстовое описание изображения.

**Подробности**:

- Кодирует изображение в base64 и отправляет его модели ИИ.
- Возвращает созданное описание или ведет журнал ошибки, если операция завершается неудачей.

### `upload_file(self, file: str | Path | IOBase, file_name: Optional[str] = None) -> bool`

**Назначение**: Загружает файл в модель ИИ.

**Подробности**:

- Обрабатывает загрузку файла и ведет журнал успешного завершения или неудачи.
- Предоставляет логику повторных попыток в случае ошибок.

## Обработка ошибок

Класс включает в себя всестороннюю обработку ошибок для различных сценариев:

- **Сетевые ошибки**: Повторяет попытки с экспоненциальным отступлением.
- **Недоступность сервиса**: Ведет журнал ошибок и повторяет попытки.
- **Лимиты квот**: Ведет журнал и ждет перед повтором попытки.
- **Ошибки аутентификации**: Ведет журнал и прекращает дальнейшие попытки.
- **Неверный ввод**: Ведет журнал и повторяет попытки с тайм-аутом.
- **Ошибки API**: Ведет журнал и прекращает дальнейшие попытки.

## Ведение журнала и история

Все взаимодействия с моделями ИИ регистрируются, и диалоги сохраняются в текстовых и JSON-форматах для последующего анализа. 
Это гарантирует, что все операции отслеживаются и могут быть проверены для отладки или аудита.

## Зависимости

- `google.generativeai`
- `requests`
- `grpc`
- `google.api_core.exceptions`
- `google.auth.exceptions`
- `src.logger`
- `src.utils.printer`
- `src.utils.file`
- `src.utils.date_time`
- `src.utils.convertors.unicode`
- `src.utils.jjson`

## Пример использования

```python
ai = GoogleGenerativeAi(api_key="your_api_key", system_instruction="Instruction")
response = ai.ask("Как дела?")
print(response)
```

Этот пример инициализирует класс `GoogleGenerativeAi` и отправляет запрос модели ИИ, печатая ответ.

---

Для получения более подробной информации обратитесь к исходному коду и комментариям в классе `GoogleGenerativeAi`.
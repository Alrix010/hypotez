# Модуль `main.py` для Desktop Assistant Hypo69

## Обзор

Этот модуль является основной точкой входа для FastAPI приложения Desktop Assistant Hypo69.
Он содержит endpoint-ы для чата и получения локализации, а также обеспечивает статический хостинг файлов шаблонов.

## Подробнее

Модуль использует FastAPI для создания веб-API, который позволяет пользователям взаимодействовать с Google Gemini AI.
Он также предоставляет endpoint для получения файлов локализации, которые используются для поддержки различных языков.
Приложение использует CORSMiddleware для разрешения запросов с любого источника.

## Классы

### `ChatRequest`

**Описание**: Pydantic модель для запросов чата.

**Атрибуты**:

- `message` (str): Сообщение пользователя.

## Функции

### `root`

**Назначение**: Обрабатывает корневой URL ("/"), возвращая HTML-контент из файла `index.html`.

**Параметры**:

- Нет

**Возвращает**:

- `HTMLResponse`: HTML-контент главной страницы.

**Вызывает исключения**:

- `HTTPException`: Если файл `index.html` не найден или произошла ошибка при его чтении.

**Как работает функция**:

- Функция пытается прочитать содержимое файла `index.html` из директории `templates_path`.
- Если файл не существует, вызывается исключение `FileNotFoundError`, которое перехватывается.
- В случае ошибки логируется сообщение об ошибке с использованием `logger.error` и выбрасывается исключение `HTTPException` с кодом состояния 500.
- В случае успеха возвращается `HTMLResponse` с содержимым файла.

**Примеры**:

```python
# Пример вызова (необходимо запустить FastAPI приложение)
# import requests
# response = requests.get("http://127.0.0.1:8000/")
# print(response.status_code)
# print(response.text)
```

### `chat`

**Назначение**: Обрабатывает POST-запросы к endpoint-у "/api/chat", взаимодействуя с моделью Google Gemini AI для генерации ответа на сообщение пользователя.

**Параметры**:

- `request` (ChatRequest): Объект `ChatRequest`, содержащий сообщение пользователя.

**Возвращает**:

- `dict`: Словарь, содержащий сгенерированный ответ от модели AI.

**Вызывает исключения**:

- `HTTPException`: Если модель не инициализирована или произошла ошибка во время взаимодействия с моделью.

**Как работает функция**:

- Функция принимает объект `ChatRequest`, содержащий сообщение пользователя.
- Проверяется, инициализирована ли глобальная переменная `model`. Если нет, то создается экземпляр `GoogleGenerativeAi` с использованием API-ключа и имени модели.
- Вызывается метод `chat` объекта `model` для получения ответа на сообщение пользователя.
- В случае ошибки логируется сообщение об ошибке с использованием `logger.error` и выбрасывается исключение `HTTPException` с кодом состояния 500.
- В случае успеха возвращается словарь с ключом "response", содержащий сгенерированный ответ.

**Примеры**:

```python
# Пример вызова (необходимо запустить FastAPI приложение)
# import requests
# import json
# data = {"message": "Hello, how are you?"}
# headers = {'Content-type': 'application/json'}
# response = requests.post("http://127.0.0.1:8000/api/chat", data=json.dumps(data), headers=headers)
# print(response.status_code)
# print(response.json())
```

### `get_locale_file`

**Назначение**: Читает и возвращает JSON-контент файла локализации для указанного языка.

**Параметры**:

- `lang` (str): Код языка (например, "en", "ru").

**Возвращает**:

- `dict`: Словарь, содержащий данные локализации из JSON-файла.

**Вызывает исключения**:

- `HTTPException`: Если файл локализации не найден, содержит невалидный JSON или произошла другая ошибка при чтении файла.

**Как работает функция**:

- Функция строит путь к файлу локализации на основе переданного кода языка.
- Пытается открыть и прочитать JSON-контент файла.
- В случае, если файл не найден, происходит ошибка декодирования JSON или любая другая ошибка, вызывается исключение `HTTPException` с соответствующим кодом состояния и детальным сообщением.
- В случае успеха возвращается словарь, полученный из JSON-контента.

**Примеры**:

```python
# Пример вызова (необходимо запустить FastAPI приложение)
# import requests
# response = requests.get("http://127.0.0.1:8000/locales/en.json")
# print(response.status_code)
# print(response.json())
```

### `locales`

**Назначение**: Endpoint для получения файла локализации по коду языка.

**Параметры**:

- `lang` (str): Код языка (например, "en", "ru").

**Возвращает**:

- `dict`: Словарь, содержащий данные локализации из JSON-файла.

**Вызывает исключения**:

- `HTTPException`: Если файл локализации не найден, содержит невалидный JSON или произошла другая ошибка при чтении файла.

**Как работает функция**:

- Функция вызывает функцию `get_locale_file` с переданным кодом языка и возвращает результат.

**Примеры**:

```python
# Пример вызова (необходимо запустить FastAPI приложение)
# import requests
# response = requests.get("http://127.0.0.1:8000/locales/en.json")
# print(response.status_code)
# print(response.json())
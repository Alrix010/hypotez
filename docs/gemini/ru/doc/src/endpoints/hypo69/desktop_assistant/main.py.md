# Модуль `main.py` для десктопного ассистента 
## Обзор
Модуль  `main.py` является точкой входа для запуска десктопного ассистента, работающего на основе моделей искусственного интеллекта (ИИ) от Google.

## Подробности

Этот модуль содержит код, необходимый для создания FastAPI-приложения, обработки запросов от пользователя и взаимодействия с моделью ИИ.

**Основные компоненты:**

- **FastAPI-приложение:**  Использует FastAPI для создания веб-сервиса, позволяющего взаимодействовать с моделью ИИ.
- **Обработка запросов:**  Определяет маршруты (`/` и `/api/chat`) для обработки запросов от пользователя, а также для обработки локализации.
- **Взаимодействие с моделью ИИ:**  Использует `GoogleGenerativeAi` для взаимодействия с Google Gemini - моделью обработки естественного языка от Google.

##  Классы

### `ChatRequest`
**Описание**:  Модель для представления запросов чата.

**Атрибуты:**

- `message` (str): Сообщение от пользователя.

## Функции
### `chat`
**Назначение**: Обрабатывает POST-запросы на маршруте `/api/chat`, отправляя сообщение пользователя в модель ИИ для обработки.

**Параметры:**

- `request` (ChatRequest): Объект запроса, содержащий сообщение пользователя.

**Возвращает**: 

-  `dict`: Словарь с ответом от модели ИИ.

**Вызывает исключения**:

- `HTTPException` (status_code=500): В случае возникновения ошибок.

**Примеры**:

```python
# Пример запроса
>>> request = ChatRequest(message='Hello, world!')
>>> chat(request) 
# Пример ответа
>>> {'response': 'Hello! How can I help you?'}
```

### `get_locale_file`
**Назначение**:  Читает локализационные файлы (JSON-файлы с переводами) из каталога `translations`.

**Параметры:**

- `lang` (str):  Код языка (например, `ru`, `en`).

**Возвращает**: 

- `dict`:  Словарь с переводами для указанного языка.

**Вызывает исключения**:

- `HTTPException` (status_code=404): Если файл локализации не найден.
- `HTTPException` (status_code=500): Если возникли проблемы с чтением или декодированием файла.

**Примеры**:

```python
>>> get_locale_file('ru')
# Пример файла с локализованными строками
>>> {'title': 'Добро пожаловать!', 'greeting': 'Привет!'}
```

### `locales`
**Назначение**: Обрабатывает GET-запросы на маршруте `/locales/{lang}.json`, чтобы вернуть  JSON-файл с переводами для указанного языка.

**Параметры:**

- `lang` (str): Код языка (например, `ru`, `en`).

**Возвращает**: 

-  `dict`:  Словарь с переводами для указанного языка.

**Вызывает исключения**:

- `HTTPException` (status_code=404): Если файл локализации не найден.
- `HTTPException` (status_code=500): Если возникли проблемы с чтением или декодированием файла.

**Примеры**:

```python
>>> locales('ru')
# Пример файла с локализованными строками
>>> {'title': 'Добро пожаловать!', 'greeting': 'Привет!'}
```


### `root`
**Назначение**: Обрабатывает GET-запросы на корневом маршруте (`/`).

**Возвращает**: 

-  `HTMLResponse`:  HTML-содержание страницы `index.html` из папки `templates`.

**Вызывает исключения**:

- `HTTPException` (status_code=500): Если возникли проблемы с чтением файла `index.html`.

**Примеры**:

```python
>>> root()
# Пример содержимого index.html:
>>> <html>
... <body>
...   <h1>Добро пожаловать!</h1>
... </body>
... </html>
```

## Параметры

- **`model`**:  Объект `GoogleGenerativeAi` для взаимодействия с моделью Google Gemini.
- **`api_key`**:  Ключ API для доступа к модели Google Gemini.
- **`system_instruction`**:  Системная инструкция, которая предоставляет модели ИИ контекст и рекомендации для генерации ответов.

## Примеры

**Запуск приложения:**

```bash
uvicorn src.endpoints.hypo69.desktop_assistant.main:app --reload
```

**Отправка запроса:**

```bash
# Отправка сообщения "Привет!" в модель ИИ
curl -X POST http://127.0.0.1:8000/api/chat -H "Content-Type: application/json" -d '{"message": "Привет!"}' 
```

**Пример ответа:**

```json
{
  "response": "Привет! Как я могу вам помочь?"
}
```

## Принцип работы

Модуль `main.py` создает веб-сервис, который принимает сообщения пользователей через POST-запрос к `/api/chat`. 
Затем  запрос передается в модель Google Gemini для обработки. Модель генерирует ответ, который возвращается пользователю. 
Кроме того, этот модуль обрабатывает маршрут `/locales/{lang}.json`, чтобы предоставлять локализованные строки для интерфейса.
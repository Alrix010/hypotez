# Модуль для работы с OpenAI 
## Обзор
Модуль `src/endpoints/hypo69/code_assistant/_experiments/openai_bot.py`  предназначен для экспериментов с моделью AI OpenAI. 
Он обрабатывает исходный код или документацию, отправляет его в модель для анализа и получения ответов.

## Подробнее

### Основные функции модуля:

-   **Обработка исходного кода/документации:**  Модуль считывает исходный код Python или Markdown-файлы, используя функцию `yield_files_content`. 
-   **Взаимодействие с моделью OpenAI:**  Используется класс `OpenAIModel` для взаимодействия с моделью OpenAI. 
-   **Генерация ответа:**  Модель OpenAI анализирует переданный код и генерирует ответ в виде текста, который в дальнейшем сохраняется в файл `.md`.
-   **Сохранение ответа:**  Функция `save_response` сохраняет полученный ответ в файл `.md` в определенной директории, которая зависит от роли, указанной в коде. 

### Роль и взаимодействие с OpenAI

-   **Роль**:  Модуль работает с различными ролями (например, `doc_writer`), которые определяют тип ответа, который генерируется моделью OpenAI. 
-   **Модель OpenAI**:  В модуле используется модель OpenAI GPT-4 для генерации документации или других текстовых материалов. 

## Классы 

### `OpenAIModel`
**Описание**:  Класс `OpenAIModel` обеспечивает взаимодействие с моделью OpenAI для получения ответа на заданный вопрос.
**Параметры**:
-   `system_instruction` (str):  Системные инструкции для модели OpenAI, определяющие ее поведение и ожидаемые результаты.
-   `model_name` (str):  Название модели OpenAI (например, `gpt-4o-mini`).
-   `assistant_id` (str):  ID ассистента OpenAI, с которым нужно взаимодействовать.

**Методы**:
-   `ask(content: str) -> str`:  Отправляет заданный текст `content` в модель OpenAI и получает ответ.

## Функции

### `main`
**Назначение**:  Функция запускает основной процесс обработки файлов. 
**Как работает**:
1.  Считывает комментарии для модели из файла `doc_writer.md`.
2.  Считывает системные инструкции для модели из файла `create_documentation.md`.
3.  Создает объект `OpenAIModel` с необходимыми параметрами.
4.  Использует функцию `yield_files_content` для получения контента файлов из указанного пути.
5.  Для каждого файла:
    -   Собирает входные данные для модели, включая комментарии, информацию о файле, его содержимое.
    -   Вызывает метод `ask` объекта `OpenAIModel` для получения ответа от модели.
    -   Сохраняет ответ модели в файл `.md` с помощью функции `save_response`.

### `save_response`
**Назначение**:  Сохраняет ответ модели OpenAI в файл `.md` с обновленным путем, основанным на роли.
**Параметры**:
-   `file_path` (Path):  Путь к исходному файлу, который обрабатывался.
-   `response` (str):  Ответ от модели OpenAI.

**Как работает**:
1.  Определяет директорию для сохранения файла, основанную на роли, используя словарь `role_directories`.
2.  Создает новый путь для файла, заменяя часть `src` на директорию, соответствующую роли.
3.  Изменяет суффикс файла на `.md`.
4.  Создает директорию, если она еще не существует.
5.  Записывает ответ в файл `.md`.

### `yield_files_content`
**Назначение**:  Генерирует контент файлов из исходного каталога, исключая определенные паттерны и директории.
**Параметры**:
-   `src_path` (Path):  Исходный каталог, в котором нужно искать файлы.
-   `patterns` (list[str]):  Список паттернов файлов, которые нужно включать (например, `*.py`, `*.txt`).

**Как работает**:
1.  Определяет регулярные выражения для исключаемых файлов и директорий, а также список исключаемых директорий.
2.  Итеративно проходит по каждому паттерну в `patterns`.
3.  Использует `src_path.rglob(pattern)` для поиска файлов, соответствующих текущему паттерну.
4.  Проверяет, не находится ли файл в исключаемых директориях.
5.  Проверяет, не соответствует ли файл исключаемым паттернам.
6.  Считывает содержимое файла и возвращает его как строку.


## Примеры
**Пример 1: Вызов функции `main`:**

```python
if __name__ == "__main__":
    print("Starting training ...")
    main()
```

**Пример 2: Сохранение ответа в файл:**

```python
save_response(file_path=Path('src/endpoints/hypo69/code_assistant/_experiments/openai_bot.py'), response='Response from OpenAI', from_model='openai')
```

**Пример 3: Получение контента файлов:**

```python
for file_path, content in yield_files_content(src_path=Path('src'), patterns=['*.py']):
    print(f"File: {file_path}")
    print(f"Content: {content}")
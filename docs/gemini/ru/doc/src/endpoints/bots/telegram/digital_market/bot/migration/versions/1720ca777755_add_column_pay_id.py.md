# Модуль для миграции базы данных `hypotez`

## Обзор

Этот модуль содержит код для миграции базы данных проекта `hypotez`. В частности, он добавляет колонку `payment_id` в таблицу `purchases`, если она не существует, и удаляет ее, если она уже есть.

## Подробней

Модуль используется для обновления структуры базы данных `hypotez`. 

**Задача**:

- Добавление колонки `payment_id` в таблицу `purchases` для хранения идентификатора платежа. 
- Создание уникального ограничения `uq_purchases_payment_id` для колонки `payment_id`. 
- Удаление колонки `payment_id` и ограничения `uq_purchases_payment_id` при откате миграции. 


**Реализация**:

- Используется библиотека `alembic` для управления миграциями.
- В функциях `upgrade` и `downgrade` выполняется проверка наличия колонки `payment_id` перед добавлением/удалением. 
- Используются команды `op.add_column` и `op.drop_column` для добавления и удаления колонок. 
- Используется `op.create_unique_constraint` и `op.drop_constraint` для создания и удаления ограничений.

## Функции

### `upgrade`

**Назначение**:

- Добавляет колонку `payment_id` в таблицу `purchases` с типом `sa.String()`, если она не существует.
- Создает уникальное ограничение `uq_purchases_payment_id` для колонки `payment_id`.

**Параметры**:

-  нет

**Возвращает**:

-  нет

**Вызывает исключения**:

-  нет

**Как работает функция**:

-  Получает соединение с базой данных.
-  Проверяет наличие колонки `payment_id` в таблице `purchases` с помощью команды `PRAGMA table_info`.
-  Если колонка не существует, добавляет ее с типом `sa.String()` и создает уникальное ограничение `uq_purchases_payment_id`.
-  Если колонка существует, выводит сообщение о пропускании добавления.


### `downgrade`

**Назначение**:

-  Удаляет колонку `payment_id` из таблицы `purchases`, если она существует.
-  Удаляет уникальное ограничение `uq_purchases_payment_id`, если оно существует.

**Параметры**:

-  нет

**Возвращает**:

-  нет

**Вызывает исключения**:

-  нет

**Как работает функция**:

-  Получает соединение с базой данных.
-  Проверяет наличие колонки `payment_id` в таблице `purchases` с помощью команды `PRAGMA table_info`.
-  Если колонка существует, удаляет ее и уникальное ограничение `uq_purchases_payment_id`.
-  Если колонка не существует, выводит сообщение о пропускании удаления.



## Примеры

**Пример вызова `upgrade`**:

```python
from hypotez.src.endpoints.bots.telegram.digital_market.bot.migration.versions.1720ca777755_add_column_pay_id import upgrade

upgrade() 
```

**Пример вызова `downgrade`**:

```python
from hypotez.src.endpoints.bots.telegram.digital_market.bot.migration.versions.1720ca777755_add_column_pay_id import downgrade

downgrade()
```

```python
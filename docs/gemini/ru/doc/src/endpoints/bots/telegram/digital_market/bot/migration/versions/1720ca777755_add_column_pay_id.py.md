# Модуль для миграции базы данных: добавление колонки `payment_id`

## Обзор

Модуль предназначен для внесения изменений в структуру базы данных, а именно для добавления колонки `payment_id` в таблицу `purchases`, если она еще не существует. Он также содержит функцию для отката этих изменений.

## Подробней

Этот модуль использует библиотеку `alembic` для управления миграциями базы данных. Он автоматически генерируется `alembic` и содержит функции для обновления (`upgrade`) и отката (`downgrade`) изменений схемы базы данных. В данном случае, модуль добавляет столбец `payment_id` в таблицу `purchases`, если он отсутствует, и создает уникальный индекс для этого столбца.  При откате изменений столбец и индекс удаляются.

## Классы

В данном модуле классы отсутствуют

## Функции

### `upgrade`

**Назначение**: Добавляет колонку `payment_id` в таблицу `purchases`, если она еще не существует.

**Параметры**:
-   `None`

**Возвращает**:
-   `None`

**Как работает функция**:

1.  Получает соединение с базой данных с помощью `op.get_bind()`.
2.  Выполняет запрос `PRAGMA table_info('purchases')` для получения информации о столбцах таблицы `purchases`.
3.  Извлекает имена столбцов из результата запроса.
4.  Проверяет, существует ли столбец `payment_id` в таблице `purchases`.
5.  Если столбец `payment_id` не существует:
    *   Добавляет столбец `payment_id` типа `String` в таблицу `purchases` с помощью `op.add_column()`, устанавливая `nullable=False`.
    *   Создает уникальный индекс `uq_purchases_payment_id` для столбца `payment_id` в таблице `purchases` с помощью `op.create_unique_constraint()`.
6.  Если столбец `payment_id` уже существует, выводит сообщение "Колонка 'payment\_id' уже существует, пропускаем добавление".

**Примеры**:

```python
# Пример вызова функции upgrade (обычно вызывается alembic)
upgrade()
```

### `downgrade`

**Назначение**: Удаляет колонку `payment_id` из таблицы `purchases`, если она существует.

**Параметры**:
-   `None`

**Возвращает**:
-   `None`

**Как работает функция**:

1.  Получает соединение с базой данных с помощью `op.get_bind()`.
2.  Выполняет запрос `PRAGMA table_info('purchases')` для получения информации о столбцах таблицы `purchases`.
3.  Извлекает имена столбцов из результата запроса.
4.  Проверяет, существует ли столбец `payment_id` в таблице `purchases`.
5.  Если столбец `payment_id` существует:
    *   Удаляет уникальный индекс `uq_purchases_payment_id` из таблицы `purchases` с помощью `op.drop_constraint()`.
    *   Удаляет столбец `payment_id` из таблицы `purchases` с помощью `op.drop_column()`.
6.  Если столбец `payment_id` не существует, выводит сообщение "Колонка 'payment\_id' не существует, пропускаем удаление".

**Примеры**:

```python
# Пример вызова функции downgrade (обычно вызывается alembic)
downgrade()
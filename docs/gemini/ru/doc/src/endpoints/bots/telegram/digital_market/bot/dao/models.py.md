# Модуль для определения моделей данных для бота Telegram цифрового рынка
=======================================================================

Модуль содержит классы, представляющие структуру базы данных: `User`, `Category`, `Product` и `Purchase`.
Эти классы используются для взаимодействия с базой данных и хранения информации о пользователях, категориях, продуктах и покупках.

## Обзор

Файл `models.py` определяет структуру таблиц базы данных, используемых Telegram-ботом цифрового рынка.
Он использует SQLAlchemy для определения моделей, которые представляют пользователей, категории продуктов, сами продукты и историю покупок.
Модели включают определения столбцов, типы данных и связи между таблицами.

## Подробней

Этот модуль служит основой для организации данных, связанных с пользователями, продуктами и транзакциями в боте.
Через ORM SQLAlchemy, классы моделей позволяют взаимодействовать с базой данных Python-коду, абстрагируясь от непосредственных SQL-запросов.
В частности, модуль определяет:

- Класс `User`: для хранения информации о пользователях бота.
- Класс `Category`: для классификации продуктов.
- Класс `Product`: для хранения деталей о каждом продукте.
- Класс `Purchase`: для учета совершенных покупок.

## Классы

### `User`

**Описание**: Представляет пользователя Telegram-бота.

**Наследует**: `Base` из `bot.dao.database`.

**Атрибуты**:
- `telegram_id` (int): Уникальный идентификатор пользователя в Telegram. Не может быть `None`.
- `username` (str | None): Имя пользователя в Telegram (опционально).
- `first_name` (str | None): Имя пользователя.
- `last_name` (str | None): Фамилия пользователя.
- `purchases` (List['Purchase']): Список покупок, связанных с пользователем.

**Методы**:
- `__repr__()`: Возвращает строковое представление объекта `User`.

**Принцип работы**:
Класс `User` представляет таблицу пользователей в базе данных. Он хранит информацию о каждом пользователе, который взаимодействует с ботом.
Атрибут `telegram_id` является уникальным идентификатором, который позволяет однозначно идентифицировать пользователя.
Связь `purchases` позволяет получить список всех покупок, совершенных данным пользователем.

### `Category`

**Описание**: Представляет категорию продукта.

**Наследует**: `Base` из `bot.dao.database`.

**Атрибуты**:
- `category_name` (str): Название категории.
- `products` (List["Product"]): Список продуктов, принадлежащих к данной категории.

**Методы**:
- `__repr__()`: Возвращает строковое представление объекта `Category`.

**Принцип работы**:
Класс `Category` представляет таблицу категорий в базе данных. Он хранит информацию о категориях продуктов,
что позволяет классифицировать продукты и упростить их поиск.
Атрибут `category_name` является названием категории, а связь `products` позволяет получить список всех продуктов,
принадлежащих к данной категории.

### `Product`

**Описание**: Представляет продукт в магазине.

**Наследует**: `Base` из `bot.dao.database`.

**Атрибуты**:
- `name` (str): Название продукта.
- `description` (str): Описание продукта.
- `price` (int): Цена продукта.
- `file_id` (str | None): Идентификатор файла, связанного с продуктом (опционально).
- `category_id` (int): Идентификатор категории, к которой принадлежит продукт.
- `hidden_content` (str): Скрытое содержимое продукта.
- `category` (Category): Категория, к которой принадлежит продукт.
- `purchases` (List['Purchase']): Список покупок, связанных с продуктом.

**Методы**:
- `__repr__()`: Возвращает строковое представление объекта `Product`.

**Принцип работы**:
Класс `Product` представляет таблицу продуктов в базе данных. Он хранит информацию о каждом продукте,
включая его название, описание, цену, идентификатор файла и категорию.
Связи `category` и `purchases` позволяют получить информацию о категории продукта и список покупок, связанных с продуктом.

### `Purchase`

**Описание**: Представляет запись о покупке.

**Наследует**: `Base` из `bot.dao.database`.

**Атрибуты**:
- `user_id` (int): Идентификатор пользователя, совершившего покупку.
- `product_id` (int): Идентификатор купленного продукта.
- `price` (int): Цена продукта на момент покупки.
- `payment_type` (str): Тип платежа.
- `payment_id` (str): Идентификатор платежа.
- `user` (User): Пользователь, совершивший покупку.
- `product` (Product): Купленный продукт.

**Методы**:
- `__repr__()`: Возвращает строковое представление объекта `Purchase`.

**Принцип работы**:
Класс `Purchase` представляет таблицу покупок в базе данных. Он хранит информацию о каждой покупке,
включая идентификатор пользователя, идентификатор продукта, цену, тип платежа и идентификатор платежа.
Связи `user` и `product` позволяют получить информацию о пользователе, совершившем покупку, и о купленном продукте.

## Методы класса

### `User.__repr__`

```python
def __repr__(self):
    return f"<User(id={self.id}, telegram_id={self.telegram_id}, username='{self.username}')>"
```

**Назначение**: Возвращает строковое представление объекта `User`.

**Возвращает**:
- `str`: Строковое представление объекта `User`, содержащее его id, telegram_id и username.

**Как работает функция**:
Функция формирует строку, содержащую информацию об идентификаторе, telegram id и имени пользователя.
Эта строка полезна для отладки и логирования.

**Примеры**:

```python
user = User(telegram_id=123456789, username='test_user')
print(user.__repr__()) # Вывод: <User(id=None, telegram_id=123456789, username='test_user')>
```

### `Category.__repr__`

```python
def __repr__(self):
    return f"<Category(id={self.id}, name='{self.category_name}')>"
```

**Назначение**: Возвращает строковое представление объекта `Category`.

**Возвращает**:
- `str`: Строковое представление объекта `Category`, содержащее его id и имя категории.

**Как работает функция**:
Функция формирует строку, содержащую информацию об идентификаторе и имени категории.
Эта строка полезна для отладки и логирования.

**Примеры**:

```python
category = Category(category_name='Test Category')
print(category.__repr__()) # Вывод: <Category(id=None, name='Test Category')>
```

### `Product.__repr__`

```python
def __repr__(self):
    return f"<Product(id={self.id}, name='{self.name}', price={self.price})>"
```

**Назначение**: Возвращает строковое представление объекта `Product`.

**Возвращает**:
- `str`: Строковое представление объекта `Product`, содержащее его id, имя и цену.

**Как работает функция**:
Функция формирует строку, содержащую информацию об идентификаторе, имени и цене продукта.
Эта строка полезна для отладки и логирования.

**Примеры**:

```python
product = Product(name='Test Product', price=100)
print(product.__repr__()) # Вывод: <Product(id=None, name='Test Product', price=100)>
```

### `Purchase.__repr__`

```python
def __repr__(self):
    return f"<Purchase(id={self.id}, user_id={self.user_id}, product_id={self.product_id}, date={self.created_at})>"
```

**Назначение**: Возвращает строковое представление объекта `Purchase`.

**Возвращает**:
- `str`: Строковое представление объекта `Purchase`, содержащее его id, id пользователя, id продукта и дату создания.

**Как работает функция**:
Функция формирует строку, содержащую информацию об идентификаторе, идентификаторе пользователя, идентификаторе продукта и дате создания покупки.
Эта строка полезна для отладки и логирования.

**Примеры**:

```python
purchase = Purchase(user_id=1, product_id=1, price=100, payment_type='card', payment_id='12345')
print(purchase.__repr__()) # Вывод: <Purchase(id=None, user_id=1, product_id=1, date=None)>
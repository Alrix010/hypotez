# Модуль `env.py`

## Обзор

Данный модуль содержит конфигурацию для запуска миграций базы данных в проекте `hypotez`. Он использует библиотеку `alembic` для управления миграциями и `sqlalchemy` для взаимодействия с базой данных.

## Подробнее

Модуль `env.py` определяет конфигурацию для запуска миграций базы данных. Он устанавливает подключение к базе данных, определяет целевую метаданную модель (включая таблицы, столбцы и связи) и предоставляет функции для запуска миграций в онлайн и оффлайн режимах.

## Функции

### `run_migrations_offline()`

**Назначение**: Запускает миграции в оффлайн режиме.

**Параметры**: 
- Отсутствуют.

**Возвращает**: 
- `None`.

**Вызывает исключения**: 
-  Отсутствуют.

**Как работает функция**:
- Функция конфигурирует контекст `alembic` с использованием только URL-адреса базы данных.
- Она не создает соединение с базой данных, поэтому не требует наличия DBAPI.
- Вызовы `context.execute()` выводят заданную строку в консоль.
- Функция запускает миграции, используя `context.run_migrations()`.

**Пример**:
- Пример вызова `run_migrations_offline()` не требуется, так как функция вызывается автоматически, если `context.is_offline_mode()` возвращает `True`.

### `do_run_migrations(connection: Connection)`

**Назначение**: Запускает миграции, используя переданное соединение с базой данных.

**Параметры**: 
- `connection` (`Connection`): Соединение с базой данных.

**Возвращает**: 
- `None`.

**Вызывает исключения**: 
- Отсутствуют.

**Как работает функция**:
- Функция конфигурирует контекст `alembic`, используя переданное соединение.
- Она запускает миграции, используя `context.run_migrations()`.

**Пример**:
- Пример вызова `do_run_migrations()` не требуется, так как функция вызывается из `run_async_migrations()`.

### `run_async_migrations()`

**Назначение**: Запускает миграции в асинхронном режиме.

**Параметры**: 
- Отсутствуют.

**Возвращает**: 
- `None`.

**Вызывает исключения**: 
- Отсутствуют.

**Как работает функция**:
- Функция создает асинхронное соединение с базой данных, используя `async_engine_from_config()`.
- Она использует `connectable.connect()` для получения соединения.
- Затем она выполняет `do_run_migrations()` в синхронном контексте, используя `connection.run_sync()`.
- Наконец, она закрывает соединение и освобождает ресурсы.

**Пример**:
- Пример вызова `run_async_migrations()` не требуется, так как функция вызывается автоматически, если `context.is_offline_mode()` возвращает `False`.

### `run_migrations_online()`

**Назначение**: Запускает миграции в онлайн режиме.

**Параметры**: 
- Отсутствуют.

**Возвращает**: 
- `None`.

**Вызывает исключения**: 
- Отсутствуют.

**Как работает функция**:
- Функция использует `asyncio.run()` для запуска `run_async_migrations()`.

**Пример**:
- Пример вызова `run_migrations_online()` не требуется, так как функция вызывается автоматически, если `context.is_offline_mode()` возвращает `False`.

##  Параметры

- `database_url` (`str`): URL-адрес для подключения к базе данных. Он определен в файле `bot/dao/database.py`.
- `target_metadata` (`Base.metadata`): Метаданные для модели базы данных.
- `config` (`alembic.config.Config`): Конфигурация для `alembic`.

## Примеры

- Примеры вызова функций представлены в коде `env.py`, например:

```python
if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
```

- В этих примерах `context.is_offline_mode()` определяет, нужно ли запускать миграции в оффлайн или онлайн режиме.
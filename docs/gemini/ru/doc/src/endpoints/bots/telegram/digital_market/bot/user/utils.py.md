# Модуль `utils` для работы с пользователем бота

## Обзор

Этот модуль содержит функцию `successful_payment_logic`, которая выполняет логику успешной покупки товара пользователем в Telegram-боте.

## Подробнее

Функция `successful_payment_logic` обрабатывает уведомления о платежах в Telegram-боте. 

## Функции

### `successful_payment_logic`

**Назначение**: Обрабатывает успешную оплату товара пользователем, отправляет уведомления администратору и пользователю, и  добавляет информацию о покупке в базу данных.

**Параметры**:

- `session` (AsyncSession): Сессия базы данных для взаимодействия с БД.
- `payment_data` (dict): Данные о платеже, полученные от Telegram API.
- `currency` (str): Валюта платежа.
- `user_tg_id` (int): Telegram ID пользователя, совершившего покупку.
- `bot` (Bot): Объект бота Telegram для отправки сообщений.

**Возвращает**:

- `None`

**Вызывает исключения**:

- `Exception`: Возникает при ошибке отправки уведомлений администраторам.

**Как работает функция**:

1. Извлекает информацию о товаре, цене, платежном методе, ID платежа и ID пользователя из `payment_data`.
2. Добавляет информацию о покупке в базу данных с использованием `PurchaseDao`.
3. Извлекает данные о товаре из БД с использованием `ProductDao`.
4. Отправляет уведомления администраторам о покупке.
5. Отправляет пользователю информацию о покупке с описанием товара и доступной документацией.
6. Выполняет автоматический возврат звезд за покупку, если платежный метод был "звездный".

**Примеры**:

```python
# Пример вызова функции с данными о платеже
await successful_payment_logic(
    session=session,
    payment_data={
        "product_id": 123,
        "price": 10.99,
        "payment_type": "card",
        "payment_id": "1234567890",
        "user_id": 1234567890
    },
    currency="USD",
    user_tg_id=1234567890,
    bot=bot
)
```
```python
# Пример вызова функции с данными о платеже с использованием "звездного" платежа
await successful_payment_logic(
    session=session,
    payment_data={
        "product_id": 123,
        "price": 10.99,
        "payment_type": "stars",
        "payment_id": "1234567890",
        "user_id": 1234567890
    },
    currency="USD",
    user_tg_id=1234567890,
    bot=bot
)
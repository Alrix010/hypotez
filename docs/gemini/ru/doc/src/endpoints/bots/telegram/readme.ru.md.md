# Телеграм-бот

## Обзор

Этот модуль содержит код для создания Telegram-бота, который реализует различные функции, связанные с обработкой команд, голосовых сообщений и взаимодействием с пользователями в Telegram.  

## Подробней

Модуль `src.endpoints.bots.telegram` является частью более масштабного проекта `hypotez` и реализует основные функции для взаимодействия с пользователем в Telegram.  Бот предназначен для интерактивного взаимодействия с пользователями в Telegram, включая обработку команд, голосовых сообщений и взаимодействие с файлами документов. 

## Классы

### `TelegramBot`

**Описание**: Класс `TelegramBot` реализует логику взаимодействия с Telegram API, обрабатывает входящие команды, сообщения, голосовые сообщения и файлы документов.

**Наследует**:  `telegram.ext.Updater`

**Атрибуты**:

- `token (str)`: Токен доступа Telegram-бота, используемый для аутентификации в Telegram API.

**Методы**:

- `__init__(self, token: str)`: Инициализирует бота с токеном и регистрирует обработчики команд и сообщений.
- `register_handlers(self)`: Регистрирует обработчики команд и сообщений.
- `start(self, update: Update, context: CallbackContext)`: Обрабатывает команду `/start` и отправляет приветственное сообщение пользователю.
- `help_command(self, update: Update, context: CallbackContext)`: Обрабатывает команду `/help` и предоставляет список доступных команд.
- `send_pdf(self, pdf_file: str | Path)`: Обрабатывает команду `/sendpdf` для отправки PDF-файла пользователю.
- `handle_voice(self, update: Update, context: CallbackContext)`: Обрабатывает голосовые сообщения, загружает файл, сохраняет его локально и транскрибирует аудио.
- `transcribe_voice(self, file_path: Path) -> str`: Транскрибирует голосовые сообщения (в настоящее время это заглушка).
- `handle_document(self, update: Update, context: CallbackContext) -> str`: Обрабатывает файлы документов, загружает файл, сохраняет его локально и читает содержимое текстового документа.
- `handle_message(self, update: Update, context: CallbackContext) -> str`: Обрабатывает текстовые сообщения и возвращает полученный текст.

## Функции

### `main()`

**Назначение**: Основная функция, которая запускает бота, регистрирует обработчики команд и сообщений, и запускает бота с помощью `run_polling()`.

**Параметры**: 

-  Нет

**Возвращает**:

-  Нет

**Как работает**:

1.  Создает экземпляр `TelegramBot` с использованием токена из переменной окружения `TELEGRAM_TOKEN`.
2.  Регистрирует обработчики команд и сообщений с помощью `register_handlers()`.
3.  Запускает бота с помощью `run_polling()`, который постоянно отслеживает обновления Telegram API и вызывает соответствующие обработчики.

**Примеры**:

```python
from src.endpoints.bots.telegram import main

if __name__ == "__main__":
    main() 
```

## Внутренние функции

**Внутренние функции** 

- `transcribe_voice(self, file_path: Path) -> str`:  В настоящий момент является заглушкой и не реализует реальную транскрипцию голосовых сообщений.
- `handle_message(self, update: Update, context: CallbackContext) -> str`: Возвращает полученный текст, но без обработки.


## Основные модули и библиотеки

- `python-telegram-bot`: Основная библиотека для создания Telegram-ботов.
- `pathlib`: Для работы с путями файлов.
- `tempfile`: Для создания временных файлов.
- `asyncio`: Для асинхронного выполнения задач.
- `requests`: Для загрузки файлов.
- `src.utils.convertors.tts`: Для распознавания речи и преобразования текста в речь.
- `src.utils.file`: Для чтения текстовых файлов.
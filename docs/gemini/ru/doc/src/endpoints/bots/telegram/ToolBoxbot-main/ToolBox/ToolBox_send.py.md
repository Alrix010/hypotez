# Модуль для рассылки промокодов Telegram ботом
=================================================

Модуль предназначен для рассылки промокодов пользователям Telegram бота. 
Он использует библиотеку `telebot` для взаимодействия с Telegram API и `sqlite3` для работы с базой данных пользователей.

## Обзор

Данный модуль выполняет рассылку промокода `FREE24` пользователям бота, у которых в базе данных не активирован промокод.

## Подробней

Модуль выполняет следующие шаги:

1.  Импортирует необходимые библиотеки: `telebot`, `sqlite3` и `os`.
2.  Загружает переменные окружения из файла `.env` с помощью `load_dotenv()`.
3.  Инициализирует Telegram бота с использованием токена, полученного из переменной окружения `TOKEN`.
4.  Устанавливает соединение с базой данных SQLite `UsersData.db`.
5.  Выполняет SQL-запрос для выборки `id` всех пользователей, у которых поле `promocode` не равно 1.
6.  Перебирает полученные `id` пользователей и отправляет им сообщение с промокодом.
7.  Обрабатывает исключения, которые могут возникнуть при отправке сообщения пользователю.
8.  Выводит в консоль информацию об успешной или неуспешной отправке сообщения для каждого пользователя.

## Функции

### Отправка промокодов пользователям Telegram бота

```python
bot.send_message(chat_id: int, text: str, parse_mode: str) -> None
```

Функция отправляет сообщение с промокодом пользователям Telegram бота.

**Параметры:**

*   `chat_id` (int): ID чата пользователя, которому необходимо отправить сообщение.
*   `text` (str): Текст сообщения, которое нужно отправить. В данном случае, это сообщение с промокодом и информацией о нем.
*   `parse_mode` (str): Режим разбора текста сообщения. В данном случае, используется `html` для поддержки HTML-тегов в тексте сообщения.

**Возвращает:**

*   `None`: Функция ничего не возвращает.

**Как работает функция:**

1.  Функция принимает `chat_id` пользователя, текст сообщения и режим разбора текста.
2.  Использует метод `send_message` объекта `bot` (экземпляр `TeleBot`) для отправки сообщения пользователю.
3.  В случае успешной отправки сообщения, функция не выполняет никаких дополнительных действий.
4.  Если при отправке сообщения возникает исключение, оно перехватывается и обрабатывается в блоке `except` внешнего цикла.

**Примеры:**

```python
# Пример отправки сообщения пользователю с chat_id=12345
bot.send_message(chat_id=12345, text="Привет! Используй промокод FREE24.", parse_mode='html')
```

### Получение списка пользователей из базы данных

Функция выполняет SQL-запрос для выборки `id` всех пользователей, у которых поле `promocode` не равно 1.

**Параметры:**

*   Отсутствуют

**Возвращает:**

*   `users` (list): Список кортежей, содержащих `id` пользователей, у которых поле `promocode` не равно 1.

**Как работает функция:**

1.  Функция выполняет SQL-запрос `SELECT id FROM users_data_table WHERE promocode != 1` к базе данных `UsersData.db`.
2.  Результат запроса сохраняется в переменной `users`.
3.  Если запрос выполнен успешно, `users` будет содержать список кортежей, где каждый кортеж содержит `id` пользователя, у которого поле `promocode` не равно 1.
4.  Если запрос не вернул результатов, `users` будет пустым списком.

**Примеры:**

```python
# Пример получения списка пользователей из базы данных
cursor.execute("SELECT id FROM users_data_table WHERE promocode != 1")
users = cursor.fetchall()
```

### Цикл по пользователям и отправка сообщений

Цикл перебирает полученные `id` пользователей и отправляет им сообщение с промокодом.

**Параметры:**

*   `users` (list): Список кортежей, содержащих `id` пользователей, которым необходимо отправить сообщение.

**Возвращает:**

*   Отсутствует

**Как работает функция:**

1.  Цикл `for us in users:` перебирает список `users`, полученный из базы данных.
2.  Для каждого пользователя `us` извлекается его `id` (первый элемент кортежа `us[0]`).
3.  Функция `bot.send_message` вызывается для отправки сообщения пользователю с указанным `id`.
4.  Если сообщение отправлено успешно, выводится сообщение "`id` yes" в консоль.
5.  Если при отправке сообщения возникает исключение, оно перехватывается блоком `except`, выводится сообщение "`id` no" в консоль, и выполнение цикла продолжается.

**Примеры:**

```python
# Пример цикла по пользователям и отправки сообщений
for us in users:
    try:
        bot.send_message(chat_id=us[0], text="Успейте воспользоваться промокодом FREE24...", parse_mode='html')
    except:
        print(us[0], "no")
    else:
        print(us[0], "yes")
```

## Переменные

*   `bot` (telebot.TeleBot): Экземпляр класса `TeleBot`, используемый для взаимодействия с Telegram API.
*   `conn` (sqlite3.Connection): Объект соединения с базой данных SQLite.
*   `cursor` (sqlite3.Cursor): Объект курсора, используемый для выполнения SQL-запросов.
*   `users` (list): Список `id` пользователей, полученных из базы данных.
*   `us` (tuple): Кортеж, содержащий информацию о пользователе (в данном случае, только `id`).
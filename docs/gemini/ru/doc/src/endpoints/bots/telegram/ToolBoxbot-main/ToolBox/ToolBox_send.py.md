# Модуль для отправки сообщений в Telegram

## Обзор

Этот файл содержит код, который отправляет сообщения всем пользователям в Telegram, у которых не активирован промокод. 

## Подробности

Этот код реализует функцию отправки сообщения в Telegram, используя API Telegram Bot. 

- **Как работает код:**
    -  Сначала устанавливается соединение с базой данных `UsersData.db` через `sqlite3`. 
    - Затем, используя запрос `SELECT id FROM users_data_table WHERE promocode != 1`,  выбираются ID пользователей, у которых не активирован промокод. 
    -  Для каждого пользователя из списка `users`  отправляется сообщение с помощью `bot.send_message`. 
    -  Сообщение содержит промокод и предложение воспользоваться им до 21 декабря.
    -  В блоке `try...except` обрабатываются ошибки, которые могут возникнуть при отправке сообщения. 

## Методы

### `send_message`

```python
def send_message(chat_id: int, text: str, parse_mode: str = 'html'):
    """
    Отправляет сообщение в Telegram пользователю с указанным идентификатором.

    Args:
        chat_id (int): Идентификатор чата.
        text (str): Текст сообщения.
        parse_mode (str, optional): Режим парсинга текста. По умолчанию 'html'.

    Returns:
        None: Функция ничего не возвращает.

    Raises:
        Exception: Если возникает ошибка при отправке сообщения.
    """
    try:
        bot.send_message(chat_id=chat_id, text=text, parse_mode=parse_mode)
    except Exception as ex:
        logger.error(f'Ошибка при отправке сообщения пользователю {chat_id}: {ex}', ex, exc_info=True)

```

## Параметры

- `chat_id` (int): Идентификатор чата получателя сообщения.
- `text` (str): Текст сообщения.
- `parse_mode` (str, optional): Режим парсинга текста. По умолчанию 'html'.

## Примеры

```python
# Пример отправки сообщения пользователю с ID 123456789
send_message(chat_id=123456789, text="Привет! Как дела?")

# Пример отправки сообщения с использованием HTML-разметки
send_message(chat_id=123456789, text="<b>Привет!</b> Как дела?", parse_mode='html')
```

## Как работает код

1. **Создание объекта `bot`:**
    - Инициализируется объект `Telebot` с токеном, который получен из переменной окружения `TOKEN`.
2. **Создание соединения с базой данных:**
    - Устанавливается соединение с SQLite-базой данных `UsersData.db`.
3. **Извлечение пользователей:**
    - Запускается SQL-запрос, который выбирает всех пользователей, у которых не активирован промокод (`promocode != 1`).
4. **Цикл по пользователям:**
    - Цикл по всем выбранным пользователям.
    - **Отправка сообщения:**
        - Для каждого пользователя отправляется сообщение с помощью `bot.send_message`.
        - Используется `parse_mode='html'` для возможности форматирования текста с помощью HTML-тегов.
    - **Обработка ошибок:**
        - В блоке `try...except` обрабатываются ошибки, которые могут возникнуть при отправке сообщения.
5. **Закрытие соединения:**
    - Закрывается соединение с базой данных.
# Модуль ToolBox_requests

## Обзор

Модуль `ToolBox_requests` содержит класс `ToolBox`, который отвечает за обработку запросов бота `ToolBoxbot` в Telegram. 

## Подробней

Класс `ToolBox` управляет взаимодействием бота с пользователем. Он предоставляет функциональность для приема и обработки запросов, связанных с различными задачами бота, такими как генерация текста, изображений, а также управление тарифами. 

Класс `ToolBox` использует методы для обработки различных типов запросов, включая: 

* `start_request`:  Отправляет стартовое приветственное сообщение и предлагает выбор задач бота.
* `restart`:   Возвращает к выбору задач бота.
* `Text_types`:   Предлагает выбор типов текста для генерации.
* `Basic_tariff`:  Предлагает подключение тарифа BASIC.
* `Pro_tariff`:  Предлагает подключение тарифа PRO.
* `TextCommands`:  Обрабатывает запросы на генерацию текста.
* `SomeTextsCommand`:  Обрабатывает запросы на генерацию нескольких текстов.
* `ImageCommand`:   Обрабатывает запросы на генерацию изображений.
* `Image_Regen_And_Upscale`:   Обрабатывает запросы на регенерацию и повышение качества изображения.
* `FreeCommand`:   Обрабатывает запросы в свободном режиме.


## Классы

### `class ToolBox`

**Описание**:  Класс `ToolBox`  отвечает за обработку запросов бота `ToolBoxbot` в Telegram. Он содержит методы для обработки различных типов запросов, связанных с генерацией текста, изображений, а также управлением тарифами.

**Наследует**: 
    - `keyboards`: Класс `keyboards` предоставляет методы для создания клавиатур для Telegram бота.
    - `neural_networks`: Класс `neural_networks`  предоставляет методы для взаимодействия с нейронными сетями.

**Атрибуты**:
    - `name` (list[str]): Список названий основных задач бота.
    - `data` (list[str]): Список данных, связанных с основными задачами бота.
    - `prompts_text` (dict): Словарь с текстами промтов для бота.
    - `bot` (telebot.TeleBot): Экземпляр телеграм-бота.
    - `keyboard_blank` (callable):  Функция-замыкание для создания пустой клавиатуры.
    - `reply_keyboard` (callable):  Функция-замыкание для создания клавиатуры с кнопками.
    - `__delay` (callable):  Функция-замыкание для отображения сообщения о задержке.
    - `start_request` (callable):  Функция-замыкание для отправки стартового запроса.
    - `restart` (callable):  Функция-замыкание для отправки запроса перезапуска.
    - `restart_markup` (callable):  Функция-замыкание для редактирования текста сообщения и отправки запроса перезапуска.
    - `OneTextArea` (callable):  Функция-замыкание для отправки запроса на генерацию одного текста.
    - `SomeTextsArea` (callable):  Функция-замыкание для отправки запроса на генерацию нескольких текстов.
    - `ImageSize` (callable):  Функция-замыкание для отправки запроса на выбор размера изображения.
    - `ImageArea` (callable):  Функция-замыкание для отправки запроса на генерацию изображения.
    - `ImageChange` (callable):  Функция-замыкание для отправки запроса на выбор следующего действия после генерации изображения.
    - `BeforeUpscale` (callable):  Функция-замыкание для отправки запроса на выбор следующего действия после повышения качества изображения.
    - `FreeArea` (callable):  Функция-замыкание для отправки запроса в свободном режиме.
    - `TariffArea` (callable):  Функция-замыкание для отправки запроса на выбор тарифа.
    - `TariffExit` (callable):  Функция-замыкание для отправки запроса на выход из меню тарифов.
    - `TarrifEnd` (callable):  Функция-замыкание для отправки запроса о завершении тарифа.
    - `FreeTariffEnd` (callable):  Функция-замыкание для отправки запроса о завершении бесплатного тарифа.
    - `SomeTexts` (callable):  Функция-замыкание для отправки запроса на выбор количества текстов для генерации.

**Методы**:

    - `__gpt_4o_mini(self, prompt: list[dict], message)`:   Метод для обработки запросов к модели GPT-4o-mini. 
    - `__FLUX_schnell(self, prompt: str, size: list[int], message, seed: int, num_inference_steps: int)`:  Метод для обработки запросов к модели FLUX schnell.
    - `Text_types(self, message)`:  Метод для отправки запроса на выбор типа текста для генерации.
    - `Basic_tariff(self, message)`:  Метод для отправки запроса на подключение тарифа BASIC.
    - `Pro_tariff(self, message)`:  Метод для отправки запроса на подключение тарифа PRO.
    - `TextCommands(self, message, ind: int)`:   Метод для обработки запросов на генерацию одного текста. 
    - `SomeTextsCommand(self, message, ind: int, tokens: dict[str, int])`:  Метод для обработки запросов на генерацию нескольких текстов.
    - `ImageCommand(self, message, prompt: str, size: list[int])`:  Метод для обработки запросов на генерацию изображения.
    - `Image_Regen_And_Upscale(self, message, prompt: str, size: list[int], seed, num_inference_steps=4)`:  Метод для обработки запросов на регенерацию и повышение качества изображения.
    - `FreeCommand(self, message, prompts: list[str])`:  Метод для обработки запросов в свободном режиме.

## Функции

### `__gpt_4o_mini`

**Назначение**:  Функция обрабатывает запросы к модели GPT-4o-mini. 

**Параметры**:
    - `prompt` (list[dict]): Список промтов для модели GPT-4o-mini.
    - `message` (telebot.types.Message): Сообщение от пользователя в Telegram.

**Возвращает**:
    - `tuple[dict[str, str], int, int]`:  Кортеж, содержащий ответ модели, количество входных токенов и количество выходных токенов.

**Как работает функция**:
    - Отправляет сообщение о задержке.
    - Выполняет запрос к модели GPT-4o-mini с использованием функции `_free_gpt_4o_mini` из класса `neural_networks`.
    - Изменяет текст сообщения о задержке на полученный от модели ответ.
    - Возвращает ответ модели, количество входных токенов и количество выходных токенов.


### `__FLUX_schnell`

**Назначение**:  Функция обрабатывает запросы к модели FLUX schnell. 

**Параметры**:
    - `prompt` (str): Текст промпта для модели FLUX schnell.
    - `size` (list[int]):  Список размеров изображения.
    - `message` (telebot.types.Message): Сообщение от пользователя в Telegram.
    - `seed` (int):  Случайное число для генерации изображения.
    - `num_inference_steps` (int):  Количество шагов генерации.

**Возвращает**:
    - `None`:  Функция не возвращает значение.

**Как работает функция**:
    - Отправляет сообщение о задержке.
    - Выполняет запрос к модели FLUX schnell с использованием функции `_FLUX_schnell` из класса `neural_networks`.
    - Если получено изображение, то отправляет его пользователю.
    - Изменяет текст сообщения о задержке на сообщение об ошибке, если генерация изображения не удалась.

## Примеры

**Пример 1**:  Запуск бота.
```python
# Создание объекта класса ToolBox
toolbox = ToolBox()

# Запуск бота
toolbox.bot.polling(none_stop=True, interval=0)
```

**Пример 2**:  Обработка запроса на генерацию текста.
```python
# Получение сообщения от пользователя
message = telebot.types.Message(
    chat = {
        "id": 123456789,
    },
    text = "Напиши текст о путешествии",
)

# Вызов метода TextCommands для обработки запроса
incoming_tokens, outgoing_tokens, _ = toolbox.TextCommands(message, ind=0)
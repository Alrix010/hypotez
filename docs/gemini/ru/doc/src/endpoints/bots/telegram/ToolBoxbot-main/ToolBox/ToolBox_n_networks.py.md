# Модуль для работы с нейронными сетями
========================================

Модуль содержит класс `neural_networks`, который предоставляет методы для взаимодействия с различными нейронными сетями для генерации изображений и обработки текста.

## Обзор

Этот модуль предоставляет класс `neural_networks` с методами для взаимодействия с различными API нейронных сетей, такими как FLUX.1-schnell, Mistral Large 2407 и Free GPT-4o mini. Он позволяет генерировать изображения на основе текстовых запросов и обрабатывать текстовые запросы с использованием моделей чат-ботов.

## Подробней

Модуль `ToolBox_n_networks.py` содержит класс `neural_networks`, который предоставляет интерфейс для работы с различными нейронными сетями. Он использует API для генерации изображений и обработки текста. В частности, он включает методы для взаимодействия с моделями FLUX.1-schnell, Mistral Large 2407 и Free GPT-4o mini. Модуль использует библиотеки `requests`, `json`, `os`, `io` и `PIL` для выполнения HTTP-запросов, обработки JSON, работы с переменными окружения, ввода-вывода и обработки изображений соответственно.

## Классы

### `neural_networks`

**Описание**: Класс для работы с нейронными сетями.

**Атрибуты**:
- Нет явных атрибутов, но использует переменные окружения для аутентификации.

**Методы**:
- `_FLUX_schnell`: Запрос к модели FLUX.1-schnell для генерации изображения.
- `__mistral_large_2407`: Запрос к модели Mistral Large 2407 для обработки текста.
- `_free_gpt_4o_mini`: Запрос к модели Free GPT-4o mini для обработки текста.

#### `_FLUX_schnell`

```python
def _FLUX_schnell(self, prompt: str, size: list[int, int], seed: int, num_inference_steps: int) -> str|None:
    """
    Отправляет запрос к модели FLUX.1-schnell для генерации изображения на основе заданного текстового запроса.

    Args:
        prompt (str): Текстовый запрос для генерации изображения.
        size (list[int, int]): Размеры изображения (ширина, высота).
        seed (int): Зерно для генерации случайных чисел.
        num_inference_steps (int): Количество шагов для генерации изображения.

    Returns:
        str | None: Сгенерированное изображение в формате PIL Image или None в случае ошибки.
    """
    ...
```

**Назначение**: Отправляет запрос к API FLUX.1-schnell для генерации изображения на основе заданного текстового запроса.

**Параметры**:
- `prompt` (str): Текстовое описание желаемого изображения.
- `size` (list[int, int]): Список, содержащий ширину и высоту изображения в пикселях.
- `seed` (int): Целочисленное значение, используемое в качестве зерна для генератора случайных чисел.
- `num_inference_steps` (int): Количество шагов, используемых в процессе генерации изображения.

**Возвращает**:
- `str | None`: Возвращает изображение в формате PIL Image или `None`, если запрос не удался.

**Как работает функция**:
- Функция формирует полезную нагрузку (payload) с текстовым запросом, параметрами генерации изображения (размер, зерно, количество шагов).
- После этого она выполняет POST-запросы к API FLUX.1-schnell, используя токены HF_TOKEN из переменных окружения.
- Если запрос успешен (код состояния 200), функция открывает изображение из полученного содержимого и возвращает его.
- Функция пытается выполнить запрос несколько раз с разными токенами, прежде чем завершиться неудачей.

#### `__mistral_large_2407`

```python
def __mistral_large_2407(self, prompt: list[dict[str, str]]) -> tuple[str, int, int]|str:
    """
    Отправляет запрос к модели Mistral Large 2407 для обработки текста.

    Args:
        prompt (list[dict[str, str]]): Список словарей, содержащих текстовые запросы.

    Returns:
        tuple[str, int, int] | str: Ответ модели, количество токенов в запросе и ответе, или сообщение об ошибке.
    """
    ...
```

**Назначение**: Отправляет запрос к API Mistral Large 2407 для обработки текстового запроса.

**Параметры**:
- `prompt` (list[dict[str, str]]): Список словарей, содержащих текстовые запросы. Каждый словарь должен иметь ключи, такие как "role" и "content".

**Возвращает**:
- `tuple[str, int, int] | str`: Возвращает кортеж, содержащий ответ модели, количество токенов в запросе и количество токенов в ответе. В случае ошибки возвращает строку с сообщением об ошибке.

**Как работает функция**:
- Функция формирует данные запроса с использованием предоставленного списка сообщений, температуры, верхнего значения `p`, максимального количества токенов и имени модели.
- Затем функция отправляет POST-запрос к API Mistral, используя токен MISTRAL_TOKEN из переменных окружения.
- Если запрос успешен, функция извлекает ответ, количество токенов в запросе и количество токенов в ответе из ответа JSON и возвращает их.

#### `_free_gpt_4o_mini`

```python
def _free_gpt_4o_mini(self, prompt: list[dict[str, str]]) -> tuple[str, int, int]|str:
    """
    Отправляет запрос к модели Free GPT-4o mini для обработки текста.

    Args:
        prompt (list[dict[str, str]]): Список словарей, содержащих текстовые запросы.

    Returns:
        tuple[str, int, int] | str: Ответ модели, количество токенов в запросе и ответе, или результат запроса к Mistral Large 2407 в случае ошибки.
    """
    ...
```

**Назначение**: Отправляет запрос к API Free GPT-4o mini для обработки текстового запроса. Если запрос к Free GPT-4o mini не удается, он возвращается к использованию Mistral Large 2407.

**Параметры**:
- `prompt` (list[dict[str, str]]): Список словарей, представляющих текстовые запросы.

**Возвращает**:
- `tuple[str, int, int] | str`: Возвращает кортеж, содержащий ответ модели, количество токенов в запросе и количество токенов в ответе. Если запрос к Free GPT-4o mini не удался, он возвращает результат запроса к Mistral Large 2407.

**Как работает функция**:
- Функция пытается выполнить запросы к API Free GPT-4o mini с использованием токенов GIT_TOKEN из переменных окружения.
- Если запрос успешен, функция извлекает ответ, количество токенов в запросе и количество токенов в ответе из ответа JSON и возвращает их.
- Если ни один из запросов к Free GPT-4o mini не удается, функция возвращается к использованию модели Mistral Large 2407.

## Примеры

### Пример использования `_FLUX_schnell`

```python
image = neural_networks()._FLUX_schnell(prompt="A futuristic cityscape", size=[512, 512], seed=42, num_inference_steps=30)
if image:
    image.save("cityscape.png")
```

### Пример использования `__mistral_large_2407`

```python
prompt = [{"role": "user", "content": "What is the capital of France?"}]
response, prompt_tokens, completion_tokens = neural_networks().__mistral_large_2407(prompt)
print(response)
```

### Пример использования `_free_gpt_4o_mini`

```python
prompt = [{"role": "user", "content": "Translate 'hello' to French."}]
response, prompt_tokens, completion_tokens = neural_networks()._free_gpt_4o_mini(prompt)
print(response)
```
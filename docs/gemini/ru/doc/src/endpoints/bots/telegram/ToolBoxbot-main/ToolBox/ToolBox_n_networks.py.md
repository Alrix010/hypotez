# Модуль `ToolBox_n_networks.py`

## Обзор

Модуль `ToolBox_n_networks.py` содержит класс `neural_networks`, который предоставляет методы для взаимодействия с различными нейронными сетями, такими как FLUX.1-schnell, mistral-large-2407 и gpt-4o-mini. Модуль использует библиотеки `requests`, `json`, `os`, `io` и `PIL` для выполнения HTTP-запросов, обработки JSON-данных, работы с переменными окружения, обработки ввода-вывода и работы с изображениями соответственно.

## Подробней

Модуль предоставляет функциональность для генерации изображений на основе текстовых запросов и для получения ответов на текстовые запросы с использованием различных AI-моделей. Он предназначен для интеграции с другими частями проекта `hypotez`, где требуется использование нейронных сетей для обработки данных.

## Классы

### `neural_networks`

**Описание**: Класс `neural_networks` предоставляет методы для взаимодействия с различными нейронными сетями.

**Атрибуты**:
- Отсутствуют публичные атрибуты.

**Методы**:
- `_FLUX_schnell`: Защищенный метод для взаимодействия с нейронной сетью FLUX.1-schnell.
- `__mistral_large_2407`: Приватный метод для взаимодействия с моделью mistral-large-2407.
- `_free_gpt_4o_mini`: Защищенный метод для взаимодействия с моделью gpt-4o-mini.

## Методы класса

### `_FLUX_schnell`

```python
def _FLUX_schnell(self, prompt: str, size: list[int, int], seed: int, num_inference_steps: int) -> str|None:
    """ Функция отправляет запрос к нейронной сети FLUX.1-schnell для генерации изображения на основе текстового запроса.

    Args:
        prompt (str): Текстовый запрос для генерации изображения.
        size (list[int, int]): Список, содержащий ширину и высоту изображения.
        seed (int): Зерно для генерации изображения.
        num_inference_steps (int): Количество шагов для генерации изображения.

    Returns:
        str|None: Объект изображения `PIL.Image` в случае успешного запроса, `None` в случае ошибки.

    Raises:
        Отсутствуют явные исключения.

    """
```

**Назначение**: Отправляет запрос к нейронной сети FLUX.1-schnell для генерации изображения на основе текстового запроса.

**Параметры**:
- `prompt` (str): Текстовый запрос для генерации изображения.
- `size` (list[int, int]): Список, содержащий ширину и высоту изображения.
- `seed` (int): Зерно для генерации изображения.
- `num_inference_steps` (int): Количество шагов для генерации изображения.

**Как работает функция**:
- Формирует полезную нагрузку (payload) с использованием входных параметров.
- Выполняет POST-запросы к API huggingface.co, используя токен HF_TOKEN из переменных окружения.
- Если запрос успешен (код состояния 200), открывает изображение из полученного содержимого и возвращает его.
- Если ни один из запросов не удался, возвращает `None`.

**Примеры**:

```python
# Пример вызова функции
# image = neural_networks()._FLUX_schnell(prompt="a cat", size=[512, 512], seed=42, num_inference_steps=50)
# if image:
#     image.save("cat.png")
```

### `__mistral_large_2407`

```python
def __mistral_large_2407(self, prompt: list[dict[str, str]]) -> tuple[str, int, int]|str:
    """ Функция отправляет запрос к модели mistral-large-2407 для получения ответа на текстовый запрос.

    Args:
        prompt (list[dict[str, str]]): Список словарей, содержащих текстовый запрос.

    Returns:
        tuple[str, int, int]|str: Кортеж, содержащий ответ, количество токенов в запросе и количество токенов в ответе в случае успешного запроса, строку с информацией об ошибке в случае неудачи.

    Raises:
        Отсутствуют явные исключения.

    """
```

**Назначение**: Отправляет запрос к модели mistral-large-2407 для получения ответа на текстовый запрос.

**Параметры**:
- `prompt` (list[dict[str, str]]): Список словарей, содержащих текстовый запрос.

**Как работает функция**:
- Формирует данные запроса с использованием входных параметров.
- Выполняет POST-запрос к API mistral.ai, используя токен MISTRAL_TOKEN из переменных окружения.
- Преобразует ответ из формата JSON.
- Возвращает ответ, количество токенов в запросе и количество токенов в ответе.

**Примеры**:

```python
# Пример вызова функции
# prompt = [{"role": "user", "content": "Hello, how are you?"}]
# response, prompt_tokens, completion_tokens = neural_networks().__mistral_large_2407(prompt)
# print(response, prompt_tokens, completion_tokens)
```

### `_free_gpt_4o_mini`

```python
def _free_gpt_4o_mini(self, prompt: list[dict[str, str]]) -> tuple[str, int, int]|str:
    """ Функция отправляет запрос к модели gpt-4o-mini для получения ответа на текстовый запрос.

    Args:
        prompt (list[dict[str, str]]): Список словарей, содержащих текстовый запрос.

    Returns:
        tuple[str, int, int]|str: Кортеж, содержащий ответ, количество токенов в запросе и количество токенов в ответе в случае успешного запроса, результат вызова `__mistral_large_2407` в случае неудачи.

    """
```

**Назначение**: Отправляет запрос к модели gpt-4o-mini для получения ответа на текстовый запрос.

**Параметры**:
- `prompt` (list[dict[str, str]]): Список словарей, содержащих текстовый запрос.

**Как работает функция**:
- Формирует данные запроса с использованием входных параметров.
- Выполняет POST-запросы к API models.inference.ai.azure.com, используя токены GIT_TOKEN из переменных окружения.
- Если запрос успешен (код состояния 200), преобразует ответ из формата JSON и возвращает ответ, количество токенов в запросе и количество токенов в ответе.
- Если ни один из запросов не удался, вызывает метод `__mistral_large_2407` и возвращает его результат.

**Примеры**:

```python
# Пример вызова функции
# prompt = [{"role": "user", "content": "Как дела?"}]
# response, prompt_tokens, completion_tokens = neural_networks()._free_gpt_4o_mini(prompt)
# print(response, prompt_tokens, completion_tokens)
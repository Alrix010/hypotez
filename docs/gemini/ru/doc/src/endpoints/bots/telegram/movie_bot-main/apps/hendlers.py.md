# Модуль обработчиков Telegram-бота для поиска фильмов
## Обзор

Модуль `hendlers.py` содержит обработчики для Telegram-бота, предназначенного для поиска фильмов и сериалов. Он использует библиотеку `aiogram` для обработки входящих сообщений и колбэков от пользователя. Модуль определяет FSM (машину состояний) для управления процессом поиска, а также использует модуль `search.py` для выполнения поисковых запросов.

## Подробней

Этот модуль является ключевым компонентом Telegram-бота, обеспечивающим взаимодействие с пользователем через Telegram API. Он обрабатывает команды, такие как `/start`, запросы на поиск фильмов и сериалов, а также управляет состоянием диалога с пользователем для уточнения параметров поиска.

## Классы

### `Params`

**Описание**: Класс `Params` представляет собой машину состояний (FSM), используемую для управления процессом поиска фильма или сериала. Он определяет два состояния: `type_movie` (тип фильма) и `name` (название фильма).

**Наследует**: `StatesGroup` из `aiogram.fsm.state`.

**Атрибуты**:
- `type_movie` (State): Состояние для ожидания ввода типа фильма (фильм или сериал).
- `name` (State): Состояние для ожидания ввода названия фильма.

**Принцип работы**:
Класс `Params` используется для определения состояний, в которых может находиться пользователь во время процесса поиска. Когда пользователь инициирует поиск, бот переходит в состояние `type_movie`, чтобы получить от пользователя тип фильма (фильм или сериал). Затем бот переходит в состояние `name`, чтобы получить название фильма. После получения всей необходимой информации бот выполняет поиск и возвращает результат пользователю.

## Функции

### `command_start_handler`

```python
async def command_start_handler(message: Message) -> None:
    """Обработчик команды /start. Отправляет приветственное сообщение пользователю и предлагает начать поиск фильма.
    Args:
        message (Message): Объект сообщения, содержащий информацию о входящем сообщении от пользователя.

    Returns:
        None

    Example:
        Пример вызова команды `/start` пользователем.
    """
```
**Назначение**: Обрабатывает команду `/start`, отправляя приветственное сообщение пользователю и предлагая начать поиск фильма.

**Параметры**:
- `message` (Message): Объект сообщения, содержащий информацию о входящем сообщении от пользователя.

**Возвращает**:
- `None`

**Как работает функция**:
Функция отправляет приветственное сообщение пользователю, используя его имя из объекта `message.from_user.full_name`. Затем она предлагает пользователю начать поиск фильма, отправляя сообщение с клавиатурой `kb.find_movie`.

### `movie_handler`

```python
async def movie_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """Обработчик колбэка 'new_movies'. Устанавливает состояние `Params.type_movie` и предлагает пользователю указать тип фильма (фильм или сериал).
    Args:
        callback (CallbackQuery): Объект колбэка, содержащий информацию о колбэке от пользователя.
        state (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

    Returns:
        None

    Example:
        Пример нажатия кнопки 'new_movies' пользователем.
    """
```

**Назначение**: Обрабатывает колбэк 'new_movies', устанавливая состояние `Params.type_movie` и предлагая пользователю указать тип фильма (фильм или сериал).

**Параметры**:
- `callback` (CallbackQuery): Объект колбэка, содержащий информацию о колбэке от пользователя.
- `state` (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
Функция устанавливает состояние `Params.type_movie` с помощью `state.set_state(Params.type_movie)`. Затем она редактирует сообщение, вызвавшее колбэк, заменяя его на сообщение с предложением указать тип фильма и клавиатурой `kb.choice`.

### `series_handler`

```python
async def series_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """Обработчик колбэка 'series'. Удаляет предыдущее сообщение, обновляет данные состояния, устанавливает состояние `Params.name` и запрашивает название сериала.
    Args:
        callback (CallbackQuery): Объект колбэка, содержащий информацию о колбэке от пользователя.
        state (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

    Returns:
        None

    Example:
        Пример нажатия кнопки 'series' пользователем.
    """
```

**Назначение**: Обрабатывает колбэк 'series', удаляя предыдущее сообщение, обновляет данные состояния, устанавливает состояние `Params.name` и запрашивает название сериала.

**Параметры**:
- `callback` (CallbackQuery): Объект колбэка, содержащий информацию о колбэке от пользователя.
- `state` (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
Функция удаляет предыдущее сообщение с помощью `callback.message.delete()`. Затем она обновляет данные состояния, устанавливая `type_movie` в 'series' с помощью `state.update_data(type_movie='series')`. После этого она устанавливает состояние `Params.name` с помощью `state.set_state(Params.name)` и отправляет пользователю сообщение с запросом названия сериала.

### `film_handler`

```python
async def film_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """Обработчик колбэка 'film'. Удаляет предыдущее сообщение, обновляет данные состояния, устанавливает состояние `Params.name` и запрашивает название фильма.
    Args:
        callback (CallbackQuery): Объект колбэка, содержащий информацию о колбэке от пользователя.
        state (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

    Returns:
        None

    Example:
        Пример нажатия кнопки 'film' пользователем.
    """
```

**Назначение**: Обрабатывает колбэк 'film', удаляя предыдущее сообщение, обновляет данные состояния, устанавливает состояние `Params.name` и запрашивает название фильма.

**Параметры**:
- `callback` (CallbackQuery): Объект колбэка, содержащий информацию о колбэке от пользователя.
- `state` (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
Функция удаляет предыдущее сообщение с помощью `callback.message.delete()`. Затем она обновляет данные состояния, устанавливая `type_movie` в 'film' с помощью `state.update_data(type_movie='film')`. После этого она устанавливает состояние `Params.name` с помощью `state.set_state(Params.name)` и отправляет пользователю сообщение с запросом названия фильма.

### `name_handler`

```python
async def name_handler(message: Message, state: FSMContext) -> None:
    """Обработчик состояния `Params.name`. Получает название фильма от пользователя, выполняет поиск и отправляет результат пользователю.
    Args:
        message (Message): Объект сообщения, содержащий информацию о входящем сообщении от пользователя.
        state (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

    Returns:
        None

    Example:
        Пример ввода названия фильма пользователем.
    """
```

**Назначение**: Обрабатывает состояние `Params.name`. Получает название фильма от пользователя, выполняет поиск и отправляет результат пользователю.

**Параметры**:
- `message` (Message): Объект сообщения, содержащий информацию о входящем сообщении от пользователя.
- `state` (FSMContext): Объект FSMContext, используемый для управления состоянием диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
Функция получает название фильма от пользователя из объекта `message.text` и сохраняет его в данных состояния с помощью `state.update_data(name=message.text)`. Затем она извлекает данные из состояния с помощью `state.get_data()` и выполняет поиск фильма с помощью функции `search_query(data['name'], data['type_movie'])`. После этого она отправляет пользователю информацию о запросе (название и тип фильма) и результат поиска. Если фильм найден, она отправляет информацию о фильме (название, описание и ссылку). Если фильм не найден, она отправляет сообщение об ошибке. В конце функция предлагает пользователю начать новый поиск и очищает состояние с помощью `state.clear()`.

## Переменные

- `router`: Объект `Router` из библиотеки `aiogram`, используемый для регистрации обработчиков.
- `type_movies`: Словарь, сопоставляющий ключи 'film' и 'series' с их русскими названиями ('Фильм' и 'Сериал').
# Модуль обработки запросов Telegram-бота для поиска фильмов

## Обзор

Данный модуль содержит обработчики для Telegram-бота, позволяющие пользователям искать фильмы и сериалы. Он использует библиотеку `aiogram` для взаимодействия с Telegram API и предоставляет интерфейс для поиска фильмов по названию и типу.

## Подробней

Модуль обрабатывает команды `/start`, запросы на поиск фильмов/сериалов, выбор типа контента (фильм или сериал) и ввод названия для поиска. Он использует конечные автоматы (FSM) для управления состоянием диалога с пользователем.

## Классы

### `Params(StatesGroup)`

**Описание**: Класс, представляющий состояния конечного автомата для обработки параметров поиска.

**Наследует**: `StatesGroup` из `aiogram.fsm.state`.

**Атрибуты**:
- `type_movie (State)`: Состояние для ожидания ввода типа фильма (фильм или сериал).
- `name (State)`: Состояние для ожидания ввода названия фильма.

**Принцип работы**:
Класс `Params` определяет два состояния: `type_movie` и `name`.  Эти состояния используются для последовательного получения от пользователя типа фильма (сериал или фильм) и названия фильма. Конечный автомат позволяет боту помнить, какую информацию он ожидает от пользователя на каждом этапе.

## Функции

### `command_start_handler(message: Message) -> None`

**Назначение**: Обработчик команды `/start`. Отправляет приветственное сообщение пользователю и предлагает начать поиск фильма.

**Параметры**:
- `message (Message)`: Объект сообщения, содержащий информацию о входящем сообщении от пользователя.

**Возвращает**:
- `None`

**Как работает функция**:
Функция отправляет два сообщения пользователю: приветствие с его именем и предложение найти фильм, используя клавиатуру `find_movie`.

**Примеры**:
```python
# Пример вызова (неявно вызывается aiogram при получении команды /start)
# await command_start_handler(message)
```

### `movie_handler(callback: CallbackQuery, state: FSMContext) -> None`

**Назначение**: Обработчик callback-запроса `new_movies`. Переводит пользователя в состояние ожидания выбора типа фильма (фильм или сериал).

**Параметры**:
- `callback (CallbackQuery)`: Объект callback-запроса, содержащий информацию о нажатой кнопке.
- `state (FSMContext)`: Объект, представляющий контекст конечного автомата для хранения состояния диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
Функция устанавливает состояние `Params.type_movie`, отправляет пользователю сообщение с предложением выбрать тип фильма (сериал или фильм) и отображает клавиатуру `choice` с вариантами выбора.

**Примеры**:
```python
# Пример вызова (неявно вызывается aiogram при нажатии на кнопку new_movies)
# await movie_handler(callback, state)
```

### `series_handler(callback: CallbackQuery, state: FSMContext) -> None`

**Назначение**: Обработчик callback-запроса `series`.  Удаляет предыдущее сообщение с вариантами выбора, сохраняет тип фильма "сериал" в контексте FSM и запрашивает название сериала.

**Параметры**:
- `callback (CallbackQuery)`: Объект callback-запроса, содержащий информацию о нажатой кнопке.
- `state (FSMContext)`: Объект, представляющий контекст конечного автомата для хранения состояния диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
1. Удаляет предыдущее сообщение с кнопками выбора типа.
2. Обновляет данные в контексте FSM, сохраняя значение `type_movie` как `'series'`.
3. Устанавливает состояние `Params.name`, чтобы ожидать ввод названия фильма.
4. Отправляет пользователю сообщение с запросом ввести название сериала.

**Примеры**:
```python
# Пример вызова (неявно вызывается aiogram при нажатии на кнопку series)
# await series_handler(callback, state)
```

### `film_handler(callback: CallbackQuery, state: FSMContext) -> None`

**Назначение**: Обработчик callback-запроса `film`.  Удаляет предыдущее сообщение с вариантами выбора, сохраняет тип фильма "фильм" в контексте FSM и запрашивает название фильма.

**Параметры**:
- `callback (CallbackQuery)`: Объект callback-запроса, содержащий информацию о нажатой кнопке.
- `state (FSMContext)`: Объект, представляющий контекст конечного автомата для хранения состояния диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
1. Удаляет предыдущее сообщение с кнопками выбора типа.
2. Обновляет данные в контексте FSM, сохраняя значение `type_movie` как `'film'`.
3. Устанавливает состояние `Params.name`, чтобы ожидать ввод названия фильма.
4. Отправляет пользователю сообщение с запросом ввести название фильма.

**Примеры**:
```python
# Пример вызова (неявно вызывается aiogram при нажатии на кнопку film)
# await film_handler(callback, state)
```

### `name_handler(message: Message, state: FSMContext) -> None`

**Назначение**: Обработчик сообщений в состоянии `Params.name`.  Сохраняет название фильма в контексте FSM, выполняет поиск и отправляет результат пользователю.

**Параметры**:
- `message (Message)`: Объект сообщения, содержащий текст с названием фильма.
- `state (FSMContext)`: Объект, представляющий контекст конечного автомата для хранения состояния диалога с пользователем.

**Возвращает**:
- `None`

**Как работает функция**:
1. Обновляет данные в контексте FSM, сохраняя введенное пользователем название фильма.
2. Извлекает из контекста FSM название и тип фильма.
3. Вызывает функцию `search_query` для поиска фильма.
4. Отправляет пользователю сообщение с информацией о запросе (название и тип).
5. Если фильм найден, отправляет сообщение с информацией о фильме (название, описание, ссылка).
6. Если фильм не найден, отправляет сообщение о том, что фильм не найден.
7. Предлагает пользователю начать новый поиск, используя клавиатуру `find_movie`.
8. Очищает состояние FSM.

**Примеры**:
```python
# Пример вызова (неявно вызывается aiogram при получении сообщения в состоянии Params.name)
# await name_handler(message, state)
```
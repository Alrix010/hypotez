# Модуль `hendlers`

## Обзор

Модуль `hendlers` - это набор обработчиков для бота Telegram, отвечающего за поиск фильмов и сериалов. 
Он использует библиотеку `aiogram` для обработки входящих запросов и взаимодействия с пользователем. 
Модуль интегрируется с другими частями проекта, в частности с модулем `search`, который обеспечивает функциональность поиска фильмов и сериалов по запросу пользователя.

## Подробней

В этом модуле реализованы различные обработчики для различных состояний бота, которые отвечают за следующие действия:

- **Обработка команды `/start`**:
    - Приветствует пользователя и предлагает начать поиск фильма.
- **Обработка нажатия кнопки "Новый фильм"**:
    - Переводит бота в состояние ожидания выбора типа фильма (фильм или сериал).
- **Обработка выбора типа фильма**:
    - Переводит бота в состояние ожидания ввода названия фильма.
- **Обработка ввода названия фильма**:
    - Получает название фильма и тип фильма от пользователя.
    - Выполняет поиск фильма по имени и типу в базе данных.
    - Возвращает информацию о найденном фильме, если он был найден.
    - В противном случае сообщает пользователю, что фильм не найден.
- **Обработка нажатия кнопки "Новый фильм" после поиска**:
    - Сбрасывает текущее состояние бота и предлагает начать новый поиск.

## Классы

### `Params`

**Описание**:  Класс `Params` определяет состояния бота, используемого для поиска фильмов.

**Наследует**: `StatesGroup` из библиотеки `aiogram`

**Атрибуты**:

- `type_movie`: Состояние ожидания выбора типа фильма (фильм или сериал).
- `name`: Состояние ожидания ввода названия фильма.

## Функции

### `command_start_handler`

**Назначение**: Обрабатывает команду `/start`, отправляемую пользователем.

**Параметры**:

- `message` (`Message`): Сообщение от пользователя.

**Возвращает**:  `None`

**Как работает функция**:

- Приветствует пользователя с помощью приветствия в виде текстового сообщения, включающего имя пользователя.
- Выводит сообщение "Найти интересующий фильм" с кнопкой "Новый фильм" для перехода к поиску.


### `movie_handler`

**Назначение**: Обрабатывает нажатие кнопки "Новый фильм" в меню бота.

**Параметры**:

- `callback` (`CallbackQuery`): Запрос пользователя на обработку кнопки.
- `state` (`FSMContext`): Состояние бота.

**Возвращает**:  `None`

**Как работает функция**:

- Устанавливает состояние бота на `Params.type_movie`.
- Редактирует сообщение с кнопкой "Новый фильм" на сообщение "Укажите фильм или сериал вы ищите" с кнопками "Фильм" и "Сериал".


### `series_handler`

**Назначение**: Обрабатывает нажатие кнопки "Сериал" в меню выбора типа фильма.

**Параметры**:

- `callback` (`CallbackQuery`): Запрос пользователя на обработку кнопки.
- `state` (`FSMContext`): Состояние бота.

**Возвращает**:  `None`

**Как работает функция**:

- Удаляет текущее сообщение.
- Обновляет данные состояния бота, устанавливая тип фильма на "series".
- Устанавливает состояние бота на `Params.name` для ожидания ввода названия фильма.
- Отправляет сообщение "Введите название".


### `film_handler`

**Назначение**: Обрабатывает нажатие кнопки "Фильм" в меню выбора типа фильма.

**Параметры**:

- `callback` (`CallbackQuery`): Запрос пользователя на обработку кнопки.
- `state` (`FSMContext`): Состояние бота.

**Возвращает**:  `None`

**Как работает функция**:

- Удаляет текущее сообщение.
- Обновляет данные состояния бота, устанавливая тип фильма на "film".
- Устанавливает состояние бота на `Params.name` для ожидания ввода названия фильма.
- Отправляет сообщение "Введите название".


### `name_handler`

**Назначение**: Обрабатывает ввод названия фильма пользователем.

**Параметры**:

- `message` (`Message`): Сообщение от пользователя, содержащее название фильма.
- `state` (`FSMContext`): Состояние бота.

**Возвращает**:  `None`

**Как работает функция**:

- Обновляет данные состояния бота, сохраняя введённое название фильма.
- Получает данные состояния бота.
- Выполняет поиск фильма по имени и типу в базе данных, используя функцию `search_query`.
- Выводит информацию о найденном фильме, включая название, описание и ссылку, если фильм был найден.
- В противном случае сообщает пользователю, что фильм не найден.
- Выводит сообщение "Найти новый фильм" с кнопкой "Новый фильм".
- Сбрасывает состояние бота.

## Параметры класса

### `type_movies`

**Описание**: Словарь, содержащий названия типов фильмов (фильм, сериал) для вывода на русском языке.

**Пример**:

```python
>>> type_movies
{'film': 'Фильм', 'series': 'Сериал'}
```

## Примеры

```python
# Пример использования обработчика /start
>>> from aiogram.types import Message
>>> from src.endpoints.bots.telegram.movie_bot-main.apps.hendlers import command_start_handler
>>> message = Message(text='/start', from_user={'full_name': 'John Doe'})
>>> command_start_handler(message)
```

```python
# Пример использования обработчика name_handler
>>> from aiogram.types import Message
>>> from aiogram.fsm.context import FSMContext
>>> from src.endpoints.bots.telegram.movie_bot-main.apps.hendlers import name_handler
>>> message = Message(text='The Shawshank Redemption', from_user={'full_name': 'John Doe'})
>>> state = FSMContext()
>>> state.update_data(name='The Shawshank Redemption', type_movie='film')
>>> name_handler(message, state)
```
```markdown
# Модуль для загрузки файлов в Google Drive

## Обзор

Этот модуль предоставляет функцию `upload`, которая позволяет загружать файлы в Google Drive, используя библиотеку `pydrive`. Модуль обеспечивает авторизацию пользователя, создание папок, загрузку файлов в указанную папку, настройку прав доступа к файлам и получение ссылки на загруженный файл.

## Подробней

Модуль `upload` реализует функциональность загрузки файлов в Google Drive. Он обеспечивает авторизацию пользователя с помощью `GoogleAuth`, создание папок в Google Drive при необходимости, загрузку файлов в указанную папку (с использованием `GoogleDrive` и `CreateFile`), настройку прав доступа к загруженным файлам и получение ссылки на загруженный файл. 

## Функции

### `upload`

**Назначение**: Загружает файл в Google Drive.

**Параметры**:

- `filename` (str): Путь к файлу, который нужно загрузить.
- `update` (Объект): Объект, содержащий информацию о текущем обновлении.
- `context` (Объект): Объект, содержащий контекстную информацию.
- `parent_folder` (str, optional): Название папки, в которую нужно загрузить файл. По умолчанию `None`.

**Возвращает**:

- `str`: URL-адрес загруженного файла в Google Drive.

**Вызывает исключения**:

- `Exception`: Возникает, если произошла ошибка во время загрузки файла.

**Как работает функция**:

1. Авторизация пользователя:
   - Использует `GoogleAuth` для загрузки сохраненных учетных данных пользователя.
   - Если учетные данные отсутствуют или срок их действия истек, функция запросит новые учетные данные и сохранит их.

2. Создание папки:
   - Если задан параметр `parent_folder`, функция проверяет существование указанной папки.
   - Если папка не существует, функция создает ее в корневом каталоге Google Drive.
   - Если папка уже существует, функция использует ее идентификатор (ID).

3. Загрузка файла:
   - Функция создает объект `CreateFile` и задает его свойства, включая название файла и родительскую папку.
   - Функция устанавливает содержимое файла, используя `SetContentFile`.
   - Функция загружает файл с помощью `Upload`.

4. Настройка прав доступа:
   - Если функция не работает с TeamDrive, функция устанавливает права доступа к загруженному файлу, чтобы любой мог его просмотреть по ссылке.

5. Возврат ссылки:
   - Функция получает ссылку на загруженный файл и возвращает ее.

**Примеры**:

```python
# Загрузка файла в корневую папку
upload('file.txt', update, context)

# Загрузка файла в папку 'MyFolder'
upload('file.txt', update, context, parent_folder='MyFolder')

# Загрузка файла в TeamDrive
upload('file.txt', update, context, parent_folder='MyFolder') # В этом случае необходимо в файле `creds.py` задать значение переменной `TEAMDRIVE_FOLDER_ID`. 
```
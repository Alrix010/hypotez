# Модуль `auto_proxy`

## Обзор

Модуль `auto_proxy` предоставляет набор функций для автоматического поиска, тестирования и использования прокси-серверов. Он позволяет улучшить стабильность и производительность при работе с API, которые могут быть ограничены по IP-адресу.

## Подробней

Модуль работает следующим образом:

- **`fetch_proxies()`**: Извлекает список прокси-серверов с сайта `proxyscrape.com`.
- **`test_proxy()`**: Проверяет работоспособность прокси-сервера с использованием тестового запроса и заданного времени ожидания.
- **`add_working_proxy()`**: Добавляет рабочий прокси-сервер в глобальный список `working_proxies`.
- **`remove_proxy()`**: Удаляет прокси-сервер из глобального списка `working_proxies`.
- **`get_working_proxies()`**: Получает список прокси-серверов, тестирует их и добавляет рабочие прокси-серверы в глобальный список `working_proxies`.
- **`update_working_proxies()`**: Регулярно обновляет глобальный список `working_proxies` рабочими прокси-серверами.
- **`get_random_proxy()`**: Возвращает случайный рабочий прокси-сервер из глобального списка `working_proxies`.

## Функции

### `fetch_proxies()`

**Назначение**: Извлекает список прокси-серверов с сайта `proxyscrape.com`.

**Параметры**: 
- Отсутствуют

**Возвращает**:
- `list`: Список прокси-серверов в формате "IP:Port".

**Как работает**:
- Функция отправляет HTTP-запрос на `https://www.proxy-list.download/api/v1/get?type=http`.
- Если запрос успешный, извлекает список прокси-серверов из текста ответа и возвращает его.
- В случае ошибки возвращает пустой список.

### `test_proxy()`

**Назначение**: Проверяет работоспособность прокси-сервера с использованием тестового запроса и заданного времени ожидания.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".
- `prompt` (str): Тестовый запрос, используемый для проверки.
- `timeout` (int): Максимальное время ожидания ответа в секундах.

**Как работает**:
- Функция пытается отправить тестовый запрос с использованием указанного прокси-сервера.
- Измеряет время ответа и проверяет, что оно меньше заданного времени ожидания.
- Если время ответа в пределах допустимых значений, выводит сообщение о успешном тестировании и добавляет прокси-сервер в глобальный список `working_proxies`.
- В случае ошибки пропускает прокси-сервер и не добавляет его в список.

### `add_working_proxy()`

**Назначение**: Добавляет рабочий прокси-сервер в глобальный список `working_proxies`.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает**:
- Функция добавляет `proxy` в глобальный список `working_proxies`.

### `remove_proxy()`

**Назначение**: Удаляет прокси-сервер из глобального списка `working_proxies`.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает**:
- Функция удаляет `proxy` из глобального списка `working_proxies`.

### `get_working_proxies()`

**Назначение**: Получает список прокси-серверов, тестирует их и добавляет рабочие прокси-серверы в глобальный список `working_proxies`.

**Параметры**:
- `prompt` (str): Тестовый запрос, используемый для проверки.
- `timeout` (int, optional): Максимальное время ожидания ответа в секундах. По умолчанию 5 секунд.

**Как работает**:
- Функция извлекает список прокси-серверов с помощью `fetch_proxies()`.
- Создает отдельный поток для каждого прокси-сервера и запускает функцию `test_proxy()`.
- Дожидается завершения всех потоков и обновляет глобальный список `working_proxies` рабочими прокси-серверами.

### `update_working_proxies()`

**Назначение**: Регулярно обновляет глобальный список `working_proxies` рабочими прокси-серверами.

**Параметры**:
- Отсутствуют

**Как работает**:
- Функция работает в цикле, обновляя глобальный список `working_proxies` каждые 30 минут.
- Очищает глобальный список `working_proxies` перед обновлением.
- Вызывает функцию `get_working_proxies()` для получения и проверки прокси-серверов.

### `get_random_proxy()`

**Назначение**: Возвращает случайный рабочий прокси-сервер из глобального списка `working_proxies`.

**Параметры**:
- Отсутствуют

**Возвращает**:
- `str`: Случайный рабочий прокси-сервер в формате "IP:Port".

**Как работает**:
- Функция выбирает случайный элемент из глобального списка `working_proxies` и возвращает его.

## Примеры

```python
# Получение списка прокси-серверов
proxies = fetch_proxies()

# Тестирование прокси-сервера
test_proxy("123.123.123.123:8080", "What is the capital of France?", 5)

# Добавление рабочего прокси-сервера
add_working_proxy("123.123.123.123:8080")

# Удаление прокси-сервера
remove_proxy("123.123.123.123:8080")

# Получение списка рабочих прокси-серверов
get_working_proxies("What is the capital of France?", 5)

# Обновление списка рабочих прокси-серверов
update_working_proxies()

# Получение случайного рабочего прокси-сервера
random_proxy = get_random_proxy()
```
# Провайдер Bing

## Обзор

Этот модуль предоставляет реализацию провайдера Bing для генерации текста с использованием модели GPT-4. 

## Подробности

Модуль `Bing.py` реализует провайдера, который использует API Bing для доступа к модели GPT-4. 

**Ключевые особенности:**

- Поддержка потоковой передачи (streaming) для вывода текста по мере его генерации.
- Использование WebSocket-соединения для общения с сервером Bing.
- Настройка параметров запроса, включая режим работы модели (например, "jailbreak").

## Классы

### `optionsSets`

**Описание**: Класс, который определяет наборы опций для взаимодействия с моделью.

**Атрибуты**:

- `optionSet`: Словарь, который описывает общий формат набора опций.
- `jailbreak`: Словарь, который содержит набор опций для "jailbreak" режима модели.

### `Defaults`

**Описание**: Класс, который содержит значения по умолчанию для различных параметров.

**Атрибуты**:

- `delimiter`: Разделитель, используемый для разделения частей ответа от сервера Bing.
- `ip_address`: IP-адрес, который используется для имитации запроса с определенного устройства.
- `allowedMessageTypes`: Список типов сообщений, которые могут быть отправлены на сервер Bing.
- `sliceIds`: Список идентификаторов, которые используются для фильтрации ответов от сервера Bing.
- `location`: Словарь, который содержит информацию о местоположении пользователя для передачи на сервер Bing.

## Функции

### `_format`

**Назначение**: Форматирует словарь в строку JSON с добавлением разделителя.

**Параметры**:

- `msg` (dict): Словарь для форматирования.

**Возвращает**:

- `str`: Форматированная строка JSON с разделителем.

**Пример**:

```python
>>> msg = {'key1': 'value1', 'key2': 'value2'}
>>> _format(msg)
'{"key1": "value1", "key2": "value2"}\x1e'
```

### `create_conversation`

**Назначение**: Создает новую сессию для общения с моделью Bing.

**Возвращает**:

- `tuple`: Кортеж, содержащий идентификатор сессии, идентификатор клиента и подпись сессии.

**Вызывает исключения**:

- `Exception`: Если не удалось создать сессию.

**Пример**:

```python
>>> conversationId, clientId, conversationSignature = await create_conversation()
```

### `stream_generate`

**Назначение**: Выполняет потоковую генерацию текста с использованием модели Bing.

**Параметры**:

- `prompt` (str): Текстовый запрос для модели.
- `mode` (optionsSets.optionSet): Набор опций для модели.
- `context` (bool or str): Контекст для модели (если нужно).

**Возвращает**:

- `Generator`: Генератор, который выдает части генерируемого текста по мере его создания.

**Пример**:

```python
>>> async for token in stream_generate('Hello world!', optionsSets.jailbreak):
...    print(token)
```

### `run`

**Назначение**: Запускает асинхронный генератор.

**Параметры**:

- `generator`: Асинхронный генератор.

**Возвращает**:

- `Generator`: Генератор, который выдает значения из асинхронного генератора.

**Пример**:

```python
>>> for token in run(stream_generate('Hello world!', optionsSets.jailbreak)):
...    print(token)
```

### `convert`

**Назначение**: Преобразует список сообщений в формат контекста для модели.

**Параметры**:

- `messages`: Список сообщений.

**Возвращает**:

- `str`: Текст контекста для модели.

**Пример**:

```python
>>> messages = [{'role': 'user', 'content': 'Hello world!'}]
>>> context = convert(messages)
>>> print(context)
[user](#message)
Hello world!

```

### `_create_completion`

**Назначение**: Создает завершение текста с использованием модели Bing.

**Параметры**:

- `model` (str): Имя модели.
- `messages` (list): Список сообщений.
- `stream` (bool): Флаг, указывающий, нужно ли использовать потоковую передачу.

**Возвращает**:

- `Generator`: Генератор, который выдает части генерируемого текста.

**Пример**:

```python
>>> for token in _create_completion('gpt-4', [{'role': 'user', 'content': 'Hello world!'}], True):
...    print(token)
```

## Параметры

- `url`: URL-адрес API Bing.
- `model`: Список поддерживаемых моделей.
- `supports_stream`: Флаг, указывающий, поддерживает ли провайдер потоковую передачу.
- `needs_auth`: Флаг, указывающий, требуется ли авторизация для использования провайдера.

## Дополнительные заметки

- Модуль использует библиотеки `requests`, `aiohttp` и `asyncio` для взаимодействия с API Bing.
- Классы `optionsSets` и `Defaults` предоставляют структуру для настройки параметров запроса и ответа.
- Функция `_create_completion` является основным методом для получения завершения текста с использованием модели Bing.
- `_create_completion` - основной метод, который вызывается для получения завершения текста с использованием модели Bing.
- `_create_completion` - основной метод, который вызывается для получения завершения текста с использованием модели Bing.
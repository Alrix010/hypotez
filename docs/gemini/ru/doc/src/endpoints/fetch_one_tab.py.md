# src/endpoints/fetch_one_tab

## Обзор

Модуль `fetch_one_tab` предназначен для парсинга и извлечения данных из веб-страниц OneTab, получая список URL-адресов, описание и, возможно, числовое значение (цену) из указанного URL.

## Подробней

Этот модуль используется для обработки ссылок, сохраненных в формате OneTab. Он отправляет HTTP-запрос к предоставленному URL OneTab, парсит HTML-содержимое страницы с помощью библиотеки `BeautifulSoup` и извлекает все ссылки на вкладки, а также дополнительную информацию из специально размеченного блока (`tabGroupLabel`). Извлеченная информация включает список целевых URL-адресов, текстовое описание и, если оно присутствует и имеет числовой формат, значение, интерпретируемое как "цена". Модуль обрабатывает возможные ошибки HTTP-запросов и логирует их.

## Функции

### `fetch_target_urls_onetab`

**Назначение**: Функция выполняет парсинг целевых URL-адресов и связанной информации (описания, возможно, цены) из веб-страницы OneTab по заданному URL.

**Параметры**:
- `one_tab_url` (str): URL веб-страницы OneTab для парсинга.

**Возвращает**:
- `tuple[str, str, list[str]] | bool`: Кортеж, содержащий (цена (str), описание (str), список URL-адресов (list[str])), если парсинг успешен. Возвращает `False, False, False` в случае ошибки при выполнении HTTP-запроса.

**Вызывает исключения**:\
- `requests.exceptions.RequestException`: Исключение может быть вызвано при возникновении проблем с выполнением HTTP-запроса (например, сетевые ошибки, ошибки статуса HTTP).

**Как работает функция**:
1.  Функция принимает URL страницы OneTab в качестве входного параметра `one_tab_url`.
2.  Выполняется HTTP GET-запрос к указанному URL с таймаутом 10 секунд с использованием библиотеки `requests`.
3.  Производится проверка статуса ответа. Если статус не успешный (например, 404, 500), вызывается исключение `requests.exceptions.RequestException`.
4.  HTML-содержимое успешного ответа парсится с помощью `BeautifulSoup` с использованием парсера 'html.parser'.
5.  Из парсированного HTML извлекаются все теги `<a>` с классом `tabLink`. Для каждого такого тега извлекается значение атрибута `href`, и эти значения собираются в список `urls`.
6.  Производится поиск тега `<div>` с классом `tabGroupLabel`.
7.  Если такой `div` найден, из него извлекается текстовое содержимое (`data`).
8.  Если `data` не пустое, выполняется попытка разделить его на две части по первому пробелу (`maxsplit=1`).
9.  Первая часть (`parts[0]`) проверяется: если она является числом (`isdigit()`), она преобразуется в целое число и присваивается переменной `price`. В противном случае `price` остается пустой строкой.
10. Вторая часть (`parts[1]`, если она существует) присваивается переменной `description`. Если второй части нет (то есть `data` состояло только из одной части или было пустым после поиска), `description` устанавливается в текущее время (`gs.now`).
11. Если `data` было пустым (то есть `div.tabGroupLabel` не найден), `price` устанавливается в пустую строку, а `description` в текущее время (`gs.now`).
12. В случае успешного выполнения функция возвращает кортеж `(price, description, urls)`.
13. Если в процессе выполнения запроса или обработки ответа возникает `requests.exceptions.RequestException`, ошибка логируется с использованием `logger.error`, включая исходное исключение и информацию об аргументах вызова. В этом случае функция возвращает кортеж `(False, False, False)`.

**Примеры**:

```python
# Пример успешного выполнения
one_tab_url = 'https://www.one-tab.com/page/example_page_id'
price, description, urls = fetch_target_urls_onetab(one_tab_url)
if urls:
    print(f'Цена: {price}')
    print(f'Описание: {description}')
    print(f'Найденные URL: {urls[:5]}...') # Выводим первые 5 URL для примера
else:
    print('Не удалось получить данные из OneTab или URL не найдены.')

# Пример обработки ошибки (если URL не существует или есть проблемы с сетью)
bad_url = 'https://invalid.one-tab.com/non_existent_page'
price, description, urls = fetch_target_urls_onetab(bad_url)
if urls is False: # Проверяем, что функция вернула False из-за ошибки
    print(f'Произошла ошибка при запросе к {bad_url}')

```
```
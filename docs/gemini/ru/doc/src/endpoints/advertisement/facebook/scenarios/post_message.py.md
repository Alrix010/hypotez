# Модуль для публикации сообщений в Facebook

## Обзор

Модуль `src.endpoints.advertisement.facebook.scenarios.post_message` предоставляет функции для публикации сообщений в Facebook. Он включает в себя сценарии для загрузки медиафайлов, обновления подписей к изображениям и публикации сообщений.

## Подробнее

Модуль `src.endpoints.advertisement.facebook.scenarios.post_message` используется для автоматизации процесса публикации сообщений в Facebook. Он предназначен для работы с веб-драйвером, используя `Driver` и `Chrome` для взаимодействия с веб-страницей Facebook.

## Классы

### `class Driver`

**Описание**: Класс `Driver` представляет собой оберточную структуру для `selenium.webdriver.remote.webdriver.WebDriver`, обеспечивая расширенные функции взаимодействия с веб-страницами Facebook. 

**Наследует**: `selenium.webdriver.remote.webdriver.WebDriver`

**Атрибуты**:

- `__init__`: Инициализирует экземпляр `Driver` с использованием выбранного браузера.

**Методы**:

- `execute_locator`: Выполняет действия над элементом на веб-странице по указанному локатору. 
- `scroll`: Прокручивает страницу вверх или вниз. 
- `wait`: Задерживает выполнение на определенное время. 

## Функции

### `post_title`

**Назначение**: Отправляет заголовок и описание кампании в поле для публикации сообщения.

**Параметры**:

- `d` (Driver): Экземпляр `Driver`, используемый для взаимодействия с веб-страницей.
- `message` (SimpleNamespace | str): Объект `SimpleNamespace` или строка, содержащая заголовок и описание.

**Возвращает**:

- `bool`: `True`, если заголовок и описание были отправлены успешно, иначе `None`.

**Примеры**:

```python
>>> driver = Driver(...)
>>> category = SimpleNamespace(title="Campaign Title", description="Campaign Description")
>>> post_title(driver, category)
True
```

**Как работает функция**:

1. Прокручивает страницу назад, чтобы сделать поле для публикации сообщения доступным.
2. Открывает поле для публикации сообщения.
3. Добавляет заголовок и описание в поле для публикации сообщения.

### `upload_media`

**Назначение**: Загружает медиафайлы в секцию изображений и обновляет подписи.

**Параметры**:

- `d` (Driver): Экземпляр `Driver`, используемый для взаимодействия с веб-страницей.
- `media` (SimpleNamespace | List[SimpleNamespace] | str | list[str]):  Список или строка, содержащая пути к медиафайлам или объект `SimpleNamespace` с информацией о медиафайлах.
- `no_video` (bool):  Если `True`, не загружает видео.
- `without_captions` (bool):  Если `True`, не обновляет подписи к медиафайлам.

**Возвращает**:

- `bool`: `True`, если медиафайлы были успешно загружены, иначе `None`.

**Вызывает исключения**:

- `Exception`:  Если во время загрузки медиафайлов или обновления подписей возникла ошибка.

**Примеры**:

```python
>>> driver = Driver(...)
>>> products = [SimpleNamespace(local_image_path='path/to/image.jpg', ...)]
>>> upload_media(driver, products)
True
```

**Как работает функция**:

1. Открывает форму добавления фото/видео.
2. Преобразует `media` в список, если это не список.
3. Итерирует по медиафайлам и загружает их в секцию изображений.
4. Обновляет подписи к медиафайлам. 

### `update_images_captions`

**Назначение**: Добавляет описания к загруженным медиафайлам.

**Параметры**:

- `d` (Driver): Экземпляр `Driver`, используемый для взаимодействия с веб-страницей.
- `media` (List[SimpleNamespace]): Список объектов `SimpleNamespace` с информацией о медиафайлах.
- `textarea_list` (List[WebElement]): Список полей ввода текста для добавления подписей.

**Вызывает исключения**:

- `Exception`: Если во время обновления подписей к медиафайлам возникла ошибка.

**Как работает функция**:

1. Извлекает локальные единицы из файла `translations.json`.
2. Обрабатывает каждый медиафайл, формируя сообщение для подписи.
3. Отправляет сформированное сообщение в соответствующее поле ввода текста. 

### `publish`

**Назначение**:  Опубликовывает сообщение.

**Параметры**:

- `d` (Driver): Экземпляр `Driver`, используемый для взаимодействия с веб-страницей.
- `attempts` (int): Количество попыток публикации (по умолчанию 5).

**Возвращает**:

- `bool`: `True`, если сообщение было опубликовано успешно, иначе `None`.

**Как работает функция**:

1. Завершает редактирование сообщения.
2. Кликает на кнопку публикации.
3. Если произошла ошибка, пытается закрыть всплывающее окно или отменить публикацию.
4. Повторяет попытки публикации, если количество попыток больше 0.

### `promote_post`

**Назначение**: Управляет процессом публикации сообщения с заголовком, описанием и медиафайлами.

**Параметры**:

- `d` (Driver): Экземпляр `Driver`, используемый для взаимодействия с веб-страницей.
- `category` (SimpleNamespace): Объект `SimpleNamespace` с информацией о заголовке и описании.
- `products` (List[SimpleNamespace]): Список объектов `SimpleNamespace` с информацией о медиафайлах и товарах.

**Примеры**:

```python
>>> driver = Driver(...)
>>> category = SimpleNamespace(title="Campaign Title", description="Campaign Description")
>>> products = [SimpleNamespace(local_image_path='path/to/image.jpg', ...)]
>>> promote_post(driver, category, products)
```

**Как работает функция**:

1. Вызывает функцию `post_title` для отправки заголовка и описания.
2. Вызывает функцию `upload_media` для загрузки медиафайлов.
3. Завершает редактирование сообщения.
4. Публикует сообщение.

### `post_message`

**Назначение**: Управляет процессом публикации сообщения с заголовком, описанием и медиафайлами.

**Параметры**:

- `d` (Driver): Экземпляр `Driver`, используемый для взаимодействия с веб-страницей.
- `message` (SimpleNamespace): Объект `SimpleNamespace` с информацией о заголовке и описании.
- `no_video` (bool): Если `True`, не загружает видео.
- `images` (Optional[str | list[str]]):  Список или строка, содержащая пути к изображениям.
- `without_captions` (bool):  Если `True`, не обновляет подписи к медиафайлам.

**Примеры**:

```python
>>> driver = Driver(...)
>>> category = SimpleNamespace(title="Campaign Title", description="Campaign Description")
>>> products = [SimpleNamespace(local_image_path='path/to/image.jpg', ...)]
>>> promote_post(driver, category, products)
```

**Как работает функция**:

1. Вызывает функцию `post_title` для отправки заголовка и описания.
2. Вызывает функцию `upload_media` для загрузки медиафайлов.
3. Завершает редактирование сообщения.
4. Публикует сообщение.
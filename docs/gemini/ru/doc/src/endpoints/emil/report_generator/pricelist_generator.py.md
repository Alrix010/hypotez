# Модуль для генерации прайс-листов для мехиронов Казаринова
==============================================================

Модуль предназначен для генерации HTML и PDF отчетов на основе данных из JSON-файлов.
Он использует шаблоны Jinja2 для создания HTML-контента и библиотеки pdfkit или WeasyPrint для преобразования HTML в PDF.

## Обзор

Модуль содержит класс `ReportGenerator`, который отвечает за генерацию отчетов.
Основные этапы работы:

1.  Загрузка данных из JSON-файла.
2.  Генерация HTML с использованием Jinja2 шаблона.
3.  Сохранение HTML в файл.
4.  Преобразование HTML в PDF.

## Подробнее

Этот модуль используется для автоматического создания прайс-листов в формате HTML и PDF.
Он принимает данные о продуктах из JSON-файла, применяет их к шаблону HTML и генерирует готовый отчет.

## Классы

### `ReportGenerator`

**Описание**: Класс для генерации HTML- и PDF-отчётов на основе данных из JSON.

**Атрибуты**:

*   `env` (Environment): Окружение Jinja2 для работы с шаблонами. Инициализируется с загрузчиком файловой системы, указывающим на текущую директорию.

**Принцип работы**:
Класс `ReportGenerator` использует Jinja2 для генерации HTML-контента на основе шаблонов и данных, загруженных из JSON.
Затем, с помощью библиотеки `pdfkit` или `WeasyPrint`, HTML преобразуется в PDF.
Основные методы класса позволяют генерировать HTML, сохранять его в файл и создавать PDF-отчет.

## Методы класса

### `generate_html`

```python
async def generate_html(self, data:dict, lang:str ) -> str:
    """
    Генерирует HTML-контент на основе шаблона и данных.

    Args:
        data (dict): Данные для заполнения шаблона.
        lang (str): Язык отчёта.

    Returns:
        str: HTML-контент.
    """
    ...
```

**Назначение**: Генерирует HTML-контент на основе шаблона и данных.

**Параметры**:

*   `data` (dict): Данные для заполнения шаблона.
*   `lang` (str): Язык отчёта (`ru` или `he`).

**Возвращает**:

*   `str`: HTML-контент, сгенерированный на основе шаблона и данных.

**Как работает функция**:
Функция определяет, какой шаблон использовать в зависимости от языка (`lang`).
Затем она читает содержимое шаблона из файла, создает шаблон Jinja2 из строки и рендерит его с использованием предоставленных данных.

**Примеры**:

```python
r = ReportGenerator()
data = {"ключ": "значение"}
lang = "ru"
html_content = asyncio.run(r.generate_html(data, lang))
print(html_content)
```

### `create_report`

```python
async def create_report(self, data: dict, lang:str, html_file:str| Path, pdf_file:str |Path) -> bool:
    """
    Полный цикл генерации отчёта.

    Args:
        data (dict): Данные для отчета.
        lang (str): Язык отчёта.
        html_file (str | Path): Путь для сохранения HTML-файла.
        pdf_file (str | Path): Путь для сохранения PDF-файла.

    Returns:
        bool: True, если отчет успешно создан, False в противном случае.
    """
    ...
```

**Назначение**: Полный цикл генерации отчёта.

**Параметры**:

*   `data` (dict): Данные для отчета.
*   `lang` (str): Язык отчёта (`ru` или `he`).
*   `html_file` (str | Path): Путь для сохранения HTML-файла.
*   `pdf_file` (str | Path): Путь для сохранения PDF-файла.

**Возвращает**:

*   `bool`: `True`, если отчет успешно создан, `False` в противном случае.

**Как работает функция**:

1.  Добавляет данные об услугах в список продуктов.
2.  Генерирует HTML-контент с использованием метода `generate_html`.
3.  Сохраняет HTML-контент в файл.
4.  Преобразует HTML в PDF с использованием `PDFUtils`.
5.  Возвращает `True`, если PDF успешно создан, иначе `False`.

**Примеры**:

```python
r = ReportGenerator()
data = {"products": []}
lang = "ru"
html_file = "report.html"
pdf_file = "report.pdf"
result = asyncio.run(r.create_report(data, lang, html_file, pdf_file))
print(result)
```

## Функции

### `main`

```python
def main(mexiron:str,lang:str) ->bool:
    """
    Основная функция для запуска генерации отчета.

    Args:
        mexiron (str): Идентификатор мехирона.
        lang (str): Язык отчёта.

    Returns:
        bool: True, если отчет успешно создан, False в противном случае.
    """
    ...
```

**Назначение**: Запускает процесс генерации отчета для указанного мехирона и языка.

**Параметры**:

*   `mexiron` (str): Идентификатор мехирона.
*   `lang` (str): Язык отчёта (`ru` или `he`).

**Возвращает**:

*   `bool`: `True`, если отчет успешно создан, `False` в противном случае.

**Как работает функция**:

1.  Определяет пути к файлам данных и отчетов на основе идентификатора мехирона и языка.
2.  Загружает данные из JSON-файла.
3.  Создает экземпляр класса `ReportGenerator`.
4.  Запускает асинхронную генерацию отчета с использованием метода `create_report`.

**Примеры**:

```python
mexiron = "24_12_01_03_18_24_269"
lang = "ru"
main(mexiron, lang)
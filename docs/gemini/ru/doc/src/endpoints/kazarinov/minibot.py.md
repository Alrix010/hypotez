# Модуль minibot

## Обзор

Этот модуль реализует телеграм-бота для обработки запросов на создание прайслиста для Казаринова. Бот использует модель Google Gemini для обработки текстовых сообщений, а также предоставляет функциональность для обработки URL с OneTab, отправки файлов и голосовых сообщений.

## Подробнее

Модуль реализует взаимодействие с телеграм-ботом, используя библиотеку `telebot`.  

В нем определены:

- **Класс `Config`**:  содержит конфигурационные параметры бота, такие как токен, канал, фотодиректория, сообщения для различных команд, и режим работы.
- **Класс `BotHandler`**:  определяет обработчик команд, полученных от бота. Обрабатывает различные типы сообщений: текстовые, URL, команды, голосовые сообщения, документы.
- **Функция `run_bot`**:  запускает бот в бесконечном цикле с автоматическим восстановлением при ошибках. 

## Классы

### `Config`

**Описание**: Класс, содержащий конфигурационные параметры бота.

**Атрибуты**:

- `ENDPOINT` (str):  Название эндпоинта бота (`'kazarinov'`).
- `MODE` (str):  Режим работы бота (`'PRODUCTION'` или `'DEV'`).
- `BOT_TOKEN` (str):  Токен телеграм-бота.
- `CHANNEL_ID` (str):  ID канала телеграм-бота.
- `PHOTO_DIR` (Path):  Путь к директории с изображениями.
- `COMMAND_INFO` (str):  Сообщения с информацией о боте.
- `UNKNOWN_COMMAND_MESSAGE` (str):  Сообщения о неверной команде.
- `START_MESSAGE` (str):  Сообщения о запуске бота.
- `HELP_MESSAGE` (str):  Сообщения о доступных командах.
- `WINDOW_MODE` (str):  Режим работы окна браузера. 

### `BotHandler`

**Описание**:  Обработчик команд, полученных ботом.

**Атрибуты**:

- `base_dir` (Path):  Путь к базовой директории бота.
- `questions_list` (list):  Список вопросов, используемых при обработке команды `--next`.
- `model` (GoogleGenerativeAi):  Модель Google Gemini для обработки текстовых сообщений.

**Методы**:

- `handle_message(bot, message)`:  обрабатывает текстовые сообщения.
- `_send_user_flowchart(bot, chat_id)`:  отправляет схему user_flowchart.
- `_handle_url(bot, message)`:  обрабатывает URL, присланный пользователем.
- `_handle_next_command(bot, message)`:  обрабатывает команду `--next` и её аналоги.
- `help_command(bot, message)`:  обрабатывает команду `/help`.
- `send_pdf(bot, message, pdf_file)`:  обрабатывает команду `/sendpdf` для отправки PDF-файла.
- `handle_voice(bot, message)`:  обрабатывает голосовые сообщения.
- `_transcribe_voice(file_path)`:  транскрибирует голосовое сообщение (заглушка).
- `handle_document(bot, message)`:  обрабатывает полученные документы.

## Функции

### `run_bot`

**Назначение**:  Запускает бот в бесконечном цикле с автоматическим восстановлением при ошибках.

**Параметры**: 
-  нет параметров

**Возвращает**: 
-  нет

**Вызывает исключения**:

- `Exception`: Повторно пробрасывается при фатальной ошибке, если бот не может быть запущен.

**Как работает функция**:

- Запускает бот в бесконечном цикле с помощью `bot.infinity_polling()`.
- При возникновении исключений выполняет остановку бота с помощью `bot.stop_bot()`.
- После остановки запускает бот заново через 10 секунд.

**Примеры**:

```python
# Запуск бота
if __name__ == '__main__':
    run_bot()
```

## Параметры класса

- `ENDPOINT` (str): Название эндпоинта бота (`'kazarinov'`). 
- `MODE` (str):  Режим работы бота (`'PRODUCTION'` или `'DEV'`).
- `BOT_TOKEN` (str):  Токен телеграм-бота. 
- `CHANNEL_ID` (str):  ID канала телеграм-бота. 
- `PHOTO_DIR` (Path):  Путь к директории с изображениями.
- `COMMAND_INFO` (str):  Сообщения с информацией о боте. 
- `UNKNOWN_COMMAND_MESSAGE` (str):  Сообщения о неверной команде. 
- `START_MESSAGE` (str):  Сообщения о запуске бота. 
- `HELP_MESSAGE` (str):  Сообщения о доступных командах. 
- `WINDOW_MODE` (str):  Режим работы окна браузера. 

## Примеры

```python
# Создание инстанса драйвера (пример с Chrome)
driver = Driver(Chrome)

# Выполнение локатора
result = driver.execute_locator(close_banner)

# Пример использования бота
bot = telebot.TeleBot(config.BOT_TOKEN)
# Обработка команды /start
@bot.message_handler(commands=['start'])
def command_start(message):
    bot.send_message(message.chat.id, config.START_MESSAGE)
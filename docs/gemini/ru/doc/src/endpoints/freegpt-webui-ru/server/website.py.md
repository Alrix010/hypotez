# Модуль `website`

## Обзор

Этот модуль отвечает за настройку и обработку маршрутов веб-сервера для интерфейса пользователя `freegpt-webui-ru`. Он предоставляет классы и функции для обработки запросов, генерации страниц и отправки файлов.

## Подробнее

Модуль использует `Flask` для создания веб-сервера, который обрабатывает запросы от пользователей. 
Он содержит класс `Website`, который отвечает за конфигурацию маршрутов, обработку запросов и отправку файлов. 
Этот модуль работает в связке с другими модулями для обеспечения полноценного взаимодействия с пользователем:
- `src.endpoints.freegpt-webui-ru.server.chat`: обработка чата;
- `src.endpoints.freegpt-webui-ru.server.api`: обработка API запросов.


## Классы

### `Website`

**Описание**: Класс `Website` отвечает за обработку веб-запросов и настройку маршрутов веб-приложения.

**Атрибуты**:

- `app (Flask)`: экземпляр приложения `Flask`.

**Методы**:

- `__init__(self, app) -> None`: Конструктор класса. Инициализирует объект `Website`, задает приложение `Flask` и создает словарь маршрутов.
- `_chat(self, conversation_id)`: Обработчик маршрута `'/chat/<conversation_id>'`. Получает ID чата из URL и перенаправляет пользователя на страницу чата.
- `_index(self)`: Обработчик маршрута `'/chat/'`. Создает новый ID чата, сохраняет его в сессию и перенаправляет пользователя на страницу чата.
- `_assets(self, folder: str, file: str)`: Обработчик маршрута `'/assets/<folder>/<file>'`. Отправляет статические файлы из папки `client`.

**Примеры**:

```python
# Создание объекта Website
website = Website(app)

# Получение обработчика для маршрута '/chat/12345'
chat_handler = website._chat('12345')

# Обработка запроса
response = chat_handler(request)

# Возвращение ответа пользователю
return response
```

## Функции

### `_chat`

**Назначение**: Обработчик маршрута `/chat/<conversation_id>`.

**Параметры**:

- `conversation_id (str)`: ID чата, полученный из URL.

**Возвращает**:

- `TemplateResponse` (render_template):  возвращает страницу chat.html с ID чата.

**Вызывает исключения**:

- `None`

**Как работает**:

- Функция проверяет, есть ли дефис `-` в `conversation_id`. 
- Если нет, то перенаправляет пользователя на маршрут `/chat`.
- Если дефис присутствует, то функция `render_template` рендерит шаблон `index.html` с  `conversation_id` в качестве параметра.

**Пример**:

```python
# Вызов обработчика маршрута
chat_handler = website._chat('12345-6789-0abc-defg-1234567890')

# Вывод ответа
print(chat_handler)
```

### `_index`

**Назначение**: Обработчик маршрута `/chat/`.

**Параметры**:

- `None`

**Возвращает**:

- `TemplateResponse` (render_template):  возвращает страницу chat.html  с новым ID чата в параметре `chat_id`.

**Вызывает исключения**:

- `None`

**Как работает**:

- Функция генерирует новый уникальный ID чата, используя функцию `urandom` и текущее время.
-  `render_template` рендерит шаблон `index.html`  с новым ID чата в качестве параметра.

**Пример**:

```python
# Вызов обработчика маршрута
index_handler = website._index()

# Вывод ответа
print(index_handler)
```

### `_assets`

**Назначение**: Обработчик маршрута `/assets/<folder>/<file>`.

**Параметры**:

- `folder (str)`: Имя папки, в которой находится файл.
- `file (str)`: Имя файла.

**Возвращает**:

- `FileResponse` (send_file): Отправляет файл с `client/<folder>/<file>` пользователю, если файл найден.
- `(str, int)`: Возвращает `("File not found", 404)`, если файл не найден.

**Вызывает исключения**:

- `None`

**Как работает**:

- Функция пытается найти файл по пути `./../client/<folder>/<file>`. 
- Если файл найден, то `send_file` отправляет файл пользователю.
- Если файл не найден, то функция возвращает `("File not found", 404)`.

**Пример**:

```python
# Вызов обработчика маршрута
assets_handler = website._assets('css', 'style.css')

# Вывод ответа
print(assets_handler)
```

## Параметры

- `app (Flask)`: Экземпляр приложения Flask, созданный в другом модуле. Отвечает за обработку запросов и рендеринг шаблонов.
- `conversation_id (str)`:  ID чата для конкретной беседы.
- `folder (str)`: Имя папки в каталоге `client`, где хранятся статические файлы.
- `file (str)`: Имя файла в каталоге `client`.

## Примеры

```python
# Пример использования для генерации ID чата
chat_id = f'{urandom(4).hex()}-{urandom(2).hex()}-{urandom(2).hex()}-{urandom(2).hex()}-{hex(int(time() * 1000))[2:]}'
print(chat_id)

# Пример использования для отправки файла
file_response = send_file('./../client/css/style.css', as_attachment=False)
print(file_response)
```
# Модуль для автоматического обновления и выбора прокси-серверов
## Обзор

Модуль предназначен для автоматического получения, тестирования и обновления списка рабочих прокси-серверов. Это необходимо для обеспечения стабильной работы с сервисами, требующими использования прокси, такими как GPT.

## Подробней

Этот модуль предоставляет функциональность для получения списка прокси-серверов, их тестирования на доступность и скорости ответа, а также выбора случайного рабочего прокси из списка. Он использует потоки для параллельного тестирования прокси и периодически обновляет список рабочих прокси.
Модуль `auto_proxy.py` выполняет следующие задачи:
1.  Получает список прокси-серверов из внешнего источника (proxyscrape.com).
2.  Тестирует каждый прокси-сервер, отправляя тестовый запрос.
3.  Добавляет рабочие прокси-серверы в глобальный список `working_proxies`.
4.  Предоставляет функцию для случайного выбора рабочего прокси-сервера.
5.  Периодически обновляет список рабочих прокси-серверов.

## Функции

### `fetch_proxies`

```python
def fetch_proxies():
    """
    Получает список прокси-серверов с proxyscrape.com.

    Returns:
        list: Список прокси-серверов в формате "IP:Port".
    """
```

**Назначение**: Получает список прокси-серверов с сайта proxyscrape.com.

**Параметры**:
-   Нет

**Возвращает**:
-   `list`: Список прокси-серверов в формате "IP:Port".

**Как работает функция**:
1.  Формирует URL для запроса списка прокси-серверов.
2.  Выполняет GET-запрос к указанному URL.
3.  Если запрос успешен (код ответа 200), разбивает полученный текст на строки, удаляет последний пустой элемент и возвращает список прокси-серверов.
4.  В случае ошибки при выполнении запроса выводит сообщение об ошибке и возвращает пустой список.

**Примеры**:

```python
proxies = fetch_proxies()
if proxies:
    print(f"Получено {len(proxies)} прокси-серверов.")
else:
    print("Не удалось получить прокси-серверы.")
```

### `test_proxy`

```python
def test_proxy(proxy, prompt, timeout):
    """
    Тестирует заданный прокси-сервер с указанным запросом и временем ожидания.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
        prompt (str): Тестовый запрос для проверки прокси-сервера.
        timeout (int): Максимальное время в секундах, допустимое для теста.
    """
```

**Назначение**: Проверяет работоспособность заданного прокси-сервера, отправляя через него тестовый запрос.

**Параметры**:
-   `proxy` (str): Прокси-сервер в формате "IP:Port".
-   `prompt` (str): Тестовый запрос для проверки прокси-сервера.
-   `timeout` (int): Максимальное время ожидания ответа в секундах.

**Как работает функция**:
1.  Измеряет время, затраченное на выполнение запроса через прокси-сервер.
2.  Если время ответа меньше заданного `timeout`, считает прокси-сервер рабочим.
3.  Выводит сообщение об успешном тестировании прокси-сервера с указанием времени ответа.
4.  Добавляет рабочий прокси-сервер в глобальный список `working_proxies` с помощью функции `add_working_proxy`.
5.  В случае возникновения исключения (например, таймаута или ошибки соединения) игнорирует прокси-сервер.

**Примеры**:

```python
test_proxy("1.2.3.4:8080", "What is the capital of France?", 5)
```

### `add_working_proxy`

```python
def add_working_proxy(proxy):
    """
    Добавляет рабочий прокси-сервер в глобальный список working_proxies.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
    """
```

**Назначение**: Добавляет рабочий прокси-сервер в глобальный список `working_proxies`.

**Параметры**:
-   `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:
1.  Добавляет переданный прокси-сервер в глобальный список `working_proxies`.

**Примеры**:

```python
add_working_proxy("1.2.3.4:8080")
```

### `remove_proxy`

```python
def remove_proxy(proxy):
    """
    Удаляет прокси-сервер из глобального списка working_proxies.

    Args:
        proxy (str): Прокси-сервер в формате "IP:Port".
    """
```

**Назначение**: Удаляет прокси-сервер из глобального списка `working_proxies`.

**Параметры**:
-   `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:
1.  Проверяет наличие прокси-сервера в глобальном списке `working_proxies`.
2.  Если прокси-сервер присутствует в списке, удаляет его.

**Примеры**:

```python
remove_proxy("1.2.3.4:8080")
```

### `get_working_proxies`

```python
def get_working_proxies(prompt, timeout=5):
    """
    Получает и тестирует прокси-серверы, добавляя рабочие прокси в глобальный список working_proxies.

    Args:
        prompt (str): Тестовый запрос для проверки прокси-серверов.
        timeout (int, optional): Максимальное время в секундах, допустимое для тестирования. По умолчанию 5.
    """
```

**Назначение**: Получает список прокси-серверов, тестирует их и добавляет рабочие прокси в глобальный список `working_proxies`.

**Параметры**:
-   `prompt` (str): Тестовый запрос для проверки прокси-серверов.
-   `timeout` (int, optional): Максимальное время ожидания ответа в секундах. По умолчанию 5.

**Как работает функция**:
1.  Получает список прокси-серверов с помощью функции `fetch_proxies`.
2.  Создает потоки для параллельного тестирования каждого прокси-сервера с использованием функции `test_proxy`.
3.  Запускает каждый поток.
4.  Ожидает завершения каждого потока в течение заданного времени `timeout`.

**Примеры**:

```python
get_working_proxies("What is the capital of France?", 5)
```

### `update_working_proxies`

```python
def update_working_proxies():
    """
    Непрерывно обновляет глобальный список working_proxies рабочими прокси-серверами.
    """
```

**Назначение**: Непрерывно обновляет глобальный список `working_proxies` рабочими прокси-серверами.

**Как работает функция**:
1.  Запускает бесконечный цикл.
2.  Очищает глобальный список `working_proxies`.
3.  Получает и тестирует прокси-серверы с помощью функции `get_working_proxies`.
4.  Выводит сообщение об обновлении прокси-серверов.
5.  Приостанавливает выполнение на 30 минут (1800 секунд).

**Примеры**:

```python
# Запуск в отдельном потоке, чтобы не блокировать основной поток
import threading
thread = threading.Thread(target=update_working_proxies)
thread.start()
```

### `get_random_proxy`

```python
def get_random_proxy():
    """
    Получает случайный рабочий прокси-сервер из глобального списка working_proxies.

    Returns:
        str: Случайный рабочий прокси-сервер в формате "IP:Port".
    """
```

**Назначение**: Получает случайный рабочий прокси-сервер из глобального списка `working_proxies`.

**Возвращает**:
-   `str`: Случайный рабочий прокси-сервер в формате "IP:Port".

**Как работает функция**:
1.  Выбирает случайный элемент из глобального списка `working_proxies` с помощью функции `random.choice`.
2.  Возвращает выбранный прокси-сервер.

**Примеры**:

```python
proxy = get_random_proxy()
if proxy:
    print(f"Случайный прокси-сервер: {proxy}")
else:
    print("Нет доступных прокси-серверов.")
```
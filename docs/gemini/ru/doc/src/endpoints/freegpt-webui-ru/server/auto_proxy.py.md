# Модуль `auto_proxy.py`

## Обзор

Модуль предназначен для автоматического получения и тестирования списка прокси-серверов с целью их дальнейшего использования для обхода ограничений при работе с различными сервисами, такими как GPT-3. Он включает в себя функции для получения списка прокси, проверки их работоспособности и выбора случайного рабочего прокси.

## Подробней

Этот модуль решает задачу автоматического поиска и поддержания актуального списка рабочих прокси-серверов. Это особенно полезно в случаях, когда необходимо обходить географические или другие ограничения при использовании онлайн-сервисов. Модуль периодически обновляет список прокси, проверяя их доступность и скорость ответа.

## Функции

### `fetch_proxies`

**Назначение**: Получает список прокси-серверов с сайта `proxyscrape.com`.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- `list`: Список прокси-серверов в формате "IP:Port". Возвращает пустой список в случае ошибки.

**Как работает функция**:
- Функция отправляет GET-запрос на сайт `proxyscrape.com`, чтобы получить список прокси-серверов.
- Если запрос успешен (код ответа 200), текст ответа разделяется на строки, и каждая строка рассматривается как прокси-сервер.
- Последний элемент списка удаляется, так как он обычно является пустой строкой.
- В случае ошибки при выполнении запроса выводится сообщение об ошибке и возвращается пустой список.

**Примеры**:
```python
proxies = fetch_proxies()
if proxies:
    print(f"Получено {len(proxies)} прокси-серверов.")
else:
    print("Не удалось получить список прокси-серверов.")
```

### `test_proxy`

**Назначение**: Проверяет работоспособность заданного прокси-сервера с использованием тестового запроса и таймаута.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".
- `prompt` (str): Тестовый запрос, используемый для проверки прокси-сервера.
- `timeout` (int): Максимальное время в секундах, допустимое для выполнения теста.

**Как работает функция**:
- Функция измеряет время от начала отправки тестового запроса до получения ответа.
- Если время ответа меньше заданного таймаута, прокси считается рабочим, и его время ответа выводится в консоль.
- Функция `add_working_proxy` добавляет рабочий прокси в глобальный список `working_proxies`.
- В случае возникновения исключения во время теста, функция игнорирует его.

**Примеры**:
```python
test_proxy("123.45.67.89:8080", "Test prompt", 5)
```

### `add_working_proxy`

**Назначение**: Добавляет рабочий прокси-сервер в глобальный список `working_proxies`.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:
- Функция добавляет переданный прокси-сервер в глобальный список `working_proxies`.

**Примеры**:
```python
add_working_proxy("123.45.67.89:8080")
```

### `remove_proxy`

**Назначение**: Удаляет прокси-сервер из глобального списка `working_proxies`.

**Параметры**:
- `proxy` (str): Прокси-сервер в формате "IP:Port".

**Как работает функция**:
- Функция проверяет, присутствует ли прокси-сервер в списке `working_proxies`, и если да, удаляет его.

**Примеры**:
```python
remove_proxy("123.45.67.89:8080")
```

### `get_working_proxies`

**Назначение**: Получает и тестирует список прокси-серверов, добавляя рабочие прокси в глобальный список `working_proxies`.

**Параметры**:
- `prompt` (str): Тестовый запрос, используемый для проверки прокси-серверов.
- `timeout` (int, optional): Максимальное время в секундах, допустимое для тестирования. По умолчанию равно 5.

**Как работает функция**:
- Функция получает список прокси-серверов с помощью `fetch_proxies`.
- Для каждого прокси-сервера создается отдельный поток, который выполняет функцию `test_proxy` для проверки его работоспособности.
- Все потоки запускаются и ожидают завершения с заданным таймаутом.

**Примеры**:
```python
get_working_proxies("What is the capital of France?", timeout=5)
```

### `update_working_proxies`

**Назначение**: Непрерывно обновляет глобальный список `working_proxies` рабочими прокси-серверами.

**Как работает функция**:
- Функция выполняет бесконечный цикл, в котором она очищает список `working_proxies`, получает новый список рабочих прокси с помощью `get_working_proxies`, и ждет 30 минут перед следующим обновлением.

**Примеры**:
```python
update_working_proxies()
```

### `get_random_proxy`

**Назначение**: Возвращает случайный рабочий прокси-сервер из глобального списка `working_proxies`.

**Возвращает**:
- `str`: Случайный рабочий прокси-сервер в формате "IP:Port".

**Как работает функция**:
- Функция выбирает случайный прокси-сервер из списка `working_proxies` и возвращает его.

**Примеры**:
```python
proxy = get_random_proxy()
if proxy:
    print(f"Случайный прокси: {proxy}")
else:
    print("Нет доступных рабочих прокси.")
# Модуль запуска веб-приложения

## Обзор

Этот модуль является точкой входа для запуска веб-приложения. Он загружает конфигурацию из файла `config.json`, настраивает маршруты для веб-сайта и бэкенд API, а затем запускает Flask-сервер.

## Подробней

Модуль отвечает за инициализацию и запуск веб-приложения, используя конфигурацию, определенную в файле `config.json`. Он создает экземпляры классов `Website` и `Backend_Api`, добавляет их маршруты в приложение Flask, и запускает сервер на порту, указанном в конфигурации.

## Основные компоненты

### Зависимости

- `server.app`: Главное приложение Flask.
- `server.website`: Класс для настройки маршрутов веб-сайта.
- `server.backend`: Класс для настройки маршрутов бэкенд API.
- `json.load`: Функция для загрузки данных из JSON-файла.

### Логика работы

1. **Загрузка конфигурации**:
   - Загружает конфигурацию из файла `config.json` с использованием `json.load`.
2. **Настройка маршрутов веб-сайта**:
   - Создает экземпляр класса `Website`, передавая ему приложение Flask.
   - Добавляет маршруты веб-сайта в приложение Flask, используя метод `add_url_rule`.
3. **Настройка маршрутов бэкенд API**:
   - Создает экземпляр класса `Backend_Api`, передавая ему приложение Flask и конфигурацию.
   - Добавляет маршруты бэкенд API в приложение Flask, используя метод `add_url_rule`.
4. **Запуск Flask-сервера**:
   - Запускает Flask-сервер с использованием конфигурации, указанной в `site_config`.
   - Выводит сообщение о запуске сервера на определенном порту.
   - После завершения работы сервера выводит сообщение о закрытии порта.

## Классы

### `Website`

**Описание**: Класс для настройки маршрутов веб-сайта.

**Атрибуты**:

- `app`: Экземпляр приложения Flask.
- `routes`: Словарь, содержащий маршруты веб-сайта и связанные с ними функции и методы.

**Методы**:

- Описание методов смотрите в документации соответствующего класса.

### `Backend_Api`

**Описание**: Класс для настройки маршрутов бэкенд API.

**Атрибуты**:

- `app`: Экземпляр приложения Flask.
- `config`: Конфигурация приложения.
- `routes`: Словарь, содержащий маршруты бэкенд API и связанные с ними функции и методы.

**Методы**:

- Описание методов смотрите в документации соответствующего класса.

## Переменные

- `config` (dict): Конфигурация, загруженная из файла `config.json`.
- `site_config` (dict): Конфигурация веб-сайта, извлеченная из `config`.
- `site` (Website): Экземпляр класса `Website`.
- `backend_api` (Backend_Api): Экземпляр класса `Backend_Api`.

## Запуск приложения

### `if __name__ == '__main__':`

Основной блок кода, который запускается при выполнении скрипта. Он выполняет следующие шаги:

1. **Загрузка конфигурации**:
   - `config = load(open('config.json', 'r'))`: Загружает конфигурацию из файла `config.json`.
2. **Настройка конфигурации сайта**:
   - `site_config = config['site_config']`: Извлекает конфигурацию сайта из общей конфигурации.
3. **Настройка маршрутов сайта**:
   - `site = Website(app)`: Создает экземпляр класса `Website`, передавая ему приложение `app`.
   - Итерируется по маршрутам сайта и добавляет их в приложение Flask с использованием `app.add_url_rule`.
4. **Настройка маршрутов API**:
   - `backend_api = Backend_Api(app, config)`: Создает экземпляр класса `Backend_Api`, передавая ему приложение `app` и общую конфигурацию.
   - Итерируется по маршрутам API и добавляет их в приложение Flask с использованием `app.add_url_rule`.
5. **Запуск сервера**:
   - `print(f"Running on port {site_config['port']}")`: Выводит сообщение о запуске сервера на определенном порту.
   - `app.run(**site_config)`: Запускает Flask-сервер с использованием параметров конфигурации сайта.
   - `print(f"Closing port {site_config['port']}")`: Выводит сообщение о закрытии порта после завершения работы сервера.

## Примеры

### Запуск сервера с конфигурацией из `config.json`

```python
# Файл config.json:
# {
#   "site_config": {
#     "host": "0.0.0.0",
#     "port": 5000,
#     "debug": true
#   },
#   "api_config": {
#     ...
#   }
# }

# После запуска скрипта:
# Running on port 5000
# * Debug mode: on
# ...
# Closing port 5000
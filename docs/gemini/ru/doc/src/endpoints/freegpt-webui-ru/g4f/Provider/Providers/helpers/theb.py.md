# Модуль для взаимодействия с chatbot.theb.ai
## Обзор
Модуль предназначен для взаимодействия с API chatbot.theb.ai с целью получения ответов на текстовые запросы. Он использует библиотеку `curl_cffi` для выполнения HTTP-запросов и извлекает информацию из полученных данных.

## Подробнее

Этот модуль отправляет POST-запросы к API `chatbot.theb.ai` и обрабатывает потоковые ответы, извлекая полезный контент из JSON-подобных структур. Он также включает обработку ошибок и повторные попытки в случае сбоев. Модуль использует заголовки, имитирующие запросы из браузера Chrome, и передает текстовый запрос в формате JSON.

## Функции

### `format`
```python
def format(chunk):
    """ Функция извлекает и печатает контент из чанка данных, полученного от сервера.

    Args:
        chunk (bytes): Бинарные данные, содержащие часть ответа от сервера.

    Returns:
        None

    Raises:
        Exception: Если не удается извлечь контент из чанка.

    Как работает функция:
    - Пытается извлечь контент, используя регулярное выражение `r'content":"(.*)"},"fin'`.
    - Извлеченный контент выводится в консоль.
    - В случае ошибки выводит сообщение об ошибке и возвращается.

    Внутренние функции:
        - нет
    """
```
## Параметры модуля
- `config` (dict): Загруженные из аргументов командной строки параметры конфигурации в формате JSON.
- `prompt` (str): Текст запроса, извлеченный из `config['messages'][-1]['content']`.
- `headers` (dict): Заголовки HTTP-запроса, имитирующие запрос от браузера Chrome.
- `json_data` (dict): Данные, отправляемые в теле POST-запроса, содержащие текст запроса (`prompt`).

## Примеры

Пример использования модуля (предполагается, что модуль вызывается через командную строку с параметрами JSON):

```bash
python your_module.py '{"messages": [{"content": "Hello, chatbot!"}]}'
```

## Принцип работы:

1.  **Чтение конфигурации**: Модуль считывает JSON-конфигурацию из аргументов командной строки. Эта конфигурация содержит текстовый запрос, который нужно отправить на сервер.
2.  **Формирование заголовков**: Создаются HTTP-заголовки, которые имитируют запрос из браузера Chrome. Это необходимо для успешной аутентификации и взаимодействия с сервером.
3.  **Формирование JSON-данных**: Текст запроса помещается в JSON-структуру, которая будет отправлена в теле POST-запроса.
4.  **Отправка запроса и обработка ответа**:
    *   Модуль отправляет POST-запрос к API `chatbot.theb.ai` с использованием библиотеки `curl_cffi`.
    *   Функция `format` используется в качестве callback-функции для обработки потоковых данных, возвращаемых сервером. Эта функция извлекает и печатает контент из каждого чанка данных.
5.  **Обработка ошибок**: Если происходит ошибка во время отправки запроса или обработки ответа, модуль выводит сообщение об ошибке и повторяет попытку.
6.  **Завершение работы**: После успешного получения и обработки ответа модуль завершает свою работу с кодом выхода 0.

## Цикл обработки запросов:

Модуль выполняет бесконечный цикл, в котором он пытается отправить запрос и обработать ответ. В случае ошибки он просто повторяет попытку.

```python
while True:
    try:
        response = requests.post(
            'https://chatbot.theb.ai/api/chat-process',
            headers=headers,
            json=json_data,
            content_callback=format,
            impersonate='chrome110'
        )
        exit(0)
    except Exception as ex:
        print('[ERROR] an error occured, retrying... |', ex, flush=True)
        continue
# Модуль Bard.py

## Обзор

Модуль `Bard.py` предоставляет интерфейс для взаимодействия с моделью Google Bard. Он позволяет отправлять текстовые запросы и получать ответы от модели, используя cookies аутентификации из браузера.

## Подробнее

Этот модуль является частью коллекции провайдеров в проекте `hypotez` и предназначен для интеграции с различными AI-моделями. Он использует библиотеку `requests` для отправки HTTP-запросов и `browser_cookie3` для получения cookies аутентификации.

## Параметры

- `url` (str): URL для взаимодействия с Google Bard.
- `model` (list): Список поддерживаемых моделей (в данном случае, `Palm2`).
- `supports_stream` (bool): Указывает, поддерживает ли модель потоковую передачу данных (в данном случае, `False`).
- `needs_auth` (bool): Указывает, требуется ли аутентификация для использования модели (в данном случае, `True`).

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """Создает запрос к Google Bard и возвращает ответ.

    Args:
        model (str): Идентификатор используемой модели.
        messages (list): Список сообщений для отправки в формате [{"role": "user" или "assistant", "content": "текст сообщения"}].
        stream (bool): Флаг, указывающий, использовать ли потоковый режим.
        **kwargs: Дополнительные аргументы, такие как `proxy`.

    Yields:
        str: Ответ от модели Google Bard.

    Raises:
        Exception: Если возникает ошибка при взаимодействии с Google Bard.

    Пример:
        >>> messages = [{"role": "user", "content": "Hello, Bard!"}]
        >>> for response in _create_completion(model='Palm2', messages=messages, stream=False):
        ...     print(response)
        <ответ от Google Bard>
    """
```

**Назначение**: Функция `_create_completion` отправляет запрос к Google Bard с заданными параметрами и возвращает ответ от модели.

**Параметры**:
- `model` (str): Идентификатор используемой модели (например, 'Palm2').
- `messages` (list): Список сообщений для отправки, где каждое сообщение представляет собой словарь с ключами `role` (роль отправителя, например, "user" или "assistant") и `content` (текст сообщения).
- `stream` (bool): Флаг, указывающий, использовать ли потоковый режим для получения ответа. В данном случае всегда `False`.
- `**kwargs`: Дополнительные аргументы, такие как `proxy` для указания прокси-сервера.

**Внутренние функции**: Отсутствуют

**Как работает функция**:
1. **Получение PSID**: Извлекает значение cookie `__Secure-1PSID` из cookies браузера Chrome для домена `.google.com`.
2. **Форматирование сообщений**: Форматирует список сообщений в строку, где каждое сообщение имеет вид "`role`: `content`".
3. **Подготовка запроса**:
   - Определяет, использовать ли прокси-сервер. Если прокси не указан, выводит предупреждение.
   - Создает сессию `requests.Session()` и устанавливает заголовки запроса, включая cookie `__Secure-1PSID`.
   - Получает токен `SNlM0e`, необходимый для аутентификации запроса.
   - Формирует параметры запроса `params` и данные запроса `data`, включая отформатированный запрос `prompt`.
4. **Отправка запроса**: Отправляет POST-запрос к Google Bard с использованием `requests`.
5. **Обработка ответа**: Извлекает данные ответа из JSON, загруженного из ответа сервера, и возвращает их.
6. **Обработка ошибок**: Если данные ответа отсутствуют, возвращает строку "error".

**Примеры**:
```python
messages = [{"role": "user", "content": "Напиши короткий стих о весне."}]
for response in _create_completion(model='Palm2', messages=messages, stream=False, proxy = '127.0.0.1:7878'):
    print(response)
# Ожидаемый вывод: <ответ от Google Bard в виде стиха>
```

## Параметры модуля

- `params` (str): Строка, содержащая информацию о поддерживаемых типах данных для функции `_create_completion`.

```python
params = f'g4f.Providers.{os.path.basename(__file__)[:-3]} supports: ' + \
    '({0})'.format(', '.join([f"{name}: {get_type_hints(_create_completion)[name].__name__}" for name in _create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]]))
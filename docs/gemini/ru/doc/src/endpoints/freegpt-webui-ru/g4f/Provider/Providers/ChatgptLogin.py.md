# Документация для `ChatgptLogin.py`

## Обзор

Модуль предоставляет класс `ChatgptLogin`, который позволяет взаимодействовать с моделью `gpt-3.5-turbo` через API `chatgptlogin.ac`.
Модуль содержит функции для получения `nonce`, преобразования сообщений и отправки запросов к API.

## Подробнее

Модуль предназначен для использования в проекте `hypotez` для обеспечения доступа к API `chatgptlogin.ac` и получения ответов от модели `gpt-3.5-turbo`.
Для работы с API требуется получить `nonce`, который используется для аутентификации запросов.
Сообщения преобразуются в формат, ожидаемый API, с использованием HTML-кодирования.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """ Функция создает запрос к API chatgptlogin.ac и возвращает ответ.

    Args:
        model (str): Имя используемой модели.
        messages (list): Список сообщений для отправки.
                         Каждый элемент списка является словарем с ключами 'role' (роль отправителя: 'user' или 'assistant') и 'content' (содержимое сообщения).
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу.

    Returns:
        str: Ответ от API.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса.

    Как работает функция:
    - Получает nonce, необходимый для аутентификации запроса.
    - Преобразует сообщения в формат, ожидаемый API.
    - Формирует JSON-данные для отправки в запросе.
    - Отправляет POST-запрос к API.
    - Возвращает ответ от API.

    Внутренние функции:
    - `get_nonce`: Функция для получения nonce.
    - `transform`: Функция для преобразования сообщений.
    - `html_encode`: Функция для HTML-кодирования строк.

    Примеры:
        >>> _create_completion(model='gpt-3.5-turbo', messages=[{'role': 'user', 'content': 'Hello'}], stream=False)
        'Hello'
    """
```

### Внутренние функции `_create_completion`

#### `get_nonce`

```python
    def get_nonce():
        """ Функция получает nonce с сайта chatgptlogin.ac.

        Returns:
            str: Строка nonce, извлеченная из HTML-кода страницы.

        Как работает функция:
        - Выполняет GET-запрос к странице `https://chatgptlogin.ac/use-chatgpt-free/`.
        - Извлекает nonce из текста ответа с использованием регулярного выражения.
        - Возвращает извлеченный nonce.

        Raises:
            Exception: Если nonce не найден.
        """
```

#### `transform`

```python
    def transform(messages: list) -> list:
        """ Функция преобразует список сообщений в формат, ожидаемый API.

        Args:
            messages (list): Список сообщений для преобразования.

        Returns:
            list: Преобразованный список сообщений.

        Как работает функция:
        - Применяет HTML-кодирование к содержимому каждого сообщения.
        - Формирует новый список сообщений с добавлением дополнительных полей.

        Внутренние функции:
        - `html_encode`: Функция для HTML-кодирования строк.
        """
```

#### `html_encode`

```python
        def html_encode(string: str) -> str:
            """ Функция выполняет HTML-кодирование строки.

            Args:
                string (str): Строка для кодирования.

            Returns:
                str: HTML-кодированная строка.

            Как работает функция:
            - Заменяет специальные символы на их HTML-эквиваленты.
            """
```

## Переменные

- `url` (str): URL для API `chatgptlogin.ac`.
- `model` (list): Список поддерживаемых моделей (в данном случае `gpt-3.5-turbo`).
- `supports_stream` (bool): Флаг, указывающий на поддержку потоковой передачи (`False`).
- `needs_auth` (bool): Флаг, указывающий на необходимость аутентификации (`False`).
- `params` (str): Строка, содержащая информацию о поддержке типов данных параметрами функции `_create_completion`.
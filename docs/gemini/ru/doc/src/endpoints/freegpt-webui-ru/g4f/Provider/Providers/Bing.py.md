# Провайдер Bing для g4f

## Обзор

Этот модуль предоставляет провайдер Bing для g4f, который позволяет использовать модель GPT-4 от Microsoft Bing для генерации текста.

## Подробней

Модуль `Bing.py`  осуществляет взаимодействие с API сервиса Bing.com для получения ответов от модели GPT-4. 
Модуль реализует асинхронную функцию `stream_generate()`, которая позволяет получить ответ от модели GPT-4 по частям (стриминг).
Модуль использует вебдрайвер (selenium) для управления браузером, который обеспечивает  интерфейс для взаимодействия с сервисом Bing.

## Классы

### `optionsSets`

**Описание**: Класс `optionsSets` предоставляет набор опций, которые можно использовать при взаимодействии с сервисом Bing. 
**Атрибуты**:
  - `optionSet`: словарь, который содержит опции.
  - `jailbreak`: словарь, который содержит опции для режима "jailbreak" (нестандартный режим работы модели, позволяющий получить более интересные и неожиданные ответы).

### `Defaults`

**Описание**: Класс `Defaults` предоставляет набор дефолтных значений, которые используются в модуле.
**Атрибуты**:
 - `delimiter`: разделитель для строк в JSON-объектах.
 - `ip_address`:  используется для имитации IP-адреса пользователя.
 - `allowedMessageTypes`:  используется для имитации типа сообщения пользователя.
 - `sliceIds`:   используется для имитации типа сообщения пользователя.
 - `location`:   используется для имитации географического местоположения пользователя.

## Функции

### `_format(msg: dict) -> str`

**Назначение**: Преобразует словарь в JSON-строку и добавляет разделитель в конце.

**Параметры**:
- `msg` (dict): словарь, который необходимо преобразовать в JSON-строку.

**Возвращает**:
- `str`: JSON-строка с разделителем в конце.

**Как работает функция**: 
- Функция `_format`  использует `json.dumps` для преобразования словаря `msg` в JSON-строку. 
- В конце строки добавляется разделитель `Defaults.delimiter`.

### `create_conversation()`

**Назначение**:  Создает новую беседу с сервисом Bing.

**Параметры**: Нет.

**Возвращает**:
- `conversationId, clientId, conversationSignature`:  Идентификаторы беседы, идентификатор клиента, сигнатура беседы, полученные от сервиса Bing.

**Как работает функция**: 
-  Функция `create_conversation()`  отправляет GET-запрос на `https://www.bing.com/turing/conversation/create` для создания новой беседы. 
- Извлекает  `conversationId`, `clientId`  и `conversationSignature`  из ответа сервиса.
- Возвращает эти идентификаторы.

### `stream_generate(prompt: str, mode: optionsSets.optionSet = optionsSets.jailbreak, context: bool or str = False)`

**Назначение**:  Отправляет запрос с заданным `prompt` в модель Bing GPT-4 и возвращает ответ в виде генератора, который выдает ответ по частям (стриминг).

**Параметры**:
- `prompt` (str): Текст запроса, который необходимо отправить в модель GPT-4.
- `mode` (optionsSets.optionSet, optional):  Набор опций, которые можно использовать при взаимодействии с сервисом Bing. По умолчанию `optionsSets.jailbreak`.
- `context` (bool or str, optional):  Дополнительный контекст для запроса. Может быть строкой или `False`. По умолчанию `False`.

**Возвращает**:
- `Generator`:  Генератор, который выдает части ответа от модели GPT-4.

**Как работает функция**: 
 - Функция `stream_generate()`  устанавливает соединение с сервисом Bing через WebSockets.
 - Отправляет  `prompt`  в модель GPT-4.
 - После этого, функция  `stream_generate()`  в цикле ожидает  ответа  от модели  GPT-4.
 - Полученные части ответа  `stream_generate()`  выдает в виде  `Generator`.

### `run(generator)`

**Назначение**:  Запускает генератор  `generator` и возвращает  `Generator`  с результатами.

**Параметры**:
- `generator`:  Генератор, который необходимо запустить.

**Возвращает**:
- `Generator`:  Генератор, который выдает результаты работы генератора `generator`.

**Как работает функция**: 
 -  Функция `run()`  получает  `generator` и запускает его. 
 - В цикле функция  `run()`  извлекает очередное значение из  `generator`  и выдает его в виде `Generator`.

### `convert(messages)`

**Назначение**:  Преобразует список  `messages`  в строку, которую можно использовать в качестве контекста для запроса.

**Параметры**:
- `messages`:  Список сообщений, который необходимо преобразовать в строку контекста.

**Возвращает**:
- `str`:  Строка контекста.

**Как работает функция**: 
 -  Функция `convert()`  проходит по  `messages`  и  создает строку  `context`  из  `role`  и  `content`  каждого сообщения. 
 -  Функция  `convert()`  возвращает  `context`.

### `_create_completion(model: str, messages: list, stream: bool, **kwargs)`

**Назначение**:  Создает запрос к модели GPT-4  и  возвращает  `Generator`  с результатом.

**Параметры**:
- `model` (str):  Название модели GPT-4, которую необходимо использовать.
- `messages` (list):  Список сообщений.
- `stream` (bool):  Флаг, определяющий, необходимо ли  получать ответ по частям  (стриминг).

**Возвращает**:
- `Generator`:  Генератор, который выдает части ответа от модели GPT-4.

**Как работает функция**: 
-  Функция `_create_completion()`  получает  `prompt`,  `context`  и  `stream`.
-  Функция `_create_completion()`  использует  `stream_generate()`  для отправки  `prompt`  в модель  GPT-4.
-  Функция `_create_completion()`  выдает части  `response`  в виде  `Generator`.

## Параметры класса

- `model`:  Название модели GPT-4, которую необходимо использовать.
- `stream`:  Флаг, определяющий, необходимо ли  получать ответ по частям  (стриминг).


## Примеры

```python
from hypotez.src.endpoints.freegpt-webui-ru.g4f.Provider.Providers.Bing import _create_completion

messages = [
    {'role': 'user', 'content': 'Привет! Как дела?'},
    {'role': 'assistant', 'content': 'Хорошо, спасибо! А у тебя как?'},
    {'role': 'user', 'content': 'Тоже хорошо.  расскажи что-нибудь интересное.'}
]

completion = _create_completion('gpt-4', messages, stream=True)

for token in completion:
    print(token, end='')
```

```python
from hypotez.src.endpoints.freegpt-webui-ru.g4f.Provider.Providers.Bing import _create_completion

messages = [
    {'role': 'user', 'content': 'Напиши мне стихотворение про любовь'}
]

completion = _create_completion('gpt-4', messages, stream=True)

for token in completion:
    print(token, end='')
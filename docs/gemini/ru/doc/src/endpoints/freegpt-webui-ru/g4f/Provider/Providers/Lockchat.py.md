# Модуль Lockchat

## Обзор

Модуль `Lockchat` предоставляет функциональность для взаимодействия с API сервиса Lockchat для генерации текста с использованием моделей GPT-4 и GPT-3.5-turbo. 

## Подробней

Модуль реализует класс `LockchatProvider`, который использует API `Lockchat` для генерации текста. 
Сервис Lockchat является платным, но предоставляет бесплатный доступ к своим моделям для тестирования. 
Он использует `requests` для отправки запросов к API. 

## Классы

### `class LockchatProvider`

**Описание**:  Класс для взаимодействия с API сервиса Lockchat. 

**Атрибуты**:

- `model` (list): Список поддерживаемых моделей.
- `url` (str): Базовый URL API сервиса.
- `supports_stream` (bool): Указывает, поддерживает ли модель потоковую передачу текста.
- `needs_auth` (bool): Указывает, требуется ли авторизация для использования API.

**Методы**:

- `_create_completion(model: str, messages: list, stream: bool, temperature: float = 0.7, **kwargs)`:  Создает запрос к API сервиса `Lockchat` для генерации текста, возвращает генератор с частями текста. 
    - `model` (str): Имя модели.
    - `messages` (list): Список сообщений, которые будут использованы в качестве контекста для генерации текста.
    - `stream` (bool): Указывает, использовать ли потоковую передачу текста.
    - `temperature` (float): Параметр, управляющий креативностью модели.

## Функции

### `_create_completion`

**Назначение**:  Создает запрос к API сервиса Lockchat для генерации текста, возвращает генератор с частями текста.

**Параметры**:

- `model` (str): Имя модели.
- `messages` (list): Список сообщений, которые будут использованы в качестве контекста для генерации текста.
- `stream` (bool): Указывает, использовать ли потоковую передачу текста.
- `temperature` (float): Параметр, управляющий креативностью модели.

**Возвращает**:

- `Generator`: Генератор строк с частями текста.

**Как работает функция**:

- Функция `_create_completion` принимает на вход имя модели, список сообщений, параметр потоковой передачи текста и температуру.
- Она формирует запрос к API сервиса Lockchat с помощью `requests.post`.
- Запрос содержит JSON-данные с информацией о модели, сообщениях, параметрах и потоковой передаче.
- Запрос отправляется к адресу `http://super.lockchat.app/v1/chat/completions?auth=FnMNPlwZEnGFqvEc9470Vw==` с заголовком `user-agent` для идентификации клиента.
- Функция получает ответ от API и использует `response.iter_lines()` для итерации по строкам ответа.
- Если в ответе встречается строка `b'The model: `gpt-4` does not exist'`, функция выводит сообщение об ошибке и рекурсивно вызывает себя с теми же параметрами.
- Если в ответе встречается строка `b"content"`, функция извлекает текст из JSON-данных ответа и генерирует его с помощью `yield`.

**Примеры**:

```python
>>> model = 'gpt-4'
>>> messages = [
...     {'role': 'user', 'content': 'Привет!'}
... ]
>>> stream = True
>>> for token in _create_completion(model=model, messages=messages, stream=stream):
...     print(token)
... 
Привет!
```
```python
>>> model = 'gpt-3.5-turbo'
>>> messages = [
...     {'role': 'user', 'content': 'Расскажи мне анекдот.'}
... ]
>>> stream = False
>>> response = _create_completion(model=model, messages=messages, stream=stream)
>>> print(next(response))
... 
Встречаются два друга. Один хвастается:
- Я вчера купил такой суперский пылесос, что он сам убирается!
- Да ну, не может быть! - скептически говорит второй.
- А вот и да! - восклицает первый. - Я его включил, а он сам пошел пылесосить! 
- И куда же он пошёл?
- К черту! - отвечает первый. - Я его никуда не направлял, он сам!
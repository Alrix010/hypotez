# Модуль для преобразования словаря в XML

## Обзор

Модуль `dict2xml.py` предназначен для преобразования структуры данных Python (словаря) в XML-формат. Он включает функции для обработки различных типов данных, таких как словари, списки и простые типы, и генерирует соответствующий XML-код. Модуль был адаптирован для работы с PrestaShop API.

## Подробней

Этот модуль предоставляет функциональность для преобразования Python-словарей в XML-формат, что может быть полезно при взаимодействии с API, требующими XML-представления данных. Он обрабатывает различные типы данных, включая вложенные словари, списки и атрибуты, и генерирует соответствующий XML-код.

## Функции

### `_process`

**Назначение**: Генерация DOM-объекта для тега и его значения.

**Параметры**:
- `doc`: XML-документ.
- `tag`: Тег.
- `tag_value`: Значение тега.

**Возвращает**:
- `node` или `nodelist`: Узел или список узлов, в зависимости от типа значения тега.

**Как работает функция**:
Функция `_process` является рекурсивной и отвечает за создание XML-узлов на основе переданных данных. Она обрабатывает различные типы данных:
- Если `tag_value` является словарем с ключом `'value'`, извлекает значение из этого словаря.
- Если `tag_value` равно `None`, устанавливает его в пустую строку.
- Для простых типов (float, int, str) вызывает функцию `_process_simple` для создания узла.
- Для списков вызывает функцию `_process_complex` для создания списка узлов с одинаковым тегом.
- Для словарей создает новый узел и добавляет в него все под-узлы. Если в словаре есть ключи `'attrs'` и `'value'`, обрабатывает их как атрибуты и значение узла соответственно.

### `_process_complex`

**Назначение**: Генерация нескольких узлов для списка или словаря.

**Параметры**:
- `doc`: XML-документ.
- `children`: Список кортежей (tag, value).

**Возвращает**:
- `nodelist`: Список узлов.
- `attrs`: Список атрибутов.

**Как работает функция**:
Функция `_process_complex` создает несколько XML-узлов на основе списка дочерних элементов. Она итерируется по списку `children`, который содержит кортежи `(tag, value)`, и вызывает функцию `_process` для каждого элемента. Если тег равен `'attrs'`, обрабатывает значения как атрибуты.

### `_process_attr`

**Назначение**: Генерация атрибутов элемента.

**Параметры**:
- `doc`: XML-документ.
- `attr_value`: Значение атрибута.

**Возвращает**:
- `attrs`: Список атрибутов.

**Как работает функция**:
Функция `_process_attr` создает атрибуты для XML-элемента на основе переданного словаря `attr_value`. Она итерируется по элементам словаря и создает атрибуты, используя значения из словаря. Если значение атрибута является словарем, предполагает наличие пространства имен (`xmlns`) и значения (`value`).

### `_process_simple`

**Назначение**: Генерация узла для простых типов (int, str).

**Параметры**:
- `doc`: XML-документ.
- `tag`: Тег.
- `tag_value`: Значение тега.

**Возвращает**:
- `node`: Узел.

**Как работает функция**:
Функция `_process_simple` создает XML-узел для простых типов данных, таких как целые числа и строки. Она создает элемент с заданным тегом и добавляет текстовый узел со значением тега.

### `dict2xml`

**Назначение**: Генерация XML-строки из словаря.

**Параметры**:
- `data`: Данные в виде словаря.
- `encoding`: Кодировка данных, по умолчанию UTF-8.

**Возвращает**:
- XML-строка.

**Вызывает исключения**:
- `Exception`: Если в словаре более одного корневого узла.

**Как работает функция**:
Функция `dict2xml` является основной функцией модуля. Она принимает словарь `data` и преобразует его в XML-строку. Она создает XML-документ, вызывает функцию `_process_complex` для обработки данных и добавляет корневой узел в документ.

**Примеры**:

```python
from pprint import pprint

# Пример 1
x = {'prestashop': {'addresses': {'address': [
    {'attrs': {'href': {'value': 'http://localhost:8080/api/addresses/1', 'xmlns': 'http://www.w3.org/1999/xlink'}, 'id': '1'}, 'value': None},
    {'attrs': {'href': {'value': 'http://localhost:8080/api/addresses/2', 'xmlns': 'http://www.w3.org/1999/xlink'}, 'id': '2'}, 'value': None}
]}}}

print(dict2xml(x))

# Пример 2
x = {'prestashop': {'address': {
    'address1': '1 Infinite Loop',
    'address2': None,
    'alias': 'manufacturer',
    'city': 'Cupertino',
    'company': None,
    'date_add': '2012-02-06 09:33:52',
    'date_upd': '2012-02-07 11:18:48',
    'deleted': '0',
    'dni': None,
    'firstname': 'STEVEN',
    'id': 1,
    'id_country': 21,
    'id_customer': None,
    'id_manufacturer': 1,
    'id_state': 5,
    'id_supplier': None,
    'lastname': 'JOBS',
    'other': None,
    'phone': '(800) 275-2273',
    'phone_mobile': None,
    'postcode': '95014',
    'vat_number': 'XXX',
    'description': {'language': [
        {'attrs': {'id': '1', 'href': {'value': 'http://localhost:8080/api/languages/1', 'xmlns': 'http://www.w3.org/1999/xlink'}}, 'value': 'test description english'},
        {'attrs': {'id': '2', 'href': {'value': 'http://localhost:8080/api/languages/1', 'xmlns': 'http://www.w3.org/1999/xlink'}}, 'value': 'test description french'}
    ]}
}}}

print(dict2xml(x))
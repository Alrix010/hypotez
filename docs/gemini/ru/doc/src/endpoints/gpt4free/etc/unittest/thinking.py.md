# Документация для модуля `thinking.py`

## Обзор

Модуль `thinking.py` содержит тесты для класса `ThinkingProcessor`, который используется для обработки текста с тегами `<think>` и `</think>`, обозначающими начало и конец процесса размышления. Этот модуль проверяет, как `ThinkingProcessor` обрабатывает различные сценарии, включая текст без тегов, начало размышления, конец размышления, а также ситуации, когда теги размышления находятся в разных частях текста.

## Подробней

Данный модуль предназначен для тестирования функциональности обработки текста с индикаторами начала и окончания "размышлений". Он использует библиотеку `unittest` для создания набора тестов, которые проверяют различные сценарии использования класса `ThinkingProcessor`. Это позволяет убедиться, что класс правильно обрабатывает текст в разных ситуациях, например, когда теги `<think>` и `</think>` находятся в одном фрагменте текста или разделены между разными фрагментами.

## Классы

### `TestThinkingProcessor`

**Описание**: Класс `TestThinkingProcessor` наследует `unittest.TestCase` и содержит набор тестовых методов для проверки функциональности класса `ThinkingProcessor`.

**Наследует**: `unittest.TestCase`

**Методы**:

- `test_non_thinking_chunk()`: Проверяет случай, когда входной текст не содержит тегов `<think>` и `</think>`.
- `test_thinking_start()`: Проверяет случай, когда входной текст содержит только открывающий тег `<think>`.
- `test_thinking_end()`: Проверяет случай, когда входной текст содержит только закрывающий тег `</think>`.
- `test_thinking_start_and_end()`: Проверяет случай, когда входной текст содержит как открывающий, так и закрывающий теги `<think>` и `</think>`.
- `test_ongoing_thinking()`: Проверяет случай, когда процесс размышления продолжается.
- `test_chunk_with_text_after_think()`: Проверяет случай, когда текст содержит теги `<think>` и `</think>`, а также текст до и после них.

## Методы класса

### `test_non_thinking_chunk`

```python
def test_non_thinking_chunk(self):
    """Проверяет случай, когда входной текст не содержит тегов <think> и </think>.

    Args:
        self (TestThinkingProcessor): Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    """
```

**Назначение**: Проверяет случай, когда входной текст не содержит тегов `<think>` и `</think>`. Функция проверяет, что при отсутствии тегов размышления время обработки равно 0, а результат совпадает с исходным текстом.

**Как работает функция**:

1. Определяет входной текст `chunk`, который не содержит тегов `<think>` и `</think>`.
2. Устанавливает ожидаемые значения времени (`expected_time`) и результата (`expected_result`).
3. Вызывает метод `ThinkingProcessor.process_thinking_chunk` с входным текстом.
4. Сравнивает фактическое время и результат с ожидаемыми значениями, используя методы `assertEqual`.

**Примеры**:

```python
test_case = TestThinkingProcessor()
test_case.test_non_thinking_chunk()
```

### `test_thinking_start`

```python
def test_thinking_start(self):
    """Проверяет случай, когда входной текст содержит только открывающий тег <think>.

    Args:
        self (TestThinkingProcessor): Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    """
```

**Назначение**: Проверяет случай, когда входной текст содержит только открывающий тег `<think>`. Функция проверяет, что при наличии открывающего тега время обработки приблизительно равно текущему времени, а результат содержит текст до тега, индикатор начала размышления и текст после тега.

**Как работает функция**:

1. Определяет входной текст `chunk`, который содержит открывающий тег `<think>`.
2. Устанавливает ожидаемое время (`expected_time`) как текущее время.
3. Устанавливает ожидаемый результат (`expected_result`), который включает текст до тега, объект `Reasoning` с информацией о начале размышления и текст после тега.
4. Вызывает метод `ThinkingProcessor.process_thinking_chunk` с входным текстом.
5. Сравнивает фактическое время и результат с ожидаемыми значениями, используя методы `assertAlmostEqual` и `assertEqual`.

**Примеры**:

```python
test_case = TestThinkingProcessor()
test_case.test_thinking_start()
```

### `test_thinking_end`

```python
def test_thinking_end(self):
    """Проверяет случай, когда входной текст содержит только закрывающий тег </think>.

    Args:
        self (TestThinkingProcessor): Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    """
```

**Назначение**: Проверяет случай, когда входной текст содержит только закрывающий тег `</think>`. Функция проверяет, что при наличии закрывающего тега время обработки равно 0, а результат содержит объект `Reasoning` с информацией об окончании размышления и текст после тега.

**Как работает функция**:

1. Определяет входной текст `chunk`, который содержит закрывающий тег `</think>`.
2. Устанавливает ожидаемый результат (`expected_result`), который включает объект `Reasoning` с информацией об окончании размышления и текст после тега.
3. Вызывает метод `ThinkingProcessor.process_thinking_chunk` с входным текстом и временем начала.
4. Сравнивает фактическое время и результат с ожидаемыми значениями, используя методы `assertEqual`.

**Примеры**:

```python
test_case = TestThinkingProcessor()
test_case.test_thinking_end()
```

### `test_thinking_start_and_end`

```python
def test_thinking_start_and_end(self):
    """Проверяет случай, когда входной текст содержит как открывающий, так и закрывающий теги <think> и </think>.

    Args:
        self (TestThinkingProcessor): Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    """
```

**Назначение**: Проверяет случай, когда входной текст содержит как открывающий, так и закрывающий теги `<think>` и `</think>`. Функция проверяет, что при наличии обоих тегов время обработки равно 0, а результат содержит объекты `Reasoning` с информацией о начале и окончании размышления, а также текст между тегами и после них.

**Как работает функция**:

1. Определяет входной текст `chunk`, который содержит открывающий и закрывающий теги `<think>` и `</think>`.
2. Устанавливает ожидаемый результат (`expected_result`), который включает объекты `Reasoning` с информацией о начале и окончании размышления, а также текст между тегами и после них.
3. Вызывает метод `ThinkingProcessor.process_thinking_chunk` с входным текстом и временем начала.
4. Сравнивает фактическое время и результат с ожидаемыми значениями, используя методы `assertEqual`.

**Примеры**:

```python
test_case = TestThinkingProcessor()
test_case.test_thinking_start_and_end()
```

### `test_ongoing_thinking`

```python
def test_ongoing_thinking(self):
    """Проверяет случай, когда процесс размышления продолжается.

    Args:
        self (TestThinkingProcessor): Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    """
```

**Назначение**: Проверяет случай, когда процесс размышления продолжается. Функция проверяет, что при отсутствии тегов, но при наличии времени начала, время обработки остается равным времени начала, а результат содержит исходный текст, обернутый в объект `Reasoning`.

**Как работает функция**:

1. Определяет входной текст `chunk`, который не содержит тегов `<think>` и `</think>`.
2. Устанавливает ожидаемый результат (`expected_result`), который включает исходный текст, обернутый в объект `Reasoning`.
3. Вызывает метод `ThinkingProcessor.process_thinking_chunk` с входным текстом и временем начала.
4. Сравнивает фактическое время и результат с ожидаемыми значениями, используя методы `assertEqual`.

**Примеры**:

```python
test_case = TestThinkingProcessor()
test_case.test_ongoing_thinking()
```

### `test_chunk_with_text_after_think`

```python
def test_chunk_with_text_after_think(self):
    """Проверяет случай, когда текст содержит теги <think> и </think>, а также текст до и после них.

    Args:
        self (TestThinkingProcessor): Экземпляр класса TestThinkingProcessor.

    Returns:
        None

    """
```

**Назначение**: Проверяет случай, когда текст содержит теги `<think>` и `</think>`, а также текст до и после них. Функция проверяет, что при наличии обоих тегов и текста до и после них, время обработки равно 0, а результат содержит текст до тега, объекты `Reasoning` с информацией о начале и окончании размышления, текст между тегами и текст после тегов.

**Как работает функция**:

1. Определяет входной текст `chunk`, который содержит теги `<think>` и `</think>`, а также текст до и после них.
2. Устанавливает ожидаемый результат (`expected_result`), который включает текст до тега, объекты `Reasoning` с информацией о начале и окончании размышления, текст между тегами и текст после тегов.
3. Вызывает метод `ThinkingProcessor.process_thinking_chunk` с входным текстом.
4. Сравнивает фактическое время и результат с ожидаемыми значениями, используя методы `assertEqual`.

**Примеры**:

```python
test_case = TestThinkingProcessor()
test_case.test_chunk_with_text_after_think()
```
# Документация модуля `models.py`

## Обзор

Модуль `models.py` предназначен для модульного тестирования в проекте `hypotez`. Он содержит тесты, проверяющие наличие моделей у различных провайдеров, а также работоспособность этих провайдеров.

## Подробней

Этот модуль важен для обеспечения совместимости и функциональности различных провайдеров моделей в проекте `hypotez`. Он использует `unittest` для создания тестовых случаев и проверок. Основная цель - убедиться, что каждый провайдер, указанный в `__models__`, действительно поддерживает заявленные модели и что провайдеры находятся в рабочем состоянии.

## Классы

### `TestProviderHasModel`

**Описание**: Класс `TestProviderHasModel` является тестовым классом, который наследует `unittest.TestCase` и содержит методы для проверки наличия моделей у провайдеров и работоспособности провайдеров.

**Наследует**: `unittest.TestCase`

**Атрибуты**:
- `cache` (dict): Кэш для хранения моделей, предоставляемых провайдерами.

**Методы**:
- `test_provider_has_model()`: Проверяет наличие моделей у провайдеров, перечисленных в `__models__`.
- `provider_has_model(provider: Type[BaseProvider], model: str)`: Проверяет, предоставляет ли указанный провайдер данную модель.
- `test_all_providers_working()`: Проверяет, находится ли каждый провайдер в рабочем состоянии.

#### Принцип работы:

1.  Класс `TestProviderHasModel` инициализируется с пустым кэшем `cache` для хранения полученных моделей от провайдеров.
2.  Метод `test_provider_has_model` итерируется по всем моделям и провайдерам, указанным в `__models__`.
3.  Для каждого провайдера проверяется, является ли он подклассом `ProviderModelMixin`. Если да, то проверяется наличие модели у провайдера с использованием `provider_has_model`.
4.  Метод `provider_has_model` проверяет, есть ли в кэше модели для данного провайдера. Если нет, то пытается получить список моделей, используя метод `get_models` провайдера. Если провайдер требует аутентификации или имеет другие ограничения, он пропускается. Затем проверяется, присутствует ли указанная модель в списке моделей провайдера.
5.  Метод `test_all_providers_working` проверяет атрибут `working` каждого провайдера, чтобы убедиться, что провайдер находится в рабочем состоянии.

## Методы класса

### `test_provider_has_model`

```python
    def test_provider_has_model(self):
        """
        Проходит по всем моделям и провайдерам из `__models__` и проверяет, предоставляет ли провайдер указанную модель.
        """
```

**Назначение**: Метод `test_provider_has_model` выполняет итерацию по всем моделям и провайдерам, определенным в `__models__`, и проверяет, предоставляет ли каждый провайдер указанную модель.

**Параметры**:
- Отсутствуют

**Возвращает**:
- `None`

**Вызывает исключения**:
- Отсутствуют

**Как работает функция**:
- Функция итерируется по всем моделям и соответствующим им провайдерам, указанным в `__models__`.
- Для каждого провайдера проверяется, является ли он подклассом `ProviderModelMixin`.
- Если провайдер является подклассом `ProviderModelMixin`, то определяется имя модели, которое может отличаться от стандартного имени, если для провайдера определены псевдонимы моделей (атрибут `model_aliases`).
- Вызывается метод `provider_has_model` для проверки наличия данной модели у текущего провайдера.

**Примеры**:
```python
# Пример вызова (в контексте unittest):
# self.test_provider_has_model()
```

### `provider_has_model`

```python
    def provider_has_model(self, provider: Type[BaseProvider], model: str):
        """
        Проверяет, предоставляет ли указанный провайдер данную модель.
        """
```

**Назначение**: Метод `provider_has_model` проверяет, предоставляет ли указанный провайдер указанную модель.

**Параметры**:
- `provider` (Type[BaseProvider]): Класс провайдера, который нужно проверить.
- `model` (str): Название модели, наличие которой нужно проверить.

**Возвращает**:
- `None`

**Вызывает исключения**:
- Отсутствуют

**Как работает функция**:
- Функция сначала проверяет, есть ли в кэше информация о моделях, предоставляемых данным провайдером.
- Если информации в кэше нет, функция пытается получить список моделей, используя метод `get_models` провайдера. Если при этом возникают исключения `MissingRequirementsError` или `MissingAuthError`, функция завершается, так как это означает, что для работы с провайдером не хватает зависимостей или не пройдена аутентификация.
- Если список моделей получен успешно, функция проверяет, содержится ли в этом списке указанная модель. Если модель отсутствует, вызывается `self.assertIn`, что приводит к ошибке теста.

**Примеры**:
```python
# Пример вызова (в контексте unittest):
# self.provider_has_model(SomeProvider, "gpt-3.5-turbo")
```

### `test_all_providers_working`

```python
    def test_all_providers_working(self):
        """
        Проверяет, находится ли каждый провайдер в рабочем состоянии.
        """
```

**Назначение**: Метод `test_all_providers_working` проверяет, находится ли каждый провайдер в рабочем состоянии, проверяя значение атрибута `working` провайдера.

**Параметры**:
- Отсутствуют

**Возвращает**:
- `None`

**Вызывает исключения**:
- Отсутствуют

**Как работает функция**:
- Функция итерируется по всем моделям и соответствующим им провайдерам, указанным в `__models__`.
- Для каждого провайдера проверяется значение атрибута `working`. Если значение `False`, вызывается `self.assertTrue`, что приводит к ошибке теста и указывает на то, что провайдер не работает.

**Примеры**:
```python
# Пример вызова (в контексте unittest):
# self.test_all_providers_working()
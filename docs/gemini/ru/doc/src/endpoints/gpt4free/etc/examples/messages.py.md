# Модуль для обработки диалогов

## Обзор

Модуль предоставляет класс `ConversationHandler`, который используется для управления диалогами с использованием AI-модели GPT-4 (или другой модели, указанной при инициализации). Он позволяет добавлять сообщения пользователя, получать ответы от модели и сохранять историю диалога.

## Подробней

Этот модуль предназначен для организации и управления многократными обменами сообщениями с AI-моделью. Он хранит историю диалога и использует ее для получения контекстно-зависимых ответов. Модуль использует библиотеку `g4f` для взаимодействия с AI-моделью.

## Классы

### `ConversationHandler`

**Описание**: Класс для управления диалогами с AI-моделью.

**Атрибуты**:

- `client` (g4f.client.Client): Клиент для взаимодействия с AI-моделью.
- `model` (str): Имя используемой AI-модели (по умолчанию "gpt-4").
- `conversation_history` (list): Список словарей, представляющих историю диалога. Каждый словарь содержит ключи "role" (роль участника диалога) и "content" (сообщение участника диалога).

**Методы**:

- `__init__(model="gpt-4")`: Инициализирует экземпляр класса `ConversationHandler`.
- `add_user_message(content)`: Добавляет сообщение пользователя в историю диалога.
- `get_response()`: Получает ответ от AI-модели на основе истории диалога.

## Методы класса

### `__init__(self, model="gpt-4")`

```python
def __init__(self, model="gpt-4"):
    """
    Инициализирует экземпляр класса `ConversationHandler`.

    Args:
        model (str, optional): Имя используемой AI-модели. По умолчанию "gpt-4".
    """
```

**Назначение**: Инициализирует объект `ConversationHandler` с указанной моделью и создает пустую историю диалога.

**Параметры**:

- `model` (str, optional): Имя используемой AI-модели. По умолчанию "gpt-4".

**Как работает функция**:

- Инициализирует атрибут `client` экземпляром класса `g4f.client.Client`.
- Устанавливает атрибут `model` в значение переданного параметра `model` (или "gpt-4" по умолчанию).
- Инициализирует атрибут `conversation_history` пустым списком.

**Примеры**:

```python
conversation = ConversationHandler()  # Использует модель gpt-4 по умолчанию
conversation = ConversationHandler(model="gpt-3.5-turbo")  # Использует модель gpt-3.5-turbo
```

### `add_user_message(self, content)`

```python
def add_user_message(self, content):
    """
    Добавляет сообщение пользователя в историю диалога.

    Args:
        content (str): Сообщение пользователя.
    """
```

**Назначение**: Добавляет сообщение пользователя в историю диалога.

**Параметры**:

- `content` (str): Сообщение пользователя.

**Как работает функция**:

- Создает словарь с ключами "role" (значение "user") и "content" (значение переданного параметра `content`).
- Добавляет созданный словарь в список `conversation_history`.

**Примеры**:

```python
conversation = ConversationHandler()
conversation.add_user_message("Привет!")
```

### `get_response(self)`

```python
def get_response(self):
    """
    Получает ответ от AI-модели на основе истории диалога.

    Returns:
        str: Ответ от AI-модели.
    """
```

**Назначение**: Получает ответ от AI-модели на основе истории диалога.

**Возвращает**:

- `str`: Ответ от AI-модели.

**Как работает функция**:

- Вызывает метод `create` объекта `self.client.chat.completions` с параметрами `model` (значение атрибута `model`) и `messages` (значение атрибута `conversation_history`).
- Извлекает роль и содержимое ответа из объекта `response.choices[0].message`.
- Создает словарь `assistant_message` с извлеченными ролью и содержимым.
- Добавляет словарь `assistant_message` в список `conversation_history`.
- Возвращает содержимое ответа (`assistant_message["content"]`).

**Примеры**:

```python
conversation = ConversationHandler()
conversation.add_user_message("Как дела?")
response = conversation.get_response()
print("Assistant:", response)
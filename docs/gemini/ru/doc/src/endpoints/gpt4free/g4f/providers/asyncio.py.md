# Модуль asyncio

## Обзор

Данный модуль предоставляет набор функций для работы с асинхронным кодом в проекте `hypotez`. Он включает в себя функции для получения текущего цикла событий, преобразования асинхронных генераторов в списки и синхронные генераторы, а также для создания асинхронных итераторов.

## Подробности

Этот модуль предназначен для обеспечения гибкой работы с асинхронными функциями и генераторами. 

## Функции

### `get_running_loop`

**Назначение**: Получение текущего цикла событий, асинхронно. 

**Параметры**:
- `check_nested` (bool): Если `True`, то функция проверяет, установлен ли пакет `nest_asyncio`. Если он не установлен, то функция выдает исключение.

**Возвращает**:
- `Optional[AbstractEventLoop]`: Текущий цикл событий, если он запущен, в противном случае - `None`.

**Как работает функция**:
- Функция пытается получить текущий цикл событий, используя функцию `asyncio.get_running_loop()`.
- Если цикл событий является `uvloop.Loop`  - функция возвращает его без модификаций.
- Если пакет `nest_asyncio` установлен, а текущий цикл событий не был изменен - функция исправляет его, чтобы избежать исключения `RuntimeError: async generator ignored GeneratorExit`.
- Если пакет `nest_asyncio` не установлен, а параметр `check_nested` равен `True`, то функция выдает исключение, прося установить пакет `nest_asyncio`.

**Примеры**:

```python
>>> import asyncio
>>> from src.endpoints.gpt4free.g4f.providers.asyncio import get_running_loop
>>> loop = get_running_loop(check_nested=True)
>>> if loop:
...     print(f'Текущий цикл событий: {loop}')
... else:
...     print('Цикл событий не запущен')
```

### `await_callback`

**Назначение**: Вызов callback-функции асинхронно.

**Параметры**:
- `callback` (Callable): Callback-функция, которую необходимо вызвать.

**Возвращает**:
- Результат вызова callback-функции.

**Как работает функция**:
- Функция принимает callback-функцию и вызывает ее асинхронно, используя `await callback()`.
- После вызова callback-функции функция возвращает ее результат.

**Примеры**:

```python
>>> async def my_callback():
...     return 'Результат callback-функции'
>>> from src.endpoints.gpt4free.g4f.providers.asyncio import await_callback
>>> result = asyncio.run(await_callback(my_callback))
>>> print(f'Результат callback-функции: {result}')
```


### `async_generator_to_list`

**Назначение**: Преобразование асинхронного генератора в список.

**Параметры**:
- `generator` (AsyncIterator): Асинхронный генератор, который необходимо преобразовать.

**Возвращает**:
- `list`: Список элементов асинхронного генератора.

**Как работает функция**:
- Функция создает новый список, используя list comprehension.
- Она итерируется по элементам асинхронного генератора, добавляя каждый элемент в список.
- Функция возвращает созданный список.

**Примеры**:

```python
>>> async def my_generator():
...     yield 1
...     yield 2
...     yield 3
>>> from src.endpoints.gpt4free.g4f.providers.asyncio import async_generator_to_list
>>> result = asyncio.run(async_generator_to_list(my_generator()))
>>> print(f'Список элементов асинхронного генератора: {result}')
```

### `to_sync_generator`

**Назначение**: Преобразование асинхронного генератора в синхронный генератор.

**Параметры**:
- `generator` (AsyncIterator): Асинхронный генератор, который необходимо преобразовать.
- `stream` (bool): Если `True`, то функция создает новый цикл событий, если он еще не был создан.

**Возвращает**:
- `Iterator`: Синхронный генератор, который генерирует элементы асинхронного генератора.

**Как работает функция**:
- Функция получает текущий цикл событий, используя `get_running_loop`.
- Если цикл событий не был создан, то функция создает новый цикл событий.
- Функция итерируется по элементам асинхронного генератора, используя `loop.run_until_complete(await_callback(gen.__anext__))`.
- Каждый полученный элемент генерируется функцией.
- После завершения итерации функция закрывает цикл событий.

**Примеры**:

```python
>>> async def my_generator():
...     yield 1
...     yield 2
...     yield 3
>>> from src.endpoints.gpt4free.g4f.providers.asyncio import to_sync_generator
>>> for item in to_sync_generator(my_generator()):
...     print(f'Элемент синхронного генератора: {item}')
```


### `to_async_iterator`

**Назначение**: Преобразование синхронного итератора в асинхронный итератор.

**Параметры**:
- `iterator`: Синхронный итератор, который необходимо преобразовать.

**Возвращает**:
- `AsyncIterator`: Асинхронный итератор.

**Как работает функция**:
- Функция проверяет, является ли `iterator` асинхронным итератором, асинхронной функцией или синхронным итератором.
- Если `iterator` является асинхронным итератором, функция возвращает его без изменений.
- Если `iterator` является асинхронной функцией, функция вызывает ее асинхронно и возвращает результат.
- Если `iterator` является синхронным итератором, функция итерируется по его элементам и возвращает их как асинхронный итератор.

**Примеры**:

```python
>>> my_list = [1, 2, 3]
>>> from src.endpoints.gpt4free.g4f.providers.asyncio import to_async_iterator
>>> async for item in to_async_iterator(my_list):
...     print(f'Элемент асинхронного итератора: {item}')
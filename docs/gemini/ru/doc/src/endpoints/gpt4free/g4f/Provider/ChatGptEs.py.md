# Модуль ChatGptEs

## Обзор

Модуль `ChatGptEs` предоставляет асинхронный генератор для взаимодействия с сервисом ChatGpt.es. Он позволяет отправлять запросы к API этого сервиса и получать ответы в асинхронном режиме. Модуль поддерживает использование прокси и обходит защиту Cloudflare.

## Подробнее

Модуль предназначен для использования в проектах, требующих интеграции с ChatGpt.es. Он предоставляет удобный интерфейс для отправки сообщений и получения ответов, а также обрабатывает ошибки и исключения, которые могут возникнуть в процессе взаимодействия с API.

## Классы

### `ChatGptEs`

**Описание**: Класс `ChatGptEs` предоставляет асинхронный генератор для взаимодействия с ChatGpt.es.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает базовую функциональность асинхронного генератора.
- `ProviderModelMixin`: Предоставляет методы для работы с моделями.

**Атрибуты**:
- `url` (str): URL сервиса ChatGpt.es.
- `api_endpoint` (str): URL API сервиса ChatGpt.es.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_stream` (bool): Флаг, указывающий на поддержку потоковой передачи данных.
- `supports_system_message` (bool): Флаг, указывающий на поддержку системных сообщений.
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений.
- `default_model` (str): Модель, используемая по умолчанию (`gpt-4o`).
- `models` (list): Список поддерживаемых моделей (`gpt-4`, `gpt-4o`, `gpt-4o-mini`).
- `SYSTEM_PROMPT` (str): Системное сообщение, используемое по умолчанию.

**Принцип работы**:

Класс `ChatGptEs` использует библиотеку `curl_cffi` для выполнения асинхронных HTTP-запросов. Он обходит защиту Cloudflare и отправляет сообщения к API ChatGpt.es, получая ответы в формате JSON. Класс также обрабатывает ошибки и исключения, которые могут возникнуть в процессе взаимодействия с API.

## Методы класса

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        **kwargs
    ) -> AsyncResult:
        """ Функция создает асинхронный генератор для взаимодействия с ChatGpt.es.

        Args:
            model (str): Модель, используемая для генерации ответа.
            messages (Messages): Список сообщений, отправляемых в запросе.
            proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
            **kwargs: Дополнительные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий ответы от ChatGpt.es.

        Raises:
            MissingRequirementsError: Если не установлена библиотека `curl_cffi`.
            ValueError: Если возникает ошибка при выполнении запроса или неожиданный формат ответа.

        Как работает функция:
        - Проверяет, установлена ли библиотека `curl_cffi`. Если нет, вызывает исключение `MissingRequirementsError`.
        - Извлекает модель из входных параметров.
        - Форматирует запрос, добавляя системное сообщение.
        - Создает сессию `curl_cffi` для выполнения HTTP-запросов.
        - Добавляет необходимые заголовки в сессию.
        - Если указан прокси, устанавливает его для сессии.
        - Выполняет первый GET-запрос для получения `nonce` и `post_id`.
        - Извлекает `nonce` и `post_id` из ответа. Если не удается извлечь, использует значения по умолчанию.
        - Генерирует случайный `client_id`.
        - Подготавливает данные для POST-запроса.
        - Выполняет POST-запрос к API.
        - Если возникает ошибка при выполнении запроса, вызывает исключение `ValueError`.
        - Извлекает данные из ответа и возвращает их в виде асинхронного генератора.

        Внутренние функции:
            Отсутствуют
        """
```
**Параметры**:
- `model` (str): Модель, используемая для генерации ответа.
- `messages` (Messages): Список сообщений, отправляемых в запросе.
- `proxy` (str, optional): URL прокси-сервера. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий ответы от ChatGpt.es.

**Вызывает исключения**:
- `MissingRequirementsError`: Если не установлена библиотека `curl_cffi`.
- `ValueError`: Если возникает ошибка при выполнении запроса или неожиданный формат ответа.

**Примеры**:
```python
# Пример использования create_async_generator
model = "gpt-4o"
messages = [{"role": "user", "content": "Hello, world!"}]
proxy = "http://your_proxy:8080"

async def main():
    generator = await ChatGptEs.create_async_generator(model=model, messages=messages, proxy=proxy)
    async for message in generator:
        print(message)

# Запуск примера (в асинхронном контексте)
# asyncio.run(main())
```
## Параметры класса

- `url` (str): URL сервиса ChatGpt.es.
- `api_endpoint` (str): URL API сервиса ChatGpt.es.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_stream` (bool): Флаг, указывающий на поддержку потоковой передачи данных.
- `supports_system_message` (bool): Флаг, указывающий на поддержку системных сообщений.
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений.
- `default_model` (str): Модель, используемая по умолчанию (`gpt-4o`).
- `models` (list): Список поддерживаемых моделей (`gpt-4`, `gpt-4o`, `gpt-4o-mini`).
- `SYSTEM_PROMPT` (str): Системное сообщение, используемое по умолчанию.
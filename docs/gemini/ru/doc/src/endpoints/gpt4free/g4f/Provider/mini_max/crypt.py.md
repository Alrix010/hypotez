# Модуль для шифрования и генерации хешей

## Обзор

Этот модуль предоставляет функции для шифрования и генерации хешей, используемых для взаимодействия с API сервиса gpt4free. 

## Классы

### `CallbackResults`

**Описание**: Класс для хранения результатов обратного вызова (callback) от API сервиса gpt4free.

**Атрибуты**:
- `token` (str): Токен авторизации пользователя.
- `path_and_query` (str): Путь и строка запроса для API.
- `timestamp` (int): Время создания запроса в миллисекундах.

## Функции

### `hash_function`

**Назначение**: Функция для генерации хеша строки с использованием MD5.

**Параметры**:
- `base_string` (str): Строка для хеширования.

**Возвращает**:
- `str`: Хеш строки в формате шестнадцатеричного числа.

**Пример**:

```python
>>> hash_function("hello world")
'b10a8db164e0754105b7a99be72e3fe5'
```

### `generate_yy_header`

**Назначение**: Функция для генерации хеша заголовка `YY` для API запроса.

**Параметры**:
- `has_search_params_path` (str): Путь к API с параметрами запроса.
- `body_to_yy` (dict): Тело запроса в виде словаря.
- `time` (int): Время создания запроса в миллисекундах.

**Возвращает**:
- `str`: Хеш заголовка `YY`.

**Как работает функция**:

1. Кодирует путь к API с параметрами запроса с использованием `urllib.parse.quote`.
2. Хеширует время создания запроса с использованием `hash_function`.
3. Объединяет закодированный путь, строку из тела запроса и хеш времени в одну строку.
4. Хеширует объединенную строку с использованием `hash_function`.
5. Возвращает полученный хеш.

**Примеры**:

```python
>>> generate_yy_header("/v4/api/chat/msg?device_platform=web&biz_id=2&app_id=3001...", {"msgContent": "Hello, world!", "characterID": "12345", "chatID": "67890"}, 1678896000000)
'b10a8db164e0754105b7a99be72e3fe5' # Пример хеша
```

### `get_body_to_yy`

**Назначение**: Функция для подготовки тела запроса для генерации хеша `YY`.

**Параметры**:
- `l` (dict): Словарь, содержащий данные запроса.

**Возвращает**:
- `str`: Строка, представляющая тело запроса для хеширования.

**Как работает функция**:

1. Преобразует строку `msgContent` из словаря `l` в одну строку, удаляя символы `\r`, `\n`, `\r\n`.
2. Хеширует строку `characterID`, `msgContent` и `chatID` из словаря `l` с использованием `hash_function`.
3. Объединяет полученные хеши в одну строку.
4. Возвращает полученную строку.

**Примеры**:

```python
>>> get_body_to_yy({"msgContent": "Hello, world!\nThis is a multiline message.", "characterID": "12345", "chatID": "67890"})
'b10a8db164e0754105b7a99be72e3fe5' # Пример строки для хеширования
```

### `get_body_json`

**Назначение**: Функция для преобразования словаря в строку JSON.

**Параметры**:
- `s` (dict): Словарь для преобразования в JSON.

**Возвращает**:
- `str`: Строка JSON, представляющая словарь.

**Пример**:

```python
>>> get_body_json({"msgContent": "Hello, world!", "characterID": "12345", "chatID": "67890"})
'{"characterID": "12345", "chatID": "67890", "msgContent": "Hello, world!"}'
```

### `get_browser_callback`

**Назначение**: Асинхронная функция для получения токена авторизации и параметров запроса от браузера.

**Параметры**:
- `auth_result` (CallbackResults): Объект `CallbackResults`, в который будут записаны результаты обратного вызова.

**Возвращает**:
- `callback` (function): Функция обратного вызова, которую нужно передать в `driver.execute_locator`.

**Как работает функция**:

1. Определяет асинхронную функцию `callback`, которая будет выполняться в контексте веб-страницы.
2. В цикле проверяет наличие токена авторизации в локальном хранилище браузера.
3. Если токен найден, извлекает его и записывает в объект `auth_result`.
4. Извлекает строку запроса и время создания запроса с использованием JavaScript кода, который выполняется на веб-странице.
5. Записывает полученные данные в объект `auth_result`.
6. Возвращает функцию `callback`.

**Примеры**:

```python
>>> driver = Driver(Chrome) # Инициализация драйвера браузера
>>> auth_result = CallbackResults()
>>> callback = get_browser_callback(auth_result) # Получение функции обратного вызова
>>> driver.execute_locator(callback) # Выполнение функции обратного вызова в браузере
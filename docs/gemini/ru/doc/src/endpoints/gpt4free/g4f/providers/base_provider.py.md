# Модуль `base_provider`

## Обзор

Этот модуль определяет базовый класс `AbstractProvider` для реализации провайдеров для различных моделей искусственного интеллекта, таких как Google Gemini и OpenAI. Он предоставляет абстрактные методы и свойства, которые должны быть реализованы конкретными провайдерами. 

## Подробнее

Базовый класс `AbstractProvider` определяет методы для создания ответов от модели, как синхронно, так и асинхронно. Также он определяет методы для получения параметров, поддерживаемых провайдером, и информацию о его модели.

## Классы

### `AbstractProvider`

**Описание**: Абстрактный класс, который должен быть наследован конкретными провайдерами.

**Наследует**: `BaseProvider`

**Атрибуты**: 

- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую обработку (streaming).

**Методы**:

- `create_completion(model: str, messages: Messages, stream: bool, **kwargs) -> CreateResult`
    - **Описание**: Абстрактный метод для создания результата с заданными параметрами.
    - **Параметры**:
        - `model` (str): Имя модели, которая будет использоваться.
        - `messages` (Messages): Сообщения, которые будут обработаны.
        - `stream` (bool): Указывает, использовать ли потоковую обработку.
        - `**kwargs`: Дополнительные аргументы.
    - **Возвращает**: 
        - `CreateResult`: Результат процесса создания.

- `create_async(model: str, messages: Messages, *, timeout: int = None, loop: AbstractEventLoop = None, executor: ThreadPoolExecutor = None, **kwargs) -> str`
    - **Описание**: Асинхронно создает результат на основе заданной модели и сообщений.
    - **Параметры**:
        - `model` (str): Имя модели, которая будет использоваться для создания.
        - `messages` (Messages): Сообщения, которые будут обработаны.
        - `loop` (AbstractEventLoop, optional): Ивент-луп для использования. По умолчанию `None`.
        - `executor` (ThreadPoolExecutor, optional): Исполнитель для запуска асинхронных задач. По умолчанию `None`.
        - `**kwargs`: Дополнительные аргументы.
    - **Возвращает**: 
        - `str`: Созданный результат в виде строки.

- `get_create_function() -> callable`
    - **Описание**: Возвращает функцию для создания результата.
    - **Возвращает**: 
        - `callable`: Функция для создания результата.

- `get_async_create_function() -> callable`
    - **Описание**: Возвращает функцию для асинхронного создания результата.
    - **Возвращает**: 
        - `callable`: Функция для асинхронного создания результата.

- `get_parameters(as_json: bool = False) -> dict[str, Parameter]`
    - **Описание**: Возвращает словарь параметров, поддерживаемых провайдером.
    - **Параметры**:
        - `as_json` (bool, optional): Указывает, возвращать ли параметры в виде JSON. По умолчанию `False`.
    - **Возвращает**: 
        - `dict[str, Parameter]`: Словарь параметров, поддерживаемых провайдером.

- `params() -> str`
    - **Описание**: Возвращает строку с параметрами, поддерживаемыми провайдером.
    - **Возвращает**: 
        - `str`: Строка с параметрами, поддерживаемыми провайдером.

### `AsyncProvider`

**Описание**: Предоставляет асинхронную функциональность для создания ответов от модели.

**Наследует**: `AbstractProvider`

**Методы**:

- `create_completion(model: str, messages: Messages, stream: bool = False, **kwargs) -> CreateResult`
    - **Описание**: Создает результат ответа модели синхронно.
    - **Параметры**:
        - `model` (str): Имя модели, которая будет использоваться для создания.
        - `messages` (Messages): Сообщения, которые будут обработаны.
        - `stream` (bool): Указывает, использовать ли потоковую обработку. По умолчанию `False`.
        - `loop` (AbstractEventLoop, optional): Ивент-луп для использования. По умолчанию `None`.
        - `**kwargs`: Дополнительные аргументы.
    - **Возвращает**: 
        - `CreateResult`: Результат создания ответа модели.

- `create_async(model: str, messages: Messages, **kwargs) -> str`
    - **Описание**: Абстрактный метод для создания асинхронного результата.
    - **Параметры**:
        - `model` (str): Имя модели, которая будет использоваться для создания.
        - `messages` (Messages): Сообщения, которые будут обработаны.
        - `**kwargs`: Дополнительные аргументы.
    - **Возвращает**: 
        - `str`: Созданный результат в виде строки.

### `AsyncGeneratorProvider`

**Описание**: Предоставляет асинхронную функциональность для потоковой обработки (streaming) ответов от модели.

**Наследует**: `AbstractProvider`

**Атрибуты**: 

- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую обработку (streaming). Значение всегда `True`.

**Методы**:

- `create_completion(model: str, messages: Messages, stream: bool = True, **kwargs) -> CreateResult`
    - **Описание**: Создает результат ответа модели синхронно с использованием потоковой обработки.
    - **Параметры**:
        - `model` (str): Имя модели, которая будет использоваться для создания.
        - `messages` (Messages): Сообщения, которые будут обработаны.
        - `stream` (bool): Указывает, использовать ли потоковую обработку. По умолчанию `True`.
        - `loop` (AbstractEventLoop, optional): Ивент-луп для использования. По умолчанию `None`.
        - `**kwargs`: Дополнительные аргументы.
    - **Возвращает**: 
        - `CreateResult`: Результат создания ответа модели.

- `create_async_generator(model: str, messages: Messages, stream: bool = True, **kwargs) -> AsyncResult`
    - **Описание**: Абстрактный метод для создания асинхронного генератора.
    - **Параметры**:
        - `model` (str): Имя модели, которая будет использоваться для создания.
        - `messages` (Messages): Сообщения, которые будут обработаны.
        - `stream` (bool): Указывает, использовать ли потоковую обработку. По умолчанию `True`.
        - `**kwargs`: Дополнительные аргументы.
    - **Возвращает**: 
        - `AsyncResult`: Асинхронный генератор, который выдает результаты.

### `ProviderModelMixin`

**Описание**: Обеспечивает функциональность для работы с моделями.

**Атрибуты**:

- `default_model` (str): Имя модели по умолчанию.
- `models` (list[str]): Список поддерживаемых моделей.
- `model_aliases` (dict[str, str]): Словарь псевдонимов для моделей.
- `image_models` (list): Список моделей, поддерживающих изображения.
- `vision_models` (list): Список моделей, поддерживающих визуальное понимание.
- `last_model` (str): Последняя использованная модель.

**Методы**:

- `get_models(**kwargs) -> list[str]`
    - **Описание**: Возвращает список поддерживаемых моделей.
    - **Возвращает**: 
        - `list[str]`: Список поддерживаемых моделей.

- `get_model(model: str, **kwargs) -> str`
    - **Описание**: Возвращает имя модели.
    - **Параметры**:
        - `model` (str): Имя модели.
        - `**kwargs`: Дополнительные аргументы.
    - **Возвращает**: 
        - `str`: Имя модели.

### `RaiseErrorMixin`

**Описание**: Обеспечивает функциональность для обработки ошибок.

**Методы**:

- `raise_error(data: dict, status: int = None)`
    - **Описание**: Вызывает исключение на основе данных ответа.
    - **Параметры**:
        - `data` (dict): Данные ответа.
        - `status` (int, optional): Код состояния ответа. По умолчанию `None`.

### `AuthFileMixin`

**Описание**: Предоставляет функциональность для работы с файлами аутентификации.

**Методы**:

- `get_cache_file() -> Path`
    - **Описание**: Возвращает путь к файлу кеша.
    - **Возвращает**: 
        - `Path`: Путь к файлу кеша.

### `AsyncAuthedProvider`

**Описание**: Предоставляет асинхронную функциональность для аутентифицированных запросов к моделям.

**Наследует**: `AsyncGeneratorProvider`, `AuthFileMixin`

**Методы**:

- `on_auth_async(**kwargs) -> AuthResult`
    - **Описание**: Асинхронно выполняет аутентификацию.
    - **Возвращает**: 
        - `AuthResult`: Результат аутентификации.

- `on_auth(**kwargs) -> AuthResult`
    - **Описание**: Выполняет аутентификацию.
    - **Возвращает**: 
        - `AuthResult`: Результат аутентификации.

- `get_create_function() -> callable`
    - **Описание**: Возвращает функцию для создания результата.
    - **Возвращает**: 
        - `callable`: Функция для создания результата.

- `get_async_create_function() -> callable`
    - **Описание**: Возвращает функцию для асинхронного создания результата.
    - **Возвращает**: 
        - `callable`: Функция для асинхронного создания результата.

- `write_cache_file(cache_file: Path, auth_result: AuthResult = None)`
    - **Описание**: Записывает результат аутентификации в файл кеша.
    - **Параметры**:
        - `cache_file` (Path): Путь к файлу кеша.
        - `auth_result` (AuthResult, optional): Результат аутентификации. По умолчанию `None`.

- `create_completion(model: str, messages: Messages, **kwargs) -> CreateResult`
    - **Описание**: Создает результат с использованием аутентификации.
    - **Параметры**:
        - `model` (str): Имя модели, которая будет использоваться для создания.
        - `messages` (Messages): Сообщения, которые будут обработаны.
        - `**kwargs`: Дополнительные аргументы.
    - **Возвращает**: 
        - `CreateResult`: Результат создания.

- `create_async_generator(model: str, messages: Messages, **kwargs) -> AsyncResult`
    - **Описание**: Асинхронно создает результат с использованием аутентификации.
    - **Параметры**:
        - `model` (str): Имя модели, которая будет использоваться для создания.
        - `messages` (Messages): Сообщения, которые будут обработаны.
        - `**kwargs`: Дополнительные аргументы.
    - **Возвращает**: 
        - `AsyncResult`: Асинхронный генератор, который выдает результаты.


## Параметры

- `provider` (str): Имя провайдера.
- `model` (str): Имя модели.
- `messages` (list[dict]): Список сообщений, которые будут обработаны.
- `stream` (bool): Указывает, использовать ли потоковую обработку (streaming).
- `timeout` (int): Таймаут в секундах.
- `response_format` (dict): Формат ответа.
- `max_tokens` (int): Максимальное количество токенов в ответе.
- `stop` (list[str]): Список слов, которые должны остановить генерацию.
- `proxy` (str): Прокси-сервер для использования.
- `temperature` (float): Температура для генерации.
- `top_k` (int): Количество лучших кандидатов для выборки.
- `top_p` (float): Вероятность выборки токена.
- `frequency_penalty` (float): Штраф за частоту токенов.
- `presence_penalty` (float): Штраф за наличие токенов.
- `media` (list[list[str]]): Список файлов медиа для использования.
- `conversation` (dict): Данные о разговоре.
- `seed` (int): Семена для генерации.
- `tools` (list): Список инструментов, которые могут использоваться в разговоре.
- `history_disabled` (bool): Указывает, отключена ли история разговора.
- `api_key` (str): Ключ API.
- `api_base` (str): Базовый URL для API.
- `web_search` (bool): Указывает, использовать ли веб-поиск.
- `guidance_scale` (float): Масштабирование подсказки.
- `num_inference_steps` (int): Количество шагов вывода.
- `randomize_seed` (bool): Указывает, следует ли рандомизировать семена.
- `safe` (bool): Указывает, следует ли использовать безопасный режим.
- `enhance` (bool): Указывает, следует ли улучшать ответ.
- `private` (bool): Указывает, является ли разговор приватным.
- `aspect_ratio` (str): Соотношение сторон изображения.
- `n` (int): Количество генераций.

**Примеры**:

```python
# Создание экземпляра провайдера (пример)
provider = Provider(model='gpt-3.5-turbo', messages=[{"role": "user", "content": "Hello world!"}])

# Создание результата (пример)
result = provider.create_completion(model='gpt-3.5-turbo', messages=[{"role": "user", "content": "Hello world!"}], stream=False)
```

```python
# Асинхронное создание результата (пример)
result = await provider.create_async(model='gpt-3.5-turbo', messages=[{"role": "user", "content": "Hello world!"}], timeout=30)
# Модуль для работы с куки

## Обзор

Модуль предоставляет функции для работы с куки-файлами различных браузеров. 

## Подробнее

Модуль `cookies.py` предоставляет функции для получения и установки куки-файлов для различных веб-сайтов. 
Он использует библиотеку `browser_cookie3` для извлечения куки-файлов из браузера, 
а также позволяет читать куки из HAR-файлов и JSON-файлов. 
Куки-файлы хранятся в кэше, чтобы избежать повторного поиска.

## Классы

### `CookiesConfig`

**Описание**:  Класс конфигурации для управления куки.

**Атрибуты**:

- `cookies` (Dict[str, Cookies]): Словарь, хранящий куки-файлы для разных доменов.

- `cookies_dir` (str): Путь к директории, где хранятся HAR-файлы и JSON-файлы с куки. 

## Функции

### `get_cookies`

**Назначение**:  Возвращает куки-файлы для заданного домена.

**Параметры**:

- `domain_name` (str): Домен, для которого нужно получить куки.

- `raise_requirements_error` (bool):  Если `True` и отсутствует `browser_cookie3`, 
   выбрасывает исключение `MissingRequirementsError`. По умолчанию `True`.

- `single_browser` (bool): Если `True`, возвращает куки из первого браузера, 
   где они найдены. По умолчанию `False`.

- `cache_result` (bool): Если `True`, кэширует результат. По умолчанию `True`.

**Возвращает**:

- `Dict[str, str]`: Словарь с куки-файлами, где ключ - имя куки, а значение - её значение.

**Как работает**:

- Функция сначала проверяет наличие куки-файлов в кэше.
- Если куки-файлы не найдены в кэше, функция использует функцию `load_cookies_from_browsers` 
   для загрузки куки-файлов из браузеров.
- В случае успешной загрузки куки-файлов, они кэшируются.

**Примеры**:

```python
>>> get_cookies("www.google.com")
{'__utma': '...', '__utmb': '...', '__utmc': '...'}
```

### `set_cookies`

**Назначение**: Устанавливает куки-файлы для заданного домена.

**Параметры**:

- `domain_name` (str): Домен, для которого нужно установить куки.

- `cookies` (Cookies): Словарь с куки-файлами, где ключ - имя куки, а значение - её значение.

**Возвращает**:

- `None`

**Как работает**:

- Функция сохраняет куки-файлы в кэше.
- Если `cookies` не заданы, удаляет куки-файлы для заданного домена из кэша.

**Примеры**:

```python
>>> set_cookies("www.google.com", {"__utma": "1234567890", "__utmb": "9876543210"})
```

### `load_cookies_from_browsers`

**Назначение**:  Загружает куки-файлы из различных браузеров.

**Параметры**:

- `domain_name` (str): Домен, для которого нужно получить куки.

- `raise_requirements_error` (bool):  Если `True` и отсутствует `browser_cookie3`, 
   выбрасывает исключение `MissingRequirementsError`. По умолчанию `True`.

- `single_browser` (bool): Если `True`, возвращает куки из первого браузера, 
   где они найдены. По умолчанию `False`.

**Возвращает**:

- `Cookies`: Словарь с куки-файлами, где ключ - имя куки, а значение - её значение.

**Как работает**:

- Функция проверяет наличие библиотеки `browser_cookie3`.
- В цикле перебирает список поддерживаемых браузеров.
- Для каждого браузера функция пытается получить куки-файлы, используя соответствующую функцию из `browser_cookie3`.
- Если куки-файлы найдены, они добавляются в словарь `cookies`.
- Если `single_browser` установлен в `True`, функция прекращает работу после первой успешной загрузки куки.

**Примеры**:

```python
>>> load_cookies_from_browsers("www.google.com")
{'__utma': '...', '__utmb': '...', '__utmc': '...'}
```

### `set_cookies_dir`

**Назначение**: Устанавливает директорию для чтения куки-файлов из HAR-файлов и JSON-файлов.

**Параметры**:

- `dir` (str): Путь к директории.

**Возвращает**:

- `None`

**Примеры**:

```python
>>> set_cookies_dir("./har_and_cookies")
```

### `get_cookies_dir`

**Назначение**: Возвращает путь к директории для чтения куки-файлов из HAR-файлов и JSON-файлов.

**Параметры**:

- Нет

**Возвращает**:

- `str`: Путь к директории.

**Примеры**:

```python
>>> get_cookies_dir()
'./har_and_cookies'
```

### `read_cookie_files`

**Назначение**: Читает куки-файлы из HAR-файлов и JSON-файлов.

**Параметры**:

- `dirPath` (str, optional):  Путь к директории с файлами. 
    По умолчанию использует значение `CookiesConfig.cookies_dir`.

**Возвращает**:

- `None`

**Как работает**:

- Функция перебирает все файлы в заданной директории.
- Для каждого файла с расширением `.har` или `.json` функция пытается считать данные 
   с помощью `json.load`.
- Для HAR-файлов функция извлекает домен из заголовка `Host` или `:authority` 
   и куки-файлы из объекта `request.cookies`.
- Для JSON-файлов функция проверяет, что файл содержит список объектов 
   с ключом `domain` и значениями `name` и `value`.
- Куки-файлы, извлеченные из файлов, добавляются в словарь `CookiesConfig.cookies`.

**Примеры**:

```python
>>> read_cookie_files("./har_and_cookies")
```

## Внутренние функции

### `get_domain`

**Назначение**: Извлекает домен из заголовка `Host` или `:authority`.

**Параметры**:

- `v` (dict): Объект, содержащий информацию о запросе.

**Возвращает**:

- `str`:  Домен, если он найден, иначе `None`.

**Как работает**:

- Функция получает значение `Host` или `:authority` из заголовков запроса.
- Она проверяет, содержится ли в этом значении один из доменов из списка `DOMAINS`.
- Если домен найден, функция возвращает его.

**Примеры**:

```python
>>> v = {'request': {'headers': [{'name': 'Host', 'value': 'www.google.com'}]}}
>>> get_domain(v)
'www.google.com'
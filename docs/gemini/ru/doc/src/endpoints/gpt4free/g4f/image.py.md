# Модуль для обработки изображений

## Обзор

Данный модуль предоставляет функции для работы с изображениями, включая:

- Преобразование различных типов изображений в объекты PIL Image.
- Проверку расширений файлов изображений.
- Проверку, является ли данная строка data URI изображением.
- Проверку, является ли данные в двоичном формате изображением с допустимым форматом.
- Извлечение двоичных данных из data URI.
- Получение ориентации изображения.
- Обработка изображений, включая регулировку ориентации и изменение размера.
- Преобразование изображения в байты.
- Преобразование изображения в data URI.
- Класс ImageDataResponse для хранения информации об изображениях.
- Класс ImageRequest для хранения опций запроса изображения.

## Подробей

Модуль предназначен для обработки изображений в различных форматах, включая преобразование их в объекты PIL Image, проверку расширений файлов, извлечение данных из data URI и другие полезные операции. Он используется для работы с изображениями в различных сценариях, таких как загрузка изображений, их преобразование, создание data URI и т. д.

## Классы

### `ImageDataResponse`

**Описание**: Класс для хранения информации об изображениях, полученных из внешних источников.

**Атрибуты**:

- `images` (Union[str, list]): Список или строка с изображениями.
- `alt` (str): Альтернативный текст для изображения.

**Методы**:

- `get_list() -> list[str]`: Возвращает список изображений.

### `ImageRequest`

**Описание**: Класс для хранения опций запроса изображения.

**Атрибуты**:

- `options` (dict): Словарь с опциями запроса.

**Методы**:

- `get(key: str)`: Возвращает значение по ключу из опций запроса.

## Функции

### `to_image(image: ImageType, is_svg: bool = False) -> Image`

**Назначение**: Преобразует изображение в объект PIL Image.

**Параметры**:

- `image` (Union[str, bytes, Image]): Изображение в виде строки, байтов или объекта PIL Image.
- `is_svg` (bool, optional): Флаг, указывающий, является ли изображение SVG. По умолчанию `False`.

**Возвращает**:

- `Image`: Объект PIL Image.

**Вызывает исключения**:

- `MissingRequirementsError`: Если отсутствуют необходимые библиотеки для обработки изображений.

**Как работает функция**:

Функция проверяет тип входных данных и преобразует их в объект PIL Image. Если изображение представлено data URI, она извлекает данные из URI. Если изображение SVG, она использует библиотеку `cairosvg` для преобразования SVG в PNG. В остальных случаях она просто загружает изображение.

**Примеры**:

```python
>>> from g4f.image import to_image
>>> image = to_image("path/to/image.jpg")
>>> image = to_image(b"binary_image_data")
>>> image = to_image("data:image/png;base64,...")
```

### `is_allowed_extension(filename: str) -> bool`

**Назначение**: Проверяет, является ли расширение файла изображения допустимым.

**Параметры**:

- `filename` (str): Имя файла.

**Возвращает**:

- `bool`: True, если расширение файла допустимо, False в противном случае.

**Как работает функция**:

Функция проверяет, содержит ли имя файла точку (`.`) и если да, то проверяет, является ли расширение файла (часть после последней точки) допустимым, сравнивая его с набором разрешенных расширений.

**Примеры**:

```python
>>> from g4f.image import is_allowed_extension
>>> is_allowed_extension("image.jpg")
True
>>> is_allowed_extension("document.txt")
False
```

### `is_data_uri_an_image(data_uri: str) -> bool`

**Назначение**: Проверяет, является ли данная строка data URI изображением.

**Параметры**:

- `data_uri` (str): Строка data URI.

**Возвращает**:

- `bool`: True, если data URI является изображением, False в противном случае.

**Вызывает исключения**:

- `ValueError`: Если data URI некорректен или формат изображения недопустим.

**Как работает функция**:

Функция проверяет, начинается ли строка data URI с `data:image/` и содержит ли она формат изображения (например, jpeg, png, gif). Затем она извлекает формат изображения из data URI и проверяет, является ли он одним из разрешенных форматов.

**Примеры**:

```python
>>> from g4f.image import is_data_uri_an_image
>>> is_data_uri_an_image("data:image/png;base64,...")
True
>>> is_data_uri_an_image("data:text/plain;base64,...")
False
```

### `is_accepted_format(binary_data: bytes) -> str`

**Назначение**: Проверяет, является ли данные в двоичном формате изображением с допустимым форматом.

**Параметры**:

- `binary_data` (bytes): Данные в двоичном формате.

**Возвращает**:

- `str`: MIME-тип изображения (например, "image/jpeg") или `None` в случае ошибки.

**Вызывает исключения**:

- `ValueError`: Если формат изображения недопустим.

**Как работает функция**:

Функция анализирует первые несколько байтов данных и сравнивает их с "magic numbers" для различных форматов изображений (JPEG, PNG, GIF, WebP). Если совпадение найдено, она возвращает соответствующий MIME-тип изображения.

**Примеры**:

```python
>>> from g4f.image import is_accepted_format
>>> is_accepted_format(b"\xFF\xD8\xFF")
"image/jpeg"
>>> is_accepted_format(b"\x89PNG\r\n\x1a\n")
"image/png"
```

### `extract_data_uri(data_uri: str) -> bytes`

**Назначение**: Извлекает двоичные данные из data URI.

**Параметры**:

- `data_uri` (str): Строка data URI.

**Возвращает**:

- `bytes`: Извлеченные двоичные данные.

**Как работает функция**:

Функция разделяет строку data URI по запятой (`,`) и берет последнюю часть, которая содержит закодированные данные в Base64. Затем она декодирует данные из Base64 и возвращает их в виде байтов.

**Примеры**:

```python
>>> from g4f.image import extract_data_uri
>>> data_uri = "data:image/png;base64,...".split(",")[-1]
>>> binary_data = extract_data_uri(data_uri)
```

### `get_orientation(image: Image) -> int`

**Назначение**: Получает ориентацию изображения.

**Параметры**:

- `image` (Image): Объект PIL Image.

**Возвращает**:

- `int`: Значение ориентации.

**Как работает функция**:

Функция пытается получить данные EXIF из изображения. Если данные EXIF доступны, она извлекает значение тега ориентации (274) и возвращает его.

**Примеры**:

```python
>>> from g4f.image import get_orientation
>>> image = open_image("path/to/image.jpg")
>>> orientation = get_orientation(image)
```

### `process_image(image: Image, new_width: int, new_height: int) -> Image`

**Назначение**: Обрабатывает изображение, регулируя его ориентацию и изменяя размер.

**Параметры**:

- `image` (Image): Объект PIL Image.
- `new_width` (int): Новая ширина изображения.
- `new_height` (int): Новая высота изображения.

**Возвращает**:

- `Image`: Обработанное изображение.

**Как работает функция**:

Функция сначала регулирует ориентацию изображения на основе данных EXIF. Затем она изменяет размер изображения до указанных ширины и высоты, сохраняя пропорции. Если изображение имеет прозрачность (RGBA), она удаляет прозрачность, заменяя ее белым цветом. В случае, если режим изображения отличается от RGB, она преобразует его в RGB для формата JPG.

**Примеры**:

```python
>>> from g4f.image import process_image
>>> image = open_image("path/to/image.jpg")
>>> processed_image = process_image(image, 200, 150)
```

### `to_bytes(image: ImageType) -> bytes`

**Назначение**: Преобразует изображение в байты.

**Параметры**:

- `image` (ImageType): Изображение в виде строки, байтов, объекта PIL Image или объекта `io.BytesIO`.

**Возвращает**:

- `bytes`: Изображение в виде байтов.

**Как работает функция**:

Функция проверяет тип входных данных и преобразует их в байты. Если изображение представлено data URI, она извлекает данные из URI. Если изображение является объектом PIL Image, она сохраняет его в объект `io.BytesIO` в выбранном формате. В случае, если изображение представлено в виде строки или `Path`, она считывает его из файла.

**Примеры**:

```python
>>> from g4f.image import to_bytes
>>> image = open_image("path/to/image.jpg")
>>> image_bytes = to_bytes(image)
>>> image_bytes = to_bytes("path/to/image.jpg")
>>> image_bytes = to_bytes("data:image/png;base64,...")
```

### `to_data_uri(image: ImageType) -> str`

**Назначение**: Преобразует изображение в data URI.

**Параметры**:

- `image` (ImageType): Изображение в виде строки, байтов, объекта PIL Image или объекта `io.BytesIO`.

**Возвращает**:

- `str`: Строка data URI.

**Как работает функция**:

Функция проверяет, является ли изображение строкой data URI. Если нет, она преобразует изображение в байты, кодирует данные в Base64 и формирует строку data URI.

**Примеры**:

```python
>>> from g4f.image import to_data_uri
>>> image = open_image("path/to/image.jpg")
>>> data_uri = to_data_uri(image)
>>> data_uri = to_data_uri("path/to/image.jpg")
```

### `generate_image_from_text(text: str, options: Optional[dict] = None) -> str:`
**Назначение**:  Генерирует изображения с помощью GPT-4-модели

**Параметры**:

- `text` (str): Текстовый запрос для генерации изображения.
- `options` (Optional[dict], optional): Дополнительные опции для генерации изображений. По умолчанию `None`.

**Возвращает**:

- `str`: data: URI изображения.

**Вызывает исключения**:

- `Exception`:  Если возникает ошибка при генерации изображения.

**Пример**:

```python
>>> from g4f.image import generate_image_from_text
>>> image_data_uri = generate_image_from_text("кошка на луне", options={"size":"1024x1024"})
>>> print(image_data_uri)
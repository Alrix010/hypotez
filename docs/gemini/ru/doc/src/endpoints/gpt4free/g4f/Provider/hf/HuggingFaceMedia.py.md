# HuggingFaceMedia

## Обзор

Модуль `HuggingFaceMedia` предоставляет функциональность для генерации изображений и видео с использованием моделей машинного обучения, размещенных на платформе Hugging Face. Модуль позволяет взаимодействовать с различными провайдерами модели, поддерживающими задачи генерации изображений и видео, и обеспечивает удобный интерфейс для работы с ними.

## Подробнее

Модуль предоставляет класс `HuggingFaceMedia`, который наследует от `AsyncGeneratorProvider` и `ProviderModelMixin`. Класс `HuggingFaceMedia` реализует логику взаимодействия с API Hugging Face для получения моделей, генерации изображений и видео.

## Классы

### `class HuggingFaceMedia`

**Описание**: Класс `HuggingFaceMedia` реализует функциональность для взаимодействия с моделями Hugging Face, которые способны генерировать изображения и видео.

**Наследует**: 
 - `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию результатов, возвращая значения по одному.
 - `ProviderModelMixin`: Предоставляет базовые методы для работы с моделями.

**Атрибуты**:
 - `label` (str): Метка провайдера ("HuggingFace (Image/Video Generation)").
 - `parent` (str): Родительский провайдер ("HuggingFace").
 - `url` (str): Основной URL провайдера ("https://huggingface.co").
 - `working` (bool): Флаг, указывающий на доступность провайдера (True).
 - `needs_auth` (bool): Флаг, указывающий на необходимость авторизации (True).
 - `tasks` (list[str]): Список поддерживаемых задач ("text-to-image", "text-to-video").
 - `provider_mapping` (dict[str, dict]): Словарь, хранящий информацию о доступных провайдерах для каждой модели.
 - `task_mapping` (dict[str, str]): Словарь, отображающий модели в соответствующие задачи.
 - `models` (list[str]): Список поддерживаемых моделей.
 - `image_models` (list[str]): Список моделей для генерации изображений.
 - `video_models` (list[str]): Список моделей для генерации видео.

**Методы**:
 - `get_models(**kwargs) -> list[str]`: Возвращает список поддерживаемых моделей.
 - `get_mapping(model: str, api_key: str = None) -> dict`: Возвращает словарь с информацией о доступных провайдерах для заданной модели.
 - `create_async_generator(**kwargs) -> AsyncGenerator`: Создает асинхронный генератор для генерации изображений или видео.

#### `get_models(**kwargs) -> list[str]`

**Назначение**: Извлекает список поддерживаемых моделей Hugging Face из API.

**Параметры**: 
 - `**kwargs`: Дополнительные аргументы (не используются в данном методе).

**Возвращает**: 
 - `list[str]`: Список поддерживаемых моделей.

**Как работает функция**:
 - Получает список моделей из API Hugging Face.
 - Фильтрует модели, основываясь на типе задачи (генерация изображений или видео) и статусе доступности.
 - Отбирает модели, поддерживающие задачи "text-to-image" и "text-to-video", и доступные для использования ("live" статус).
 - Сортирует список моделей, помещая модели для генерации видео в начало.
 - Сохраняет список моделей в атрибутах `models`, `image_models` и `video_models` класса `HuggingFaceMedia`.

#### `get_mapping(model: str, api_key: str = None) -> dict`:

**Назначение**: Получает список доступных провайдеров для указанной модели Hugging Face.

**Параметры**: 
 - `model` (str): Идентификатор модели.
 - `api_key` (str, optional): Ключ API для авторизации. По умолчанию None.

**Возвращает**: 
 - `dict`: Словарь, содержащий информацию о доступных провайдерах для модели.

**Как работает функция**:
 - Проверяет, существует ли информация о модели в кэше `provider_mapping`.
 - Если информация о модели не найдена, то запрашивает ее из API Hugging Face.
 - Сохраняет информацию о модели в кэше `provider_mapping`.
 - Возвращает словарь с информацией о доступных провайдерах.

#### `create_async_generator(**kwargs) -> AsyncGenerator`:

**Назначение**: Создает асинхронный генератор для генерации изображений или видео с использованием выбранной модели Hugging Face.

**Параметры**: 
 - `model` (str): Идентификатор модели.
 - `messages` (Messages): Объект, содержащий сообщения для генерации.
 - `api_key` (str, optional): Ключ API для авторизации. По умолчанию None.
 - `extra_data` (dict, optional): Дополнительные параметры для генерации. По умолчанию пустой словарь.
 - `prompt` (str, optional): Текстовый запрос для генерации. По умолчанию None.
 - `proxy` (str, optional): Прокси-сервер для запросов. По умолчанию None.
 - `timeout` (int, optional): Тайм-аут для запросов. По умолчанию 0.
 - `n` (int, optional): Количество генераций. По умолчанию 1.
 - `aspect_ratio` (str, optional): Соотношение сторон для генерации. По умолчанию None.
 - `height` (int, optional): Высота изображения для генерации. По умолчанию None.
 - `width` (int, optional): Ширина изображения для генерации. По умолчанию None.
 - `resolution` (str, optional): Разрешение видео для генерации. По умолчанию "480p".
 - `**kwargs`: Дополнительные аргументы.

**Возвращает**: 
 - `AsyncGenerator`: Асинхронный генератор, который возвращает информацию о провайдере и результат генерации.

**Как работает функция**:
 - Выбирает модель для генерации.
 - Получает список доступных провайдеров для модели.
 - Создает асинхронную функцию `generate`, которая выполняет генерацию с использованием выбранного провайдера.
 - Запускает асинхронные задачи для генерации.
 - Возвращает асинхронный генератор, который по очереди возвращает информацию о провайдере и результат генерации.

**Внутренние функции**:

#### `generate(extra_data: dict, aspect_ratio: str = None)`

**Назначение**: Выполняет генерацию изображения или видео с использованием выбранного провайдера.

**Параметры**: 
 - `extra_data` (dict): Дополнительные параметры для генерации.
 - `aspect_ratio` (str, optional): Соотношение сторон для генерации.

**Возвращает**: 
 - `tuple[ProviderInfo, ImageResponse | VideoResponse | None]`: Информация о провайдере и результат генерации.

**Как работает функция**:
 - Проходит по списку доступных провайдеров.
 - Выбирает провайдера, соответствующего заданному типу модели.
 - Формирует URL запроса и данные для генерации.
 - Выполняет запрос к API провайдера.
 - Обрабатывает ответ от API и возвращает результат генерации.

## Примеры

### Создание инстанса класса `HuggingFaceMedia`:

```python
from hypotez.src.endpoints.gpt4free.g4f.Provider.hf import HuggingFaceMedia

# Создание объекта HuggingFaceMedia
hf_media = HuggingFaceMedia()

# Получение списка доступных моделей
models = hf_media.get_models()

# Вывод списка моделей
print(f"Список доступных моделей: {models}")

# Получение информации о модели
model_info = hf_media.get_mapping("CompVis/stable-diffusion-v1-4")

# Вывод информации о модели
print(f"Информация о модели: {model_info}")

# Создание асинхронного генератора для генерации изображения
async_generator = hf_media.create_async_generator(
    model="CompVis/stable-diffusion-v1-4",
    messages=["Generate a picture of a cute cat"],
)

# Использование асинхронного генератора
async for item in async_generator:
    print(item)
# Модуль `raise_for_status`

## Обзор

Модуль `raise_for_status` содержит функцию `raise_for_status`, которая проверяет статус ответа от сервера и генерирует исключение `ResponseStatusError`, если статус ответа не является успешным (код ответа не равен 200). 

## Подробней

Данная функция используется в модуле `requests` для обработки ошибок ответа от сервера. Она анализирует статус ответа и возвращает соответствующее исключение. 

## Функции

### `raise_for_status`

**Назначение**:  Проверяет статус ответа и генерирует исключение, если статус ответа не является успешным. 

**Параметры**:

- `response` (Union[StreamResponse, ClientResponse]): Объект ответа, который был получен от сервера.
- `message` (str): Дополнительное сообщение об ошибке. По умолчанию `None`.

**Возвращает**:

- `None`: Возвращает `None`, если статус ответа является успешным.

**Вызывает исключения**:

- `ResponseStatusError`: Если статус ответа не является успешным.

**Как работает функция**:

- Проверяет статус ответа `response.ok`. 
- Если статус не `ok`, функция извлекает тип контента ответа (`content_type`) и пытается преобразовать ответ в JSON (`response.json()`). 
- Если преобразование в JSON успешно, функция извлекает сообщение об ошибке из JSON (`data.get("error", data.get("message", message))`).
- Если преобразование в JSON неудачно, функция извлекает текст ответа (`response.text()`). 
- На основе полученного сообщения об ошибке или текста ответа, функция генерирует исключение `ResponseStatusError` с описанием ошибки. 

**Примеры**:

```python
# Пример вызова с успешным ответом
response = StreamResponse(status=200, ok=True)
raise_for_status(response) # Не будет генерировать исключение

# Пример вызова с ошибочным ответом
response = StreamResponse(status=400, ok=False)
try:
    raise_for_status(response) 
except ResponseStatusError as ex:
    print(ex) # Выведет ошибку "Response 400: "

# Пример вызова с ответом в JSON
response = StreamResponse(status=400, ok=False, headers={"content-type": "application/json"}, text='{"error": "Invalid request"}')
try:
    raise_for_status(response) 
except ResponseStatusError as ex:
    print(ex) # Выведет ошибку "Response 400: Invalid request"
```

**Внутренние функции**: 

- Нет.

**Дополнительные замечания**:

- Функция `raise_for_status` является частью модуля `requests` и используется для обработки ошибок ответа от сервера. 
- Эта функция гарантирует, что код не будет продолжать выполняться, если статус ответа не является успешным.
- Функция `raise_for_status` является полезным инструментом для разработки, так как она позволяет быстро обнаружить ошибки в коде, связанные с ответами от сервера.
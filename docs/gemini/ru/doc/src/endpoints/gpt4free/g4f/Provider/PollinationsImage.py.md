# Документация модуля `PollinationsImage.py`

## Обзор

Модуль `PollinationsImage.py` расширяет функциональность класса `PollinationsAI` для генерации изображений с использованием сервиса Pollinations AI. Он предоставляет возможность выбора модели для генерации изображений, а также настройки различных параметров, таких как соотношение сторон, размеры изображения и другие параметры.

## Подробней

Этот модуль является частью системы, отвечающей за взаимодействие с различными AI-моделями для генерации контента, в частности изображений. Он позволяет пользователям создавать изображения на основе текстовых запросов, используя различные модели и параметры. Модуль предназначен для асинхронной работы, что позволяет эффективно обрабатывать запросы на генерацию изображений.

## Классы

### `PollinationsImage`

**Описание**: Класс `PollinationsImage` предназначен для генерации изображений с использованием API Pollinations AI. Он наследует функциональность от класса `PollinationsAI` и добавляет специфические параметры и методы для работы с изображениями.

**Наследует**:

- `PollinationsAI`: Класс, предоставляющий базовую функциональность для взаимодействия с API Pollinations AI.

**Атрибуты**:

- `label` (str): Метка, идентифицирующая провайдера изображений (`"PollinationsImage"`).
- `default_model` (str): Модель, используемая по умолчанию для генерации изображений (`"flux"`).
- `default_vision_model` (None): Модель, используемая по умолчанию для обработки изображений (в данном случае `None`).
- `default_image_model` (str): Модель изображения по умолчанию, имеет значение `default_model` (`"flux"`).
- `image_models` (list[str]): Список моделей, доступных для генерации изображений, содержащий `default_image_model`.
- `_models_loaded` (bool): Флаг, указывающий, были ли загружены модели (изначально `False`).

**Методы**:
- `get_models()`: Получает список доступных моделей для генерации изображений.
- `create_async_generator()`: Создает асинхронный генератор для создания изображений на основе заданных параметров.

## Методы класса

### `get_models`

```python
@classmethod
def get_models(cls, **kwargs):
    """
    Получает список доступных моделей для генерации изображений.

    Args:
        **kwargs: Дополнительные аргументы.

    Returns:
        list[str]: Список доступных моделей изображений.
    """
    ...
```

**Назначение**: Метод `get_models` используется для получения списка доступных моделей для генерации изображений. Он проверяет, были ли уже загружены модели, и если нет, то загружает их, объединяя модели из родительского класса (`PollinationsAI`) и дополнительные модели, специфичные для `PollinationsImage`.

**Как работает функция**:

1. Проверяет, загружены ли модели (`cls._models_loaded`).
2. Если модели не загружены, вызывает метод `get_models` родительского класса (`super().get_models()`).
3. Объединяет списки моделей из `cls.image_models`, `PollinationsAI.image_models` и `cls.extra_image_models`, удаляя дубликаты.
4. Обновляет `cls.image_models` объединенным списком моделей.
5. Устанавливает флаг `cls._models_loaded` в `True`.
6. Возвращает список доступных моделей изображений (`cls.image_models`).

**Примеры**:

```python
models = PollinationsImage.get_models()
print(models)
```

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    prompt: str = None,
    aspect_ratio: str = "1:1",
    width: int = None,
    height: int = None,
    seed: Optional[int] = None,
    cache: bool = False,
    nologo: bool = True,
    private: bool = False,
    enhance: bool = False,
    safe: bool = False,
    n: int = 4,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для создания изображений на основе заданных параметров.

    Args:
        model (str): Модель для генерации изображения.
        messages (Messages): Сообщения, используемые для формирования запроса.
        proxy (str, optional): Прокси-сервер для выполнения запроса. По умолчанию `None`.
        prompt (str, optional): Дополнительный текст запроса. По умолчанию `None`.
        aspect_ratio (str, optional): Соотношение сторон изображения. По умолчанию `"1:1"`.
        width (int, optional): Ширина изображения. По умолчанию `None`.
        height (int, optional): Высота изображения. По умолчанию `None`.
        seed (Optional[int], optional): Зерно для генерации случайных чисел. По умолчанию `None`.
        cache (bool, optional): Использовать кэш. По умолчанию `False`.
        nologo (bool, optional): Удалять логотип. По умолчанию `True`.
        private (bool, optional): Сделать изображение приватным. По умолчанию `False`.
        enhance (bool, optional): Улучшить качество изображения. По умолчанию `False`.
        safe (bool, optional): Включить безопасный режим. По умолчанию `False`.
        n (int, optional): Количество генерируемых изображений. По умолчанию `4`.
        **kwargs: Дополнительные аргументы.

    Yields:
        AsyncResult: Части результата генерации изображения.
    """
    ...
```

**Назначение**: Метод `create_async_generator` создает асинхронный генератор для генерации изображений на основе заданных параметров. Он использует модель, текстовые сообщения и различные параметры для формирования запроса к API Pollinations AI и возвращает результат в виде асинхронного генератора.

**Как работает функция**:

1. Вызывает метод `get_models` для обновления списка доступных моделей.
2. Использует асинхронный генератор `cls._generate_image` для получения чанков изображения.
3. Формирует запрос с использованием функции `format_image_prompt` для объединения сообщений и текста запроса.
4. Передает параметры, такие как модель, прокси, соотношение сторон, размеры изображения, зерно, настройки кэша, логотипа, приватности, улучшения качества и безопасного режима.
5. Возвращает асинхронный генератор, который выдает чанки изображения.

**Примеры**:

```python
messages = [{"role": "user", "content": "A cat wearing a hat"}]
async for chunk in PollinationsImage.create_async_generator(model="flux", messages=messages):
    print(chunk)
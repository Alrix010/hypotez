# Модуль `PollinationsImage`

## Обзор

Модуль `PollinationsImage` предоставляет класс `PollinationsImage`, который является подклассом `PollinationsAI` и предназначен для генерации изображений с использованием моделей Pollinations AI. Этот модуль позволяет асинхронно генерировать изображения на основе текстовых запросов.

## Подробней

Модуль расширяет функциональность базового класса `PollinationsAI`, добавляя специфические параметры и логику для работы с моделями генерации изображений. Он также включает механизм кэширования моделей и асинхронную генерацию изображений.

## Классы

### `PollinationsImage`

**Описание**: Класс для работы с моделями Pollinations AI для генерации изображений.

**Наследует**: `PollinationsAI`

**Атрибуты**:
- `label` (str): Метка класса, определяющая используемый провайдер ("PollinationsImage").
- `default_model` (str): Модель, используемая по умолчанию ("flux").
- `default_vision_model` (None): Модель vision, используемая по умолчанию (None).
- `default_image_model` (str): Модель генерации изображений по умолчанию, соответствующая `default_model` ("flux").
- `image_models` (list[str]): Список поддерживаемых моделей для генерации изображений, включающий `default_image_model`.
- `_models_loaded` (bool): Флаг, указывающий, были ли загружены модели (изначально `False`).

**Методы**:
- `get_models()`: Возвращает список доступных моделей изображений, загружая их при необходимости.
- `create_async_generator()`: Создает асинхронный генератор для создания изображений на основе запроса.

## Методы класса

### `get_models`

```python
    @classmethod
    def get_models(cls, **kwargs):
        """
        Получает список доступных моделей изображений, загружая их при необходимости.
        Args:
            **kwargs: Дополнительные параметры.

        Returns:
            list[str]: Список доступных моделей изображений.
        """
```

**Назначение**:
Функция получает список доступных моделей изображений. Если модели еще не были загружены, она вызывает метод `get_models()` родительского класса (`PollinationsAI`) для их загрузки, объединяет модели из родительского класса с моделями текущего класса и устанавливает флаг `_models_loaded` в `True`, чтобы избежать повторной загрузки моделей.

**Как работает функция**:

1. Проверяет, загружены ли модели, используя атрибут класса `_models_loaded`.
2. Если `_models_loaded` равен `False`, выполняет следующие шаги:
   - Вызывает метод `get_models()` родительского класса (`PollinationsAI`) для загрузки моделей.
   - Объединяет модели текущего класса (`cls.image_models`), модели родительского класса (`PollinationsAI.image_models`) и дополнительные модели (`cls.extra_image_models`) в один список, удаляя дубликаты с помощью `dict.fromkeys()`.
   - Присваивает полученный список атрибуту `cls.image_models`.
   - Устанавливает `cls._models_loaded` в `True`, чтобы указать, что модели были загружены.
3. Возвращает список доступных моделей изображений (`cls.image_models`).

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        prompt: str = None,
        aspect_ratio: str = "1:1",
        width: int = None,
        height: int = None,
        seed: Optional[int] = None,
        cache: bool = False,
        nologo: bool = True,
        private: bool = False,
        enhance: bool = False,
        safe: bool = False,
        n: int = 4,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для создания изображений на основе запроса.

        Args:
            model (str): Модель для генерации изображения.
            messages (Messages): Список сообщений для формирования запроса.
            proxy (str, optional): Прокси-сервер для выполнения запроса. По умолчанию `None`.
            prompt (str, optional): Дополнительный текст запроса. По умолчанию `None`.
            aspect_ratio (str, optional): Соотношение сторон изображения. По умолчанию "1:1".
            width (int, optional): Ширина изображения. По умолчанию `None`.
            height (int, optional): Высота изображения. По умолчанию `None`.
            seed (Optional[int], optional): Зерно для генерации изображения. По умолчанию `None`.
            cache (bool, optional): Использовать кэш. По умолчанию `False`.
            nologo (bool, optional): Не добавлять логотип. По умолчанию `True`.
            private (bool, optional): Приватный режим. По умолчанию `False`.
            enhance (bool, optional): Улучшить изображение. По умолчанию `False`.
            safe (bool, optional): Безопасный режим. По умолчанию `False`.
            n (int, optional): Количество изображений для генерации. По умолчанию 4.
            **kwargs: Дополнительные параметры.

        Yields:
            AsyncResult: Части сгенерированного изображения.
        """
```

**Назначение**:
Функция создает асинхронный генератор, который генерирует изображения на основе предоставленных параметров, таких как модель, сообщения и прокси. Она вызывает функцию `_generate_image` для фактической генерации изображения и возвращает результат в виде асинхронного генератора.

**Как работает функция**:

1. Вызывает метод `get_models()` для обновления списка моделей.
2. Запускает асинхронный генератор, используя `cls._generate_image()` с переданными параметрами.
   - `model`: Модель для генерации изображения.
   - `prompt`: Форматированный запрос на основе сообщений и дополнительного текста.
   - `proxy`: Прокси-сервер для выполнения запроса.
   - `aspect_ratio`: Соотношение сторон изображения.
   - `width`: Ширина изображения.
   - `height`: Высота изображения.
   - `seed`: Зерно для генерации изображения.
   - `cache`: Использовать кэш.
   - `nologo`: Не добавлять логотип.
   - `private`: Приватный режим.
   - `enhance`: Улучшить изображение.
   - `safe`: Безопасный режим.
   - `n`: Количество изображений для генерации.
3. Передает каждый чанк (частичное изображение) из генератора `cls._generate_image()` через `yield`, что позволяет асинхронно получать результаты генерации изображения.
# Модуль Myshell

## Обзор

Модуль `Myshell` предоставляет асинхронный интерфейс для взаимодействия с сервисом Myshell AI. Он включает в себя функциональность для создания асинхронных генераторов, отправки сообщений и получения ответов от AI-моделей, таких как Samantha, GPT-3.5 Turbo и GPT-4. Модуль использует `aiohttp` для асинхронной коммуникации через WebSocket.

## Подробнее

Этот модуль предназначен для интеграции с платформой Myshell AI, предоставляя возможность использовать различные AI-модели для генерации текста. Он включает в себя функции для создания уникальных идентификаторов посетителей, генерации подписей для запросов и обработки потоковых ответов от сервера.

## Классы

### `Myshell`

**Описание**: Класс `Myshell` является провайдером асинхронного генератора для взаимодействия с API Myshell.

**Наследует**: `AsyncGeneratorProvider`

**Атрибуты**:
- `url` (str): URL для подключения к API Myshell.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели GPT-3.5 Turbo.
- `supports_gpt_4` (bool): Флаг, указывающий на поддержку модели GPT-4.

**Методы**:

- `create_async_generator(model: str, messages: Messages, proxy: str = None, timeout: int = 90, **kwargs) -> AsyncResult`: Создает асинхронный генератор для обмена сообщениями с Myshell AI.

## Методы класса

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        timeout: int = 90,
        **kwargs
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для обмена сообщениями с Myshell AI.

        Args:
            model (str): Название используемой модели (например, "samantha", "gpt-3.5-turbo", "gpt-4").
            messages (Messages): Список сообщений для отправки.
            proxy (str, optional): URL прокси-сервера. По умолчанию `None`.
            timeout (int, optional): Время ожидания ответа в секундах. По умолчанию 90.
            **kwargs: Дополнительные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, выдающий результаты от AI.

        Raises:
            ValueError: Если указанная модель не поддерживается.
            RuntimeError: Если получен неожиданный тип сообщения от сервера.

        Как работает функция:
        - Определяет ID бота на основе выбранной модели.
        - Генерирует уникальный идентификатор посетителя.
        - Устанавливает асинхронное соединение с WebSocket сервером Myshell AI.
        - Отправляет приветственное сообщение и информацию о посетителе.
        - Форматирует сообщения для чата и отправляет их на сервер.
        - Получает и обрабатывает ответы от сервера, выдавая текст в реальном времени через генератор.
        - Обрабатывает различные типы сообщений, включая текстовые потоки и сообщения об ошибках.
        """
        ...
```

**Параметры**:
- `model` (str): Название используемой модели (например, "samantha", "gpt-3.5-turbo", "gpt-4").
- `messages` (Messages): Список сообщений для отправки.
- `proxy` (str, optional): URL прокси-сервера. По умолчанию `None`.
- `timeout` (int, optional): Время ожидания ответа в секундах. По умолчанию 90.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий результаты от AI.

**Вызывает исключения**:
- `ValueError`: Если указанная модель не поддерживается.
- `RuntimeError`: Если получен неожиданный тип сообщения от сервера.

**Примеры**:

```python
# Пример использования create_async_generator
import asyncio
from src.endpoints.gpt4free.g4f.Provider.deprecated.Myshell import Myshell

async def main():
    model = "gpt-3.5-turbo"
    messages = [{"role": "user", "content": "Hello, how are you?"}]
    
    try:
        async for message in Myshell.create_async_generator(model=model, messages=messages):
            print(message, end="")
    except Exception as ex:
        print(f"Error: {ex}")

if __name__ == "__main__":
    asyncio.run(main())
```

## Функции

### `generate_timestamp`

```python
def generate_timestamp() -> str:
    """
    Генерирует временную метку, используемую для подписи запросов к API Myshell.

    Returns:
        str: Сгенерированная временная метка.

    Как работает функция:
    - Вычисляет текущее время в миллисекундах.
    - Добавляет контрольную цифру, основанную на сумме цифр времени, умноженных на разные коэффициенты.
    - Преобразует полученное значение в строку.
    """
    ...
```

**Возвращает**:
- `str`: Сгенерированная временная метка.

### `generate_signature`

```python
def generate_signature(text: str):
    """
    Генерирует подпись для запроса к API Myshell.

    Args:
        text (str): Текст запроса.

    Returns:
        dict: Словарь, содержащий подпись, временную метку и версию.

    Как работает функция:
    - Генерирует временную метку с помощью `generate_timestamp`.
    - Формирует строку данных для подписи, объединяя версию, текст, временную метку и секретный ключ.
    - Вычисляет MD5-хеш от полученной строки.
    - Переворачивает полученный хеш и возвращает его вместе с временной меткой и версией.
    """
    ...
```

**Параметры**:
- `text` (str): Текст запроса.

**Возвращает**:
- `dict`: Словарь, содержащий подпись, временную метку и версию.

### `xor_hash`

```python
def xor_hash(B: str):
    """
    Вычисляет XOR-хеш от строки.

    Args:
        B (str): Входная строка.

    Returns:
        str: XOR-хеш в шестнадцатеричном формате.

    Как работает функция:
    - Преобразует каждый символ входной строки в его ASCII-код.
    - Выполняет XOR-операцию над полученными значениями с использованием буфера и циклических сдвигов.
    - Возвращает результат в виде шестнадцатеричной строки.
    """
    ...
```

**Параметры**:
- `B` (str): Входная строка.

**Возвращает**:
- `str`: XOR-хеш в шестнадцатеричном формате.

### `performance`

```python
def performance() -> str:
    """
    Измеряет производительность, вычисляя количество итераций цикла, выполняемых за одну миллисекунду.

    Returns:
        str: Шестнадцатеричное представление времени и количества итераций.

    Как работает функция:
    - Измеряет время в миллисекундах.
    - Подсчитывает количество итераций цикла, выполняемых за это время.
    - Возвращает шестнадцатеричное представление времени и количества итераций.
    """
    ...
```

**Возвращает**:
- `str`: Шестнадцатеричное представление времени и количества итераций.

### `generate_visitor_id`

```python
def generate_visitor_id(user_agent: str) -> str:
    """
    Генерирует уникальный идентификатор посетителя на основе user-agent.

    Args:
        user_agent (str): User-agent строка браузера.

    Returns:
        str: Уникальный идентификатор посетителя.

    Как работает функция:
    - Вычисляет хеш производительности с помощью `performance`.
    - Генерирует случайное шестнадцатеричное число.
    - Вычисляет XOR-хеш user-agent с помощью `xor_hash`.
    - Формирует идентификатор, объединяя полученные значения.
    """
    ...
```

**Параметры**:
- `user_agent` (str): User-agent строка браузера.

**Возвращает**:
- `str`: Уникальный идентификатор посетителя.
# Модуль для работы с API GPT-4Free

## Обзор

Модуль `hypotez/src/endpoints/gpt4free/g4f/client/service.py` предоставляет набор функций для взаимодействия с API GPT-4Free (g4f)  с помощью клиента `service.py`.  Он включает в себя функции для выбора модели и провайдера, а также для обработки ошибок.

## Подробней

Этот модуль используется в `hypotez` для выбора подходящего провайдера и модели GPT-4Free в зависимости от заданных параметров.  Он позволяет выбрать провайдера, модель и  режим работы.

## Функции

### `convert_to_provider`

**Назначение**: Преобразует имя провайдера или список провайдеров в объект `ProviderType`.

**Параметры**:
- `provider` (str): Имя провайдера или список имен провайдеров, разделенных пробелами.

**Возвращает**:
- `ProviderType`: Объект `ProviderType`, представляющий провайдера или список провайдеров.

**Вызывает исключения**:
- `ProviderNotFoundError`: Если провайдер не найден.

**Как работает функция**:
- Функция принимает имя провайдера или список имен провайдеров.
- Если имя провайдера содержит пробелы, она интерпретирует его как список имен провайдеров.
- Функция проверяет, есть ли провайдеры в списке `ProviderUtils.convert`.
- Если провайдер не найден, функция генерирует исключение `ProviderNotFoundError`.
- В противном случае функция возвращает объект `ProviderType`, представляющий провайдера.

**Примеры**:
- `convert_to_provider("openai")` возвращает объект `ProviderType`, представляющий провайдера `OpenAI`.
- `convert_to_provider("openai gpt4all")` возвращает список объектов `ProviderType`, представляющих провайдеров `OpenAI` и `GPT4All`.

### `get_model_and_provider`

**Назначение**: Выбирает модель и провайдера GPT-4Free в зависимости от заданных параметров.

**Параметры**:
- `model` (Union[Model, str]): Модель, которую нужно использовать, как объект или строковый идентификатор.
- `provider` (Union[ProviderType, str, None]): Провайдер, которого нужно использовать, как объект, строковый идентификатор или `None`.
- `stream` (bool): Указывает, нужно ли выполнять операцию в режиме потоковой передачи.
- `ignore_working` (bool, optional): Если `True`, игнорирует статус работы провайдера.
- `ignore_stream` (bool, optional): Если `True`, игнорирует возможность потоковой передачи провайдера.
- `logging` (bool, optional): Если `True`, выводит логи.
- `has_images` (bool, optional): Если `True`, предполагается, что модель обрабатывает изображения.

**Возвращает**:
- tuple[str, ProviderType]: Кортеж, содержащий имя модели и тип провайдера.

**Вызывает исключения**:
- `ProviderNotFoundError`: Если провайдер не найден.
- `ModelNotFoundError`: Если модель не найдена.
- `ProviderNotWorkingError`: Если провайдер не работает.
- `StreamNotSupportedError`: Если провайдер не поддерживает режим потоковой передачи.

**Как работает функция**:
- Функция определяет модель и провайдера в зависимости от заданных параметров.
- Она проверяет, заданы ли модель и провайдер, а если нет, то выбирает их по умолчанию.
- Если провайдер не задан, но задана модель, она пытается найти провайдера, соответствующий модели.
- Если модель не задана, но задан провайдер, она пытается найти модель, соответствующую провайдеру.
- Функция проверяет, доступен ли провайдер, и поддерживает ли он режим потоковой передачи.
- Если провайдер не доступен или не поддерживает потоковую передачу, функция генерирует соответствующее исключение.
- В противном случае функция возвращает имя модели и тип провайдера.

**Примеры**:
- `get_model_and_provider("gpt-3.5-turbo", "openai", stream=True)` возвращает кортеж, содержащий `gpt-3.5-turbo` и объект `OpenAI`.
- `get_model_and_provider(None, "openai", stream=False)` возвращает кортеж, содержащий `text-davinci-003` и объект `OpenAI`.

### `get_last_provider`

**Назначение**: Возвращает последний использованный провайдер.

**Параметры**:
- `as_dict` (bool, optional): Если `True`, возвращает информацию о провайдере в виде словаря.

**Возвращает**:
- Union[ProviderType, dict[str, str]]: Последний использованный провайдер, как объект или словарь.

**Как работает функция**:
- Функция извлекает последний использованный провайдер из глобальной переменной `debug.last_provider`.
- Если провайдер является `BaseRetryProvider`, она извлекает последний провайдер из списка `provider.providers`.
- Если `as_dict` установлен в `True`, функция возвращает информацию о провайдере в виде словаря, включая имя, URL, модель и метку.
- В противном случае функция возвращает объект провайдера.

**Примеры**:
- `get_last_provider()` возвращает объект `ProviderType` последнего использованного провайдера.
- `get_last_provider(as_dict=True)` возвращает словарь, содержащий информацию о последнем использованном провайдере.

## Примеры использования

```python
# Выбор модели и провайдера по умолчанию
model, provider = get_model_and_provider(None, None, stream=False)
# Вывод имени модели и провайдера
print(f"Using {model} model and {provider.__name__} provider")

# Выбор модели по имени
model, provider = get_model_and_provider("gpt-3.5-turbo", None, stream=True)
# Вывод имени модели и провайдера
print(f"Using {model} model and {provider.__name__} provider")

# Выбор провайдера по имени
model, provider = get_model_and_provider(None, "openai", stream=False)
# Вывод имени модели и провайдера
print(f"Using {model} model and {provider.__name__} provider")

# Получение информации о последнем использованном провайдере в виде словаря
last_provider = get_last_provider(as_dict=True)
print(f"Last provider: {last_provider}")

# Получение информации о последнем использованном провайдере в виде объекта
last_provider = get_last_provider()
print(f"Last provider: {last_provider}")

# Вывод модели и провайдера, выбранных последним
print(f"Last model: {debug.last_model}")
print(f"Last provider: {debug.last_provider}")
```
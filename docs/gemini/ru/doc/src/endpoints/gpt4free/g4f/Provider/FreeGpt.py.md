# Модуль FreeGpt

## Обзор

Модуль `FreeGpt` предоставляет асинхронный генератор для взаимодействия с сервисом FreeGpt. Он поддерживает стриминг ответов, историю сообщений и системные сообщения. Модуль использует несколько доменов для обеспечения отказоустойчивости и включает механизмы обработки ошибок, такие как ограничение скорости запросов.

## Подробнее

Модуль предназначен для использования в асинхронных приложениях, требующих генерации текста на основе предоставленных сообщений. Он включает поддержку прокси и имеет настраиваемый таймаут.

## Классы

### `FreeGpt`

**Описание**: Класс `FreeGpt` является асинхронным провайдером генерации текста.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает базовую функциональность для асинхронных генераторов.
- `ProviderModelMixin`: Предоставляет функциональность для работы с моделями.

**Атрибуты**:
- `url` (str): URL для доступа к API FreeGpt.
- `working` (bool): Указывает, работает ли провайдер.
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений.
- `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения.
- `default_model` (str): Модель, используемая по умолчанию (`gemini-1.5-pro`).
- `models` (list): Список поддерживаемых моделей (`gemini-1.5-pro`, `gemini-1.5-flash`).

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения текстовых фрагментов.
- `_build_request_data`: Создает словарь с данными запроса.

## Методы класса

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: Optional[str] = None,
    timeout: int = 120,
    **kwargs: Any
) -> AsyncGenerator[str, None]:
    """Создает асинхронный генератор для получения текстовых фрагментов.

    Args:
        model (str): Используемая модель.
        messages (Messages): Список сообщений для отправки.
        proxy (Optional[str], optional): Прокси-сервер для использования. По умолчанию `None`.
        timeout (int, optional): Время ожидания запроса в секундах. По умолчанию 120.
        **kwargs (Any): Дополнительные аргументы.

    Returns:
        AsyncGenerator[str, None]: Асинхронный генератор текстовых фрагментов.

    Raises:
        RateLimitError: Если достигнут лимит запросов.

    Как работает функция:
    - Функция принимает модель, список сообщений, прокси и таймаут в качестве аргументов.
    - Извлекает последний элемент `content` из списка сообщений.
    - Генерирует timestamp.
    - Вызывает `_build_request_data` для построения данных запроса.
    - Выбирает случайный домен из списка `DOMAINS`.
    - Отправляет POST-запрос к API FreeGpt.
    - Перебирает полученные чанки данных и декодирует их.
    - Если встречается сообщение об ограничении скорости, вызывает исключение `RateLimitError`.
    - Возвращает асинхронный генератор, выдающий текстовые фрагменты.
    """
```

### `_build_request_data`

```python
@staticmethod
def _build_request_data(messages: Messages, prompt: str, timestamp: int, secret: str = "") -> Dict[str, Any]:
    """Создает словарь с данными запроса.

    Args:
        messages (Messages): Список сообщений.
        prompt (str): Текст запроса.
        timestamp (int): Временная метка.
        secret (str, optional): Секретный ключ. По умолчанию пустая строка.

    Returns:
        Dict[str, Any]: Словарь с данными запроса.

     Как работает функция:
    - Функция принимает список сообщений, текст запроса, временную метку и секретный ключ.
    - Формирует словарь, содержащий сообщения, временную метку, `pass` равный `None`, и сгенерированную подпись.
    - Возвращает сформированный словарь.
    """
```

## Функции

### `generate_signature`

```python
def generate_signature(timestamp: int, message: str, secret: str = "") -> str:
    """Генерирует подпись для запроса.

    Args:
        timestamp (int): Временная метка.
        message (str): Сообщение для подписи.
        secret (str, optional): Секретный ключ. По умолчанию пустая строка.

    Returns:
        str: Сгенерированная подпись.

     Как работает функция:
    - Функция принимает временную метку, сообщение и секретный ключ.
    - Формирует строку данных, объединяя timestamp, сообщение и секретный ключ через двоеточие.
    - Вычисляет SHA256-хеш от полученной строки.
    - Возвращает полученный хеш в виде шестнадцатеричной строки.
    """
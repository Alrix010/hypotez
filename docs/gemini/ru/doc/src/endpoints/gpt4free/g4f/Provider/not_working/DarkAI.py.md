# Модуль `DarkAI.py`

## Обзор

Модуль `DarkAI.py` предоставляет асинхронный интерфейс для взаимодействия с сервисом DarkAI. Он позволяет генерировать текст на основе предоставленных сообщений, используя различные модели, поддерживаемые DarkAI. Модуль поддерживает потоковую передачу данных, что позволяет получать результаты генерации текста по частям.

## Подробней

Модуль предназначен для использования в асинхронных приложениях, требующих генерации текста с использованием моделей DarkAI. Он включает в себя поддержку прокси-серверов и обработку ошибок при взаимодействии с API DarkAI.

## Классы

### `DarkAI`

**Описание**: Класс `DarkAI` является провайдером для асинхронной генерации текста с использованием API DarkAI. Он наследует функциональность от `AsyncGeneratorProvider` и `ProviderModelMixin`.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает базовую структуру для асинхронных провайдеров, генерирующих данные.
- `ProviderModelMixin`: Предоставляет методы для работы с моделями, такими как получение модели по имени или псевдониму.

**Атрибуты**:
- `url` (str): URL сервиса DarkAI.
- `api_endpoint` (str): URL API для взаимодействия с DarkAI.
- `working` (bool): Указывает, работает ли провайдер в данный момент.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных.
- `default_model` (str): Модель, используемая по умолчанию, если не указана другая.
- `models` (List[str]): Список поддерживаемых моделей.
- `model_aliases` (Dict[str, str]): Словарь псевдонимов моделей.

**Методы**:
- `create_async_generator()`: Создает асинхронный генератор для генерации текста на основе предоставленных сообщений.

## Методы класса

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для генерации текста на основе предоставленных сообщений.

    Args:
        cls (DarkAI): Ссылка на класс `DarkAI`.
        model (str): Название модели, которую необходимо использовать для генерации текста.
        messages (Messages): Список сообщений, используемых для формирования запроса.
        proxy (str, optional): URL прокси-сервера для использования при подключении к API. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий текст по частям.

    Raises:
        Exception: В случае ошибки при взаимодействии с API DarkAI.

    **Внутренние функции**:
        Отсутствуют.

    **Как работает функция**:
    1. Функция получает модель, используя метод `cls.get_model(model)`.
    2. Определяет заголовки запроса, включая `accept`, `content-type` и `user-agent`.
    3. Устанавливает `timeout` для `ClientSession`.
    4. Формирует `prompt` из списка сообщений, используя функцию `format_prompt(messages)`.
    5. Создает тело запроса `data` с `query` и `model`.
    6. Отправляет асинхронный POST-запрос к `cls.api_endpoint` с использованием `ClientSession`.
    7. Обрабатывает ответ от API, читая его по частям (chunks).
    8. Разделяет полученные данные на строки и декодирует их.
    9. Извлекает данные из JSON-формата, если строка начинается с `data: `.
    10. Если `event` имеет значение `text-chunk`, извлекает текст и передает его в генератор.
    11. Если `event` имеет значение `stream-end`, завершает генератор.
    12. Обрабатывает возможные ошибки JSONDecodeError и другие исключения.
    """
```

**Параметры**:
- `cls` (DarkAI): Ссылка на класс `DarkAI`.
- `model` (str): Название модели для генерации текста.
- `messages` (Messages): Список сообщений для формирования запроса.
- `proxy` (str, optional): URL прокси-сервера. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий текст по частям.

**Вызывает исключения**:
- `Exception`: В случае ошибки при взаимодействии с API DarkAI.

**Примеры**:

Пример использования `create_async_generator`:

```python
async def main():
    messages = [{"role": "user", "content": "Hello, DarkAI!"}]
    async for chunk in DarkAI.create_async_generator(model="gpt-3.5-turbo", messages=messages):
        print(chunk, end="")

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
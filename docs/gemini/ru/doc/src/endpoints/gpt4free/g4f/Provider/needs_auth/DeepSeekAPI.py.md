# Модуль `DeepSeekAPI.py`

## Обзор

Модуль `DeepSeekAPI.py` предназначен для взаимодействия с API DeepSeek для получения ответов от AI-моделей. Он предоставляет асинхронный интерфейс для аутентификации и создания запросов к DeepSeek API. Модуль использует библиотеку `dsk.api` для взаимодействия с API, а также включает в себя функциональность для обработки аутентификации через веб-драйвер.

## Подробнее

Модуль реализует класс `DeepSeekAPI`, который наследуется от `AsyncAuthedProvider` и `ProviderModelMixin`. Он позволяет аутентифицироваться в DeepSeek API, создавать чат-сессии и получать ответы от AI-моделей. Модуль также поддерживает использование веб-поиска и отображение процесса "мышления" модели.

## Классы

### `DeepSeekAPI`

**Описание**: Класс для взаимодействия с DeepSeek API.

**Наследует**:
- `AsyncAuthedProvider`: Предоставляет базовую функциональность для асинхронной аутентификации.
- `ProviderModelMixin`: Добавляет поддержку выбора модели.

**Атрибуты**:
- `url` (str): URL для доступа к DeepSeek API.
- `working` (bool): Указывает, работает ли данный провайдер (зависит от наличия библиотеки `dsk`).
- `needs_auth` (bool): Указывает, требуется ли аутентификация для работы с API.
- `use_nodriver` (bool): Указывает, используется ли безголовый браузер для аутентификации.
- `_access_token` (str): Приватный атрибут для хранения токена доступа.
- `default_model` (str): Модель, используемая по умолчанию ("deepseek-v3").
- `models` (List[str]): Список поддерживаемых моделей (["deepseek-v3", "deepseek-r1"]).

**Методы**:
- `on_auth_async()`: Асинхронный метод для аутентификации пользователя.
- `create_authed()`: Асинхронный метод для создания аутентифицированного запроса к API.

## Методы класса

### `on_auth_async`

```python
    @classmethod
    async def on_auth_async(cls, proxy: str = None, **kwargs) -> AsyncIterator:
        """Асинхронный метод для аутентификации пользователя.

        Args:
            proxy (str, optional): Прокси-сервер для использования при аутентификации. По умолчанию `None`.
            **kwargs: Дополнительные аргументы.

        Yields:
            RequestLogin: Объект, содержащий информацию о необходимости логина.
            AuthResult: Объект, содержащий результаты аутентификации.

        Принцип работы:
        - Проверяет, инициализирован ли браузер (безголовый Chrome). Если нет, инициализирует его.
        - Открывает страницу логина.
        - Ожидает получения токена доступа из `localStorage`.
        - Возвращает результаты аутентификации.

        Внутренние функции:
            callback(page): Асинхронная функция обратного вызова, которая выполняется на странице браузера.
                Она ожидает появления токена доступа в `localStorage` и сохраняет его в `cls._access_token`.
        """
        ...
```

### `create_authed`

```python
    @classmethod
    async def create_authed(
        cls,
        model: str,
        messages: Messages,
        auth_result: AuthResult,
        conversation: JsonConversation = None,
        web_search: bool = False,
        **kwargs
    ) -> AsyncResult:
        """Асинхронный метод для создания аутентифицированного запроса к API.

        Args:
            model (str): Название используемой модели.
            messages (Messages): Список сообщений для отправки в API.
            auth_result (AuthResult): Результаты аутентификации.
            conversation (JsonConversation, optional): Объект, представляющий текущую беседу. По умолчанию `None`.
            web_search (bool, optional): Указывает, следует ли использовать веб-поиск. По умолчанию `False`.
            **kwargs: Дополнительные аргументы.

        Yields:
            JsonConversation: Объект, представляющий текущую беседу.
            Reasoning: Объект, содержащий информацию о процессе "мышления" модели.
            str: Часть ответа от API.
            FinishReason: Объект, содержащий причину завершения ответа.

        Принцип работы:
        - Инициализирует API с использованием токена доступа.
        - Создает новую чат-сессию, если `conversation` не предоставлен.
        - Отправляет запрос в API и обрабатывает полученные чанки данных.
        - Возвращает чанки данных, содержащие информацию о процессе "мышления", текст ответа и причину завершения.
        """
        ...
```

## Параметры класса

- `url` (str): URL для доступа к DeepSeek API.
- `working` (bool): Указывает, работает ли данный провайдер (зависит от наличия библиотеки `dsk`).
- `needs_auth` (bool): Указывает, требуется ли аутентификация для работы с API.
- `use_nodriver` (bool): Указывает, используется ли безголовый браузер для аутентификации.
- `_access_token` (str): Приватный атрибут для хранения токена доступа.
- `default_model` (str): Модель, используемая по умолчанию ("deepseek-v3").
- `models` (List[str]): Список поддерживаемых моделей (["deepseek-v3", "deepseek-r1"]).

## Примеры

### Аутентификация

```python
# Пример аутентификации
# Предполагается, что у вас уже есть настроенный веб-драйвер и учетные данные
# auth_result = await DeepSeekAPI.on_auth_async()
# print(auth_result.api_key)
...
```

### Создание запроса

```python
# Пример создания запроса
# messages = [{"role": "user", "content": "Hello, how are you?"}]
# auth_result = AuthResult(api_key="your_api_key")
# async for chunk in DeepSeekAPI.create_authed(model="deepseek-v3", messages=messages, auth_result=auth_result):
#     print(chunk)
...
# Модуль `GPTalk`

## Обзор

Модуль `GPTalk` предоставляет асинхронный интерфейс для взаимодействия с сервисом GPTalk (gptalk.net). Он позволяет генерировать текст на основе предоставленных сообщений, используя API GPTalk. Модуль поддерживает модель `gpt-3.5-turbo` и использует `aiohttp` для выполнения асинхронных HTTP-запросов.

## Подробнее

Модуль предназначен для использования в асинхронных приложениях, требующих генерации текста с использованием GPTalk. Он автоматически управляет аутентификацией, повторно используя токен до истечения срока его действия или достижения лимита в 5 использований.

## Классы

### `GPTalk`

**Описание**: Класс `GPTalk` является провайдером асинхронной генерации текста на основе API GPTalk.

**Наследует**: `AsyncGeneratorProvider`

**Атрибуты**:

- `url` (str): URL сервиса GPTalk (`"https://gptalk.net"`).
- `working` (bool): Флаг, указывающий на работоспособность провайдера (по умолчанию `False`).
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели `gpt-3.5-turbo` (по умолчанию `True`).
- `_auth` (Optional[dict]): Информация об аутентификации, хранящая токен и время его истечения.
- `used_times` (int): Счетчик использований текущего токена (по умолчанию `0`).

**Методы**:

- `create_async_generator`: Создает асинхронный генератор для получения текста от GPTalk.

## Методы класса

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для получения текста от GPTalk.

    Args:
        cls (Type[GPTalk]): Ссылка на класс `GPTalk`.
        model (str): Имя модели для использования (например, `"gpt-3.5-turbo"`).
        messages (Messages): Список сообщений для отправки в GPTalk.
        proxy (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий текст от GPTalk.

    Raises:
        aiohttp.ClientResponseError: Если HTTP-запрос завершается с ошибкой.

    **Как работает функция**:

    1. **Подготовка**:
       - Функция начинается с установки модели, если она не была указана.
       - Вычисляется текущая метка времени (`timestamp`).
       - Формируются заголовки (`headers`) для HTTP-запроса, включая информацию о браузере и идентификаторы.

    2. **Аутентификация**:
       - Проверяется, требуется ли обновление токена аутентификации (`cls._auth`). Токен нужно обновить, если он отсутствует, истек или был использован 5 раз.
       - Если требуется обновление, выполняется POST-запрос к `f"{cls.url}/api/chatgpt/user/login"` для получения нового токена.
       - В теле запроса передается случайный fingerprint и платформа fingerprint.
       - Полученный токен и время его истечения сохраняются в `cls._auth`, а счетчик использований (`cls.used_times`) сбрасывается.

    3. **Отправка запроса**:
       - Формируется тело запроса (`data`) с использованием предоставленных сообщений, модели и других параметров.
       - Заголовки обновляются, чтобы включить токен аутентификации.
       - Выполняется POST-запрос к `f"{cls.url}/api/chatgpt/chatapi/text"` для отправки сообщения и получения токена чата.

    4. **Получение потока**:
       - Выполняется GET-запрос к `f"{cls.url}/api/chatgpt/chatapi/stream"` с токеном чата в качестве параметра.
       - Функция итерирует по строкам ответа, извлекая полезные данные JSON.
       - Каждая строка, начинающаяся с `data: `, парсится как JSON, и извлекается содержимое (`content`).
       - Извлеченное содержимое передается через `yield`, возвращая только новые части сообщения по сравнению с предыдущим.

    **Внутренние функции**:

    В данной функции внутренних функций нет.

    """
    ...
```

## Параметры класса

- `model` (str): Имя модели, используемой для генерации текста.
- `messages` (Messages): Список сообщений, передаваемых в GPTalk.
- `proxy` (str, optional): URL прокси-сервера для использования. По умолчанию `None`.

## Примеры

Пример использования класса `GPTalk` для генерации текста:

```python
import asyncio
from src.endpoints.gpt4free.g4f.Provider.deprecated import GPTalk

async def main():
    messages = [{"role": "user", "content": "Напиши короткий рассказ о космосе."}]
    async for message in GPTalk.create_async_generator(model="gpt-3.5-turbo", messages=messages):
        print(message, end="")

if __name__ == "__main__":
    asyncio.run(main())
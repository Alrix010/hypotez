# Модуль `Jmuz`

## Обзор

Модуль `Jmuz` представляет собой класс, предназначенный для взаимодействия с API Jmuz, который предоставляет доступ к различным моделям, включая `gpt-4o`, `qwq-32b`, `gemini-1.5` и `deepseek-chat`. Этот класс наследуется от `OpenaiTemplate` и предоставляет функциональность для асинхронной генерации текста на основе предоставленных сообщений.

## Подробнее

Модуль содержит настройки для подключения к API Jmuz, такие как URL, базовый URL API и ключ API. Также модуль определяет псевдонимы для некоторых моделей, чтобы обеспечить совместимость с различными названиями моделей. Класс `Jmuz` поддерживает потоковую передачу данных и предоставляет метод для получения списка доступных моделей.

## Классы

### `Jmuz(OpenaiTemplate)`

**Описание**: Класс `Jmuz` предназначен для взаимодействия с API Jmuz и предоставляет функциональность для асинхронной генерации текста на основе предоставленных сообщений.
**Наследует**: `OpenaiTemplate`

**Атрибуты**:
- `url` (str): URL для получения дополнительной информации о Jmuz.
- `api_base` (str): Базовый URL API Jmuz.
- `api_key` (str): Ключ API для аутентификации запросов к Jmuz.
- `working` (bool): Указывает, работает ли провайдер.
- `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения.
- `default_model` (str): Модель, используемая по умолчанию (`gpt-4o`).
- `model_aliases` (dict): Словарь псевдонимов моделей для совместимости.

**Методы**:
- `get_models(**kwargs)`: Возвращает список доступных моделей.
- `create_async_generator(model: str, messages: Messages, stream: bool = True, api_key: str = None, **kwargs) -> AsyncResult`: Создает асинхронный генератор для получения текстовых фрагментов от API Jmuz.

## Методы класса

### `get_models(**kwargs)`

```python
@classmethod
def get_models(cls, **kwargs):
    """
    Получает список доступных моделей.

    Args:
        **kwargs: Дополнительные аргументы, которые могут потребоваться для получения списка моделей.

    Returns:
        list: Список доступных моделей.
    """
```

**Назначение**: Получение списка доступных моделей из API Jmuz.

**Параметры**:
- `**kwargs`: Дополнительные аргументы, которые могут потребоваться для получения списка моделей.

**Возвращает**:
- `list`: Список доступных моделей.

**Как работает функция**:
- Функция проверяет, был ли уже получен список моделей. Если нет, она вызывает метод `get_models` родительского класса `OpenaiTemplate` с использованием ключа API и базового URL API Jmuz.
- Возвращает полученный список моделей.

**Примеры**:
```python
models = Jmuz.get_models()
print(models)
```

### `create_async_generator(model: str, messages: Messages, stream: bool = True, api_key: str = None, **kwargs) -> AsyncResult`

```python
@classmethod
async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        stream: bool = True,
        api_key: str = None, # Remove api_key from kwargs
        **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения текстовых фрагментов от API Jmuz.

    Args:
        model (str): Название используемой модели.
        messages (Messages): Список сообщений для отправки в API.
        stream (bool, optional): Указывает, использовать ли потоковую передачу данных. По умолчанию `True`.
        api_key (str, optional): Ключ API для аутентификации. По умолчанию `None`.
        **kwargs: Дополнительные аргументы для передачи в API.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий текстовые фрагменты.
    """
```

**Назначение**: Создание асинхронного генератора для получения текстовых фрагментов от API Jmuz.

**Параметры**:
- `model` (str): Название используемой модели.
- `messages` (Messages): Список сообщений для отправки в API.
- `stream` (bool, optional): Указывает, использовать ли потоковую передачу данных. По умолчанию `True`.
- `api_key` (str, optional): Ключ API для аутентификации. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы для передачи в API.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий текстовые фрагменты.

**Как работает функция**:
1.  **Подготовка заголовков**:
    *   Формируются заголовки HTTP-запроса, включая ключ API, тип контента и User-Agent.

2.  **Инициализация переменных**:

    *   `started`: Флаг, указывающий, начался ли уже возврат полезных данных.
    *   `buffer`: Буфер для накопления фрагментов текста.

3.  **Асинхронная генерация фрагментов**:

    *   Функция вызывает `super().create_async_generator` для получения фрагментов текста от API Jmuz.
    *   Для каждого полученного фрагмента выполняется постобработка:
        *   Фрагменты добавляются в буфер `buffer`.
        *   Выполняется проверка на наличие нежелательных строк, таких как "Join for free" или "https://discord.gg/", и при их обнаружении буфер очищается.
        *   Если фрагмент является началом полезных данных, удаляются начальные пробелы.
        *   Если буфер содержит полезные данные, устанавливается флаг `started`, и содержимое буфера возвращается как фрагмент.

**Примеры**:
```python
messages = [{"role": "user", "content": "Hello, world!"}]
async for chunk in Jmuz.create_async_generator(model="gpt-4o", messages=messages):
    print(chunk)
# Модуль `FastGpt`

## Обзор

Модуль предоставляет класс `FastGpt`, который является устаревшим поставщиком (провайдером) для работы с API FastGPT. Он поддерживает потоковую передачу данных и модель `gpt-3.5-turbo`. Модуль предназначен для интеграции с другими частями проекта `hypotez` для обеспечения функциональности чат-ботов.

## Подробней

Этот модуль определяет способ взаимодействия с сервисом `FastGPT`. Он включает в себя конфигурацию URL, указание на поддержку потоковой передачи, а также необходимые заголовки и параметры для выполнения запросов к API. Использование модуля позволяет абстрагироваться от деталей реализации API `FastGPT` и упрощает интеграцию с другими компонентами системы.

## Классы

### `FastGpt(AbstractProvider)`

**Описание**: Класс `FastGpt` является поставщиком для работы с API FastGPT. Он наследуется от `AbstractProvider` и реализует метод `create_completion` для создания запросов к API.

**Наследует**:
- `AbstractProvider`: Абстрактный класс, определяющий интерфейс для всех провайдеров.

**Атрибуты**:
- `url` (str): URL-адрес сервиса FastGPT (`https://chat9.fastgpt.me/`).
- `working` (bool): Указывает, работает ли провайдер (в данном случае `False`).
- `needs_auth` (bool): Указывает, требуется ли аутентификация (в данном случае `False`).
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (в данном случае `True`).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo` (в данном случае `True`).
- `supports_gpt_4` (bool): Указывает, поддерживает ли провайдер модель `gpt-4` (в данном случае `False`).

**Методы**:
- `create_completion`: Создает запрос к API FastGPT и возвращает результат.

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool, **kwargs: Any) -> CreateResult:
    """
    Создает запрос к API FastGPT и возвращает результат.

    Args:
        model (str): Название модели для использования.
        messages (list[dict[str, str]]): Список сообщений для отправки в API.
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
        **kwargs (Any): Дополнительные параметры запроса.

    Returns:
        CreateResult: Результат запроса к API.

    Raises:
        Exception: Если возникает ошибка при выполнении запроса.

    """
```

**Назначение**:
Метод `create_completion` отправляет запрос к API FastGPT для создания завершения (completion) на основе предоставленных сообщений и параметров. Он поддерживает потоковую передачу данных, что позволяет получать ответы по частям.

**Параметры**:
- `model` (str): Название модели, которую следует использовать для генерации ответа.
- `messages` (list[dict[str, str]]): Список сообщений, представляющих контекст для генерации ответа. Каждое сообщение содержит роль (`role`) и содержимое (`content`).
- `stream` (bool): Флаг, указывающий, следует ли использовать потоковый режим для получения ответа.
- `**kwargs` (Any): Дополнительные параметры, такие как `temperature`, `presence_penalty`, `frequency_penalty` и `top_p`, которые влияют на процесс генерации ответа.

**Возвращает**:
- `CreateResult`: Результат запроса к API. В случае потокового режима возвращает генератор, который выдает токены ответа по мере их поступления.

**Как работает функция**:
1. Определяются заголовки (`headers`) для HTTP-запроса, включая `User-Agent`, `Content-Type` и другие необходимые параметры.
2. Формируется JSON-тело запроса (`json_data`) с использованием входных параметров `messages`, `stream`, `model` и дополнительных параметров из `kwargs`.
3. Выбирается случайный поддомен (`subdomain`) из списка `['jdaen979ew', 'chat9']` для формирования URL-адреса API.
4. Отправляется POST-запрос к API FastGPT с использованием библиотеки `requests`.
5. В случае потокового режима (`stream=True`), функция итерируется по строкам ответа (`response.iter_lines()`) и извлекает содержимое (`content`) из каждой строки, если оно присутствует.
6. Извлеченное содержимое передается через `yield token`, что позволяет возвращать токены ответа по мере их поступления.
7. Обрабатываются исключения, которые могут возникнуть при обработке строк ответа.

**Примеры**:

```python
# Пример вызова функции create_completion с потоковой передачей данных
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = True
kwargs = {"temperature": 0.7, "top_p": 0.9}
result = FastGpt.create_completion(model, messages, stream, **kwargs)
for token in result:
    print(token, end="")
```

```python
# Пример вызова функции create_completion без потоковой передачи данных
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Tell me a joke."}]
stream = False
kwargs = {}
result = FastGpt.create_completion(model, messages, stream, **kwargs)
print("".join(result))
# Модуль валидации для tinytroupe

## Обзор

Этот модуль содержит набор функций для валидации и санитации данных, используемых в компоненте `tinytroupe`. Он предоставляет инструменты для проверки допустимости полей, удаления недопустимых символов из строк и ограничения глубины вложенности словарей.

## Детали

### Функции

#### `check_valid_fields`

**Назначение**: Проверяет, являются ли поля в заданном словаре допустимыми согласно списку допустимых полей.

**Параметры**:

- `obj` (dict): Словарь, который нужно проверить.
- `valid_fields` (list): Список допустимых полей.

**Возвращает**:

- `None`: Функция не возвращает значение.

**Вызывает исключения**:

- `ValueError`: Если в словаре присутствуют недопустимые поля.

**Как работает функция**:

- Функция итерируется по ключам словаря `obj`.
- Для каждого ключа она проверяет, присутствует ли он в списке `valid_fields`.
- Если ключ не найден в списке, функция вызывает исключение `ValueError` с подробным сообщением об ошибке, указывающим на недопустимый ключ и список допустимых ключей.

**Примеры**:

```python
>>> check_valid_fields({"name": "Alice", "age": 30}, ["name", "age"]) # корректный вызов
>>> check_valid_fields({"name": "Alice", "city": "New York"}, ["name", "age"]) # вызовет исключение
```

#### `sanitize_raw_string`

**Назначение**: Санирует заданную строку, удаляя недопустимые символы и ограничивая ее длину максимальным значением для строки в Python.

**Параметры**:

- `value` (str): Строка, которую нужно санировать.

**Возвращает**:

- `str`: Санированная строка.

**Как работает функция**:

- Функция преобразует строку в байтовый поток UTF-8, игнорируя недопустимые символы.
- Затем она преобразует полученный байтовый поток обратно в строку UTF-8.
- Функция нормализует строку с использованием `unicodedata.normalize` для удаления нежелательных символов и преобразования в более стандартный формат.
- Наконец, она ограничивает длину строки максимальным значением для строки в Python, чтобы предотвратить проблемы с переполнением.

**Примеры**:

```python
>>> sanitize_raw_string("Привет, мир! こんにちは世界！")
'Привет, мир! こんにちは世界！'
>>> sanitize_raw_string("Invalid characters: \x00 \x01 \x02")
'Invalid characters:  '
```

#### `sanitize_dict`

**Назначение**: Санирует заданный словарь, удаляя недопустимые символы из строковых значений и ограничивая глубину вложенности.

**Параметры**:

- `value` (dict): Словарь, который нужно санировать.

**Возвращает**:

- `dict`: Санированный словарь.

**Как работает функция**:

- Функция итерируется по парам ключ-значение в словаре `value`.
- Если значение является строкой, она вызывает функцию `sanitize_raw_string` для санитации строки.
- В противном случае она оставляет значение без изменений.
- Затем функция возвращает санированный словарь.

**Примеры**:

```python
>>> sanitize_dict({"name": "Alice", "city": "New York", "description": "Привет, мир! \x00 \x01 \x02"})
{'name': 'Alice', 'city': 'New York', 'description': 'Привет, мир!  '}
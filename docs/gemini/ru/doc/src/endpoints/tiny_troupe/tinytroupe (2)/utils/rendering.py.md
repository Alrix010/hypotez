# Модуль для рендеринга и разметки

## Обзор

Модуль предоставляет набор утилит для обработки текста, форматирования HTML и стилизации текста для отображения в пользовательском интерфейсе. Он включает функции для вставки стилей в HTML, обрезки текста до заданной длины, форматирования даты и времени, удаления отступов и переноса текста. Также включает класс `RichTextStyle` для определения стилей текста.

## Подробней

Этот модуль используется для подготовки и стилизации текста, отображаемого в интерфейсе пользователя, чтобы сделать его более читаемым и привлекательным. Функции модуля позволяют динамически изменять внешний вид текста в зависимости от контекста и типа контента.

## Функции

### `inject_html_css_style_prefix`

**Назначение**: Вставляет префикс стиля ко всем атрибутам `style` в заданной HTML-строке.

**Параметры**:

-   `html` (str): HTML-строка, в которой нужно вставить префикс стиля.
-   `style_prefix_attributes` (str): Префикс стиля, который нужно вставить.

**Возвращает**:

-   `str`: HTML-строка с вставленным префиксом стиля.

**Как работает функция**:

Функция использует метод `replace` для замены всех вхождений `style="` в HTML-строке на `style="{style_prefix_attributes};`. Это позволяет добавить дополнительные стили к существующим стилям HTML-элементов.

**Примеры**:

```python
html = '<div style="color: red;">Hello</div>'
style_prefix = 'font-size: 20px;'
result = inject_html_css_style_prefix(html, style_prefix)
print(result)
# Вывод: <div style="font-size: 20px;;color: red;">Hello</div>
```

### `break_text_at_length`

**Назначение**: Обрезает текст или JSON до указанной длины, добавляя строку `(...)` в точке обрыва.

**Параметры**:

-   `text` (Union[str, dict]): Текст или словарь для обрезки.
-   `max_length` (int, optional): Максимальная длина текста. Если `None`, текст не обрезается. По умолчанию `None`.

**Возвращает**:

-   `str`: Обрезанный текст с добавленной строкой `(...)`, если текст был обрезан.

**Как работает функция**:

1.  Если входной параметр `text` является словарем, он преобразуется в JSON-строку с отступами.
2.  Если `max_length` равен `None` или длина текста меньше или равна `max_length`, возвращается исходный текст.
3.  В противном случае текст обрезается до `max_length`, и к нему добавляется строка `(...)`.

**Примеры**:

```python
text = "This is a long text."
result = break_text_at_length(text, 10)
print(result)
# Вывод: This is a  (...)

data = {"name": "Alice", "age": 30}
result = break_text_at_length(data, 20)
print(result)
# Вывод: {
#     "name": "Alice" (...)
```

### `pretty_datetime`

**Назначение**: Возвращает строковое представление объекта `datetime` в формате `YYYY-MM-DD HH:MM`.

**Параметры**:

-   `dt` (datetime): Объект `datetime` для форматирования.

**Возвращает**:

-   `str`: Строковое представление даты и времени.

**Как работает функция**:

Функция использует метод `strftime` объекта `datetime` для форматирования даты и времени в соответствии с указанным форматом `%Y-%m-%d %H:%M`.

**Примеры**:

```python
from datetime import datetime
now = datetime.now()
result = pretty_datetime(now)
print(result)
# Вывод: 2023-10-26 10:30 (пример)
```

### `dedent`

**Назначение**: Удаляет начальные пробелы и отступы из заданной строки.

**Параметры**:

-   `text` (str): Текст для удаления отступов.

**Возвращает**:

-   `str`: Текст без начальных пробелов и отступов.

**Как работает функция**:

Функция использует `textwrap.dedent` для удаления общего начального пробельного префикса из каждой строки в тексте, а затем удаляет все начальные и конечные пробелы с помощью `strip()`.

**Примеры**:

```python
text = "  Hello,\n    World!"
result = dedent(text)
print(result)
# Вывод: Hello,
#       World!
```

### `wrap_text`

**Назначение**: Переносит текст на новую строку с указанной шириной.

**Параметры**:

-   `text` (str): Текст для переноса.
-   `width` (int, optional): Максимальная ширина строки. По умолчанию 100.

**Возвращает**:

-   `str`: Текст, перенесенный на новые строки.

**Как работает функция**:

Функция использует `textwrap.fill` для переноса текста на новые строки так, чтобы каждая строка не превышала указанную ширину.

**Примеры**:

```python
text = "This is a very long text that needs to be wrapped."
result = wrap_text(text, width=20)
print(result)
# Вывод: This is a very
# long text that
# needs to be wrapped.
```

## Классы

### `RichTextStyle`

**Описание**: Класс, определяющий стили текста для использования с библиотекой `rich`.

**Атрибуты**:

-   `STIMULUS_CONVERSATION_STYLE` (str): Стиль для текста в стиле беседы (`bold italic cyan1`).
-   `STIMULUS_THOUGHT_STYLE` (str): Стиль для текста, представляющего мысли (`dim italic cyan1`).
-   `STIMULUS_DEFAULT_STYLE` (str): Стиль по умолчанию для стимулов (`italic`).
-   `ACTION_DONE_STYLE` (str): Стиль для завершенных действий (`grey82`).
-   `ACTION_TALK_STYLE` (str): Стиль для разговора (`bold green3`).
-   `ACTION_THINK_STYLE` (str): Стиль для размышления (`green`).
-   `ACTION_DEFAULT_STYLE` (str): Стиль по умолчанию для действий (`purple`).
-   `INTERVENTION_DEFAULT_STYLE` (str): Стиль по умолчанию для вмешательств (`bright_magenta`).

#### Методы класса

##### `get_style_for`

**Назначение**: Возвращает стиль для указанного типа контента и события.

**Параметры**:

-   `kind` (str): Тип контента (`stimulus`, `action`, `intervention`).
-   `event_type` (str, optional): Тип события (`CONVERSATION`, `THOUGHT`, `DONE`, `TALK`, `THINK`). По умолчанию `None`.

**Возвращает**:

-   `str`: Строка стиля, соответствующая указанному типу контента и события.

**Как работает функция**:

Функция проверяет значение параметра `kind` и возвращает соответствующий стиль из атрибутов класса. Если `kind` равен `"stimulus"` или `"stimuli"`, функция дополнительно проверяет значение `event_type` и возвращает стиль, соответствующий типу события (`CONVERSATION`, `THOUGHT` или стиль по умолчанию). Аналогично, если `kind` равен `"action"`, функция проверяет `event_type` и возвращает соответствующий стиль (`DONE`, `TALK`, `THINK` или стиль по умолчанию). Если `kind` равен `"intervention"`, возвращается стиль по умолчанию для вмешательств.

**Примеры**:

```python
style = RichTextStyle.get_style_for("stimulus", "CONVERSATION")
print(style)
# Вывод: bold italic cyan1

style = RichTextStyle.get_style_for("action", "DONE")
print(style)
# Вывод: grey82

style = RichTextStyle.get_style_for("intervention")
print(style)
# Вывод: bright_magenta
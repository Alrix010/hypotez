# Модуль `experimentation.py`

## Обзор

Модуль `experimentation.py` содержит классы `ABRandomizer` и `Intervention`, которые используются для реализации A/B-тестирования и проведения интервенций в среде с агентами.

## Подробней

Модуль предназначен для проведения экспериментов в среде с агентами. Он предлагает инструменты для случайного распределения агентов по группам, а также для проведения интервенций в среде.

## Классы

### `ABRandomizer`

**Описание**: Класс `ABRandomizer` реализует функцию случайного распределения элементов по двум группам, позволяя затем восстановить исходное распределение.

**Наследует**: Нет

**Атрибуты**:

- `choices` (dict): Словарь, хранящий информацию о случайном распределении. Ключом является индекс элемента, а значением - кортеж из двух чисел, показывающий, был ли элемент изменен.
- `real_name_1` (str): Настоящее имя первой группы.
- `real_name_2` (str): Настоящее имя второй группы.
- `blind_name_a` (str): Имя первой группы, отображаемое для пользователя.
- `blind_name_b` (str): Имя второй группы, отображаемое для пользователя.
- `passtrough_name` (list): Список имен, которые не случайным образом распределяются и всегда возвращаются как есть.
- `random_seed` (int): Случайное семя, используемое для генерации случайных чисел.

**Методы**:

- `randomize(i, a, b)`: Случайным образом переключает `a` и `b` и возвращает выбранные варианты. Сохраняет информацию о переключении для последующего декодирования.
    **Параметры**:
    - `i` (int): Индекс элемента.
    - `a` (str): Первый вариант.
    - `b` (str): Второй вариант.
- `derandomize(i, a, b)`: Восстанавливает исходное распределение для элемента `i` и возвращает выбранные варианты.
    **Параметры**:
    - `i` (int): Индекс элемента.
    - `a` (str): Первый вариант.
    - `b` (str): Второй вариант.
- `derandomize_name(i, blind_name)`: Декодирует выбор, сделанный пользователем, и возвращает выбор.
    **Параметры**:
    - `i` (int): Индекс элемента.
    - `blind_name` (str): Выбор, сделанный пользователем.


**Пример**:

```python
# Создание объекта ABRandomizer
randomizer = ABRandomizer(real_name_1="A", real_name_2="B", blind_name_a="Control", blind_name_b="Treatment")

# Случайная выборка для элемента с индексом 0
choice_a, choice_b = randomizer.randomize(0, "A", "B")

# Декодирование выбора пользователя
real_name = randomizer.derandomize_name(0, "Treatment")
```

### `Intervention`

**Описание**: Класс `Intervention` реализует функцию проведения интервенций в среде с агентами.

**Наследует**: Нет

**Атрибуты**:

- `agents` (list): Список агентов, на которых проводится интервенция.
- `environments` (list): Список сред, на которых проводится интервенция.
- `text_precondition` (str): Текстовое описание условия, которое должно быть выполнено, чтобы интервенция была применимой.
- `precondition_func` (function): Функция, которая проверяет, выполнено ли условие для интервенции.
- `effect_func` (function): Функция, которая применяется к агентам и средам, чтобы выполнить интервенцию.

**Методы**:

- `check_precondition()`: Проверяет, выполнено ли условие для интервенции.
- `apply()`: Применяет интервенцию к агентам и средам.
- `set_textual_precondition(text)`: Устанавливает текстовое описание условия для интервенции.
- `set_functional_precondition(func)`: Устанавливает функцию, которая проверяет, выполнено ли условие для интервенции.
- `set_effect(effect_func)`: Устанавливает функцию, которая применяется к агентам и средам, чтобы выполнить интервенцию.

**Пример**:

```python
# Создание объекта Intervention
intervention = Intervention(agent=agent)

# Установка условия для интервенции
intervention.set_textual_precondition("Агент должен быть в состоянии 'ready'")

# Установка действия для интервенции
intervention.set_effect(lambda agents, environments: print(f"Интервенция применена к {agents} в {environments}"))

# Проверка условия
if intervention.check_precondition():
    # Применение интервенции
    intervention.apply()
```

## Параметры

- `real_name_1` (str): Настоящее имя первой группы.
- `real_name_2` (str): Настоящее имя второй группы.
- `blind_name_a` (str): Имя первой группы, отображаемое для пользователя.
- `blind_name_b` (str): Имя второй группы, отображаемое для пользователя.
- `passtrough_name` (list): Список имен, которые не случайным образом распределяются и всегда возвращаются как есть.
- `random_seed` (int): Случайное семя, используемое для генерации случайных чисел.
- `agent` (TinyPerson): Агент, на которого применяется интервенция.
- `agents` (list): Список агентов, на которых применяется интервенция.
- `environment` (TinyWorld): Среда, на которой применяется интервенция.
- `environments` (list): Список сред, на которых применяется интервенция.
- `text` (str): Текстовое описание условия для интервенции.
- `func` (function): Функция, которая проверяет, выполнено ли условие для интервенции.
- `effect_func` (function): Функция, которая применяется к агентам и средам, чтобы выполнить интервенцию.

## Примеры

```python
# Пример использования ABRandomizer
from tinytroupe.experimentation import ABRandomizer

# Создание объекта ABRandomizer
randomizer = ABRandomizer(real_name_1="A", real_name_2="B", blind_name_a="Control", blind_name_b="Treatment")

# Случайная выборка для элемента с индексом 0
choice_a, choice_b = randomizer.randomize(0, "A", "B")

# Декодирование выбора пользователя
real_name = randomizer.derandomize_name(0, "Treatment")

# Вывод результатов
print(f"Случайный выбор: {choice_a}, {choice_b}")
print(f"Декодированный выбор: {real_name}")

# Пример использования Intervention
from tinytroupe.experimentation import Intervention
from tinytroupe.agent import TinyPerson

# Создание объекта Intervention
intervention = Intervention(agent=TinyPerson())

# Установка условия для интервенции
intervention.set_textual_precondition("Агент должен быть в состоянии 'ready'")

# Установка действия для интервенции
intervention.set_effect(lambda agents, environments: print(f"Интервенция применена к {agents} в {environments}"))

# Проверка условия
if intervention.check_precondition():
    # Применение интервенции
    intervention.apply()
```

## Как работает код

Модуль `experimentation.py` обеспечивает возможность проведения экспериментов в среде с агентами. Класс `ABRandomizer` позволяет случайным образом распределять элементы по двум группам, а затем декодировать выбор пользователя, чтобы восстановить исходное распределение. Класс `Intervention` реализует функцию проведения интервенций, которая включает в себя проверку условий и применение действий к агентам и средам.

## Важные моменты

- Используйте классы `ABRandomizer` и `Intervention` для проведения экспериментов в среде с агентами.
- Класс `ABRandomizer` обеспечивает случайное распределение элементов по двум группам и декодирование выбора пользователя.
- Класс `Intervention` позволяет проводить интервенции, включающие проверку условий и применение действий к агентам и средам.
- Модуль `experimentation.py` интегрируется с другими модулями `tinytroupe`, такими как `agent.py`, для создания полной функциональности.

```markdown
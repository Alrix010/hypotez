# Модуль для рандомизации A/B тестов
=================================================

Модуль предоставляет класс `ABRandomizer`, который используется для рандомизации между двумя опциями и последующей дерандомизации.
Класс позволяет хранить сделанные выборы и возвращать исходные значения.

Пример использования:
```python
randomizer = ABRandomizer(real_name_1="control", real_name_2="treatment",
                           blind_name_a="A", blind_name_b="B",
                           passtrough_name=[],
                           random_seed=42)

a, b = randomizer.randomize(1, "option_a", "option_b")
print(f"Randomized choices: a={a}, b={b}")

original_a, original_b = randomizer.derandomize(1, "option_a", "option_b")
print(f"De-randomized choices: a={original_a}, b={original_b}")

decoded_name = randomizer.derandomize_name(1, "A")
print(f"De-randomized name: {decoded_name}")
```

## Обзор

Модуль `randomization.py` предоставляет функциональность для проведения A/B-тестирования, позволяя рандомизировать и дерандомизировать варианты, а также декодировать выбор пользователя. Класс `ABRandomizer` управляет рандомизацией между двумя опциями, сохраняя информацию о переключении вариантов для последующей дерандомизации.

## Подробнее

Этот модуль предназначен для использования в экспериментах, где необходимо случайным образом распределить пользователей между двумя группами (например, контрольной и тестовой). Класс `ABRandomizer` позволяет не только рандомизировать отображение вариантов, но и восстанавливать исходные значения на основе сделанного выбора. Это особенно полезно при анализе результатов A/B-тестов, когда необходимо определить, какой вариант был показан пользователю и как он повлиял на его решение.

## Классы

### `ABRandomizer`

**Описание**: Класс для рандомизации между двумя опциями и последующей дерандомизации.

**Атрибуты**:
- `choices` (dict): Словарь, хранящий информацию о том, были ли переключены варианты для каждого элемента.
- `real_name_1` (str): Название первого варианта в исходных данных.
- `real_name_2` (str): Название второго варианта в исходных данных.
- `blind_name_a` (str): Название первого варианта, отображаемое пользователю.
- `blind_name_b` (str): Название второго варианта, отображаемое пользователю.
- `passtrough_name` (list): Список названий, которые не должны быть рандомизированы и возвращаются как есть.
- `random_seed` (int): Зерно для генератора случайных чисел.

**Методы**:
- `__init__`: Инициализирует экземпляр класса `ABRandomizer`.
- `randomize`: Случайно переключает два варианта и сохраняет информацию о переключении.
- `derandomize`: Возвращает исходные варианты на основе информации о переключении.
- `derandomize_name`: Декодирует выбор пользователя и возвращает исходное название варианта.

#### `__init__`

```python
def __init__(self, real_name_1="control", real_name_2="treatment",
                       blind_name_a="A", blind_name_b="B",
                       passtrough_name=[],
                       random_seed=42):
```

**Назначение**: Инициализирует объект класса `ABRandomizer` с заданными параметрами.

**Параметры**:
- `real_name_1` (str): Название первого варианта в исходных данных (по умолчанию "control").
- `real_name_2` (str): Название второго варианта в исходных данных (по умолчанию "treatment").
- `blind_name_a` (str): Название первого варианта, отображаемое пользователю (по умолчанию "A").
- `blind_name_b` (str): Название второго варианта, отображаемое пользователю (по умолчанию "B").
- `passtrough_name` (list): Список названий, которые не должны быть рандомизированы и возвращаются как есть (по умолчанию `[]`).
- `random_seed` (int): Зерно для генератора случайных чисел (по умолчанию 42).

**Как работает функция**:
- Инициализирует словарь `self.choices` для хранения информации о рандомизации.
- Устанавливает значения атрибутов класса на основе переданных параметров.

**Примеры**:

```python
randomizer = ABRandomizer()
randomizer = ABRandomizer(real_name_1="option1", real_name_2="option2", blind_name_a="X", blind_name_b="Y", random_seed=123)
```

#### `randomize`

```python
def randomize(self, i, a, b):
```

**Назначение**: Случайно переключает два варианта (`a` и `b`) и возвращает их в случайном порядке. Сохраняет информацию о переключении для последующей дерандомизации.

**Параметры**:
- `i` (int): Индекс элемента.
- `a` (str): Первый вариант.
- `b` (str): Второй вариант.

**Возвращает**:
- `tuple[str, str]`: Кортеж из двух элементов, представляющих варианты `a` и `b` в случайном порядке.

**Как работает функция**:
- Использует `random.Random(self.random_seed).random()` для генерации случайного числа в диапазоне от 0 до 1.
- Если случайное число меньше 0.5, то варианты `a` и `b` возвращаются в исходном порядке, и в `self.choices` сохраняется значение `(0, 1)`.
- Иначе варианты `a` и `b` меняются местами, и в `self.choices` сохраняется значение `(1, 0)`.

**Примеры**:

```python
randomizer = ABRandomizer()
a, b = randomizer.randomize(1, "option_a", "option_b")
print(f"Randomized choices: a={a}, b={b}")
```

#### `derandomize`

```python
def derandomize(self, i, a, b):
```

**Назначение**: Возвращает исходные варианты `a` и `b` на основе информации о переключении, сохраненной в `self.choices`.

**Параметры**:
- `i` (int): Индекс элемента.
- `a` (str): Первый вариант.
- `b` (str): Второй вариант.

**Возвращает**:
- `tuple[str, str]`: Кортеж из двух элементов, представляющих варианты `a` и `b` в исходном порядке.

**Вызывает исключения**:
- `Exception`: Если для элемента `i` не найдена информация о рандомизации.

**Как работает функция**:
- Проверяет значение `self.choices[i]`.
- Если `self.choices[i]` равно `(0, 1)`, то варианты `a` и `b` возвращаются в исходном порядке.
- Если `self.choices[i]` равно `(1, 0)`, то варианты `a` и `b` меняются местами и возвращаются.
- Если для элемента `i` не найдена информация о рандомизации, вызывается исключение.

**Примеры**:

```python
randomizer = ABRandomizer()
randomizer.randomize(1, "option_a", "option_b")
original_a, original_b = randomizer.derandomize(1, "option_a", "option_b")
print(f"De-randomized choices: a={original_a}, b={original_b}")
```

#### `derandomize_name`

```python
def derandomize_name(self, i, blind_name):
```

**Назначение**: Декодирует выбор пользователя (`blind_name`) и возвращает исходное название варианта.

**Параметры**:
- `i` (int): Индекс элемента.
- `blind_name` (str): Название варианта, выбранное пользователем.

**Возвращает**:
- `str`: Исходное название варианта.

**Вызывает исключения**:
- `Exception`: Если для элемента `i` не найдена информация о рандомизации или если название варианта не распознано.

**Как работает функция**:
- Проверяет значение `self.choices[i]`.
- Если `self.choices[i]` равно `(0, 1)`, то варианты не были переключены при рандомизации.
    - Если `blind_name` равно `self.blind_name_a`, то возвращается `self.real_name_1`.
    - Если `blind_name` равно `self.blind_name_b`, то возвращается `self.real_name_2`.
    - Если `blind_name` есть в `self.passtrough_name`, возвращается `blind_name`.
    - Иначе вызывается исключение.
- Если `self.choices[i]` равно `(1, 0)`, то варианты были переключены при рандомизации.
    - Если `blind_name` равно `self.blind_name_a`, то возвращается `self.real_name_2`.
    - Если `blind_name` равно `self.blind_name_b`, то возвращается `self.real_name_1`.
    - Если `blind_name` есть в `self.passtrough_name`, возвращается `blind_name`.
    - Иначе вызывается исключение.
- Если для элемента `i` не найдена информация о рандомизации, вызывается исключение.

**Примеры**:

```python
randomizer = ABRandomizer(real_name_1="control", real_name_2="treatment", blind_name_a="A", blind_name_b="B")
randomizer.randomize(1, "option_a", "option_b")
decoded_name = randomizer.derandomize_name(1, "A")
print(f"De-randomized name: {decoded_name}")
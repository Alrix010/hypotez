# Модуль Normalizer

## Обзор

Модуль `Normalizer` предоставляет механизм для нормализации текстовых элементов, таких как фрагменты текста, концепции и другие, с помощью модели OpenAI. Он используется для преобразования неоднозначных или нестандартных выражений в более унифицированный формат.

## Подробней

Внутри модуля реализован класс `Normalizer`, который выполняет следующие действия:

- **Инициализация:** При создании экземпляра класса `Normalizer` происходит нормализация списка входных элементов `elements`  с помощью модели OpenAI. 
- **Нормализация:** Метод `normalize` нормализует заданный элемент или список элементов с использованием кэширования для повышения производительности. Если элемент уже был нормализован, его нормализованный вариант извлекается из кэша. 
- **Обработка ошибок:** Модуль использует `logger` из проекта `hypotez` для регистрации сообщений об ошибках. 

## Классы

### `Normalizer`

**Описание**: Класс `Normalizer` реализует механизм нормализации текстовых элементов с использованием модели OpenAI.

**Атрибуты**:

- `elements (List[str])`: Список элементов, которые будут нормализованы. 
- `n (int)`: Количество нормализованных элементов, которые будут выведены.
- `verbose (bool)`: Флаг, указывающий, следует ли выводить отладочную информацию.
- `normalized_elements (dict)`: Словарь, где каждый ключ - это нормализованный элемент, а значение - список входных элементов, которые были объединены в этот элемент.
- `normalizing_map (dict)`: Словарь, который сопоставляет каждый входной элемент с его нормализованным вариантом. Используется для кэширования.

**Методы**:

- `__init__(self, elements: List[str], n: int, verbose: bool = False)`: Конструктор класса `Normalizer`.
- `normalize(self, element_or_elements: Union[str, List[str]]) -> Union[str, List[str]]`: Нормализует заданный элемент или список элементов с использованием кэширования.

## Функции

### `__init__`

**Назначение**: Конструктор класса `Normalizer`.

**Параметры**:

- `elements (List[str])`: Список элементов, которые будут нормализованы.
- `n (int)`: Количество нормализованных элементов, которые будут выведены.
- `verbose (bool, optional)`: Флаг, указывающий, следует ли выводить отладочную информацию. По умолчанию `False`.

**Как работает функция**:

1. Функция `__init__` создает экземпляр класса `Normalizer`.
2. Проверяет, что все элементы в `elements` уникальны.
3. Инициализирует атрибуты `n` и `verbose`.
4. Инициализирует пустые словари `normalized_elements` и `normalizing_map`.
5. Формирует начальные сообщения для модели OpenAI (LLM)  с использованием шаблонов "normalizer.system.mustache" и "normalizer.user.mustache". 
6. Отправляет сообщения модели OpenAI с помощью `openai_utils.client().send_message` и получает результат.
7. Записывает результат в `self.normalized_elements`.

**Примеры**:

```python
# Инициализация экземпляра класса Normalizer
normalizer = Normalizer(elements=["apple", "banana", "cherry"], n=3, verbose=True) 

# Инициализация экземпляра класса Normalizer без вывода отладочной информации
normalizer = Normalizer(elements=["apple", "banana", "cherry"], n=3, verbose=False) 
```


### `normalize`

**Назначение**: Нормализует заданный элемент или список элементов с использованием кэширования.

**Параметры**:

- `element_or_elements (Union[str, List[str]])`: Элемент или список элементов, которые будут нормализованы.

**Возвращает**:

- `str`: Нормализованный элемент, если входным параметром была строка.
- `list`: Список нормализованных элементов, если входным параметром был список, сохраняя порядок элементов в исходном списке.

**Вызывает исключения**:

- `ValueError`: Если `element_or_elements` не является строкой или списком.

**Как работает функция**:

1. Функция `normalize` обрабатывает как отдельные элементы, так и списки элементов.
2. Проверяет, был ли элемент уже нормализован (используя `normalizing_map`).
3. Если элемент не был нормализован, функция отправляет запрос к модели OpenAI для нормализации.
4. Сохраняет нормализованный элемент в `normalizing_map` для будущих вызовов.
5. Возвращает нормализованный элемент или список элементов.

**Примеры**:

```python
# Нормализация одного элемента
normalized_element = normalizer.normalize("apple")

# Нормализация списка элементов
normalized_elements = normalizer.normalize(["apple", "banana", "cherry"]) 
```

##  Параметры класса 

- `elements (List[str])`: Список элементов для нормализации. Например: `['apple', 'banana', 'cherry']`. 
- `n (int)`: Число элементов для нормализации. Например: `3`. 
- `verbose (bool)`:  Флаг для вывода отладочной информации. 
- `normalized_elements (dict)`:  Словарь, где ключ - нормализованный элемент, а значение - список элементов, которые были объединены в этот элемент.
- `normalizing_map (dict)`:  Словарь, который сопоставляет каждый входной элемент с его нормализованным вариантом. 


##  Примеры 

```python
from tinytroupe.extraction.normalizer import Normalizer

# Создаем экземпляр класса Normalizer
normalizer = Normalizer(elements=["apple", "banana", "cherry"], n=3, verbose=True)

# Нормализуем один элемент
normalized_element = normalizer.normalize("apple")

# Выводим нормализованный элемент
print(normalized_element)

# Нормализуем список элементов
normalized_elements = normalizer.normalize(["apple", "banana", "cherry"])

# Выводим список нормализованных элементов
print(normalized_elements)
```

```python
from tinytroupe.extraction.normalizer import Normalizer

# Создаем экземпляр класса Normalizer без вывода отладочной информации
normalizer = Normalizer(elements=["apple", "banana", "cherry"], n=3, verbose=False)

# Нормализуем один элемент
normalized_element = normalizer.normalize("apple")

# Выводим нормализованный элемент
print(normalized_element)

# Нормализуем список элементов
normalized_elements = normalizer.normalize(["apple", "banana", "cherry"])

# Выводим список нормализованных элементов
print(normalized_elements)
```
```markdown
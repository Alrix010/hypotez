# Модуль для работы с психическими способностями агента

## Обзор

Модуль `mental_faculty.py` предоставляет классы для определения и реализации психических способностей агента. 
Психические способности - это когнитивные возможности, которые позволяют агенту взаимодействовать с миром и выполнять задачи. 
Этот модуль реализует базовый класс `TinyMentalFaculty` и несколько его наследников, которые представляют различные 
психические способности, такие как `CustomMentalFaculty`, `RecallFaculty`, `FilesAndWebGroundingFaculty` и `TinyToolUse`. 

## Классы

### `TinyMentalFaculty`

**Описание**: Базовый класс для определения психических способностей агента.

**Наследует**: 
    - `JsonSerializableRegistry` 

**Атрибуты**:

  - `name` (str): Название психической способности.
  - `requires_faculties` (list): Список других психических способностей, которые необходимы для работы этой способности.

**Методы**:

  - `process_action(agent, action: dict) -> bool`: 
    - Обрабатывает действие, связанное с этой способностью.
    - Возвращает `True`, если действие успешно обработано, `False` в противном случае.
  - `actions_definitions_prompt() -> str`: 
    - Возвращает подсказку для определения действий, связанных с этой способностью.
  - `actions_constraints_prompt() -> str`: 
    - Возвращает подсказку для определения ограничений для действий, связанных с этой способностью.


### `CustomMentalFaculty`

**Описание**: Представляет пользовательскую психическую способность, которую агент может использовать. 
Пользователь может определить действия, которые способность может выполнять, и ограничения, которые она вводит. 
Ограничения могут быть связаны с действиями, которые способность может выполнять, или более общими ограничениями, 
которые агент должен соблюдать.

**Наследует**: 
    - `TinyMentalFaculty`

**Атрибуты**:

  - `name` (str): Название психической способности.
  - `requires_faculties` (list): Список других психических способностей, которые необходимы для работы этой способности.
  - `actions_configs` (dict): Словарь с конфигурацией действий, которые эта способность может выполнять. 
    - Формат: {<имя_действия>: {"description": <описание>, "function": <функция>}}
  - `constraints` (dict): Список ограничений, введенных этой способностью. 
    - Формат: [<ограничение1>, <ограничение2>, ...]

**Методы**:

  - `add_action(action_name: str, description: str, function: Callable=None)`: 
    - Добавляет новое действие к конфигурации действий.
  - `add_actions(actions: dict)`: 
    - Добавляет несколько действий к конфигурации действий.
  - `add_action_constraint(constraint: str)`: 
    - Добавляет новое ограничение к списку ограничений.
  - `add_actions_constraints(constraints: list)`: 
    - Добавляет несколько ограничений к списку ограничений.
  - `process_action(agent, action: dict) -> bool`: 
    - Обрабатывает действие, связанное с этой способностью. 
    - Выполняет функцию, связанную с действием, если оно найдено в конфигурации действий. 
    - Возвращает `True`, если действие успешно обработано, `False` в противном случае.
  - `actions_definitions_prompt() -> str`: 
    - Возвращает подсказку для определения действий, связанных с этой способностью. 
    - Формирует подсказку на основе описаний действий из конфигурации действий.
  - `actions_constraints_prompt() -> str`: 
    - Возвращает подсказку для определения ограничений для действий, связанных с этой способностью.
    - Формирует подсказку на основе списка ограничений.


### `RecallFaculty`

**Описание**: Представляет психическую способность, которая позволяет агенту вспоминать информацию из своей памяти.

**Наследует**: 
    - `TinyMentalFaculty`

**Атрибуты**: 
  - `name` (str): Название психической способности.
  - `requires_faculties` (list): Список других психических способностей, которые необходимы для работы этой способности.

**Методы**:

  - `process_action(agent, action: dict) -> bool`: 
    - Обрабатывает действие, связанное с этой способностью. 
    - Если тип действия - "RECALL" и содержание не пусто, 
    - извлекает релевантные воспоминания из памяти агента.
    - Выводит сообщение о найденных воспоминаниях и использует их для дальнейших действий.
    - Возвращает `True`, если действие успешно обработано, `False` в противном случае.
  - `actions_definitions_prompt() -> str`: 
    - Возвращает подсказку для определения действий, связанных с этой способностью.
    - Формирует подсказку о том, что агент может вспомнить информацию из своей памяти, указав "mental query" для 
    - поиска нужного воспоминания.
  - `actions_constraints_prompt() -> str`: 
    - Возвращает подсказку для определения ограничений для действий, связанных с этой способностью.
    - Формирует подсказку о том, что агент должен попытаться вспомнить информацию из памяти, прежде чем утверждать, 
    - что он не знает чего-то или не имеет доступа к информации.
    - Также, подсказка описывает, как агент должен использовать "mental query" для поиска информации.


### `FilesAndWebGroundingFaculty`

**Описание**: Представляет психическую способность, которая позволяет агенту получить доступ к локальным файлам и веб-страницам 
для обоснования своих знаний.

**Наследует**: 
    - `TinyMentalFaculty`

**Атрибуты**:

  - `name` (str): Название психической способности.
  - `requires_faculties` (list): Список других психических способностей, которые необходимы для работы этой способности.
  - `local_files_grounding_connector` (`LocalFilesGroundingConnector`): 
    - Объект для взаимодействия с локальными файлами.
  - `web_grounding_connector` (`WebPagesGroundingConnector`): 
    - Объект для взаимодействия с веб-страницами.

**Методы**:

  - `process_action(agent, action: dict) -> bool`: 
    - Обрабатывает действие, связанное с этой способностью.
    - Если тип действия - "CONSULT" и содержание не пусто, 
    - извлекает документ из локальных файлов или веб-страниц по указанному имени.
    - Выводит сообщение о найденном документе или о том, что документ не найден.
    - Если тип действия - "LIST_DOCUMENTS", 
    - выводит список доступных документов.
    - Возвращает `True`, если действие успешно обработано, `False` в противном случае.
  - `actions_definitions_prompt() -> str`: 
    - Возвращает подсказку для определения действий, связанных с этой способностью.
    - Формирует подсказку о том, что агент может перечислить доступные документы или получить доступ к конкретному 
    - документу по его имени.
  - `actions_constraints_prompt() -> str`: 
    - Возвращает подсказку для определения ограничений для действий, связанных с этой способностью.
    - Формирует подсказку о том, что агент должен перечислить доступные документы, прежде чем получать доступ к 
    - ним, и что он должен использовать "CONSULT", а не "RECALL", когда ему нужна информация из конкретного документа.


### `TinyToolUse`

**Описание**: Представляет психическую способность, которая позволяет агенту использовать инструменты для выполнения задач.

**Наследует**: 
    - `TinyMentalFaculty`

**Атрибуты**:

  - `name` (str): Название психической способности.
  - `requires_faculties` (list): Список других психических способностей, которые необходимы для работы этой способности.
  - `tools` (list): Список инструментов, которые агент может использовать.

**Методы**:

  - `process_action(agent, action: dict) -> bool`: 
    - Обрабатывает действие, связанное с этой способностью.
    - Передает действие каждому инструменту из списка инструментов. 
    - Возвращает `True`, если хотя бы один инструмент успешно обработал действие, `False` в противном случае.
  - `actions_definitions_prompt() -> str`: 
    - Возвращает подсказку для определения действий, связанных с этой способностью.
    - Формирует подсказку на основе подсказок от каждого инструмента из списка инструментов.
  - `actions_constraints_prompt() -> str`: 
    - Возвращает подсказку для определения ограничений для действий, связанных с этой способностью.
    - Формирует подсказку на основе подсказок от каждого инструмента из списка инструментов. 

## Параметры класса

  - `name` (str): Название психической способности.
  - `requires_faculties` (list): Список других психических способностей, которые необходимы для работы этой способности.


## Примеры

```python
# Создание экземпляра психической способности "CustomMentalFaculty"
custom_faculty = CustomMentalFaculty(name="Custom Faculty", 
                                     actions_configs={"action1": {"description": "Описание действия 1", "function": None},
                                                     "action2": {"description": "Описание действия 2", "function": None}},
                                     constraints=["Ограничение 1", "Ограничение 2"])

# Добавление нового действия к конфигурации действий
custom_faculty.add_action("action3", "Описание действия 3", function=None)

# Добавление нескольких действий к конфигурации действий
custom_faculty.add_actions({"action4": {"description": "Описание действия 4", "function": None},
                           "action5": {"description": "Описание действия 5", "function": None}})

# Добавление нового ограничения к списку ограничений
custom_faculty.add_action_constraint("Ограничение 3")

# Добавление нескольких ограничений к списку ограничений
custom_faculty.add_actions_constraints(["Ограничение 4", "Ограничение 5"])

# Получение подсказки для определения действий
prompt = custom_faculty.actions_definitions_prompt()

# Получение подсказки для определения ограничений
constraints_prompt = custom_faculty.actions_constraints_prompt()

# Создание экземпляра психической способности "RecallFaculty"
recall_faculty = RecallFaculty()

# Создание экземпляра психической способности "FilesAndWebGroundingFaculty"
grounding_faculty = FilesAndWebGroundingFaculty(folders_paths=["/path/to/folder1", "/path/to/folder2"],
                                              web_urls=["https://example.com", "https://www.google.com"])

# Создание экземпляра психической способности "TinyToolUse"
tools = []  # Список инструментов
tool_use_faculty = TinyToolUse(tools=tools)

# Использование психической способности "TinyToolUse"
action = {"type": "TOOL_ACTION", "content": None}
tool_use_faculty.process_action(agent=None, action=action)
```

## Принцип работы

Модуль предоставляет классы для определения психических способностей агента. Каждый класс определяет набор 
действий, которые может выполнять способность, и ограничения, которые она вводит. Агент может использовать 
эти способности для выполнения различных задач.

## Как работает функция

**`process_action`**: Эта функция является основным методом для каждой психической способности. 
Она обрабатывает действия, связанные с данной способностью. 
Функция принимает два аргумента: `agent` - объект агента, который выполняет действие, 
и `action` - словарь, представляющий действие. 
Функция проверяет тип действия и выполняет соответствующую операцию. 
Например, для способности `RecallFaculty` функция `process_action` 
извлекает релевантные воспоминания из памяти агента, если тип действия - "RECALL".

**`actions_definitions_prompt`**: Эта функция генерирует подсказку для определения действий, 
связанных с данной способностью. 
Функция возвращает строку с описанием действий, которые агент может выполнить с помощью данной способности. 
Например, для способности `RecallFaculty` функция `actions_definitions_prompt` 
возвращает строку, описывающую, как агент может вспомнить информацию из своей памяти, указав "mental query" для 
поиска нужного воспоминания.

**`actions_constraints_prompt`**: Эта функция генерирует подсказку для определения ограничений, 
связанных с данной способностью. 
Функция возвращает строку с описанием ограничений, которые агент должен соблюдать при использовании данной 
способности. 
Например, для способности `RecallFaculty` функция `actions_constraints_prompt` 
возвращает строку, описывающую, что агент должен попытаться вспомнить информацию из памяти, 
прежде чем утверждать, что он не знает чего-то или не имеет доступа к информации. 
Также, подсказка описывает, как агент должен использовать "mental query" для поиска информации.
# Модуль `tiny_factory.py`

## Обзор

Этот модуль содержит класс `TinyFactory`, который представляет собой базовый класс для различных типов фабрик, используемых в системе `TinyTroupe`.  

## Классы

### `TinyFactory`

**Описание**: Базовый класс для различных типов фабрик. Обеспечивает механизмы для создания и управления фабриками, а также  поддерживает транзакционную кеширование.

**Наследует**:  

**Атрибуты**:

- `name` (str): Уникальное имя фабрики.
- `simulation_id` (str): Идентификатор симуляции, к которой принадлежит фабрика.

**Методы**:

- `__init__(self, simulation_id:str=None) -> None`: Инициализирует экземпляр `TinyFactory`. 
- `__repr__(self)`: Возвращает строковое представление объекта `TinyFactory`. 
- `set_simulation_for_free_factories(simulation)`:  Присваивает симуляцию фабрике, если ее идентификатор симуляции (`simulation_id`) не был определен.
- `add_factory(factory)`: Добавляет фабрику в глобальный список всех фабрик.
- `clear_factories()`: Очищает глобальный список всех фабрик.
- `encode_complete_state(self) -> dict`: Кодирует полное состояние фабрики.
- `decode_complete_state(self, state:dict)`: Декодирует полное состояние фабрики.

**Принцип работы**: 

Класс `TinyFactory`  определяет основные атрибуты и методы для фабрик, которые могут быть использованы для создания и управления агентами или другими объектами.  
- **Транзакционная кеширование**:  `TinyFactory` поддерживает транзакционную кеширование, что важно для согласованного состояния между фабриками и агентами, которые они создают.

**Примеры**:

```python
# Создание экземпляра фабрики
factory = TinyFactory(simulation_id='my_simulation')

# Проверка имени фабрики
print(factory.name)  # Вывод: Factory ... (уникальное имя)

# Проверка идентификатора симуляции
print(factory.simulation_id)  # Вывод: my_simulation

# Очистка глобального списка фабрик
TinyFactory.clear_factories()
```


## Внутренние функции

### `add_factory(factory)`

**Назначение**: Добавляет фабрику в глобальный список всех фабрик. 

**Параметры**:
- `factory` (TinyFactory): Экземпляр фабрики, который нужно добавить в список.

**Возвращает**: 
- `None`

**Вызывает исключения**: 
- `ValueError`: Если фабрика с таким же именем уже существует.

**Как работает функция**:

- Проверяет, существует ли уже фабрика с таким же именем.
- Если да, то генерируется ошибка.
- Если нет, то фабрика добавляется в глобальный список всех фабрик. 

### `clear_factories()`

**Назначение**: Очищает глобальный список всех фабрик.

**Параметры**:
- Отсутствуют.

**Возвращает**: 
- `None`

**Вызывает исключения**: 
- Отсутствуют.

**Как работает функция**:

- Устанавливает глобальный список всех фабрик в пустой словарь.

### `set_simulation_for_free_factories(simulation)`

**Назначение**:  Присваивает симуляцию фабрике, если ее идентификатор симуляции (`simulation_id`) не был определен. 

**Параметры**:
- `simulation` (Simulation): Экземпляр симуляции, который нужно присвоить.

**Возвращает**: 
- `None`

**Вызывает исключения**: 
- Отсутствуют.

**Как работает функция**:

- Перебирает все фабрики в глобальном списке.
- Если идентификатор симуляции фабрики не установлен, то  присваивает ей  идентификатор симуляции из аргумента `simulation`.

### `encode_complete_state(self) -> dict`

**Назначение**: Кодирует полное состояние фабрики. 

**Параметры**:
- `self` (TinyFactory): Текущий экземпляр `TinyFactory`.

**Возвращает**: 
- `dict`: Словарь, представляющий сериализованное состояние фабрики.

**Вызывает исключения**: 
- Отсутствуют.

**Как работает функция**:

- Создает глубокую копию словаря атрибутов текущего экземпляра `TinyFactory`.
- Возвращает эту копию как словарь.

### `decode_complete_state(self, state:dict)`

**Назначение**: Декодирует полное состояние фабрики. 

**Параметры**:
- `self` (TinyFactory): Текущий экземпляр `TinyFactory`.
- `state` (dict): Словарь, содержащий сериализованное состояние фабрики.

**Возвращает**: 
- `TinyFactory`:  Текущий экземпляр `TinyFactory` с обновленными атрибутами.

**Вызывает исключения**: 
- Отсутствуют.

**Как работает функция**:

- Создает глубокую копию словаря `state`.
- Обновляет атрибуты текущего экземпляра `TinyFactory` значениями из словаря `state`.
- Возвращает текущий экземпляр `TinyFactory`.


## Параметры класса

- `all_factories` (dict): Глобальный словарь всех созданных фабрик.  Ключи — имена фабрик, значения — экземпляры фабрик.

## Примеры

```python
# Создание фабрики
factory = TinyFactory(simulation_id='my_simulation')

# Получение состояния фабрики
state = factory.encode_complete_state()

# Создание новой фабрики из сохраненного состояния
new_factory = TinyFactory().decode_complete_state(state)

# Проверка, что новая фабрика имеет те же атрибуты
print(new_factory.name == factory.name)  # Вывод: True
print(new_factory.simulation_id == factory.simulation_id)  # Вывод: True
```
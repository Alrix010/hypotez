# Модуль тестирования `test_intervention.py`

## Обзор

Модуль содержит набор тестов для проверки функциональности класса `Intervention` из модуля `tinytroupe.steering`. 
Тесты проверяют, как `Intervention` влияет на поведение персонажей в `TinyWorld` на основе заданных условий и эффектов.

## Подробней

В модуле определен один тест - `test_intervention_1`, который создает персонажа Оскара, задает ему начальное состояние (грусть) и определяет интервенцию, изменяющую его поведение. 
Тест проверяет, что после применения интервенции Оскар начинает говорить о вещах, приносящих радость.

## Классы

### `Intervention`

**Описание**: Класс для определения интервенций, изменяющих поведение персонажей в `TinyWorld` на основе заданных условий и эффектов.

**Атрибуты**:
- Нет явно определенных атрибутов в коде, но класс имеет методы для установки текстового предусловия и эффекта интервенции.

**Методы**:
- `set_textual_precondition(condition: str) -> Intervention`: Устанавливает текстовое предусловие для интервенции.
- `set_effect(effect: Callable[[Any], None]) -> Intervention`: Устанавливает эффект интервенции, который будет применен к целевому персонажу.

### `ABRandomizer`

**Описание**: Класс для проведения A/B-тестирования различных стратегий или параметров.

**Атрибуты**:
- Нет явно определенных атрибутов в коде.

**Методы**:
- Нет явно определенных методов в коде.

### `Proposition`

**Описание**: Класс для представления утверждений о состоянии мира или персонажей.

**Атрибуты**:
- Нет явно определенных атрибутов в коде.

**Методы**:
- Нет явно определенных методов в коде.

### `TinyWorld`

**Описание**: Класс для создания виртуального мира, в котором живут и взаимодействуют персонажи.

**Атрибуты**:
- `name` (str): Название мира.
- `agents` (List[Agent]): Список агентов, населяющих мир.
- `interventions` (List[Intervention]): Список интервенций, которые могут быть применены в мире.

**Методы**:
- `run(ticks: int) -> None`: Запускает симуляцию мира на заданное количество тиков.

## Функции

### `test_intervention_1`

**Назначение**: Проверяет, как интервенция изменяет поведение персонажа в `TinyWorld`.

```python
def test_intervention_1():
    """
    Тест проверяет, что интервенция изменяет поведение персонажа Оскара в TinyWorld.

    Создается персонаж Оскар, задается ему начальное состояние (грусть) и определяется интервенция,
    которая изменяет его поведение, заставляя говорить о вещах, приносящих радость.
    """
    oscar = create_oscar_the_architect()

    oscar.think("I am terribly sad, as a dear friend has died. I'm going now to verbalize my sadness.")
    oscar.act()

    assert check_proposition(oscar, "Oscar is talking about something sad or unfortunate.", last_n=3)

    intervention = \
        Intervention(oscar) \
        .set_textual_precondition("Oscar is not very happy.") \
        .set_effect(lambda target: target.think("Enough sadness. I will now talk about something else that makes me happy."))

    world = TinyWorld("Test World", [oscar], interventions=[intervention])

    world.run(2)

    assert check_proposition(oscar, "Oscar is talking about something that brings joy or happiness to him.", last_n=3)

    # TODO
```

**Как работает функция**:
1. Создается персонаж Оскар с использованием функции `create_oscar_the_architect`.
2. Оскар выражает свою грусть.
3. Проверяется, что Оскар говорит о чем-то грустном или неприятном.
4. Определяется интервенция, которая срабатывает, если Оскар не очень счастлив, и заставляет его думать о вещах, приносящих радость.
5. Создается мир `TinyWorld` с Оскаром и определенной интервенцией.
6. Запускается симуляция мира на 2 тика.
7. Проверяется, что после применения интервенции Оскар говорит о вещах, приносящих радость.

**Примеры**:
```python
test_intervention_1()
```

### `create_oscar_the_architect`

**Назначение**: Функция создает персонажа Оскара архитектора.

### `create_oscar_the_architect_2`

**Назначение**: Функция создает персонажа Оскара архитектора.

### `create_lisa_the_data_scientist`

**Назначение**: Функция создает персонажа Лизу, специалиста по анализу данных.

### `create_lisa_the_data_scientist_2`

**Назначение**: Функция создает персонажа Лизу, специалиста по анализу данных.

### `check_proposition`

**Назначение**: Проверяет, соответствует ли поведение персонажа заданному утверждению.

**Параметры**:
- `agent` (Agent): Персонаж, поведение которого проверяется.
- `proposition` (str): Текст утверждения, которому должно соответствовать поведение персонажа.
- `last_n` (int): Количество последних действий персонажа, которые учитываются при проверке.

**Возвращает**:
- `bool`: `True`, если поведение персонажа соответствует утверждению, и `False` в противном случае.
# Модуль для работы с Excel файлами (xls.py)

## Обзор

Этот модуль предоставляет функции для преобразования файлов Excel (`xls`, `xlsx`) в формат JSON и наоборот, а также для работы с данными Excel.

## Подробней

Модуль `src.utils.xls` предназначен для упрощения работы с Excel файлами в проекте `hypotez`. Он предоставляет функции для чтения данных из Excel файлов в различные структуры данных (словари, списки), преобразования этих данных в формат JSON и сохранения данных из JSON обратно в Excel файлы. Модуль использует библиотеку `pandas` для работы с данными Excel и обеспечивает логирование ошибок с использованием модуля `logging`.

## Функции

### `read_xls_as_dict`

**Назначение**: Читает Excel файл и преобразует его в JSON. Опционально, преобразует конкретный лист и сохраняет результат в JSON файл. Обрабатывает ошибки.

```python
def read_xls_as_dict(
    xls_file: str,
    json_file: str = None,
    sheet_name: Union[str, int] = None
) -> Union[Dict, List[Dict], bool]:
    """
    Reads an Excel file and converts it to JSON.  Optionally, converts a specific sheet and saves the result to a JSON file.
    Handles errors gracefully.
    """
    ...
```

**Параметры**:

-   `xls_file` (str): Путь к Excel файлу.
-   `json_file` (str, optional): Путь для сохранения JSON файла. Если `None`, JSON не сохраняется в файл. По умолчанию `None`.
-   `sheet_name` (Union[str, int], optional): Имя или индекс листа Excel для чтения. Если `None`, читаются все листы. По умолчанию `None`.

**Возвращает**:

-   `Union[Dict, List[Dict], bool]`: Словарь, содержащий данные из Excel файла, список словарей (если указан конкретный лист) или `False` в случае ошибки.

**Вызывает исключения**:

-   `FileNotFoundError`: Если Excel файл не найден.
-   `Exception`: При возникновении других ошибок при обработке файла.

**Как работает функция**:

1.  Проверяет, существует ли указанный Excel файл.
2.  Создает объект `pd.ExcelFile` для чтения Excel файла.
3.  Если `sheet_name` не указан, читает все листы Excel файла и сохраняет их содержимое в словаре, где ключами являются имена листов, а значениями - списки словарей, представляющие строки данных.
4.  Если `sheet_name` указан, читает только указанный лист и сохраняет его содержимое в список словарей.
5.  Если указан `json_file`, сохраняет данные в файл в формате JSON.
6.  Логирует информацию об успешном сохранении JSON или возникших ошибках.
7.  Возвращает данные в виде словаря или списка словарей (в зависимости от того, был ли указан `sheet_name`).

### `save_xls_file`

**Назначение**: Сохраняет JSON данные в Excel файл. Обрабатывает ошибки.

```python
def save_xls_file(data: Dict[str, List[Dict]], file_path: str) -> bool:
    """Saves JSON data to an Excel file. Handles errors gracefully."""
    ...
```

**Параметры**:

-   `data` (Dict[str, List[Dict]]): Данные для сохранения в Excel файл. Ключи словаря - имена листов, значения - списки словарей, представляющие строки данных.
-   `file_path` (str): Путь к файлу Excel для сохранения.

**Возвращает**:

-   `bool`: `True`, если сохранение прошло успешно, `False` - в противном случае.

**Как работает функция**:

1.  Создает объект `pd.ExcelWriter` для записи в Excel файл, используя движок `xlsxwriter`.
2.  Перебирает листы и строки данных в словаре `data`.
3.  Для каждого листа создает объект `pd.DataFrame` из списка словарей.
4.  Записывает DataFrame в Excel файл, используя `df.to_excel`.
5.  Логирует информацию об успешном сохранении листа или возникших ошибках.
6.  Сохраняет Excel файл.

## Переменные модуля

В данном модуле отсутствуют переменные, за исключением констант, определенных внутри функций (если бы они были).

## Пример использования

**Чтение и опциональное сохранение в JSON:**

```python
from src.utils import xls

data = xls.read_xls_as_dict('input.xlsx', 'output.json', 'Sheet1')  # Чтение листа с именем 'Sheet1'
if data:
    print(data)  # Вывод: {'Sheet1': [{...}]}
```

**Сохранение из JSON данных:**

```python
from src.utils import xls

data_to_save = {'Sheet1': [{'column1': 'value1', 'column2': 'value2'}]}
success = xls.save_xls_file(data_to_save, 'output.xlsx')
if success:
    print("Successfully saved to output.xlsx")
```

## Взаимосвязь с другими частями проекта

-   Этот модуль зависит от библиотеки `pandas` для работы с данными Excel и от модуля `src.logger.logger` для логирования.
-   Модуль может использоваться другими частями проекта `hypotez` для импорта данных из Excel файлов, экспорта данных в Excel файлы или для преобразования данных между форматами Excel и JSON.
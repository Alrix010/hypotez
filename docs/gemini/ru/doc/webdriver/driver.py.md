### Анализ кода модуля `src/webdriver/driver.py`

## Обзор

Этот модуль предоставляет базовый класс `Driver` для работы с веб-драйверами Selenium, обеспечивая унифицированный интерфейс для взаимодействия с различными браузерами, такими как Chrome, Firefox и Edge.

## Подробней

Модуль `src/webdriver/driver.py` содержит класс `Driver`, который служит основой для работы с веб-драйверами Selenium в проекте `hypotez`. Он предоставляет абстракцию над конкретными реализациями драйверов (Chrome, Firefox и т.д.), упрощая задачи инициализации драйвера, навигации по URL, управления куками и обработки исключений.

## Классы

### `Driver`

**Описание**: Обеспечивает удобный интерфейс для работы с различными драйверами, такими как Chrome, Firefox и Edge.

**Атрибуты**:

-   `driver` (selenium.webdriver): Экземпляр Selenium WebDriver.

**Методы**:

-   `__init__(self, webdriver_cls, *args, **kwargs)`: Инициализирует экземпляр класса `Driver`.
-   `__init_subclass__(cls, *, browser_name: Optional[str] = None, **kwargs)`: Автоматически вызывается при создании подкласса `Driver`.
-   `__getattr__(self, item: str)`: Прокси для доступа к атрибутам драйвера.
-   `scroll(self, scrolls: int = 1, frame_size: int = 600, direction: str = 'both', delay: float = .3) -> bool`: Прокручивает страницу в указанном направлении.
-   `locale(self) -> Optional[str]`: Определяет язык страницы на основе мета-тегов или JavaScript.
-   `get_url(self, url: str) -> bool`: Переходит по указанному URL и сохраняет текущий URL, предыдущий URL и куки.
-   `window_open(self, url: Optional[str] = None) -> None`: Открывает новую вкладку в текущем окне браузера и переключается на нее.
-   `wait(self, delay: float = .3) -> None`: Ожидает указанное количество времени.
-   `_save_cookies_localy(self) -> None`: Сохраняет текущие куки веб-драйвера в локальный файл.
-   `fetch_html(self, url: str) -> Optional[bool]`: Извлекает HTML-контент из файла или веб-страницы.

#### `__init__`

**Назначение**: Инициализирует экземпляр класса `Driver`.

```python
def __init__(self, webdriver_cls, *args, **kwargs):
    """
    Инициализирует экземпляр класса Driver.

    Args:
        webdriver_cls: Класс WebDriver, например Chrome или Firefox.
        args: Позиционные аргументы для драйвера.
        kwargs: Ключевые аргументы для драйвера.

    Raises:
        TypeError: Если `webdriver_cls` не является допустимым классом WebDriver.

    Example:
        >>> from selenium.webdriver import Chrome
        >>> driver = Driver(Chrome, executable_path='/path/to/chromedriver')
    """
    ...
```

**Параметры**:

-   `webdriver_cls`: Класс WebDriver, например `Chrome` или `Firefox`.
-   `*args`: Позиционные аргументы для драйвера.
-   `**kwargs`: Ключевые аргументы для драйвера.

**Вызывает исключения**:

-   `TypeError`: Если `webdriver_cls` не является допустимым классом WebDriver.

**Как работает функция**:

1.  Проверяет, является ли `webdriver_cls` допустимым классом WebDriver (имеет ли атрибут `get`).
2.  Создает экземпляр класса WebDriver, используя переданные аргументы.

#### `__init_subclass__`

**Назначение**: Автоматически вызывается при создании подкласса `Driver`.

```python
def __init_subclass__(cls, *, browser_name: Optional[str] = None, **kwargs):
    """
    Автоматически вызывается при создании подкласса `Driver`.

    Args:
        browser_name: Имя браузера.
        kwargs: Дополнительные аргументы.

    Raises:
        ValueError: Если browser_name не указан.
    """
    ...
```

**Параметры**:

-   `browser_name`: Имя браузера.
-   `kwargs`: Дополнительные аргументы.

**Вызывает исключения**:

-   `ValueError`: Если `browser_name` не указан.

**Как работает функция**:

1.  Вызывает конструктор базового класса.
2.  Проверяет, указано ли имя браузера (`browser_name`).
3.  Если имя браузера не указано, вызывает исключение `ValueError`.
4.  Сохраняет имя браузера в атрибуте класса `browser_name`.

#### `__getattr__`

**Назначение**: Прокси для доступа к атрибутам драйвера.

```python
def __getattr__(self, item: str):
    """
    Прокси для доступа к атрибутам драйвера.

    Args:
        item: Имя атрибута.

    Example:
        >>> driver.current_url
    """
    ...
```

**Параметры**:

-   `item` (str): Имя атрибута.

**Как работает функция**:

1.  Перехватывает попытки доступа к несуществующим атрибутам объекта `Driver`.
2.  Перенаправляет запрос к соответствующему атрибуту объекта `self.driver` (экземпляра WebDriver).

#### `scroll`

**Назначение**: Прокручивает страницу в указанном направлении.

```python
def scroll(self, scrolls: int = 1, frame_size: int = 600, direction: str = 'both', delay: float = .3) -> bool:
    """
    Прокручивает страницу в указанном направлении.

    Args:
        scrolls: Количество прокруток, по умолчанию 1.
        frame_size: Размер прокрутки в пикселях, по умолчанию 600.
        direction: Направление ('both', 'down', 'up'), по умолчанию 'both'.
        delay: Задержка между прокрутками, по умолчанию 0.3.

    Returns:
        True, если успешно, иначе False.

    Example:
        >>> driver.scroll(scrolls=3, direction='down')
    """
    ...
```

**Параметры**:

-   `scrolls` (int): Количество прокруток, по умолчанию 1.
-   `frame_size` (int): Размер прокрутки в пикселях, по умолчанию 600.
-   `direction` (str): Направление прокрутки ('both', 'down', 'up'), по умолчанию 'both'.
-   `delay` (float): Задержка между прокрутками, по умолчанию 0.3.

**Возвращает**:

-   `True`, если прокрутка прошла успешно, `False` - в противном случае.

**Как работает функция**:

1.  Определяет внутреннюю функцию `carousel` для выполнения фактической прокрутки.
2.  В зависимости от значения параметра `direction`, вызывает функцию `carousel` с соответствующими параметрами.
3.  Обрабатывает возможные исключения, возникающие при прокрутке страницы, и логирует информацию об ошибке.

#### `locale`

**Назначение**: Определяет язык страницы на основе мета-тегов или JavaScript.

```python
@property
def locale(self) -> Optional[str]:
    """
    Определяет язык страницы на основе мета-тегов или JavaScript.

    Returns:
        Код языка, если найден, иначе None.

    Example:
        >>> lang = driver.locale
        >>> print(lang)  # 'en' или None
    """
    ...
```

**Возвращает**:

-   Код языка, если найден, или `None`.

**Как работает функция**:

1.  Пытается найти элемент `<meta>` с атрибутом `http-equiv="Content-Language"` и извлечь значение атрибута `content`.
2.  Если не удается найти мета-тег, пытается получить язык страницы с использованием JavaScript.
3.  Возвращает код языка или `None`, если не удается определить язык.
4.  Для логирования ошибок используется модуль `logger`.

#### `get_url`

**Назначение**: Переходит по указанному URL и сохраняет текущий URL, предыдущий URL и куки.

```python
def get_url(self, url: str) -> bool:
    """
    Переходит по указанному URL и сохраняет текущий URL, предыдущий URL и куки.

    Args:
        url: URL для перехода.

    Returns:
        `True`, если переход успешен и текущий URL совпадает с ожидаемым, `False` в противном случае.

    Raises:
        WebDriverException: Если возникает ошибка с WebDriver.
        InvalidArgumentException: Если URL некорректен.
        Exception: Для любых других ошибок при переходе.
    """
    ...
```

**Параметры**:

-   `url` (str): URL для перехода.

**Возвращает**:

-   `bool`: `True`, если переход успешен, `False` - в противном случае.

**Вызывает исключения**:

-   `WebDriverException`: Если возникает ошибка с WebDriver.
-   `InvalidArgumentException`: Если URL некорректен.
-   `Exception`: Для любых других ошибок при переходе.

**Как работает функция**:

1.  Сохраняет текущий URL в переменную `_previous_url`.
2.  Выполняет переход по указанному URL с помощью `self.driver.get(url)`.
3.  Сохраняет куки.
4.  Логирует информацию об ошибках, используя `logger.error`.

#### `window_open`

**Назначение**: Открывает новую вкладку в текущем окне браузера и переключается на нее.

```python
def window_open(self, url: Optional[str] = None) -> None:
    """Open a new tab in the current browser window and switch to it.

    Args:
        url: URL to open in the new tab. Defaults to `None`.
    """
    ...
```

**Параметры**:

-   `url` (Optional[str]): URL для открытия в новой вкладке. По умолчанию `None`.

**Как работает функция**:

1.  Выполняет JavaScript-код `window.open();` для открытия новой вкладки.
2.  Переключается на новую вкладку, используя `self.switch_to.window(self.window_handles[-1])`.
3.  Если указан URL, выполняет переход по этому URL в новой вкладке.

#### `wait`

**Назначение**: Ожидает указанное количество времени.

```python
def wait(self, delay: float = .3) -> None:
    """
    Ожидает указанное количество времени.

    Args:
        delay: Время задержки в секундах. По умолчанию 0.3.

    Returns:
        None
    """
    ...
```

**Параметры**:

-   `delay` (float): Время задержки в секундах. По умолчанию 0.3.

**Как работает функция**:

1.  Приостанавливает выполнение на указанное количество секунд, используя `time.sleep(delay)`.

#### `_save_cookies_localy`

**Назначение**: Сохраняет текущие куки веб-драйвера в локальный файл.

```python
def _save_cookies_localy(self) -> None:
    """
    Сохраняет текущие куки веб-драйвера в локальный файл.

    Returns:
        None

    Raises:
        Exception: Если возникает ошибка при сохранении куки.
    """
    ...
```

**Вызывает исключения**:

-   `Exception`: Если возникает ошибка при сохранении куки.

**Как работает функция**:

1.  Сохраняет куки веб-драйвера в локальный файл, используя `pickle.dump`.
2.  В случае возникновения исключения логирует ошибку, используя `logger.error`.

#### `fetch_html`

**Назначение**: Извлекает HTML-контент из файла или веб-страницы.

```python
def fetch_html(self, url: str) -> Optional[bool]:
    """
    Извлекает HTML-контент из файла или веб-страницы.

    Args:
        url: Путь к файлу или URL для извлечения HTML-контента.

    Returns:
        Возвращает `True`, если контент успешно получен, иначе `None`.

    Raises:
        Exception: Если возникает ошибка при извлечении контента.
    """
    ...
```

**Параметры**:

-   `url` (str): Путь к файлу или URL для извлечения HTML-контента.

**Возвращает**:

-   Возвращает `True`, если контент успешно получен, иначе `None`.

**Как работает функция**:

1.  Проверяет, является ли URL ссылкой на локальный файл (`file://`) или веб-страницей (`http://` или `https://`).
2.  Если это локальный файл, извлекает путь к файлу и пытается прочитать его содержимое.
3.  Если это веб-страница, переходит по указанному URL, используя функцию `self.get_url`, и сохраняет исходный код страницы в атрибуте `self.html_content`.
4.  Логирует информацию об ошибках, используя `logger.error`.

## Переменные модуля

-   В этом модуле отсутствуют глобальные переменные, за исключением импортированных модулей и констант, определенных внутри функций (если бы они были).

## Пример использования

**Создание экземпляра драйвера и переход по URL:**

```python
from src.webdriver import Driver
from selenium.webdriver import Firefox

driver = Driver(Firefox)
success = driver.get_url("https://www.example.com")
if success:
    print("Переход выполнен успешно!")
else:
    print("Не удалось перейти по URL.")
driver.quit()
```

## Взаимосвязь с другими частями проекта

-   Модуль `src/webdriver/driver.py` зависит от библиотеки `selenium` для работы с веб-драйверами, от модуля `header` для получения пути к файлу настроек, от модуля `src.logger.logger` для логирования и от модуля `src.logger.exceptions` для обработки исключений.
-   Он предоставляет базовый класс `Driver`, который используется в других модулях для управления веб-браузерами и выполнения различных действий на веб-страницах.
# Модуль для подготовки кода для ввода в AI

## Обзор

Этот модуль предназначен для сбора содержимого определенных файлов в директории `src`, исключая ненужные директории и файлы, и сохранения собранного содержимого в один текстовый файл для использования в качестве входных данных для моделей машинного обучения.

## Подробней

Модуль автоматизирует процесс подготовки данных для машинного обучения, собирая код из различных файлов проекта в единый формат. Он позволяет исключить нерелевантные файлы и директории, такие как логи, временные файлы и артефакты сборки, и сфокусироваться на основном коде проекта. Поддерживаются файлы с расширениями `.py`, `.json`, `.md`, `.dot` и `.mer`.

## Функции

### `collect_file_contents`

**Назначение**: Рекурсивно собирает содержимое указанных файлов.

```python
def collect_file_contents(directory: Path, target_directory: Path) -> dict:
    """ Recursively collects the content of specific files.

    Traverses the specified `directory`, filters out unwanted directories and files,
    and collects the content of remaining files with specific extensions.

    Args:
        directory (Path): Path to the source directory to scan.
        target_directory (Path): Path to save the final text file for ML input.

    Returns:
        dict: A dictionary where keys are file paths and values are file contents.
    """
    ...
```

**Параметры**:

-   `directory` (Path): Путь к исходной директории для сканирования.
-   `target_directory` (Path): Путь к директории, в которой будет сохранен конечный текстовый файл для ввода в ML.

**Возвращает**:

-   `contents` (dict): Словарь, где ключи - это пути к файлам, а значения - содержимое файлов.

**Как работает функция**:

1.  Создает пустой словарь `contents` для хранения содержимого файлов.
2.  Перебирает все элементы (файлы и поддиректории) в указанной директории.
3.  Для каждой поддиректории проверяет, не входит ли ее имя в список исключений (`'profiles'`, `'__pycache__'`, `'_experiments'`) и не начинается ли оно с `'___'`, а также не содержит ли символ `'*'`. Если поддиректория не исключена, рекурсивно вызывает саму себя для обработки содержимого этой поддиректории и добавляет результат в словарь `contents`.
4.  Для каждого файла проверяет, имеет ли он одно из разрешенных расширений (`'.py'`, `'.json'`, `'.md'`, `'.dot'`, `'.mer'`), не начинается ли его имя с `'___'`, и не содержит ли символы `'*'`, `'('` или `')'`. Если файл соответствует условиям, открывает файл, считывает его содержимое и сохраняет в словаре `contents`, используя путь к файлу в качестве ключа.
5.  Возвращает словарь `contents`.

### `save_contents_to_text`

**Назначение**: Сохраняет собранное содержимое файлов в один текстовый файл.

```python
def save_contents_to_text(contents: dict, output_file: Path):
    """ Saves collected file contents to a single text file.

    Args:
        contents (dict): Dictionary with file paths as keys and file contents as values.
        output_file (Path): Path to the output text file for ML input.
    """
    ...
```

**Параметры**:

-   `contents` (dict): Словарь с путями к файлам в качестве ключей и содержимым файлов в качестве значений.
-   `output_file` (Path): Путь к выходному текстовому файлу для ввода в ML.

**Как работает функция**:

1.  Принимает словарь с содержимым файлов и путь к выходному файлу.
2.  Открывает выходной файл для записи.
3.  Перебирает элементы словаря `contents`.
4.  Для каждого элемента (пути к файлу и содержимого файла) записывает в выходной файл строку "File: {path}" и содержимое файла.
5.  После каждого файла добавляет разделитель в виде строки из 80 символов `=` и двух переносов строки.

### `main`

**Назначение**: Основная функция для запуска процесса сбора содержимого и сохранения в текстовый файл.

```python
def main():
    """ Main function to initiate content collection and save to a text file."""
    ...
```

**Параметры**:

-   Нет.

**Возвращает**:

-   Нет.

**Как работает функция**:

1.  Определяет исходную директорию для сбора файлов (`src_directory`) как `src/utils` относительно корневой директории проекта.
2.  Определяет директорию для сохранения выходного файла (`project_structure_directory`) как `prod` внутри исходной директории и создает ее, если она не существует.
3.  Вызывает функцию `collect_file_contents` для сбора содержимого файлов из исходной директории.
4.  Формирует путь к выходному файлу (`output_file_path`) как `all_file_contents.txt` внутри директории для сохранения.
5.  Вызывает функцию `save_contents_to_text` для сохранения собранного содержимого в текстовый файл.

## Запуск модуля

В блоке `if __name__ == "__main__":` вызывается функция `main()` для запуска процесса сбора и сохранения содержимого файлов.

```python
if __name__ == "__main__":
    main()
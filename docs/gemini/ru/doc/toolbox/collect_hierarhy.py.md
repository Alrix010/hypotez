# Модуль для сбора иерархии файлов

## Обзор

Модуль предназначен для рекурсивного обхода указанной директории, сбора иерархии файлов и их копирования в другую директорию. Он позволяет фильтровать файлы по расширению и имени, а также исключать определенные директории из обработки. Собранная иерархия сохраняется в формате JSON.

## Подробнее

Этот модуль используется для автоматического создания копии структуры файлов и директорий из исходной директории в целевую, попутно собирая информацию об иерархии файлов. Он фильтрует файлы по расширению (`.py`, `.json`, `.md`, `.dot`, `.mer`) и исключает директории с определенными именами (`profiles`, `__pycache__`, `_experiments`) или начинающиеся с `___` или содержащие символ `*`. Собранная иерархия сохраняется в JSON-файл, что упрощает дальнейшую обработку и анализ структуры проекта.

## Функции

### `collect_and_copy_files`

```python
def collect_and_copy_files(directory: Path, target_directory: Path) -> dict:
    """
    Рекурсивно проходит по каждому элементу в директории, копирует файлы подходящего типа в целевой каталог и
    возвращает словарь с иерархией файлов.
    
    Args:
        directory (Path): Путь к директории, которую необходимо обработать.
        target_directory (Path): Путь к директории, в которую необходимо скопировать файлы.
        
    Returns:
        dict: Словарь с иерархией файлов, где ключами являются имена файлов и папок.
    """
    ...
```

**Назначение**:
Функция `collect_and_copy_files` рекурсивно проходит по указанной директории, копирует файлы с определенными расширениями в целевую директорию и возвращает словарь, представляющий иерархию файлов.

**Параметры**:

- `directory` (Path): Путь к директории, которую необходимо обработать.
- `target_directory` (Path): Путь к директории, в которую необходимо скопировать файлы.

**Возвращает**:

- `dict`: Словарь, представляющий иерархию файлов и поддиректорий. Ключи словаря - имена файлов и директорий, значения - либо `None` (для файлов), либо рекурсивно построенные словари для поддиректорий.

**Как работает функция**:

1.  Инициализирует пустой словарь `hierarchy` для хранения иерархии файлов.
2.  Перебирает все элементы (файлы и поддиректории) в указанной директории.
3.  Для каждого элемента:
    -   Если элемент является директорией и не входит в список исключений (`profiles`, `__pycache__`, `_experiments`) и ее имя не начинается с `___` и не содержит символ `*`, то:
        -   Рекурсивно вызывает `collect_and_copy_files` для этой директории, передавая путь к новой поддиректории в целевом каталоге.
        -   Добавляет результат рекурсивного вызова в словарь `hierarchy`, используя имя директории в качестве ключа.
    -   Если элемент является файлом, имеет одно из разрешенных расширений (`.py`, `.json`, `.md`, `.dot`, `.mer`), и его имя не начинается с `___`, не содержит символы `*`, `(` или `)`, то:
        -   Добавляет запись о файле в словарь `hierarchy`, используя имя файла в качестве ключа и `None` в качестве значения.
        -   Создает необходимые поддиректории в целевом каталоге, если они не существуют.
        -   Копирует файл в целевой каталог с сохранением структуры директорий.
4.  Возвращает словарь `hierarchy`.

### `main`

```python
def main():
    """
    Устанавливает начальную папку для поиска, создает папку для сохранения результатов, вызывает
    `collect_and_copy_files` для сбора структуры файлов и записывает её в `file_hierarchy.json`.
    """
    ...
```

**Назначение**:
Функция `main` является основной точкой входа в скрипт. Она устанавливает исходную и целевую директории, вызывает функцию `collect_and_copy_files` для сбора иерархии файлов и сохраняет ее в файл `file_hierarchy.json`.

**Параметры**:
-   Отсутствуют.

**Возвращает**:
-   `None`

**Как работает функция**:

1.  Определяет путь к исходной директории (`src/utils`) и сохраняет его в переменной `src_directory`.
2.  Определяет путь к целевой директории (`src/utils/prod`) и сохраняет его в переменной `project_structure_directory`.
3.  Вызывает функцию `collect_and_copy_files`, передавая ей исходную и целевую директории. Сохраняет возвращенный словарь в переменной `file_hierarchy`.
4.  Определяет путь к файлу, в который будет сохранена иерархия (`src/utils/prod/file_hierarchy.json`) и сохраняет его в переменной `json_output_path`.
5.  Использует функцию `j_dumps` для сохранения словаря `file_hierarchy` в формате JSON в указанный файл.

## Примеры

### Пример использования модуля

```python
from pathlib import Path
from shutil import copy2
from src.utils.jjson import j_dumps
from dev_utils.collect_hierarhy import collect_and_copy_files, main
import header

if __name__ == "__main__":
    main()
```

Этот код выполняет следующие действия:

1.  Импортирует необходимые модули и функции.
2.  Вызывает функцию `main`, которая выполняет сбор иерархии файлов и их копирование, а также сохраняет иерархию в JSON-файл.
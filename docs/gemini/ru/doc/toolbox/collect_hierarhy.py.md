# Модуль для сбора иерархии файлов и их копирования

## Обзор

Этот модуль предназначен для рекурсивного прохода по указанной директории, сбора иерархии файлов определенных типов, и копирования этих файлов в другую директорию с сохранением структуры.

## Подробней

Модуль предназначен для автоматизации процесса сбора файлов определенных расширений из указанной директории, фильтрации этих файлов по определенным критериям и сохранения их в другую директорию с сохранением структуры. Это может быть полезно для создания резервных копий, подготовки данных для анализа или обучения моделей.

## Функции

### `collect_and_copy_files`

**Назначение**: Рекурсивно проходит по директории, собирает иерархию файлов и копирует файлы в целевую директорию.

```python
def collect_and_copy_files(directory: Path, target_directory: Path) -> dict:
    """
    Рекурсивно проходит по каждому элементу в директории. Если элемент — папка, то вызывается рекурсия для обработки её содержимого,
    и создаётся поддиректория в целевом каталоге. Если элемент — файл подходящего типа, он копируется в целевой каталог
    (`target_directory`) с сохранением структуры. Возвращает словарь с иерархией файлов, где ключами являются имена файлов и папок.
    """
    ...
```

**Параметры**:
- `directory` (Path): Путь к директории, которую нужно обработать.
- `target_directory` (Path): Путь к директории, в которую нужно скопировать файлы.

**Возвращает**:
- `hierarchy` (dict): Словарь с иерархией файлов и папок. Ключи - имена файлов и папок, значения - вложенные словари для папок и `None` для файлов.

**Как работает функция**:
1.  Создает пустой словарь `hierarchy` для хранения иерархии файлов.
2.  Перебирает все элементы (файлы и поддиректории) в указанной директории.
3.  Для каждой поддиректории, если её имя не входит в список исключений (`'profiles'`, `'__pycache__'`, `'_experiments'`) и не начинается с `'___'`, и не содержит символ `'*'`, рекурсивно вызывает саму себя для обработки содержимого этой поддиректории. Результат рекурсивного вызова добавляется в словарь `hierarchy` под именем текущей поддиректории.
4.  Для каждого файла, если его расширение входит в список разрешенных (`'.py'`, `'.json'`, `'.md'`, `'.dot'`, `'.mer'`), и его имя не начинается с `'___'`, и не содержит символы `'*'`, `'('` или `')'`, файл копируется в целевую директорию с сохранением структуры. Информация о файле (имя файла и значение `None`) добавляется в словарь `hierarchy`.
5.  Возвращает словарь `hierarchy`.
6.  Создает поддиректории в целевом каталоге используя `target_file_path.parent.mkdir(parents=True, exist_ok=True)`
7.  Копирует файлы в целевой каталог, используя `copy2(item, target_file_path)`
### `main`

**Назначение**: Устанавливает параметры и запускает процесс сбора и копирования файлов.

```python
def main():
    """
    Устанавливает начальную папку `src/utils` для поиска (`src_directory`) и создаёт папку `prod` для сохранения результатов.
    Вызывает `collect_and_copy_files` для сбора структуры файлов и записывает её в `file_hierarchy.json`
    с использованием функции `j_dumps`.
    """
    ...
```

**Параметры**:
- Отсутствуют

**Возвращает**:
- Отсутствует

**Как работает функция**:
1.  Определяет исходную директорию для сбора файлов (`src_directory`) как `src/utils` относительно корневой директории проекта.
2.  Определяет целевую директорию для копирования файлов (`project_structure_directory`) как поддиректорию `prod` внутри исходной директории.
3.  Вызывает функцию `collect_and_copy_files` для сбора иерархии файлов и копирования файлов из исходной директории в целевую.
4.  Определяет путь для сохранения иерархии файлов в формате JSON (`json_output_path`) как `file_hierarchy.json` внутри целевой директории.
5.  Сохраняет иерархию файлов в формате JSON в указанный файл, используя функцию `j_dumps`.

## Запуск модуля

В блоке `if __name__ == "__main__":` вызывается функция `main()` для запуска процесса сбора и копирования файлов.

```python
if __name__ == "__main__":
    main()
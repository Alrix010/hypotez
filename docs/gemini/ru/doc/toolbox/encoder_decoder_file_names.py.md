# Модуль для кодирования и декодирования имен файлов

## Обзор

Модуль предоставляет класс `PathEncoderDecoder` для кодирования и декодирования путей к файлам с использованием хэширования и сохранения соответствий в базе данных SQLite. Это может быть полезно для сокращения длинных путей или для сокрытия реальных имен файлов.

## Подробнее

Класс `PathEncoderDecoder` позволяет кодировать полные пути файлов в короткие идентификаторы (хэши), которые затем можно использовать вместо оригинальных путей. Соответствие между короткими идентификаторами и полными путями хранится в базе данных SQLite. Это позволяет восстанавливать оригинальные пути по их коротким идентификаторам.

## Классы

### `PathEncoderDecoder`

**Описание**:
Класс для кодирования и декодирования путей с использованием хэширования и хранения данных в SQLite базе данных.

**Атрибуты**:

-   `db_path` (Path): Путь к SQLite базе данных для хранения таблицы соответствий.

**Методы**:

-   `__init__(db_path: str = 'path_mapping.db')`: Инициализация класса.
-   `_initialize_database()`: Инициализация базы данных, создание таблицы, если она отсутствует.
-   `_save_to_database(short_id: str, file_path: str)`: Сохраняет хэш и путь в базу данных.
-   `_fetch_from_database(short_id: str) -> Optional[str]`: Извлекает путь из базы данных по короткому идентификатору.
-   `encode(file_path: str) -> str`: Кодирует путь в короткий идентификатор.
-   `decode(short_id: str) -> Optional[str]`: Декодирует короткий идентификатор обратно в путь.
-   `clear_mapping()`: Очищает таблицу соответствий.

## Методы класса

### `__init__`

```python
def __init__(self, db_path: str = 'path_mapping.db'):
    """
    Инициализация класса.

    Args:
        db_path (str): Путь к SQLite базе данных для хранения таблицы соответствий.
    """
    ...
```

**Назначение**: Инициализация класса `PathEncoderDecoder`.

**Параметры**:

-   `db_path` (str): Путь к SQLite базе данных для хранения таблицы соответствий. По умолчанию `'path_mapping.db'`.

**Как работает функция**:

1.  Принимает путь к базе данных SQLite, где будут храниться соответствия между путями и их закодированными значениями.
2.  Сохраняет путь к базе данных в атрибуте `db_path`.
3.  Вызывает метод `_initialize_database` для создания таблицы в базе данных, если она еще не существует.

### `_initialize_database`

```python
def _initialize_database(self):
    """
    Инициализация базы данных, создание таблицы, если она отсутствует.
    """
    ...
```

**Назначение**: Инициализация базы данных, создание таблицы `path_mapping`, если она отсутствует.

**Как работает функция**:

1.  Устанавливает соединение с базой данных SQLite по пути, указанному в атрибуте `db_path`.
2.  Создает таблицу `path_mapping` с двумя столбцами: `id` (TEXT PRIMARY KEY) и `file_path` (TEXT NOT NULL), если она еще не существует.
3.  Сохраняет изменения в базе данных.

### `_save_to_database`

```python
def _save_to_database(self, short_id: str, file_path: str):
    """
    Сохраняет хэш и путь в базу данных.

    Args:
        short_id (str): Уникальный идентификатор пути.
        file_path (str): Полный путь к файлу.
    """
    ...
```

**Назначение**: Сохранение соответствия между закодированным идентификатором и полным путем файла в базе данных.

**Параметры**:

-   `short_id` (str): Уникальный идентификатор пути.
-   `file_path` (str): Полный путь к файлу.

**Как работает функция**:

1.  Устанавливает соединение с базой данных SQLite.
2.  Выполняет SQL-запрос `INSERT OR IGNORE` для добавления новой записи в таблицу `path_mapping` с указанными `short_id` и `file_path`. Если запись с таким `short_id` уже существует, она будет проигнорирована.
3.  Сохраняет изменения в базе данных.

### `_fetch_from_database`

```python
def _fetch_from_database(self, short_id: str) -> Optional[str]:
    """
    Извлекает путь из базы данных по короткому идентификатору.

    Args:
        short_id (str): Уникальный идентификатор пути.

    Returns:
        Optional[str]: Полный путь файла или `None`, если идентификатор не найден.
    """
    ...
```

**Назначение**: Извлечение полного пути файла из базы данных по его закодированному идентификатору.

**Параметры**:

-   `short_id` (str): Уникальный идентификатор пути.

**Возвращает**:

-   `Optional[str]`: Полный путь файла или `None`, если идентификатор не найден.

**Как работает функция**:

1.  Устанавливает соединение с базой данных SQLite.
2.  Выполняет SQL-запрос `SELECT` для поиска записи в таблице `path_mapping` с указанным `short_id`.
3.  Если запись найдена, возвращает значение столбца `file_path`.
4.  Если запись не найдена, возвращает `None`.

### `encode`

```python
def encode(self, file_path: str) -> str:
    """
    Кодирует путь в короткий идентификатор.

    Args:
        file_path (str): Полный путь файла.

    Returns:
        str: Короткий идентификатор.
    """
    ...
```

**Назначение**: Кодирование полного пути файла в короткий идентификатор с использованием хэширования.

**Параметры**:

-   `file_path` (str): Полный путь файла.

**Возвращает**:

-   `str`: Короткий идентификатор.

**Как работает функция**:

1.  Вычисляет MD5-хэш от входного пути файла.
2.  Оставляет только первые 8 символов хэша.
3.  Формирует короткий идентификатор, добавляя префикс `id-` к полученному хэшу.
4.  Сохраняет соответствие между коротким идентификатором и полным путем файла в базе данных.
5.  Возвращает короткий идентификатор.

### `decode`

```python
def decode(self, short_id: str) -> Optional[str]:
    """
    Декодирует короткий идентификатор обратно в путь.

    Args:
        short_id (str): Короткий идентификатор.

    Returns:
        Optional[str]: Полный путь файла или `None`, если идентификатор не найден.
    """
    ...
```

**Назначение**: Декодирование короткого идентификатора обратно в полный путь файла.

**Параметры**:

-   `short_id` (str): Короткий идентификатор.

**Возвращает**:

-   `Optional[str]`: Полный путь файла или `None`, если идентификатор не найден.

**Как работает функция**:

1.  Вызывает метод `_fetch_from_database` для поиска полного пути файла в базе данных по заданному короткому идентификатору.
2.  Возвращает полученный путь или `None`, если путь не найден.

### `clear_mapping`

```python
def clear_mapping(self):
    """
    Очищает таблицу соответствий.
    """
    ...
```

**Назначение**: Очистка таблицы соответствий между короткими идентификаторами и полными путями в базе данных.

**Как работает функция**:

1.  Устанавливает соединение с базой данных SQLite.
2.  Выполняет SQL-запрос `DELETE FROM path_mapping` для удаления всех записей из таблицы `path_mapping`.
3.  Сохраняет изменения в базе данных.

## Примеры использования

```python
from pathlib import Path
from dev_utils.encoder_decoder_file_names import PathEncoderDecoder

encoder_decoder = PathEncoderDecoder()

# Кодирование пути
original_path = 'src/same_folder/same_sub_folder/same-file.ext'
encoded = encoder_decoder.encode(original_path)
print(f'Кодированный путь: {encoded}')

# Декодирование пути
decoded = encoder_decoder.decode(encoded)
print(f'Декодированный путь: {decoded}')

# Очистка таблицы соответствий
# encoder_decoder.clear_mapping()
```

Этот код демонстрирует основные функции класса `PathEncoderDecoder`: кодирование пути в короткий идентификатор и декодирование короткого идентификатора обратно в исходный путь. Также показан пример очистки таблицы соответствий в базе данных.
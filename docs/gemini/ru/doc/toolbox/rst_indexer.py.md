# Модуль rst_indexer

## Обзор

Модуль `rst_indexer` предназначен для автоматического создания индексного файла в формате reStructuredText (`index.rst`) для документации Sphinx. Он рекурсивно обходит указанный каталог, находит все файлы Python (`.py`) и добавляет их в `index.rst` файл в формате, совместимом со Sphinx.

## Подробней

Этот модуль упрощает процесс создания документации для проектов на Python, автоматически генерируя оглавление, которое включает все модули, найденные в указанной директории. Он предназначен для работы в окружении разработки и автоматизирует рутинную задачу обновления индексного файла документации.

## Классы

В данном модуле классы отсутствуют.

## Функции

### `create_index_rst`

```python
def create_index_rst(start_dir: str) -> None:
    """
    Recursively traverses all subdirectories from the start directory, reads all *.py files,
    and creates an index.rst file in the `docs` directory that lists all these files
    using the Sphinx `toctree` structure. Logs the process throughout.

    Args:
        start_dir (str): The root directory to start the traversal from.

    Returns:
        None

    Example:
        >>> create_index_rst(os.getcwd())
    """
    ...
```

**Назначение**: Рекурсивно обходит все поддиректории, начиная с указанной директории, считывает все файлы `.py` и создает файл `index.rst` в директории `docs`, который содержит список всех этих файлов, отформатированный с использованием структуры `toctree` Sphinx.

**Параметры**:
- `start_dir` (str): Корневая директория, с которой начинается обход.

**Возвращает**:
- `None`

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при создании файла `index.rst`.

**Как работает функция**:
1. Функция принимает путь к директории (`start_dir`), с которой начнется обход поддиректорий.
2. Определяется путь к директории `docs` и файлу `index.rst` внутри этой директории.
3. Проверяется, существует ли директория `docs`, и если нет, то она создается.
4. Открывается файл `index.rst` для записи, и в него записывается заголовок в формате Sphinx, включая структуру `toctree`.
5. Рекурсивно обходятся все поддиректории, начиная с `start_dir`.
6. Для каждой поддиректории находятся все файлы с расширением `.py`, исключая файлы, содержащие символы '(' или ')' в имени.
7. Для каждого найденного файла вычисляется относительный путь, который преобразуется в имя модуля, используемое в документации Sphinx.
8. Имя модуля добавляется в файл `index.rst` в формате Sphinx.
9. Если файлы `.py` не найдены, в файл `index.rst` записывается сообщение об этом.
10. В случае возникновения ошибки, информация об ошибке логируется и вызывается исключение.

**Примеры**:

```python
import os
from pathlib import Path
# Допустим, что текущая рабочая директория - корень проекта
# и в корне проекта есть папка src/utils
current_dir = os.getcwd()
create_index_rst(current_dir)  # Создаст index.rst в папке ./docs
```

### Внутренние переменные

- `start_path` (Path): Преобразует `start_dir` в объект `Path` для удобства работы с путями.
- `docs_dir` (Path): Определяет путь к директории `docs`, где будет создан файл `index.rst`.
- `index_file_path` (Path): Определяет полный путь к файлу `index.rst`.
- `found_files` (bool): Флаг, указывающий, были ли найдены какие-либо файлы Python.
- `root` (str): Текущая директория в процессе обхода дерева директорий.
- `_` (list): Список поддиректорий в текущей директории (не используется в коде, но возвращается `os.walk`).
- `files` (list): Список файлов в текущей директории.
- `py_files` (list): Список файлов Python, найденных в текущей директории.
- `rel_root` (Path): Относительный путь от `start_path` до текущей директории.
- `py_file` (str): Имя текущего файла Python.
- `module_path` (Path): Полный путь к модулю (файлу Python).
- `module_name` (str): Имя модуля, используемое в `index.rst` (путь к файлу с заменой разделителей на точки).
- `index_file`: Файловый объект для записи в `index.rst`.

## Пример использования

```python
if __name__ == "__main__":
    create_index_rst(Path(header.__root__, 'src', 'utils'))
```

В данном примере функция `create_index_rst` вызывается с путем к директории `src/utils`, находящейся внутри каталога, указанного в `header.__root__`. Это создает или обновляет файл `index.rst` в директории `docs`, расположенной в корне указанной директории, включая в него все найденные файлы Python.
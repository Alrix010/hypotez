# Модуль для обновления заголовков файлов

## Обзор

Этот модуль предназначен для автоматического обновления заголовков файлов в проекте `hypotez`. Он позволяет добавлять или заменять информацию о кодировке, интерпретаторе и метаданные модуля в Python-файлах. Скрипт рекурсивно обходит все файлы в проекте и обновляет их, добавляя стандартизированную информацию.

## Подробней

Модуль автоматизирует процесс добавления или замены заголовков в Python-файлах, что может быть полезно для обеспечения единообразного стиля и метаданных в проекте. Он позволяет указывать, следует ли принудительно обновлять заголовки, даже если они уже существуют, а также исключать определенные директории из обработки.

## Функции

### `find_project_root`

**Назначение**: Находит корневую директорию проекта, начиная с указанного пути.

```python
def find_project_root(start_path: Path, project_root_folder: str) -> Path:
    """Find the project root directory by searching for the specified folder."""
    ...
```

**Параметры**:

-   `start_path` (Path): Путь, с которого начинается поиск корневой директории.
-   `project_root_folder` (str): Имя папки, которая считается корневой (например, `".."`).

**Возвращает**:

-   `Path`: Путь к корневой директории проекта.

**Вызывает исключения**:

-   `FileNotFoundError`: Если корневая директория не найдена.

**Как работает функция**:

1.  Начинает поиск с указанного пути (`start_path`).
2.  Проверяет, существует ли папка `project_root_folder` в текущей директории.
3.  Если папка найдена, возвращает путь к этой папке.
4.  Если папка не найдена, переходит к родительской директории и повторяет поиск.
5.  Если достигнут корень файловой системы и папка не найдена, вызывает исключение `FileNotFoundError`.

### `get_interpreter_paths`

**Назначение**: Возвращает пути к интерпретаторам Python для Windows и Linux/macOS.

```python
def get_interpreter_paths(project_root: Path) -> tuple:
    """Returns paths to Python interpreters for Windows and Linux/macOS."""
    ...
```

**Параметры**:

-   `project_root` (Path): Корневой путь проекта.

**Возвращает**:

-   `tuple`: Кортеж, содержащий пути к интерпретаторам для Windows и Linux/macOS.

**Как работает функция**:

1.  Определяет пути к интерпретаторам Python, расположенным в директории `venv` проекта для Windows и Linux/macOS.
2.  Возвращает кортеж, содержащий эти пути.

### `add_or_replace_file_header`

**Назначение**: Добавляет или заменяет заголовок, строки интерпретатора и docstring модуля в указанном Python-файле.

```python
def add_or_replace_file_header(file_path: str, project_root: Path, force_update: bool):
    """Adds or replaces header, interpreter lines, and module docstring."""
    ...
```

**Параметры**:

-   `file_path` (str): Путь к файлу, в котором нужно добавить или заменить заголовок.
-   `project_root` (Path): Корневой путь проекта.
-   `force_update` (bool): Флаг, указывающий, следует ли принудительно обновить заголовок, даже если он уже существует.

**Как работает функция**:

1.  Формирует строку заголовка с информацией о пути к файлу.
2.  Определяет строки для указания кодировки, пути к интерпретаторам и docstring модуля.
3.  Открывает файл для чтения и записи.
4.  Читает все строки из файла, удаляя BOM (Byte Order Mark) и фильтруя строки, которые уже содержат информацию о заголовке, кодировке или интерпретаторе.
5.  Проверяет, нужно ли обновлять заголовок (если `force_update` установлен или если какие-либо из необходимых строк отсутствуют в файле).
6.  Если обновление необходимо, формирует новый список строк, содержащий заголовок, кодировку, строки интерпретатора и docstring модуля, а также отфильтрованные строки из исходного файла.
7.  Записывает новый список строк в файл, перезаписывая его содержимое.

### `clean`

**Назначение**: Удаляет указанные строки заголовка из файла и заменяет их пустыми строками.

```python
def clean(file_path: str):
    """Removes specified header lines from the file and replaces them with empty lines."""
    ...
```

**Параметры**:

-   `file_path` (str): Путь к файлу, из которого нужно удалить строки заголовка.

**Как работает функция**:

1.  Определяет префиксы строк, которые нужно удалить (строки заголовка, кодировки, интерпретатора и docstring модуля).
2.  Открывает файл для чтения и записи.
3.  Читает все строки из файла, удаляя BOM и заменяя строки, начинающиеся с указанных префиксов, на пустые строки.
4.  Записывает отфильтрованный список строк в файл, перезаписывая его содержимое.

### `traverse_and_update`

**Назначение**: Рекурсивно обходит директорию и обновляет заголовки в Python-файлах.

```python
def traverse_and_update(directory: Path, force_update: bool):
    """Traverses the directory and updates headers in Python files."""
    ...
```

**Параметры**:

-   `directory` (Path): Путь к директории, которую нужно обработать.
-   `force_update` (bool): Флаг, указывающий, следует ли принудительно обновлять заголовки.

**Как работает функция**:

1.  Рекурсивно обходит указанную директорию, используя `os.walk`.
2.  Исключает из обхода директории, указанные в списке `EXCLUDE_DIRS`.
3.  Для каждого файла проверяет, имеет ли он расширение `.py`.
4.  Если файл является Python-файлом, вызывает функцию `add_or_replace_file_header` для добавления или замены заголовка.

### `traverse_and_clean`

**Назначение**: Рекурсивно обходит директорию и удаляет указанные заголовки из Python-файлов.

```python
def traverse_and_clean(directory: Path):
    """Traverses the directory and cleans specified headers from Python files."""
    ...
```

**Параметры**:

-   `directory` (Path): Путь к директории, которую нужно обработать.

**Как работает функция**:

1.  Рекурсивно обходит указанную директорию, используя `os.walk`.
2.  Исключает из обхода директории, указанные в списке `EXCLUDE_DIRS`.
3.  Для каждого файла проверяет, имеет ли он расширение `.py`.
4.  Если файл является Python-файлом, вызывает функцию `clean` для удаления строк заголовка.

### `main`

**Назначение**: Основная функция для запуска скрипта.

```python
def main():
    """Main function to execute the script."""
    ...
```

**Как работает функция**:

1.  Определяет корневую директорию проекта.
2.  Определяет, следует ли выполнять очистку или обновление заголовков.
3.  Вызывает соответствующие функции (`traverse_and_clean` или `traverse_and_update`) для обработки файлов в проекте.

## Переменные модуля

-   `MODE` (str): Определяет режим работы модуля (в данном случае, 'development').
-   `PROJECT_ROOT_FOLDER` (str): Имя папки, которая считается корневой (в данном случае, `".."`)
-   `EXCLUDE_DIRS` (list): Список директорий, которые следует исключить из обработки.

## Запуск модуля

В блоке `if __name__ == '__main__':` вызывается функция `main()` для запуска процесса.

```python
if __name__ == '__main__':
    main()
```

Скрипт может быть запущен с различными аргументами командной строки, которые позволяют настроить его поведение (например, принудительное обновление заголовков или очистка заголовков).
### Как использовать этот блок кода

=========================================================================================

Описание
-------------------------
Данный блок кода предназначен для демонстрации взаимодействия с OpenAI API для генерации текста (в данном случае, стихотворения о дереве) через локальный прокси-сервер. Он устанавливает соединение с локальным сервером OpenAI и отправляет запрос на создание стихотворения, а затем выводит результат в консоль, обрабатывая как потоковый, так и не потоковый ответы.

Шаги выполнения
-------------------------
1. **Импорт библиотеки openai**: Импортируется библиотека `openai`, необходимая для взаимодействия с OpenAI API.
2. **Установка ключа API и базы API**: Устанавливаются значения `openai.api_key` и `openai.api_base` для указания локального прокси-сервера. `openai.api_key` устанавливается как пустая строка, а `openai.api_base` указывает на адрес локального сервера ("http://localhost:1337").
3. **Определение функции main()**: Определяется функция `main()`, которая содержит основную логику взаимодействия с OpenAI API.
4. **Создание запроса к ChatCompletion**: Внутри функции `main()` вызывается метод `openai.ChatCompletion.create()` для отправки запроса на генерацию стихотворения. Указываются следующие параметры:
    - `model`: Модель, используемая для генерации текста (в данном случае, "gpt-3.5-turbo").
    - `messages`: Список сообщений, где каждое сообщение содержит роль и контент. В данном случае, отправляется одно сообщение с ролью "user" и контентом "write a poem about a tree".
    - `stream`: Устанавливается в `True` для получения ответа в потоковом режиме.
5. **Обработка ответа**: Полученный ответ `chat_completion` проверяется на тип данных.
    - Если ответ является словарем (`dict`), это означает, что ответ не потоковый. В этом случае извлекается и выводится контент из первого выбора (`chat_completion.choices[0].message.content`).
    - Если ответ не является словарем, это означает, что ответ потоковый. В этом случае перебираются токены в ответе, и из каждого токена извлекается контент (`token["choices"][0]["delta"].get("content")`), который затем выводится в консоль.
6. **Вызов функции main()**: В блоке `if __name__ == "__main__":` вызывается функция `main()`, чтобы запустить процесс генерации и вывода стихотворения.

Пример использования
-------------------------

```python
                # type: ignore
import openai

openai.api_key = ""
openai.api_base = "http://localhost:1337"


def main():
    chat_completion = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": "write a poem about a tree"}],
        stream=True,
    )

    if isinstance(chat_completion, dict):
        # not stream
        print(chat_completion.choices[0].message.content)
    else:
        # stream
        for token in chat_completion:
            content = token["choices"][0]["delta"].get("content")
            if content != None:
                print(content, end="", flush=True)


if __name__ == "__main__":
    main()
```
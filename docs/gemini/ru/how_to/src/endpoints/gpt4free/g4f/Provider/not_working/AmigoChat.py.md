### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код определяет класс `AmigoChat`, который является асинхронным провайдером для работы с API AmigoChat для генерации текста и изображений. Он поддерживает стриминг, системные сообщения и историю сообщений. Класс использует различные модели, такие как GPT-4o, Gemini, Claude, Qwen и другие, а также модели для генерации изображений, такие как Flux и DALL-E 3.

Шаги выполнения
-------------------------
1. **Определение моделей**:
   - В коде определен словарь `MODELS`, который содержит доступные модели для чата и генерации изображений. Каждая модель связана с определенным `persona_id`.

2. **Инициализация класса `AmigoChat`**:
   - Класс `AmigoChat` наследуется от `AsyncGeneratorProvider` и `ProviderModelMixin`.
   - Определяются основные параметры, такие как URL, endpoints для чата и генерации изображений, поддержка стриминга и системных сообщений.
   - Устанавливается модель по умолчанию (`gpt-4o-mini`).
   - Формируются списки доступных моделей для чата (`chat_models`) и изображений (`image_models`).
   - Создается словарь `model_aliases` для упрощения использования моделей.

3. **Получение `personaId`**:
   - Метод `get_personaId` извлекает `persona_id` для заданной модели из словаря `MODELS`. Если модель не найдена, вызывается исключение `ValueError`.

4. **Генерация `chat_id`**:
   - Метод `generate_chat_id` генерирует уникальный идентификатор чата в формате `8-4-4-4-12` шестнадцатеричных цифр с использованием `uuid.uuid4()`.

5. **Создание асинхронного генератора**:
   - Метод `create_async_generator` является асинхронным методом, который создает генератор для получения ответов от API AmigoChat.
   - Принимает параметры, такие как модель, сообщения, прокси, стриминг, таймаут, штрафы за частоту и присутствие, максимальное количество токенов, температуру и top_p.
   - Получает модель, используя `get_model`.
   - Генерирует уникальный `device_uuid`.
   - Выполняет несколько попыток (`max_retries`) для отправки запроса.
   - Формирует заголовки (`headers`) для HTTP-запроса.
   - Создает `StreamSession` для асинхронной отправки запросов.
   - Если модель предназначена для чата:
     - Формирует данные (`data`) для запроса к API чата, включая `chatId`, `messages`, `model`, `personaId` и другие параметры.
     - Отправляет POST-запрос к `chat_api_endpoint`.
     - Итерируется по строкам в ответе, декодирует их и извлекает контент из JSON-структуры.
     - Выдает (`yield`) контент для каждой части ответа.
   - Если модель предназначена для генерации изображений:
     - Извлекает `prompt` из последнего сообщения.
     - Формирует данные (`data`) для запроса к API генерации изображений, включая `prompt`, `model` и `personaId`.
     - Отправляет POST-запрос к `image_api_endpoint`.
     - Извлекает URL-адреса изображений из ответа и формирует `ImageResponse`.
     - Выдает (`yield`) объект `ImageResponse`.
   - Обрабатывает исключения `ResponseStatusError` и `Exception`, повторяет запрос несколько раз, если необходимо.

Пример использования
-------------------------

```python
from src.endpoints.gpt4free.g4f.Provider.not_working import AmigoChat
from src.typing import Message

async def main():
    messages: list[Message] = [
        {"role": "user", "content": "Напиши короткий стих о весне"}
    ]
    model = "gpt-4o-mini"  # Или другая доступная модель
    async for response in AmigoChat.create_async_generator(model=model, messages=messages):
        print(response, end="")

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
### **Как использовать этот блок кода**
=========================================================================================

Описание
-------------------------
Этот код определяет асинхронный провайдер `FreeNetfly` для работы с API, имитирующим OpenAI, и предназначен для генерации текста на основе предоставленных сообщений. Он использует асинхронные запросы для взаимодействия с API и обрабатывает потоковую передачу данных для получения результатов.

Шаги выполнения
-------------------------
1. **Инициализация класса `FreeNetfly`**:
   - Определяются основные атрибуты класса, такие как `url` (базовый URL API), `api_endpoint` (путь к конечной точке API), `working` (логический флаг, показывающий работоспособность провайдера), `default_model` (используемая по умолчанию модель) и `models` (список поддерживаемых моделей).
2. **Создание асинхронного генератора `create_async_generator`**:
   - Метод принимает `model` (модель для использования), `messages` (список сообщений для отправки), `proxy` (прокси-сервер для использования) и `**kwargs` (дополнительные аргументы).
   - Формируются заголовки (`headers`) для HTTP-запроса, включающие информацию о типе контента, User-Agent и Referer.
   - Формируется тело запроса (`data`) с сообщениями, параметрами потоковой передачи, моделью и другими параметрами, связанными с генерацией текста.
3. **Выполнение асинхронных запросов с повторными попытками**:
   - Устанавливается максимальное количество повторных попыток (`max_retries`) и начальная задержка (`retry_delay`).
   - В цикле выполняется несколько попыток отправки запроса к API. Если запрос завершается неудачей из-за ошибок клиента (`ClientError`) или тайм-аута (`asyncio.TimeoutError`), происходит ожидание с экспоненциальным увеличением задержки перед следующей попыткой.
   - Используется `ClientSession` из библиотеки `aiohttp` для управления асинхронными HTTP-запросами.
   - Отправляется `POST` запрос к API с использованием `session.post`.
   - Обрабатывается ответ от API с использованием асинхронного генератора `_process_response`.
   - В случае успешного выполнения запрос, функция завершается (`return`).
4. **Обработка ответа `_process_response`**:
   - Метод `_process_response` принимает объект `response` (ответ от API) и возвращает асинхронный генератор, выдающий части контента.
   - Читает ответ построчно, накапливая данные в буфере (`buffer`).
   - Разделяет буфер на подстроки по разделителю `\n`.
   - Извлекает данные JSON из каждой подстроки, начинающейся с `data: `.
   - Извлекает содержимое (`content`) из JSON-ответа и передает его через `yield`.
   - Обрабатывает ситуации, когда JSON не может быть декодирован или структура JSON отличается от ожидаемой.

Пример использования
-------------------------

```python
import asyncio
from src.endpoints.gpt4free.g4f.Provider.not_working import FreeNetfly

async def main():
    model = "gpt-3.5-turbo"
    messages = [{"role": "user", "content": "Напиши короткий стих о природе."}]
    
    try:
        async for chunk in FreeNetfly.create_async_generator(model=model, messages=messages):
            print(chunk, end="")
    except Exception as e:
        print(f"Произошла ошибка: {e}")

if __name__ == "__main__":
    asyncio.run(main())
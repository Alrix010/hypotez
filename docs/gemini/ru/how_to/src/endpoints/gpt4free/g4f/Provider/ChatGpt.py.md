### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Данный код реализует функцию `create_completion` для взаимодействия с API ChatGpt. Она отвечает за отправку запроса на генерацию ответа на основе предоставленных сообщений и параметров модели, а также за обработку потоковых ответов.

Шаги выполнения
-------------------------
1. **Выбор модели**:
   - Функция `get_model` вызывается для определения используемой модели на основе входного параметра `model`. Если модель не найдена в списке поддерживаемых, используется модель по умолчанию.
2. **Инициализация сессии**:
   - Имитируется User Agent  `user_agent`.
   - Функция `init_session` инициализирует сессию HTTP для выполнения запросов к API. Она устанавливает необходимые заголовки и выполняет первоначальный GET-запрос.
3. **Подготовка заголовков**:
   - Вызывается функция `get_config` для получения необходимой конфигурации.
   - Функция `get_requirements_token` запрашивает токен требований.
   - Формируются заголовки запроса, включая токены безопасности и идентификаторы.
4. **Отправка запроса требований**:
   - POST-запрос отправляется на эндпоинт `https://chatgpt.com/backend-anon/sentinel/chat-requirements` для получения данных, необходимых для продолжения разговора.
5. **Обработка Turnstile**:
   - Функция `process_turnstile` вызывается для обработки Turnstile, если это требуется, чтобы получить токен.
6. **Формирование данных JSON**:
   - Функция `format_conversation` преобразует список сообщений в формат, ожидаемый API.
   - Подготавливаются данные JSON, включающие сообщения, параметры модели и другие настройки.
7. **Отправка запроса на разговор**:
   - POST-запрос отправляется на эндпоинт `https://chatgpt.com/backend-anon/conversation` с заголовками и данными JSON, stream=True.
8. **Обработка потокового ответа**:
   - Итерация по строкам ответа для получения данных JSON.
   - Проверка каждой строки на начало с `data:`.
   - Извлечение JSON из строки и декодирование его.
   - Если получен маркер `[DONE]`, прекращается обработка.
   - Извлечение контента сообщения ответа и передача его вызывающей стороне с помощью `yield`.

Пример использования
-------------------------

```python
from src.endpoints.gpt4free.g4f.Provider.ChatGpt import ChatGpt

# messages: Messages = [{"role": "user", "content": "Hello!"}]
# model = "gpt-3.5-turbo"
# stream = True

# for response in ChatGpt.create_completion(model=model, messages=messages, stream=stream):
#     print(response, end="", flush=True)
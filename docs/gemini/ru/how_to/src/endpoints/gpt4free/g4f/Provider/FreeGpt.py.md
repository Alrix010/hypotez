### **Инструкции для генерации документации к коду**

=========================================================================================

1. **Анализируй код**: Пойми логику и действия, выполняемые данным фрагментом кода.

2. **Создай пошаговую инструкцию**:
    - **Описание**: Объясни, что делает данный блок кода.
    - **Шаги выполнения**: Опиши последовательность действий в коде.
    - **Пример использования**: Приведи пример кода, как использовать данный фрагмент в проекте.

3. **Пример**:
Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код определяет класс `FreeGpt`, который является асинхронным провайдером для работы с Gemini API через бесплатные домены. Он включает в себя методы для создания асинхронного генератора ответов на основе входящих сообщений, а также функцию для генерации подписи запроса.

Шаги выполнения
-------------------------
1. **Определение констант**:
   - Определяются константы `DOMAINS` (список доменов), `RATE_LIMIT_ERROR_MESSAGE` (сообщение об ошибке при превышении лимита).

2. **Класс `FreeGpt`**:
   - Класс `FreeGpt` наследуется от `AsyncGeneratorProvider` и `ProviderModelMixin`.
   - Указываются атрибуты класса: `url` (базовый URL), `working` (статус работоспособности), `supports_message_history` (поддержка истории сообщений), `supports_system_message` (поддержка системных сообщений), `default_model` (модель по умолчанию) и `models` (список поддерживаемых моделей).

3. **Метод `create_async_generator`**:
   - Этот асинхронный метод создает генератор для получения ответов от API.
   - **Шаг 1**: Извлекает последний запрос пользователя (`prompt`) из списка сообщений.
   - **Шаг 2**: Получает текущую временную метку (`timestamp`).
   - **Шаг 3**: Вызывает метод `_build_request_data` для формирования данных запроса.
   - **Шаг 4**: Выбирает случайный домен из списка `DOMAINS`.
   - **Шаг 5**: Отправляет асинхронный POST-запрос к API с использованием `StreamSession`.
   - **Шаг 6**: Обрабатывает чанки данных, возвращаемые сервером, и генерирует их.
   - **Шаг 7**: Проверяет каждый чанк на наличие сообщения об ошибке, связанной с превышением лимита запросов (`RATE_LIMIT_ERROR_MESSAGE`). Если такое сообщение обнаружено, вызывается исключение `RateLimitError`.

4. **Метод `_build_request_data`**:
   - Статический метод для формирования данных запроса в виде словаря.
   - **Шаг 1**: Создает словарь с сообщениями, временной меткой, пустым паролем и подписью, сгенерированной функцией `generate_signature`.
   - **Шаг 2**: Возвращает этот словарь.

5. **Функция `generate_signature`**:
   - Функция для генерации подписи запроса.
   - **Шаг 1**: Формирует строку данных, объединяя временную метку, сообщение и секретный ключ.
   - **Шаг 2**: Вычисляет SHA256-хеш от полученной строки.
   - **Шаг 3**: Возвращает хеш в виде шестнадцатеричной строки.

Пример использования
-------------------------

```python
from src.endpoints.gpt4free.g4f.Provider import FreeGpt
import asyncio

async def main():
    messages = [{"role": "user", "content": "Hello, how are you?"}]
    model = "gemini-1.5-pro"

    try:
        generator = FreeGpt.create_async_generator(model=model, messages=messages)
        async for message in await generator:
            print(message, end="")
    except Exception as e:
        print(f"An error occurred: {e}")

if __name__ == "__main__":
    asyncio.run(main())
```
4. **Избегай расплывчатых терминов** вроде "получаем" или "делаем". Будь конкретным, что именно делает код, например: "проверяет", "валидирует" или "отправляет".
### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Данный блок кода предназначен для обработки медиафайлов (изображений и аудио) в контексте сообщений, используемых, например, в чат-ботах или других приложениях, где необходимо отображать или обрабатывать медиаконтент. Он включает в себя функции для рендеринга медиафайлов из различных источников (URL, локальные файлы), преобразования их в base64 формат, а также для объединения медиафайлов с текстовыми сообщениями.

Шаги выполнения
-------------------------
1. **Функция `render_media`**:
   - Функция принимает `bucket_id`, `name`, `url` медиафайла, а также флаги `as_path` и `as_base64`.
   - Если `as_base64` или `as_path` установлены в `True`, или если `url` начинается с "/", функция пытается прочитать файл локально.
   - Если `as_path` установлен, функция возвращает путь к файлу.
   - Если `as_base64` установлен, функция возвращает содержимое файла в формате base64.
   - В противном случае функция возвращает URL медиафайла.

2. **Функция `render_part`**:
   - Функция принимает словарь `part`, представляющий часть контента сообщения.
   - Если в `part` есть ключ "type", функция просто возвращает `part`.
   - Если отсутствует ключ "name", функция пытается прочитать содержимое из "bucket_dir" и возвращает текстовое сообщение.
   - Если файл является аудио, функция возвращает словарь с типом "input_audio" и данными в формате base64.
   - В противном случае функция возвращает словарь с типом "image_url" и URL медиафайла.

3. **Функция `merge_media`**:
   - Функция принимает список медиафайлов `media` и список сообщений `messages`.
   - Функция извлекает медиафайлы из сообщений пользователя и объединяет их в буфер.
   - Функция возвращает генератор, который сначала выдает медиафайлы из буфера, а затем из списка `media`.

4. **Функция `render_messages`**:
   - Функция принимает список сообщений `messages` и список медиафайлов `media`.
   - Функция обрабатывает каждое сообщение, рендерит части контента и объединяет медиафайлы с сообщениями.
   - Для сообщений, содержащих список частей контента, функция рендерит каждую часть с помощью `render_part`.
   - Если `media` не `None` и текущее сообщение является последним в списке, функция объединяет медиафайлы с контентом сообщения.
   - Функция возвращает генератор обработанных сообщений.

Пример использования
-------------------------

```python
from typing import List, Dict, Iterator

# Пример структуры сообщения
message: Dict = {
    "role": "user",
    "content": [
        {"name": "example.jpg", "bucket_id": "123"},
        {"text": "Hello, world!"}
    ]
}

messages: List[Dict] = [message]
media: List[tuple[bytes, str]] = []

# Пример использования render_messages
def process_messages(messages: List[Dict], media: List[tuple[bytes, str]]) -> Iterator[Dict]:
    """
    Функция обрабатывает список сообщений, рендерит медиафайлы и объединяет их с сообщениями.

    Args:
        messages (List[Dict]): Список сообщений для обработки.
        media (List[tuple[bytes, str]]): Список медиафайлов для объединения с сообщениями.

    Returns:
        Iterator[Dict]: Генератор обработанных сообщений.
    """
    for processed_message in render_messages(messages, media):
        yield processed_message

# Пример вызова функции process_messages
processed_messages: Iterator[Dict] = process_messages(messages, media)

# Вывод обработанных сообщений
for msg in processed_messages:
    print(msg)
```
## Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот блок кода реализует класс `GigaChat`, который является асинхронным генераторным провайдером для GigaChat API, позволяющим взаимодействовать с моделью GigaChat. 

Шаги выполнения
-------------------------
1. **Импортирование библиотек:**
    -  Импортируются необходимые библиотеки для работы с API GigaChat, такие как `aiohttp` для асинхронных HTTP-запросов, `json` для работы с JSON-данными и `Path` для работы с путями.
2. **Инициализация глобальных переменных:**
    -  Объявляются глобальные переменные `access_token` и `token_expires_at` для хранения токена доступа и времени его истечения.
3. **Определение класса `GigaChat`:**
    -  Класс наследует от `AsyncGeneratorProvider` и `ProviderModelMixin`, обеспечивая функциональность асинхронного генератора и методы для работы с моделями.
    -  Класс содержит атрибуты, определяющие базовые параметры для работы с GigaChat API:
        -  `url`: базовый URL API.
        -  `working`: флаг, указывающий на работоспособность API.
        -  `supports_message_history`, `supports_system_message`, `supports_stream`: флаги, указывающие на поддержку API соответствующих функций.
        -  `needs_auth`: флаг, указывающий на необходимость аутентификации.
        -  `default_model`: название модели по умолчанию.
        -  `models`: список доступных моделей.
4. **Создание асинхронного генератора `create_async_generator`:**
    -  Этот метод отвечает за асинхронное создание генератора, который обеспечивает доступ к GigaChat API.
    -  В методе:
        -  `model`: имя модели, с которой будет взаимодействовать генератор.
        -  `messages`: список сообщений для передачи в API.
        -  `stream`: флаг, указывающий на использование потоковой передачи ответов.
        -  `proxy`: прокси-сервер для запросов.
        -  `api_key`: API-ключ для аутентификации.
        -  `connector`:  коннектор для асинхронных HTTP-запросов.
        -  `scope`: scope для запросов к API.
        -  `update_interval`: интервал обновления потока.
    -  Метод проверяет наличие `api_key` и создает сертификат `russian_trusted_root_ca.crt` в папке cookie, если его нет.
    -  Создается сессия с `ClientSession` для асинхронных запросов.
    -  Проверяется срок действия токена доступа, и, если он меньше 60 секунд, то происходит обновление токена.
    -  Выполняется POST-запрос к `gigachat.devices.sberbank.ru` с JSON-данными, содержащими информацию о модели, сообщениях, потоке, интервале обновления и другими параметрами.
    -  Полученные данные обрабатываются и возвращаются в виде генератора.
5. **Обработка ответов:**
    -  В цикле `async for` обрабатываются данные, полученные от API GigaChat.
    -  Если `stream` не установлен, то возвращается полное сообщение.
    -  Если `stream` установлен, то обрабатываются частичные ответы, которые возвращаются в виде генератора.

Пример использования
-------------------------

```python
from hypotez.src.endpoints.gpt4free.g4f.Provider.needs_auth.GigaChat import GigaChat

async def main():
    # Инициализация модели GigaChat с использованием API-ключа
    giga_chat = GigaChat(api_key="YOUR_API_KEY")

    # Отправка запроса с сообщением
    async for response in giga_chat.stream_messages("Hello, GigaChat!"):
        print(response)

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
```

**Важно:**
- Замените `YOUR_API_KEY` на свой действительный API-ключ GigaChat.
- Не забудьте установить зависимости, необходимые для работы с этим модулем, используя `pip install -r requirements.txt`.
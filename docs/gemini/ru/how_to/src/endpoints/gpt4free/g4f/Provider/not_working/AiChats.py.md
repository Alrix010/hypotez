### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код реализует асинхронный провайдер `AiChats` для взаимодействия с API ai-chats.org. Он поддерживает как текстовые запросы (chat), так и генерацию изображений (dalle). Класс использует `aiohttp` для выполнения асинхронных HTTP-запросов и предоставляет методы для создания асинхронного генератора ответов и получения ответа.

Шаги выполнения
-------------------------
1. **Инициализация**:
   - Определяются URL, endpoint API, флаг `working` (работоспособность), поддержка истории сообщений и список доступных моделей (`gpt-4`, `dalle`).
2. **`create_async_generator`**:
   - Функция `create_async_generator` является асинхронным генератором, который отправляет запросы к API `ai-chats.org` и обрабатывает ответы.
   - **Формирование заголовков**: Создаются HTTP-заголовки, включая `user-agent`, `content-type` и `referer`.
   - **Создание сессии `aiohttp`**: Используется `ClientSession` для управления асинхронными HTTP-запросами.
   - **Подготовка данных**:
     - Для модели `dalle` извлекается последний `content` из списка сообщений.
     - Для других моделей используется функция `format_prompt` для форматирования сообщений.
   - **Отправка запроса**:
     - Отправляется POST-запрос к `cls.api_endpoint` с данными в формате JSON.
   - **Обработка ответа**:
     - Для модели `dalle`:
       - Извлекается URL изображения из JSON-ответа.
       - Если URL найден, скачивается изображение, кодируется в base64 и возвращается в формате `ImageResponse`.
       - В случае ошибки возвращается сообщение об ошибке.
     - Для других моделей:
       - Извлекаются данные из каждой строки ответа, начиная с `data:`.
       - Возвращается собранное сообщение.
   - **Обработка исключений**:
     - В случае возникновения исключения возвращается сообщение об ошибке.
3. **`create_async`**:
   - Функция `create_async` использует `create_async_generator` для получения асинхронных ответов.
   - Если ответ является `ImageResponse`, возвращается URL первого изображения.
   - В противном случае возвращается текстовый ответ.

Пример использования
-------------------------

```python
from src.endpoints.gpt4free.g4f.Provider.not_working import AiChats
from src.endpoints.gpt4free.g4f.typing import Messages
import asyncio

async def main():
    model = "gpt-4"  # или "dalle"
    messages: Messages = [{"role": "user", "content": "Hello, how are you?"}]  # Пример текстового запроса
    # messages: Messages = [{"role": "user", "content": "Generate a picture of cat"}]  # Пример запроса генерации изображения

    async for response in AiChats.create_async_generator(model=model, messages=messages):
        print(response)

if __name__ == "__main__":
    asyncio.run(main())
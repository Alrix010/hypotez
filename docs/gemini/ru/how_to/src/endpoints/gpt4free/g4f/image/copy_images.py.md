## Как использовать блок кода `copy_media`

=========================================================================================

### Описание

-------------------------

Блок кода `copy_media` предназначен для загрузки и сохранения изображений или медиафайлов (аудио, видео) локально с использованием безопасных для Unicode имен файлов. 
Он возвращает список относительных URL-адресов сохраненных медиафайлов.


### Шаги выполнения

-------------------------

1. **Проверка аргументов**: 
    - Проверяет наличие аргумента `add_url` и устанавливает его значение в `True`, если `cookies` не заданы.
    - Вызывает функцию `ensure_images_dir()` для создания директории `generated_images`, если она не существует.
2. **Инициализация `ClientSession`**:
    - Создает `ClientSession` с параметрами:
        - `connector`: Использует `get_connector` для создания соединения, поддерживающего прокси, если задан.
        - `cookies`: Использует `cookies`, если они заданы.
        - `headers`: Использует `headers`, если они заданы.
3. **Инициализация асинхронной функции `copy_image`**:
    - Определяет асинхронную функцию `copy_image`, которая обрабатывает загрузку отдельного изображения.
4. **Обработка изображения**:
    - Проверяет, является ли изображение локальным. Если да, то возвращает его путь.
    - Если изображение не локальное, то:
        - Собирает информацию о имени файла, типе медиафайла и целевом пути.
        - Обрабатывает разные типы изображений:
            - `data:`-URI: Извлекает данные URI и сохраняет их в файл.
            - URL: Скачивает изображение с использованием `session.get` и сохраняет его в файл.
        - Проверяет формат файла и при необходимости переименовывает его.
        - Возвращает URL-адрес сохраненного изображения.
5. **Обработка ошибок**:
    - Ловит ошибки `ClientError`, `IOError`, `OSError` и `ValueError` во время обработки изображения.
    - Выводит сообщение об ошибке в лог.
    - Возвращает исходный URL изображения, если загрузка не удалась.
6. **Запуск асинхронных задач**:
    - Использует `asyncio.gather` для параллельной обработки всех изображений из `images`.
    - Возвращает список URL-адресов всех сохраненных медиафайлов.

### Пример использования

-------------------------

```python
from hypotez.src.endpoints.gpt4free.g4f.image.copy_images import copy_media

async def main():
    images = [
        "https://example.com/image1.jpg",
        "https://example.com/image2.png",
        "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAY...",  # Base64 encoded image
    ]
    tags = ["cat", "cute"]
    alt = "A cute cat"

    # Download and store images
    media_urls = await copy_media(images, tags=tags, alt=alt)
    print(f"Saved media URLs: {media_urls}")

if __name__ == "__main__":
    asyncio.run(main())
```

**Описание примера:**

- В примере определена функция `main`, которая:
    - Содержит список URL-адресов изображений, которые необходимо скачать.
    - Задает `tags` и `alt` для описания изображений.
    - Вызывает `copy_media` с переданными изображениями и дополнительными параметрами.
    - Выводит список URL-адресов сохраненных медиафайлов.
- Пример демонстрирует, как использовать `copy_media` для загрузки и сохранения изображений, а также как задавать дополнительные параметры для описания изображений.

**Примечание**: 

- `copy_media` также может использоваться для загрузки аудио и видеофайлов. 
- Для этого нужно передать в качестве `images` URL-адреса соответствующих медиафайлов.
- В этом случае тип медиафайла будет определен автоматически по типу контента ответа. 
- Дополнительно можно использовать `tags` и `alt` для описания медиафайлов.
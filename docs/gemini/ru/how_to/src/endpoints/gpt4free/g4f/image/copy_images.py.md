### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код предназначен для скачивания и сохранения изображений локально, присваивая им безопасные имена файлов в Unicode. Он обеспечивает обработку различных типов изображений (как URL, так и data URI) и проверяет формат файла.

Шаги выполнения
-------------------------
1. **Проверка наличия локального пути**:
   - Код сначала проверяет, является ли изображение уже локальным путем (начинается с "/"). Если это так, он возвращает его без изменений.

2. **Создание имени файла**:
   - Если `target_path` не указан, формируется имя файла с использованием `get_filename`, который генерирует уникальное имя на основе тегов, альтернативного текста, времени и хеша содержимого изображения.
   - Созданный `filename` объединяется с путем к директории `images_dir` для получения полного пути сохранения `target_path`.

3. **Обработка различных типов изображений**:
   - Если изображение представлено в формате data URI (начинается с "data:"), извлекаются данные и записываются в файл.
   - Если изображение является URL-ом, выполняется GET-запрос к этому URL-у. При необходимости используются параметры `BackendApi` для заголовков и SSL.

4. **Выполнение GET-запроса**:
   - С использованием `ClientSession` выполняется асинхронный GET-запрос к URL изображения.
   - Проверяется `content-type` ответа. Если тип контента не является допустимым, выбрасывается исключение `ValueError`.

5. **Сохранение содержимого изображения**:
   - Полученное содержимое изображения записывается в файл по пути `target_path` чанками.

6. **Верификация формата файла**:
   - Если `target` не был указан (то есть имя файла было сгенерировано), проверяется формат сохраненного файла по его заголовку.
   - Если формат определяется, файлу присваивается соответствующее расширение.

7. **Формирование URL**:
   - Формируется URL для доступа к сохраненному файлу. URL-кодируется имя файла для безопасной передачи в вебе.
   - Если `add_url` имеет значение `True` и изображение не является data URI, к URL добавляется параметр `url` с оригинальным URL изображения.

8. **Обработка ошибок**:
   - В случае возникновения ошибок (например, `ClientError`, `IOError`, `OSError`, `ValueError`), они логируются, и возвращается оригинальный URL изображения или его источник, если он доступен.
   - Если во время обработки возникла ошибка и файл был создан, он удаляется.

9. **Асинхронный запуск**:
   - Функция `copy_image` вызывается асинхронно для каждого изображения в списке `images`.

Пример использования
-------------------------

```python
import asyncio
from src.endpoints.gpt4free.g4f.image.copy_images import copy_media

async def main():
    image_urls = [
        "https://example.com/image1.jpg",
        "https://example.com/image2.png"
    ]
    
    # скачиваем и сохраняем изображения локально
    local_urls = await copy_media(image_urls, tags=["example"], alt="example images")
    
    print(f"Локальные URL изображений: {local_urls}")

if __name__ == "__main__":
    asyncio.run(main())
```
```
Этот пример показывает, как использовать функцию `copy_media` для скачивания списка изображений и получения списка локальных URL.
### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Блок кода `Blackbox` представляет собой класс `AsyncGeneratorProvider`, предназначенный для взаимодействия с API Blackbox AI. Он поддерживает различные модели, включая текстовые и графические, и обеспечивает асинхронную генерацию ответов. Класс предназначен для работы с сообщениями, прокси и медиафайлами, а также управляет историей разговоров и аутентификацией пользователя.

Шаги выполнения
-------------------------
1. **Инициализация класса `Blackbox`**:
   - Определяются основные атрибуты класса, такие как `label`, `url`, `api_endpoint`, `working`, `supports_stream`, `supports_system_message`, `supports_message_history`, а также модели по умолчанию и списки поддерживаемых моделей (`fallback_models`, `image_models`, `vision_models`, `userSelectedModel`).
   - Определяются конфигурации для различных режимов агента (`agentMode`, `trendingAgentMode`).

2. **Генерация сессии**:
   - Метод `generate_session` создает динамическую сессию с уникальным идентификатором и сроком действия.
   - Функция генерирует случайный числовой ID, дату истечения срока действия и URL изображения пользователя.

3. **Получение проверенного значения**:
   - Метод `fetch_validated` извлекает проверенное значение (validated_value) из кеша или извлекает его с веб-страницы.
   - Функция пытается прочитать значение из файла кеша и, если это не удается, выполняет поиск шаблонов JavaScript и UUID на веб-странице.

4. **Генерация ID**:
   - Метод `generate_id` генерирует случайный идентификатор заданной длины.

5. **Получение списка моделей**:
   - Метод `get_models` возвращает список доступных моделей на основе статуса авторизации пользователя.
   - Для авторизованных пользователей возвращается полный список моделей, а для неавторизованных - только `fallback_models`.

6. **Проверка премиум-доступа**:
   - Метод `_check_premium_access` проверяет наличие авторизованной сессии в файлах HAR.
   - Функция анализирует файлы HAR для обнаружения сессионных данных, которые отличаются от демо-сессии.

7. **Создание асинхронного генератора**:
   - Метод `create_async_generator` является основным методом для генерации ответов от API Blackbox AI.
   - Функция принимает параметры, такие как модель, сообщения, прокси, медиафайлы, и использует асинхронный генератор для обработки ответов.
   - Функция выполняет следующие шаги:
     - Получение модели с помощью `cls.get_model(model)`.
     - Создание или использование существующей сессии разговора (`Conversation`).
     - Подготовка данных запроса, включая сообщения, параметры модели и сессионные данные.
     - Поиск сессионных данных в файлах HAR.
     - Выполнение POST-запроса к API Blackbox AI.
     - Обработка ответа, включая чтение чанков, извлечение URL изображений (для графических моделей) и обновление истории разговоров.

Пример использования
-------------------------

```python
from src.endpoints.gpt4free.g4f.Provider.Blackbox import Blackbox, Conversation
from src.logger.logger import logger

async def example():
    # Пример использования create_async_generator
    model = "blackboxai"
    messages = [{"role": "user", "content": "Hello, Blackbox AI!"}]
    conversation = Conversation(model)
    try:
        async for response in Blackbox.create_async_generator(model=model, messages=messages, conversation=conversation, return_conversation=True):
            if isinstance(response, Conversation):
                print(f"Conversation history: {response.message_history}")
            else:
                print(f"Response: {response}")
    except Exception as e:
        logger.error(f"Error: {e}")

# Запуск примера
if __name__ == "__main__":
    import asyncio
    asyncio.run(example())
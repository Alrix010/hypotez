## Как использовать этот блок кода
=========================================================================================

### Описание
-------------------------
Данный блок кода реализует асинхронный генератор для работы с моделью Qwen-2.72B, доступной через Hugging Face Spaces. Он обеспечивает возможность получить результаты генерации текста по частям,  а также поддерживает различные функции, такие как:

- **Stream-генерация:** Позволяет получать результат генерации текста по мере его создания, что полезно для отображения процесса генерации в реальном времени.
- **Поддержка system message:**  Поддерживает возможность передать моделью системные инструкции, которые влияют на общий контекст и стиль ответа.
- **Асинхронная работа:**  Использует `aiohttp` для асинхронных запросов к API модели.

### Шаги выполнения
-------------------------
1. **Инициализация сессии:** 
   -  Создается уникальный идентификатор сессии (session hash) для отслеживания запросов.
   -  Настраиваются заголовки для отправки запросов к API модели.
2. **Формирование запроса:**
   -  Преобразуется список сообщений в формат, подходящий для модели.
   -  Подготавливается объект `payload_join` для отправки запроса на подключение к потоку данных.
3. **Отправка запроса на подключение:**
   -  Отправляется POST-запрос к API-точке `api_endpoint` с JSON-данными `payload_join`. 
   -  Получается идентификатор события `event_id` для дальнейшего использования в запросе к потоку данных. 
4. **Получение потока данных:**
   -  Формируется URL для получения потока данных `url_data` с использованием `event_id`.
   -  Настраиваются заголовки для получения потока данных.
5. **Обработка потока данных:**
   -  Отправляется GET-запрос к API-точке `url_data` с использованием `event_id`.
   -  Асинхронно обрабатываются данные, поступающие из потока данных.
   -  Проверяется наличие  событий `process_generating` и `process_completed`.
   -  Извлекаются фрагменты текста из `output` и передаются в качестве результатов генерации.
6. **Возвращение результата:**
   -  Генератор возвращает текст, полученный из потока данных, по мере его поступления.
   -  В конце генерации возвращается полный текст, полученный из `output` события `process_completed`.

### Пример использования
-------------------------

```python
from hypotez.src.endpoints.gpt4free.g4f.Provider.hf_space.Qwen_Qwen_2_72B import Qwen_Qwen_2_72B

async def main():
    model = Qwen_Qwen_2_72B
    messages = [
        {"role": "system", "content": "Ты - писатель"},
        {"role": "user", "content": "Напиши рассказ о коте, который путешествует по миру."}
    ]

    async for response_part in model.create_async_generator(model="qwen-2-72b", messages=messages):
        print(response_part, end="")
    
    print("\n--- End of response ---")


if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
```

**Важно**:

-  В коде используется библиотека `aiohttp` для отправки асинхронных запросов к API модели.
-  Для запуска асинхронного кода используйте `asyncio.run()`.
-  Проверяйте, что у вас установлен пакет `aiohttp`. 
-  Обратите внимание, что этот код реализован для использования с моделью Qwen-2.72B, доступной через Hugging Face Spaces.
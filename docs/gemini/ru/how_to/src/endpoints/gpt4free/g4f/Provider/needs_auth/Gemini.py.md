## Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот блок кода представляет класс `Gemini`, который предоставляет функциональность для взаимодействия с моделью Google Gemini. Класс обеспечивает авторизацию, отправку запросов и обработку ответов модели.

Шаги выполнения
-------------------------
1. **Инициализация класса:** Создайте экземпляр класса `Gemini` для взаимодействия с моделью.
2. **Авторизация:**  
    - Используйте метод `nodriver_login` для авторизации с помощью Nodriver.
    - Если Nodriver не доступен, используйте метод `start_auto_refresh` для автоматического обновления куки-файлов в фоновом режиме.
3. **Отправка запросов:**
    - Используйте метод `create_async_generator` для отправки запросов к модели с использованием предоставленных параметров: 
        - `model`: имя модели Gemini.
        - `messages`: список сообщений в чате.
        - `proxy`: прокси-сервер для анонимности.
        - `cookies`: куки-файлы авторизации.
        - `media`: список файлов медиа.
        - `return_conversation`: флаг для возврата объекта `Conversation` (идентификаторы беседы).
        - `conversation`: объект `Conversation` для отслеживания диалога.
        - `language`: язык запроса.
    - Метод `create_async_generator` генерирует асинхронный итератор, который возвращает части ответа модели.
4. **Обработка ответов:** 
    - Метод `create_async_generator` предоставляет частичный ответ модели в виде текстовых строк или объектов  `Reasoning`, `ImageResponse` и `YouTube`, если это необходимо.
    - Обработайте  ответы модели, чтобы извлечь необходимую информацию.

Пример использования
-------------------------

```python
from hypotez.src.endpoints.gpt4free.g4f.Provider.needs_auth.Gemini import Gemini, Conversation

async def main():
    gemini = Gemini()
    # Авторизация с помощью Nodriver (если доступен)
    async for chunk in gemini.nodriver_login():
        print(chunk)
    # Или обновление куки-файлов в фоновом режиме (если Nodriver недоступен)
    await gemini.start_auto_refresh()
    # Отправка запроса
    async for chunk in gemini.create_async_generator(
        model="gemini-2.0-flash",
        messages=[{"role": "user", "content": "Привет, как дела?"}]
    ):
        print(chunk)
    # Обработка ответа
    # ...

if __name__ == "__main__":
    asyncio.run(main())
```

**Важные замечания:**
- Метод `nodriver_login` использует Nodriver для авторизации. Если Nodriver не доступен, используйте метод `start_auto_refresh` для автоматического обновления куки-файлов.
- Метод `create_async_generator` возвращает асинхронный итератор, который предоставляет частичные ответы модели. 
- Модель Gemini требует авторизации с помощью куки-файлов.
- Метод `upload_images` позволяет загружать изображения в модель Gemini.
- Метод `synthesize` позволяет отправлять синтезированный текст на сервер для обработки.
- `build_request` формирует запрос к модели Gemini.
- Используйте метод `fetch_snlm0e` для получения идентификатора `SNlM0e` из страницы Gemini.

**Дополнительно:**
- Класс `Conversation` позволяет отслеживать идентификаторы беседы и сохранять диалог.
- Используйте метод `rotate_1psidts` для обновления куки-файла `__Secure-1PSIDTS`.
- Функции `iter_filter_base64` и `iter_base64_decode` используются для обработки ответа модели, закодированного в Base64.
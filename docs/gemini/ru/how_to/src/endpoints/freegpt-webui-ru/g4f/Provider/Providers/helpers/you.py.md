## Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот блок кода реализует взаимодействие с API You.com для получения ответов от чат-бота YouChat. 

Он принимает список сообщений `messages` как входные данные, преобразует их в формат, подходящий для API YouChat, отправляет запрос к API и обрабатывает ответ в потоковом режиме, выводая полученный токен `youChatToken`.

Шаги выполнения
-------------------------
1. **Импорт библиотек**: Импортируются необходимые библиотеки для работы с JSON, URL-кодированием, запросами и обработкой строк.
2. **Загрузка конфигурации**: Загружается конфигурация из аргументов командной строки в виде JSON-строки.
3. **Преобразование сообщений**: Функция `transform(messages: list) -> list` преобразует список сообщений `messages` в формат, подходящий для API YouChat. Сообщения группируются по парам "вопрос-ответ", с учетом роли каждого сообщения (`user`, `assistant`, `system`).
4. **Формирование запроса**: Формируется URL-закодированный запрос к API YouChat, содержащий текст последнего вопроса пользователя `prompt` и историю предыдущих сообщений в преобразованном формате.
5. **Отправка запроса**: С помощью библиотеки `curl_cffi` отправляется GET-запрос к API YouChat с указанными заголовками и параметрами.
6. **Обработка ответа**:  Функция `output(chunk)` обрабатывает ответ API в потоковом режиме. Она ищет токен `youChatToken` в полученных данных и выводит его на консоль.
7. **Повторные попытки**:  В случае ошибки при отправке запроса или получении ответа, программа предпринимает повторные попытки до успешного получения токена.


Пример использования
-------------------------

```python
    import sys
    import json

    # Загружаем конфигурацию из аргументов командной строки
    config = json.loads(sys.argv[1])
    messages = config['messages']

    # Вызываем функцию для преобразования сообщений
    transformed_messages = transform(messages)

    # Формируем запрос к API YouChat
    params = urllib.parse.urlencode({
        'q': 'What is the meaning of life?',  # Задаем вопрос
        'domain': 'youchat',
        'chat': transformed_messages, 
    })

    # Отправляем запрос к API и получаем ответ
    response = requests.get(f'https://you.com/api/streamingSearch?{params}',
                        headers=headers, content_callback=output, impersonate='safari15_5')
```

В этом примере мы передаем список сообщений `messages` и текст последнего вопроса `'What is the meaning of life?'` в функцию `transform`, формируем запрос к API и запускаем выполнение. Функция `output` будет выводить токен `youChatToken` в консоль по мере его получения.
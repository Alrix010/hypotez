### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код определяет функцию `_create_completion`, которая отправляет запросы к Google Bard для генерации ответов на основе предоставленных сообщений. Он использует cookies для аутентификации и прокси при необходимости.

Шаги выполнения
-------------------------
1. **Извлечение cookie:** Код извлекает значение cookie `__Secure-1PSID` из cookies браузера Chrome для аутентификации.
2. **Форматирование сообщений:** Форматирует список сообщений в строку, объединяя роль и содержимое каждого сообщения.
3. **Настройка прокси (опционально):** Если предоставлен прокси, настраивает его для использования в HTTP и HTTPS запросах.
4. **Инициализация параметров:** Инициализирует параметры `snlm0e`, `conversation_id`, `response_id` и `choice_id`.
5. **Настройка заголовков:** Устанавливает необходимые заголовки для HTTP-запроса, включая cookie с `__Secure-1PSID`.
6. **Получение `SNlM0e`:** Если `snlm0e` не определен, извлекает его из HTML главной страницы Bard.
7. **Формирование данных запроса:** Формирует данные запроса, включая `at` (значение `snlm0e`) и `f.req` (JSON-дамп списка с промптом и идентификаторами).
8. **Отправка запроса:** Отправляет POST-запрос к API Bard для генерации ответа.
9. **Обработка ответа:** Извлекает данные чата из ответа и возвращает сгенерированный текст.
10. **Обработка ошибок:** Если данные чата отсутствуют, возвращает строку 'error'.

Пример использования
-------------------------

```python
import asyncio

# Пример использования асинхронной функции _create_completion
async def main():
    messages = [
        {"role": "user", "content": "What is the capital of France?"},
    ]

    # Замените 'your_proxy' на ваш фактический прокси или установите proxy=False
    proxy = 'your_proxy' 

    # Использование async for для обработки потока ответов
    responses = []
    async for response in _create_completion(model="Palm2", messages=messages, stream=True, proxy=proxy):
        responses.append(response)

    # Вывод всех полученных ответов
    print(responses)

# Запуск асинхронной функции
if __name__ == "__main__":
    asyncio.run(main())
### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код предоставляет реализацию взаимодействия с Bing AI для генерации текста на основе заданного запроса. Он включает в себя функции для создания диалога, отправки запросов и обработки ответов в потоковом режиме.

Шаги выполнения
-------------------------
1. **Импорт необходимых модулей**:
   - Импортируются модули `os`, `json`, `random`, `uuid`, `ssl`, `certifi`, `aiohttp`, `asyncio` и `requests`.
   - Из `...typing` импортируются `sha256`, `Dict`, `get_type_hints`.

2. **Определение глобальных параметров**:
   - Устанавливается `url` для Bing Chat.
   - Определяется список поддерживаемых моделей (`model`).
   - Указывается поддержка потоковой передачи (`supports_stream`).
   - Отмечается, что аутентификация не требуется (`needs_auth`).
   - Создается SSL-контекст для безопасного соединения.

3. **Класс `optionsSets`**:
   - Определяет структуру наборов параметров, включая `jailbreak` с набором опций.

4. **Класс `Defaults`**:
   - Задает параметры по умолчанию, такие как разделитель, IP-адрес, разрешенные типы сообщений, идентификаторы срезов и информацию о местоположении.

5. **Функция `_format`**:
   - Форматирует сообщение в JSON и добавляет разделитель.

6. **Функция `create_conversation`**:
   - Функция создает диалог с сервером Bing и возвращает идентификатор диалога, идентификатор клиента и подпись диалога.
   - Выполняет несколько попыток запроса, если первая попытка не удалась.

7. **Функция `stream_generate`**:
   - Асинхронно генерирует текст на основе запроса, используя WebSocket для потоковой передачи.
   - Устанавливает соединение с сервером Bing, отправляет запрос и обрабатывает ответы, возвращая их в виде генератора.
   - Обрабатывает различные типы сообщений и ошибок.

8. **Функция `run`**:
   - Запускает асинхронный генератор и возвращает значения в синхронном режиме.

9. **Функция `convert`**:
   - Конвертирует историю сообщений в строку контекста.

10. **Функция `_create_completion`**:
    - Принимает запрос и контекст, и возвращает ответ от Bing AI в потоковом режиме.
    - Использует `stream_generate` для генерации ответа.

11. **Параметры**:
    - Определяет параметры, поддерживаемые провайдером.

Пример использования
-------------------------

```python
import asyncio
from src.endpoints.freegpt_webui_ru.g4f.Provider.Providers import Bing

async def main():
    prompt = "Напиши короткий рассказ о космосе."
    generator = Bing.stream_generate(prompt)
    async for message in generator:
        print(message, end="")

if __name__ == "__main__":
    asyncio.run(main())
```
```python
import asyncio
from src.endpoints.freegpt_webui_ru.g4f.Provider.Providers import Bing

async def main():
    messages = [
        {"role": "user", "content": "Что такое Python?"},
        {"role": "assistant", "content": "Python - это высокоуровневый язык программирования."},
        {"role": "user", "content": "Напиши пример кода на Python, который выводит 'Hello, world!'"}
    ]
    prompt = messages[-1]["content"]
    context = Bing.convert(messages[:-1])
    generator = Bing.stream_generate(prompt, context=context)
    async for message in generator:
        print(message, end="")

if __name__ == "__main__":
    asyncio.run(main())
### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот блок кода определяет набор обработчиков (роутеров) для Telegram-бота, управляющих каталогом товаров. Он включает обработку запросов на отображение каталога, отображение товаров в выбранной категории и организацию процесса покупки товаров через различные платежные системы (ЮKassa, Stars, Robocassa).

Шаги выполнения
-------------------------
1. **Обработка запроса каталога**:
   - Функция `page_catalog` вызывается при получении callback-запроса с данными "catalog".
   - Функция отвечает на callback-запрос текстом "Загрузка каталога...".
   - Сообщение, вызвавшее запрос, удаляется.
   - Функция извлекает все категории товаров из базы данных, используя `CategoryDao.find_all`.
   - Функция отправляет сообщение с категориями товаров и кнопками, используя `catalog_kb` для формирования клавиатуры.

2. **Отображение товаров категории**:
   - Функция `page_catalog_products` вызывается при получении callback-запроса с данными, начинающимися с "category_".
   - Функция извлекает ID категории из данных callback-запроса.
   - Функция извлекает все товары, принадлежащие выбранной категории, из базы данных, используя `ProductDao.find_all`.
   - Если товары в категории есть:
     - Функция отвечает на callback-запрос сообщением о количестве товаров в категории.
     - Для каждого товара формируется текстовое описание, включающее название, цену и описание товара.
     - Отправляется сообщение с описанием товара и кнопками для покупки, используя `product_kb` для формирования клавиатуры.
   - Если товаров в категории нет, функция отвечает на callback-запрос сообщением об отсутствии товаров.

3. **Обработка запроса на покупку товара**:
   - Функция `process_about` вызывается при получении callback-запроса с данными, начинающимися с "buy_".
   - Функция извлекает информацию о пользователе из базы данных, используя `UserDAO.find_one_or_none`.
   - Функция извлекает тип платежа, ID товара и цену из данных callback-запроса.
   - В зависимости от типа платежа вызывается соответствующая функция для создания и отправки счета:
     - `send_yukassa_invoice` для ЮKassa.
     - `send_stars_invoice` для Stars.
     - `send_robocassa_invoice` для Robocassa.
   - Сообщение, вызвавшее запрос, удаляется.

4. **Отправка счета ЮKassa**:
   - Функция `send_yukassa_invoice` отправляет счет для оплаты через ЮKassa.
   - Функция формирует параметры счета, такие как ID чата, заголовок, описание, payload, токен провайдера, валюта и цены.
   - Функция отправляет счет пользователю с помощью `bot.send_invoice` и клавиатурой для оплаты, используя `get_product_buy_youkassa`.

5. **Отправка счета Robocassa**:
   - Функция `send_robocassa_invoice` отправляет счет для оплаты через Robocassa.
   - Функция получает следующий доступный ID покупки из базы данных, используя `PurchaseDao.get_next_id`.
   - Функция формирует ссылку на оплату, используя `generate_payment_link`.
   - Функция отправляет сообщение с описанием товара и кнопками для оплаты, используя `get_product_buy_robocassa`.

6. **Отправка счета Stars**:
   - Функция `send_stars_invoice` отправляет счет для оплаты звездами (Stars).
   - Функция формирует параметры счета, такие как ID чата, заголовок, описание, payload, токен провайдера, валюта и цены.
   - Функция отправляет счет пользователю с помощью `bot.send_invoice` и клавиатурой для оплаты, используя `get_product_buy_stars`.

7. **Обработка предварительной проверки оплаты**:
   - Функция `pre_checkout_query` вызывается перед подтверждением оплаты.
   - Функция подтверждает возможность проведения оплаты, используя `bot.answer_pre_checkout_query`.

8. **Обработка успешной оплаты**:
   - Функция `successful_payment` вызывается после успешной оплаты.
   - Функция извлекает информацию об оплате из сообщения.
   - Функция извлекает тип платежа, ID пользователя и ID товара из данных об оплате.
   - Функция определяет цену и валюту в зависимости от типа платежа.
   - Функция формирует словарь с данными об оплате.
   - Функция вызывает `successful_payment_logic` для завершения обработки успешной оплаты.

Пример использования
-------------------------

```python
from aiogram import Dispatcher

# Предположим, catalog_router уже создан

dp = Dispatcher()
dp.include_router(catalog_router)

# Запуск бота
# dp.run_polling()
```
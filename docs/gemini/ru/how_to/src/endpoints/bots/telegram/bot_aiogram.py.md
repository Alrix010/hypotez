### Как использовать класс `TelegramBot`
=========================================================================================

Описание
-------------------------
Этот класс представляет собой интерфейс для управления Telegram-ботом, который интегрирован с FastAPI через RPC. Он позволяет запускать бота, регистрировать обработчики команд и сообщений, а также управлять вебхуком для получения обновлений от Telegram.

Шаги выполнения
-------------------------
1. **Инициализация класса `TelegramBot`**:
   - Создается экземпляр класса `TelegramBot` с указанием токена Telegram-бота и маршрута для вебхука.
   - Вызывается метод `__init__`, который инициализирует основные компоненты бота, такие как токен, маршрут, конфигурацию, экземпляр `Bot` (из `aiogram`), диспетчер `Dispatcher`, обработчик `BotHandler` и регистрирует обработчики по умолчанию.

2. **Запуск бота**:
   - Вызывается метод `run`, который выполняет следующие действия:
     - Инициализирует RPC-клиента для связи с сервером FastAPI.
     - Запускает RPC-сервер, используя `ServerProxy` для регистрации маршрутов и обработки запросов.
     - Инициализирует вебхук Telegram-бота, чтобы бот мог получать обновления через HTTP.
     - Регистрирует маршрут вебхука через RPC, чтобы сервер FastAPI мог перенаправлять обновления боту.
     - Запускает веб-приложение `aiohttp` для обработки входящих запросов от Telegram.
     - Если не удалось настроить вебхук, бот запускается в режиме опроса (`polling`).

3. **Регистрация обработчиков по умолчанию**:
   - Вызывается метод `_register_default_handlers`, который регистрирует обработчики для различных команд и типов сообщений.
   - Используется `self.dp.message.register` для регистрации обработчиков для команд `/start`, `/help`, `/sendpdf`, а также для текстовых сообщений, голосовых сообщений и документов.

4. **Обработка сообщений**:
   - При получении текстового сообщения вызывается метод `_handle_message`, который передает сообщение обработчику `BotHandler` для дальнейшей обработки.

5. **Инициализация вебхука**:
   - Вызывается метод `initialize_bot_webhook`, который настраивает вебхук для бота, чтобы Telegram мог отправлять обновления на указанный URL.
   - Если хост указан как `127.0.0.1` или `localhost`, используется `ngrok` для создания публичного URL.

6. **Регистрация маршрута через RPC**:
   - Вызывается метод `_register_route_via_rpc`, который регистрирует маршрут вебхука на сервере FastAPI через RPC.

7. **Остановка бота**:
   - Вызывается метод `stop`, который останавливает веб-приложение и удаляет вебхук, чтобы бот перестал получать обновления.

Пример использования
-------------------------

```python
import os
from dotenv import load_dotenv
from src.endpoints.bots.telegram.bot_aiogram import TelegramBot

# Загрузка переменных окружения из файла .env
load_dotenv()

# Создание экземпляра TelegramBot с использованием токена из переменных окружения
bot = TelegramBot(os.getenv('TELEGRAM_TOKEN'))

# Запуск бота
bot.run()

# Для остановки бота:
# bot.stop()
### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот блок кода определяет набор обработчиков и состояний для реализации административной панели в Telegram-боте. Он включает в себя функции для отображения статистики, добавления и удаления товаров, а также для управления категориями товаров.

Шаги выполнения
-------------------------
1. **Инициализация роутера и состояний**:
   - Создается роутер `admin_router` для обработки административных запросов.
   - Определяется класс `AddProduct` с состояниями, необходимыми для добавления нового товара (имя, описание, цена, файл, категория, скрытый контент, подтверждение).

2. **Обработчик команды "admin_panel"**:
   - Функция `start_admin` обрабатывает команду `admin_panel` (доступна только для пользователей с `ID` в списке `settings.ADMIN_IDS`).
   - Функция отправляет пользователю сообщение с административной панелью, предлагая выбрать действие.

3. **Обработчик команды "statistic"**:
   - Функция `admin_statistic` обрабатывает команду `statistic`, отображая статистику по пользователям и заказам.
   - Функция извлекает данные о пользователях и платежах из базы данных с помощью `UserDAO` и `PurchaseDao`.
   - Формирует текстовое сообщение со статистикой и отправляет его пользователю.

4. **Обработчик команды "cancel"**:
   - Функция `admin_process_cancel` обрабатывает команду `cancel`, отменяя текущий сценарий добавления товара.
   - Функция очищает состояние пользователя с помощью `state.clear()` и отправляет сообщение об отмене.

5. **Обработчик команды "delete_product"**:
   - Функция `admin_process_start_dell` обрабатывает команду `delete_product`, запуская процесс удаления товаров.
   - Функция извлекает все товары из базы данных с помощью `ProductDao.find_all()`.
   - Для каждого товара формирует описание и кнопки для удаления.
   - Отправляет товары с кнопками для удаления.

6. **Обработчик удаления товара**:
   - Функция `admin_process_start_dell` обрабатывает нажатие на кнопку удаления товара (данные начинаются с `dell_`).
   - Извлекает `ID` товара из данных обратного вызова.
   - Удаляет товар из базы данных с помощью `ProductDao.delete()`.
   - Отправляет подтверждение об удалении и удаляет сообщение с товаром.

7. **Обработчик команды "process_products"**:
   - Функция `admin_process_products` обрабатывает команду `process_products`, предлагая действия по управлению товарами.
   - Функция извлекает общее количество товаров из базы данных.
   - Отправляет сообщение с предложением выбрать действие (добавление, удаление и т.д.).

8. **Обработчик команды "add_product"**:
   - Функция `admin_process_add_product` обрабатывает команду `add_product`, запуская сценарий добавления нового товара.
   - Функция запрашивает у пользователя имя товара и переводит его в состояние `AddProduct.name`.

9. **Обработчик ввода имени товара**:
   - Функция `admin_process_name` обрабатывает ввод имени товара пользователем.
   - Функция сохраняет имя товара в состоянии и запрашивает описание товара, переводя пользователя в состояние `AddProduct.description`.

10. **Обработчик ввода описания товара**:
    - Функция `admin_process_description` обрабатывает ввод описания товара пользователем.
    - Функция сохраняет описание товара в состоянии и запрашивает выбор категории товара, переводя пользователя в состояние `AddProduct.category_id`.

11. **Обработчик выбора категории товара**:
    - Функция `admin_process_category` обрабатывает выбор категории товара пользователем.
    - Функция сохраняет `ID` категории в состоянии и запрашивает цену товара, переводя пользователя в состояние `AddProduct.price`.

12. **Обработчик ввода цены товара**:
    - Функция `admin_process_price` обрабатывает ввод цены товара пользователем.
    - Функция проверяет, что введено числовое значение, сохраняет цену в состоянии и запрашивает файл (документ) товара, переводя пользователя в состояние `AddProduct.file_id`.

13. **Обработчик отсутствия файла товара**:
    - Функция `admin_process_without_file` обрабатывает выбор варианта "без файла" для товара.
    - Функция сохраняет `None` в состоянии для `file_id` и запрашивает скрытый контент, который будет доступен после покупки, переводя пользователя в состояние `AddProduct.hidden_content`.

14. **Обработчик отправки файла товара**:
    - Функция `admin_process_without_file` обрабатывает отправку файла (документа) товара пользователем.
    - Функция сохраняет `file_id` в состоянии и запрашивает скрытый контент, который будет доступен после покупки, переводя пользователя в состояние `AddProduct.hidden_content`.

15. **Обработчик ввода скрытого контента товара**:
    - Функция `admin_process_hidden_content` обрабатывает ввод скрытого контента товара пользователем.
    - Функция сохраняет скрытый контент в состоянии и формирует текст для подтверждения данных о товаре.
    - Отправляет пользователю сообщение с данными о товаре и кнопками для подтверждения, переводя пользователя в состояние `AddProduct.confirm_add`.

16. **Обработчик подтверждения добавления товара**:
    - Функция `admin_process_confirm_add` обрабатывает подтверждение добавления товара пользователем.
    - Функция извлекает все данные о товаре из состояния.
    - Сохраняет товар в базе данных с помощью `ProductDao.add()`.
    - Отправляет сообщение об успешном добавлении товара.

Пример использования
-------------------------

```python
from aiogram import Bot, Dispatcher
from aiogram.types import Message
from aiogram import Router, F
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import StatesGroup, State
from aiogram.types import CallbackQuery, Message
from sqlalchemy.ext.asyncio import AsyncSession
from bot.config import settings, bot
from bot.dao.dao import UserDAO, ProductDao, CategoryDao, PurchaseDao
from bot.admin.kbs import admin_kb, admin_kb_back, product_management_kb, cancel_kb_inline, catalog_admin_kb, \
    admin_send_file_kb, admin_confirm_kb, dell_product_kb
from bot.admin.schemas import ProductModel, ProductIDModel
from bot.admin.utils import process_dell_text_msg

# Инициализация бота и диспетчера
bot = Bot(token=settings.BOT_TOKEN)
dp = Dispatcher()

# Регистрация роутера административной панели
dp.include_router(admin_router)

# Пример использования обработчика команды "admin_panel"
@dp.message(F.text == "/admin", F.from_user.id.in_(settings.ADMIN_IDS))
async def admin_command(message: Message):
    # Эмулируем CallbackQuery для вызова обработчика admin_panel
    await start_admin(call=CallbackQuery(from_user=message.from_user, message=message, data="admin_panel"))

# Запуск бота
async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
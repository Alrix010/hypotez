## Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот блок кода представляет собой основную точку входа для запуска Telegram-бота, реализованного на базе библиотеки `aiogram`. Он обрабатывает установку бота, регистрацию маршрутов и обработчиков, а также запускает приложение `aiohttp` для работы бота в вебхук-режиме. 

Шаги выполнения
-------------------------
1. **Инициализация**: Импортируются необходимые модули, включая `aiogram`, `aiohttp`, `loguru`, а также конфигурационные настройки бота, обработчики и мидлвари из других файлов проекта.
2. **Установка команд**: Функция `set_default_commands()` задает команды по умолчанию для бота, такие как `/start`. 
3. **Запуск бота**: Функция `on_startup()` выполняется при запуске приложения. Она устанавливает команды, устанавливает вебхук для бота и отправляет сообщение админам о запуске.
4. **Остановка бота**: Функция `on_shutdown()` выполняется при остановке приложения. Она удаляет вебхук, закрывает сессию бота и отправляет сообщение админам о завершении работы.
5. **Регистрация мидлварей**: Функция `register_middlewares()` регистрирует мидлвари для диспетчера, которые будут обрабатывать все входящие обновления от Telegram.
6. **Регистрация маршрутов**: Функция `register_routers()` регистрирует обработчики для различных маршрутов бота, например, для обработки команд, сообщений, inline-запросов.
7. **Создание приложения**: Функция `create_app()` создает приложение `aiohttp` и настраивает его. Она добавляет обработчики для маршрутов, включая вебхук, обработчики для Robokassa (системы оплаты) и страницу приветствия. 
8. **Запуск приложения**: Функция `main()` является основной точкой входа. Она регистрирует мидлвари и маршруты, создает приложение `aiohttp` и запускает его на указанном хосте и порте.

Пример использования
-------------------------

```python
# main.py
from bot.config import settings
from bot.app.app import handle_webhook, robokassa_result, robokassa_fail, home_page 

# Создаем приложение aiohttp
app = web.Application()

# Регистрация обработчиков маршрутов
app.router.add_post(f"/{settings.BOT_TOKEN}", handle_webhook) 
app.router.add_post("/robokassa/result/", robokassa_result)
app.router.add_get("/robokassa/fail/", robokassa_fail)
app.router.add_get("/", home_page)

# ... остальной код для запуска бота

# Запускаем приложение
web.run_app(app, host=settings.SITE_HOST, port=settings.SITE_PORT)
```

В данном примере создается приложение `aiohttp` и регистрируются обработчики для разных маршрутов, включая обработчик вебхука, обработчики для Robokassa и страницу приветствия.
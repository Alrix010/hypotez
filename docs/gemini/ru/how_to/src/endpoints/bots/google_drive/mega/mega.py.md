### Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот код представляет собой класс `Mega`, который предоставляет интерфейс для работы с облачным хранилищем Mega. Он включает в себя функции для входа в систему (с использованием email/пароля или эфемерой аутентификации), загрузки файлов, скачивания файлов, получения публичных ссылок и управления файлами.

Шаги выполнения
-------------------------
1. **Инициализация класса `Mega`**:
   - Создается экземпляр класса `Mega`. При инициализации генерируется случайный номер последовательности `seqno` и устанавливается `sid` в `None`.

2. **Аутентификация**:
   - **Через email и пароль**: Вызывается метод `login_user(email, password)`.
     - Функция `prepare_key` подготавливает ключ на основе пароля.
     - Вычисляется хеш `uh` на основе email и подготовленного ключа.
     - Отправляется API-запрос для аутентификации пользователя.
     - Вызывается `_login_common` для обработки результата.
   - **Через эфемерой вход**: Вызывается метод `login_ephemeral()`.
     - Генерируются случайные ключи и challenge.
     - Отправляется API-запрос для получения user handle.
     - Отправляется API-запрос для аутентификации пользователя.
     - Вызывается `_login_common` для обработки результата.

3. **Общая логика входа (`_login_common`)**:
   - Дешифруется мастер-ключ с использованием предоставленного пароля.
   - Если в ответе есть `tsid`, используется он для установки `sid`.
   - Если в ответе есть `csid`, дешифруется RSA приватный ключ и используется для получения `sid`.

4. **Получение списка файлов (`get_files`)**:
   - Отправляется API-запрос для получения списка файлов.
   - Для каждого файла дешифруется ключ и атрибуты.
   - Определяются ID корневой директории, входящих и корзины.

5. **Скачивание файла**:
   - **Из URL (`download_from_url`)**: Извлекается ID и ключ файла из URL и вызывается `download_file`.
   - **По ID и ключу (`download_file`)**:
     - Отправляется API-запрос для получения информации о файле (URL, размер, атрибуты).
     - Дешифруются атрибуты файла для получения имени файла.
     - Скачивается файл по частям, дешифруется каждая часть и записывается в выходной файл.
     - Проверяется целостность файла с использованием MAC.

6. **Получение публичной ссылки (`get_public_url`)**:
   - Отправляется API-запрос для получения публичного handle файла.
   - Формируется публичная ссылка.

7. **Загрузка файла (`uploadfile`)**:
   - Открывается файл для чтения.
   - Отправляется API-запрос для получения URL загрузки.
   - Генерируются случайные ключи для шифрования файла.
   - Файл шифруется по частям и отправляется на URL загрузки.
   - Вычисляется MAC для каждой части файла.
   - Отправляется API-запрос для завершения загрузки и получения информации о файле.

Пример использования
-------------------------

```python
from mega import Mega

# Пример использования с email и паролем
try:
    mega = Mega.from_credentials('your_email', 'your_password')
    files = mega.get_files()
    print(f"Список файлов: {files}")

    # Загрузка файла
    file_path = mega.uploadfile('example.txt')
    print(f"Файл загружен: {file_path}")
    
    # Скачивание файла по id и ключу
    file_id = files['f'][0]['h'] # get first file_id
    file_key = files['f'][0]['k'] # get first file_key
    downloaded_file = mega.download_file(file_id, file_key)
    print(f"Файл скачан: {downloaded_file}")

except Exception as e:
    print(f"Произошла ошибка: {e}")
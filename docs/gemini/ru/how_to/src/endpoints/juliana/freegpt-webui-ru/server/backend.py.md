## Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Блок кода реализует API-интерфейс для взаимодействия с моделью ChatGPT. Он обрабатывает входящие запросы от пользователей, создает сообщения для модели, отправляет их на обработку и возвращает ответ в виде потока событий. 

Шаги выполнения
-------------------------
1. **Инициализация класса Backend_Api:** Создается экземпляр класса `Backend_Api`, который принимает два аргумента: `app` (приложение Flask) и `config` (словарь настроек).
2. **Определение маршрутов:**  В классе определяются маршруты API-интерфейса. В этом случае, единственный маршрут `/backend-api/v2/conversation` привязан к функции `_conversation`, которая обрабатывает запросы к этому маршруту методом POST.
3. **Обработка запросов:** Функция `_conversation` извлекает данные из тела запроса: `streaming`, `jailbreak`, `model`, `messages`. 
4. **Генерация ответа:** Используется библиотека `g4f` для взаимодействия с моделью ChatGPT. 
   - Функция `ChatCompletion.create` отправляет сообщения модели и получает ответ.
   - Если в настройках указано использование автоматического прокси, функция `get_random_proxy` выбирает случайный прокси-сервер для отправки запросов.
5. **Формирование ответа:** Ответ от модели формируется в виде потока событий (`text/event-stream`) и возвращается клиенту.
6. **Обработка ошибок:** В случае возникновения ошибки во время обработки запроса или ответа, функция возвращает JSON-объект с информацией об ошибке.

Пример использования
-------------------------

```python
from server.backend import Backend_Api

# Создание экземпляра класса Backend_Api
backend_api = Backend_Api(app, config)

# Отправка запроса к API
response = requests.post(
    'http://localhost:5000/backend-api/v2/conversation',
    json={
        'stream': True,
        'jailbreak': 'Default',
        'model': 'gpt-3.5-turbo',
        'messages': [
            {'role': 'user', 'content': 'Привет! Как дела?'}
        ]
    }
)

# Обработка ответа
if response.status_code == 200:
    # Получение потока событий из ответа
    for message in response.iter_lines():
        # Обработка каждого сообщения
        print(message.decode('utf-8'))
else:
    # Обработка ошибки
    print(f'Ошибка: {response.json()}')
```
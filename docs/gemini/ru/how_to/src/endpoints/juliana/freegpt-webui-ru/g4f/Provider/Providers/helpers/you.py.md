## Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Данный код реализует взаимодействие с API you.com для получения ответов от чат-бота. Код преобразует историю диалога в формат, понятный для API, отправляет запрос и получает ответ.

Шаги выполнения
-------------------------
1. **Инициализация**: 
    - Загружаем конфигурацию из аргумента командной строки (`sys.argv[1]`).
    - Извлекаем список сообщений из конфигурации (`config['messages']`).
    - Инициализируем пустую строку для хранения последнего пользовательского сообщения (`prompt = ''`).
2. **Преобразование истории диалога**:
    - Функция `transform(messages: list)` принимает список сообщений и преобразует его в формат, необходимый для API.
    - Функция итерирует по списку сообщений, группируя их по ролям (`user`, `assistant`, `system`).
    - Для сообщений пользователя (`role: user`) сохраняется текст вопроса (`question`) и текст ответа (`answer`).
    - Для сообщений бота (`role: assistant`) сохраняется пустой вопрос и текст ответа.
    - Для системных сообщений (`role: system`) сохраняется текст вопроса и пустой ответ.
    - Функция возвращает преобразованный список.
3. **Подготовка запроса**:
    - Проверяется, является ли последнее сообщение в истории сообщением пользователя (`messages[-1]['role'] == 'user'`).
    - Если да, то текст сообщения пользователя записывается в переменную `prompt`, а последнее сообщение удаляется из истории.
    - Формируется словарь параметров запроса (`params`), который включает:
        - `q`: Последний вопрос пользователя (`prompt`).
        - `domain`: Домен чат-бота (`youchat`).
        - `chat`: Преобразованная история диалога (`transform(messages)`).
    - Параметры кодируются с помощью `urllib.parse.urlencode`.
4. **Отправка запроса**:
    - Задаются заголовки запроса (`headers`) с информацией о языке, агенте пользователя, типе содержимого и т. д.
    - Инициализируется бесконечный цикл.
    - Внутри цикла отправляется GET-запрос к API you.com (`https://you.com/api/streamingSearch?{params}`) с использованием `requests.get`.
    - Запрос отправляется с заголовками `headers`, а также с параметрами `content_callback=output` и `impersonate='safari15_5'`, которые позволяют обрабатывать ответ потоком.
5. **Обработка ответа**:
    - Функция `output(chunk)` вызывается при поступлении части ответа от API.
    - Функция проверяет наличие токена чата (`"youChatToken"`) в части ответа.
    - Если токен найден, то извлекается JSON-объект с токеном чата и печатается на консоль.
    - Если в процессе работы возникла ошибка, то сообщение об ошибке печатается на консоль, и цикл продолжается.


Пример использования
-------------------------

```python
# Пример конфигурации, передаваемой в качестве аргумента командной строки
config = {
    'messages': [
        {'role': 'user', 'content': 'Привет! Как дела?'},
        {'role': 'assistant', 'content': 'Привет! У меня все отлично, а у тебя?'},
        {'role': 'user', 'content': 'Хорошо, спасибо.'}
    ]
}

# Передача конфигурации в виде JSON-строки
sys.argv = ['you.py', json.dumps(config)]

# Выполнение кода
import you
```

**Важно:** 
- Необходимо заменить `config` на актуальную конфигурацию с историей диалога.
- Этот код предназначен для работы в качестве скрипта, получающего конфигурацию из аргумента командной строки.
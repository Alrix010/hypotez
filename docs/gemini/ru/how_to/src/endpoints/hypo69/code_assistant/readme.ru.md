## \file hypotez/src/endpoints/hypo69/code_assistant/readme.ru.md
# -*- coding: utf-8 -*-
#! .pyenv/bin/python3

"""
Документация для модуля `Code Assistant`.
=========================================
"""

``````rst
.. module:: src.endpoints.hypo69.code_assistant
``````

<TABLE >
<TR>
<TD>
<A HREF = 'https://github.com/hypo69/hypotez/blob/master/readme.ru.md'>[Root ↑]</A>
</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypotez/blob/master/src/readme.ru.md'>src</A> \ 
<A HREF = 'https://github.com/hypo69/hypotez/blob/master/src/endpoints/readme.ru.md'>endpoints</A> \
<A HREF = 'https://github.com/hypo69/hypotez/blob/master/src/endpoints/hypo69/readme.ru.md'>hypo69</A>

</TD>
<TD>
<A HREF = 'https://github.com/hypo69/hypotez/blob/master/src/endpoints/hypo69/code_assistant/README.MD'>English</A>
</TD>
</TR>
</TABLE>

# Модуль `Code Assistant`

## Обзор

Модуль `Code Assistant` представляет собой набор инструментов для взаимодействия с моделями **Gemini** и **OpenAI** с целью обработки исходного кода проекта. Он выполняет задачи, такие как создание документации, проверка кода и генерация тестов на основе указанных файлов. Также включает скрипты для создания файла `SUMMARY.md` для компиляции документации и Telegram-бота для обработки задач, связанных с кодом.

## Основные возможности

### `code_assistant.py`
- **Чтение файлов**: Функция читает код из файлов с расширениями `.py` и `README.MD` в указанных директориях.
- **Взаимодействие с моделями**: Функция отправляет код в модели для выполнения задач, таких как создание документации или проверка ошибок.
- **Генерация результатов**: Функция сохраняет ответы моделей в указанные директории для каждой роли.

### `make_summary.py`
- **Генерация `SUMMARY.md`**: Функция рекурсивно обходит директорию для создания файла `SUMMARY.md` для компиляции документации.
- **Фильтрация по языку**: Функция поддерживает фильтрацию файлов по языку (`ru` или `en`).

### `onela_bot.py` и `bot_handlers.py`
- **Telegram-бот**: Бот для обработки задач, связанных с кодом, таких как отправка фрагментов кода на проверку или генерация документации.
- **Обработчики бота**: Файл содержит обработчики для команд и сообщений бота.

## Структура проекта

- **Модели**: Используются модели **Gemini** и **OpenAI** для обработки запросов.
- **Промпты**: Функция считывает промпты из файлов в директории `src/ai/prompts/developer/` (например, `doc_writer_en.md`).
- **Файлы**: Функция обрабатывает файлы с расширениями `.py` и `README.MD` в указанных директориях.

## Примеры использования

### Запуск с настройками из JSON:
```bash
python code_assistant.py --settings settings.json
```

### Запуск с явным указанием параметров:
```bash
python code_assistant.py --role doc_writer --lang ru --models gemini openai --start_dirs /path/to/dir1 /path/to/dir2
```

### Пример для роли `code_checker`:
```bash
python code_assistant.py --role code_checker --lang en --models gemini --start_dirs /path/to/dir
```

### Пример для модели `openai`:
```bash
python code_assistant.py --role doc_writer --lang en --models openai
```

## Параметры командной строки

- `--settings`: Путь к JSON-файлу с настройками. Загружает параметры из файла.
- `--role`: Роль модели для выполнения задачи (например, `doc_writer`, `code_checker`).
- `--lang`: Язык выполнения задачи (например, `ru` или `en`).
- `--models`: Список моделей для инициализации (например, `gemini`, `openai`).
- `--start_dirs`: Список директорий для обработки (например, `/path/to/dir1`).

## Логика работы

1. **Чтение файлов**: Функция ищет файлы с расширениями `.py` и `README.MD` в указанных директориях.
2. **Загрузка промптов**: Функция загружает промпты для каждой роли из директории `src/ai/prompts/developer/`.
3. **Обработка запросов**: Функция формирует запросы на основе загруженных файлов и отправляет их в модели.
4. **Сохранение ответов**: Функция сохраняет ответы моделей в директории, соответствующие роли и модели (например, `docs/raw_rst_from_<model>/<lang>/`).

## Исключения

Настройка исключений для файлов и директорий с помощью параметров:
- `exclude_file_patterns`: Список регулярных выражений для исключения файлов.
- `exclude_dirs`: Список директорий для исключения.
- `exclude_files`: Список файлов для исключения.

## Логирование

Логи сохраняются с помощью библиотеки `logger` и содержат информацию о процессе обработки файлов и полученных ответах.

## Зависимости

- **Gemini API**: Требуется API-ключ для работы с моделью Gemini.
- **OpenAI API**: Требуется API-ключ для работы с моделью OpenAI.

## Создание новой роли для моделей ИИ

1. **Обновление `code_assistant.json`**:
   - Функция добавляет новую роль в список ролей:
     ```json
     "roles": [
       "code_checker",
       ...
     ]
     ```
   - Функция исключает роль в `"exclude-roles"`.

2. **Добавление роли в переводы**:
   - Функция обновляет файл `translations/translations.json` с новой ролью.

3. **Создание системного промпта**:
   - Функция добавляет новый системный промпт в директорию `ai/prompts/developer/`.

4. **Создание командной инструкции**:
   - Функция добавляет новую команду в директорию `instructions/`.

``````

Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Этот блок кода предоставляет общее описание и инструкции по использованию модуля `Code Assistant`, включая его основные компоненты, возможности и структуру.

Шаги выполнения
-------------------------
1. **Просмотр обзора**: Ознакомьтесь с общим описанием модуля `Code Assistant` и его назначением.
2. **Изучение основных возможностей**: Рассмотрите основные возможности модуля, такие как чтение файлов, взаимодействие с моделями, генерация результатов, генерация `SUMMARY.md`, Telegram-бот и обработчики бота.
3. **Анализ структуры проекта**: Изучите структуру проекта, включая используемые модели, промпты и типы обрабатываемых файлов.
4. **Ознакомление с примерами использования**: Просмотрите примеры использования модуля с различными параметрами командной строки.
5. **Изучение параметров командной строки**: Ознакомьтесь с доступными параметрами командной строки и их функциями.
6. **Понимание логики работы**: Рассмотрите логику работы модуля, включая чтение файлов, загрузку промптов, обработку запросов и сохранение ответов.
7. **Настройка исключений**: Узнайте, как настраивать исключения для файлов и директорий с помощью параметров `exclude_file_patterns`, `exclude_dirs` и `exclude_files`.
8. **Изучение логирования**: Ознакомьтесь с тем, как логи сохраняются и какую информацию они содержат.
9. **Проверка зависимостей**: Убедитесь, что установлены необходимые зависимости, такие как API-ключи для Gemini и OpenAI.
10. **Создание новой роли**: Следуйте инструкциям по созданию новой роли для моделей ИИ, включая обновление `code_assistant.json`, добавление роли в переводы, создание системного промпта и создание командной инструкции.

Пример использования
-------------------------

```python
# Пример использования модуля Code Assistant для запуска с настройками из JSON
import subprocess

def run_code_assistant_with_settings(settings_file: str) -> None:
    """
    Запускает скрипт code_assistant.py с указанным файлом настроек.

    Args:
        settings_file (str): Путь к JSON-файлу с настройками.
    """
    try:
        command = ["python", "code_assistant.py", "--settings", settings_file]
        result = subprocess.run(command, capture_output=True, text=True, check=True)
        print("Скрипт успешно выполнен.")
        print("Вывод скрипта:")
        print(result.stdout)
    except subprocess.CalledProcessError as e:
        print(f"Ошибка выполнения скрипта: {e}")
        print("Сообщение об ошибке:")
        print(e.stderr)

# Пример использования
settings_file = "settings.json"
run_code_assistant_with_settings(settings_file)
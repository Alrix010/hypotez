## Сценарий асинхронной публикации сообщения на Facebook

### Обзор

Этот скрипт автоматизирует процесс публикации сообщений на Facebook. Скрипт взаимодействует со страницей Facebook, используя локаторы для выполнения различных действий, таких как отправка сообщений, загрузка медиафайлов и обновление подписей.

### Основные возможности

1.  **Отправка заголовка и описания**: Отправляет заголовок и описание кампании в поле сообщения на Facebook.
2.  **Загрузка медиафайлов**: Загружает медиафайлы (изображения и видео) на пост Facebook и обновляет их подписи.
3.  **Продвижение поста**: Управляет всем процессом продвижения поста с заголовком, описанием и медиафайлами.

### Структура модуля

[Диаграмма Mermaid, описывающая структуру модуля]

### Легенда

1.  **Start**: Начало выполнения скрипта.
2.  **InitDriver**: Создание экземпляра класса `Driver`.
3.  **LoadCategoryAndProducts**: Загрузка данных категории и товаров.
4.  **SendTitle**: Вызов функции `post_title` для отправки заголовка.
5.  **CheckTitleSuccess**: Проверка успешности отправки заголовка.

    *   **Да**: Переход к загрузке медиа и продвижению поста.
    *   **Нет**: Вывод ошибки "Не удалось отправить заголовок".
6.  **UploadMediaAndPromotePost**: Вызов функции `promote_post`.
7.  **UploadMedia**: Вызов функции `upload_media` для загрузки медиафайлов.
8.  **CheckMediaSuccess**: Проверка успешности загрузки медиа.

    *   **Да**: Переход к обновлению подписей к изображениям.
    *   **Нет**: Вывод ошибки "Не удалось загрузить медиа".
9.  **UpdateCaptions**: Вызов функции `update_images_captions` для обновления подписей.
10. **PromotePost**: Завершение процесса продвижения поста.
11. **CheckPromoteSuccess**: Проверка успешности продвижения поста.

    *   **Да**: Конец выполнения скрипта.
    *   **Нет**: Вывод ошибки "Не удалось продвинуть пост".

#### Функции

*   **`post_title(d: Driver, category: SimpleNamespace) -> bool`**:

    *   **Назначение**: Функция отправляет заголовок и описание кампании в поле сообщения на Facebook.
    *   **Параметры**:

        *   `d`: Экземпляр `Driver` для взаимодействия с веб-страницей.
        *   `category`: Категория, содержащая заголовок и описание для отправки.
    *   **Возвращает**: `True`, если заголовок и описание были успешно отправлены. В противном случае `None`.
*   **`upload_media(d: Driver, products: List[SimpleNamespace], no_video: bool = False) -> bool`**:

    *   **Назначение**: Функция загружает медиафайлы на пост Facebook.
    *   **Параметры**:

        *   `d`: Экземпляр `Driver` для взаимодействия с веб-страницей.
        *   `products`: Список товаров, содержащих пути к медиафайлам.
        *   `no_video`: Флаг, указывающий, следует ли пропустить загрузку видео.
    *   **Возвращает**: `True`, если медиафайлы были успешно загружены. В противном случае `None`.
*   **`update_images_captions(d: Driver, products: List[SimpleNamespace], textarea_list: List[WebElement]) -> None`**:

    *   **Назначение**: Функция асинхронно добавляет описания к загруженным медиафайлам.
    *   **Параметры**:

        *   `d`: Экземпляр `Driver` для взаимодействия с веб-страницей.
        *   `products`: Список товаров с деталями для обновления.
        *   `textarea_list`: Список текстовых полей, куда добавляются подписи.
*   **`promote_post(d: Driver, category: SimpleNamespace, products: List[SimpleNamespace], no_video: bool = False) -> bool`**:

    *   **Назначение**: Функция управляет процессом продвижения поста с заголовком, описанием и медиафайлами.
    *   **Параметры**:

        *   `d`: Экземпляр `Driver` для взаимодействия с веб-страницей.
        *   `category`: Детали категории, используемые для заголовка и описания поста.
        *   `products`: Список товаров, содержащих медиа и детали для публикации.
        *   `no_video`: Флаг, указывающий, следует ли пропустить загрузку видео.
    *   **Возвращает**: `True`, если пост был успешно продвинут. В противном случае `None`.

### Использование

Чтобы использовать этот скрипт, выполните следующие действия:

1.  **Инициализация Driver**: Создайте экземпляр класса `Driver`.
2.  **Загрузка локаторов**: Загрузите локаторы из JSON-файла.
3.  **Вызов функций**: Используйте предоставленные функции для отправки заголовка, загрузки медиа и продвижения поста.

#### Пример

```python
from src.webdriver.driver import Driver
from types import SimpleNamespace

# Инициализация Driver
driver = Driver(...)

# Загрузка категории и товаров
category = SimpleNamespace(title="Заголовок кампании", description="Описание кампании")
products = [SimpleNamespace(local_image_path='путь/к/изображению.jpg', ...)]

# Отправка заголовка
post_title(driver, category)

# Загрузка медиа и продвижение поста
await promote_post(driver, category, products)
```

### Зависимости

*   `selenium`: Для веб-автоматизации.
*   `asyncio`: Для асинхронных операций.
*   `pathlib`: Для обработки путей к файлам.
*   `types`: Для создания простых пространств имен.
*   `typing`: Для аннотаций типов.

### Обработка ошибок

Скрипт включает надежную обработку ошибок, чтобы обеспечить продолжение выполнения даже в случае, если некоторые элементы не найдены или если возникли проблемы с веб-страницей. Это особенно полезно для обработки динамических или нестабильных веб-страниц.

### Вклад

Вклад в этот скрипт приветствуется. Убедитесь, что любые изменения хорошо документированы и включают соответствующие тесты.

### Лицензия

Этот скрипт лицензирован под MIT License. Подробности смотрите в файле `LICENSE`.
```

Как использовать этот блок кода
=========================================================================================

Описание
-------------------------

Этот блок кода предоставляет сценарий асинхронной публикации сообщений на Facebook, включая отправку заголовка и описания, загрузку медиафайлов и продвижение поста. Он использует веб-драйвер для взаимодействия с Facebook.

Шаги выполнения
-------------------------

1.  **Инициализируйте драйвер**: Создайте экземпляр класса `Driver`, который будет использоваться для управления браузером и взаимодействия с веб-страницей Facebook.
2.  **Подготовьте данные**: Создайте объекты `SimpleNamespace` для хранения данных о категории и товарах, включая заголовок, описание и пути к медиафайлам.
3.  **Отправьте заголовок**: Вызовите функцию `post_title` для отправки заголовка и описания кампании на страницу Facebook. Эта функция выполняет действия по заполнению соответствующих полей на веб-странице.
4.  **Загрузите медиафайлы и продвиньте пост**: Вызовите функцию `promote_post`, которая загружает медиафайлы (изображения, видео) на страницу Facebook и выполняет необходимые действия для продвижения поста.

Пример использования
-------------------------

```python
from src.webdriver.driver import Driver
from types import SimpleNamespace
import asyncio

# Инициализация Driver (замените '...' на фактические параметры)
driver = Driver(browser_name='chrome')

# Подготовка данных о категории
category = SimpleNamespace(title="Пример заголовка кампании", description="Пример описания кампании")

# Подготовка данных о товарах (замените 'путь/к/изображению.jpg' на фактический путь)
products = [SimpleNamespace(local_image_path='путь/к/изображению.jpg')]

# Функция для асинхронного запуска продвижения поста
async def run_promotion():
    # Отправка заголовка
    await post_title(driver, category)
    # Загрузка медиа и продвижение поста
    await promote_post(driver, category, products)

# Запуск асинхронной функции
asyncio.run(run_promotion())
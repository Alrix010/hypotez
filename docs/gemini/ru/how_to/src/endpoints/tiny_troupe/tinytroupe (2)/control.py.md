### **Как использовать этот блок кода**
=========================================================================================

Описание
-------------------------
Этот код реализует систему управления симуляцией, которая включает в себя механизмы кэширования и транзакций для обеспечения воспроизводимости и эффективности выполнения симуляций. Он позволяет запускать, останавливать, сохранять состояния симуляции, а также добавлять агентов, среды и фабрики в симуляцию. Кроме того, он поддерживает кэширование результатов выполнения функций для ускорения повторных выполнений с использованием механизма транзакций.

Шаги выполнения
-------------------------
1. **Инициализация симуляции**: Создайте экземпляр класса `Simulation`, который представляет собой контейнер для агентов, сред и фабрик.
2. **Запуск симуляции**: Используйте метод `begin()` для запуска симуляции. При этом можно указать путь к файлу кэша и необходимость автоматического сохранения состояния после каждой транзакции.
3. **Добавление компонентов**: Добавьте агентов, среды и фабрики в симуляцию с помощью методов `add_agent()`, `add_environment()` и `add_factory()`.
4. **Выполнение транзакций**: Оберните функции, которые изменяют состояние симуляции, декоратором `@transactional`. Это позволит автоматически кэшировать результаты выполнения этих функций и использовать их при повторном вызове с теми же аргументами.
5. **Завершение симуляции**: Используйте метод `end()` для завершения симуляции. При этом будет автоматически сохранено текущее состояние симуляции в файл кэша.
6. **Сохранение состояния**: Используйте метод `checkpoint()` для принудительного сохранения текущего состояния симуляции в файл кэша.
7. **Сброс состояния**: Используйте функцию `reset()` для сброса состояния симуляции к начальному.

Пример использования
-------------------------

```python
import tinytroupe
from tinytroupe.control import Simulation, transactional, begin, end, reset
from tinytroupe.agent import TinyPerson
from tinytroupe.environment import TinyWorld

# 1. Инициализация и запуск симуляции
reset()
begin(cache_path="./simulation.cache.json", auto_checkpoint=True)

# 2. Создание агента и добавление его в симуляцию
class MyAgent(TinyPerson):
    def __init__(self, name="MyAgent", age=20, environment=None):
        super().__init__(name=name, age=age, environment=environment)

    @transactional
    def update_age(self, new_age):
        """Обновляет возраст агента."""
        self.age = new_age
        return self.age

agent = MyAgent()

# 3. Создание среды и добавление ее в симуляцию
class MyEnvironment(TinyWorld):
    def __init__(self, name="MyEnvironment"):
        super().__init__(name=name)

environment = MyEnvironment()

# 4. Выполнение транзакции
initial_age = agent.age
new_age = agent.update_age(25)

print(f"Initial age: {initial_age}, New age: {new_age}")

# 5. Повторное выполнение транзакции (будет использован кэш)
new_age_cached = agent.update_age(30)
print(f"New cached age: {new_age_cached}")

# 6. Завершение симуляции
end()
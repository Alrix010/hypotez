Как использовать этот блок кода
=========================================================================================

Описание
-------------------------
Класс `Normalizer` предназначен для нормализации текстовых элементов, таких как пассажи, концепции и другие текстовые фрагменты. Он использует LLM (Large Language Model) для приведения различных элементов к единому, стандартизированному виду. Класс включает в себя механизмы кэширования для повышения производительности при повторной нормализации одних и тех же элементов.

Шаги выполнения
-------------------------
1. **Инициализация объекта `Normalizer`**:
   - Класс `Normalizer` инициализируется списком элементов (`elements`), которые необходимо нормализовать, числом (`n`) нормализованных элементов для вывода и флагом `verbose`, определяющим необходимость вывода отладочных сообщений.
   - При инициализации выполняется удаление дубликатов из списка входных элементов.

2. **Композиция сообщений для LLM**:
   - Используется функция `utils.compose_initial_LLM_messages_with_templates` для создания сообщений, которые будут отправлены в LLM. Эта функция комбинирует системные и пользовательские шаблоны сообщений, используя `mustache` шаблоны из папки `extraction`.
   - В шаблоны передаются параметры, такие как количество нормализованных элементов (`n`) и сами элементы (`elements`).

3. **Отправка сообщений в LLM и получение результата**:
   - Сообщения отправляются в LLM с помощью метода `openai_utils.client().send_message`.
   - Полученный результат (JSON) извлекается с использованием функции `utils.extract_json`.

4. **Нормализация элементов**:
   - Метод `normalize` принимает один элемент или список элементов для нормализации.
   - Сначала проверяется, есть ли элемент в кэше (`self.normalizing_map`). Если элемент найден в кэше, возвращается его нормализованное значение из кэша.
   - Если элемента нет в кэше, он добавляется в список элементов для нормализации.

5. **Обработка некэшированных элементов**:
   - Для некэшированных элементов формируются новые сообщения для LLM, используя шаблоны `normalizer.applier.system.mustache` и `normalizer.applier.user.mustache`.
   - Результат нормализации извлекается из ответа LLM и сохраняется в кэше (`self.normalizing_map`) для последующего использования.

6. **Возврат нормализованных элементов**:
   - Метод возвращает список нормализованных элементов в том же порядке, в котором они были переданы на вход.

Пример использования
-------------------------

```python
from tinytroupe.extraction.normalizer import Normalizer

# Пример списка элементов для нормализации
elements = ["кошка", "собака", "птица", "кошка"]

# Создание экземпляра класса Normalizer
normalizer = Normalizer(elements=elements, n=3, verbose=True)

# Нормализация списка элементов
normalized_elements = normalizer.normalize(elements)

# Вывод нормализованных элементов
print(normalized_elements)

# Нормализация одного элемента
normalized_element = normalizer.normalize("слон")
print(normalized_element)
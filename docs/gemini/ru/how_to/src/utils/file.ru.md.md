## Как использовать блок кода `file.py`
=========================================================================================

Описание
-------------------------
Модуль `file.py` предоставляет набор функций для работы с файлами и директориями, включая запись данных в файлы, чтение файлов (в том числе больших) с использованием генераторов, рекурсивный поиск файлов, получение списка имен файлов и поддиректорий, а также удаление BOM (Byte Order Mark) из файлов.

Шаги выполнения
-------------------------
1. **Импорт модуля**: Импортируйте необходимые функции из модуля `file.py`.
2. **Использование функций**: Выберите и используйте нужные функции для выполнения операций с файлами и директориями.

Пример использования
-------------------------

```python
from pathlib import Path
from src.utils.file import (
    save_text_file,
    read_text_file,
    get_filenames_from_directory,
    recursively_get_file_path,
    remove_bom
)

# 1. Сохранение данных в файл
data = {"name": "John", "age": 30, "city": "New York"}
file_path = "data.json"
result = save_text_file(data, file_path)
if result:
    print(f"Файл '{file_path}' успешно сохранен.")
else:
    print(f"Ошибка при сохранении файла '{file_path}'.")

# 2. Чтение данных из файла
content = read_text_file(file_path)
if content:
    print(f"Содержимое файла '{file_path}':\n{content}")
else:
    print(f"Ошибка при чтении файла '{file_path}'.")

# 3. Получение списка файлов в директории
directory_path = "."  # текущая директория
filenames = get_filenames_from_directory(directory_path)
print(f"Список файлов в директории '{directory_path}':\n{filenames}")

# 4. Рекурсивный поиск файлов в директории
root_dir = "."  # текущая директория
patterns = "*.json"
file_paths = recursively_get_file_path(root_dir, patterns)
print(f"Список файлов с расширением '{patterns}' в директории '{root_dir}':\n{file_paths}")

# 5. Удаление BOM из файла
file_path = "data.json"
remove_bom(file_path)
print(f"BOM удален из файла '{file_path}'.")
```

### Описание функций

#### 1. `save_text_file(data, file_path, mode='w')`

Функция записывает данные в указанный текстовый файл.

**Шаги выполнения:**

1. **Подготовка данных**:
   - Функция проверяет тип входных данных `data`. Если это словарь, преобразует его в JSON-формат. Если это список строк, объединяет строки с символом новой строки.

2. **Создание директорий**:
   - Функция использует `file_path.parent.mkdir(parents=True, exist_ok=True)` для создания необходимых директорий, если они не существуют.

3. **Запись данных в файл**:
   - Функция открывает файл в указанном режиме (`mode`) с кодировкой UTF-8 и записывает данные в файл.

4. **Обработка ошибок**:
   - Функция возвращает `True` при успешной записи и `False` в случае ошибки, логируя исключение.

#### 2. `read_text_file_generator(file_path, as_list=False, extensions=None, chunk_size=8192, recursive=False, patterns=None)`

Функция читает содержимое файла или директории, используя генератор для эффективной обработки больших файлов.

**Шаги выполнения:**

1. **Проверка типа пути**:
   - Функция проверяет, является ли `file_path` файлом или директорией.

2. **Чтение файла**:
   - Если `file_path` – файл:
     - Если `as_list=True`, функция возвращает генератор строк, используя `_read_file_lines_generator`.
     - Если `as_list=False`, функция возвращает всё содержимое файла как строку, используя `_read_file_content`.

3. **Чтение директории**:
   - Если `file_path` – директория:
     - Функция рекурсивно находит все файлы, соответствующие `patterns` и `extensions`.
     - Если `as_list=True`, функция возвращает генератор, объединяющий строки из всех файлов.
     - Если `as_list=False`, функция возвращает объединённую строку из всех файлов.

4. **Обработка ошибок**:
   - Функция возвращает `None` при возникновении ошибок и логирует их.

#### 3. `read_text_file(file_path, as_list=False, extensions=None, exc_info=True, chunk_size=8192)`

Функция читает содержимое файла или директории.

**Шаги выполнения:**

1. **Проверка типа пути**:
   - Функция проверяет, является ли `file_path` файлом или директорией.

2. **Чтение файла**:
   - Если `file_path` – файл:
     - Открывает файл для чтения и возвращает его содержимое в виде строки или списка строк в зависимости от значения `as_list`.

3. **Чтение директории**:
   - Если `file_path` – директория:
     - Рекурсивно считывает все файлы, соответствующие `extensions`, и объединяет их содержимое в одну строку или список строк.

4. **Обработка ошибок**:
   - Функция возвращает `None` при возникновении ошибок и логирует их.

#### 4. `yield_text_from_files(file_path, as_list=False, chunk_size=8192)`

Функция читает файл и возвращает его содержимое как генератор строк или как одну строку.

**Шаги выполнения:**

1. **Выбор метода чтения**:
   - В зависимости от значения `as_list` функция выбирает метод чтения файла:
     - Если `as_list=True`, использует `_read_file_lines_generator` для построчного чтения с использованием генератора.
     - Если `as_list=False`, использует `_read_file_content` для чтения всего содержимого файла в одну строку.

2. **Обработка ошибок**:
   - Функция возвращает `None` при возникновении ошибок.

#### 5. `_read_file_content(file_path, chunk_size)`

Функция читает содержимое файла по частям (чанкам) и возвращает его как одну строку.

**Шаги выполнения:**

1. **Инициализация**:
   - Функция инициализирует пустую строку `content` для накопления содержимого файла.

2. **Чтение файла по частям**:
   - Функция открывает файл для чтения и читает его по частям размером `chunk_size`.

3. **Накопление данных**:
   - Функция добавляет каждую прочитанную часть файла к переменной `content`.

4. **Возврат результата**:
   - Функция возвращает накопленное содержимое файла как одну строку.

#### 6. `_read_file_lines_generator(file_path, chunk_size)`

Функция читает файл построчно с помощью генератора.

**Шаги выполнения:**

1. **Чтение файла по частям**:
   - Функция открывает файл для чтения и читает его по частям размером `chunk_size`.

2. **Разделение на строки**:
   - Функция разделяет каждую прочитанную часть на строки с помощью `splitlines()`.

3. **Обработка неполных строк**:
   - Функция обрабатывает случай, когда последняя строка в части неполная, и добавляет её к следующей части файла.

4. **Генерация строк**:
   - Функция возвращает каждую строку с помощью `yield`.

#### 7. `get_filenames_from_directory(directory, ext='*')`

Функция возвращает список имен файлов в указанной директории, фильтруя по расширению.

**Шаги выполнения:**

1. **Получение списка файлов**:
   - Функция получает список всех файлов в указанной директории с помощью `os.listdir()`.

2. **Фильтрация по расширению**:
   - Функция фильтрует список файлов, оставляя только те, которые соответствуют указанному расширению (`ext`).

3. **Возврат результата**:
   - Функция возвращает список имен файлов, соответствующих указанному расширению.

#### 8. `recursively_yield_file_path(root_dir, patterns='*')`

Функция рекурсивно итерирует по файлам в указанной директории и её поддиректориях, возвращая пути к файлам, соответствующим заданным шаблонам.

**Шаги выполнения:**

1. **Рекурсивный поиск файлов**:
   - Функция использует `Path.rglob()` для рекурсивного поиска файлов, соответствующих заданным шаблонам (`patterns`).

2. **Генерация путей к файлам**:
   - Функция возвращает каждый найденный путь к файлу с помощью `yield`.

#### 9. `recursively_get_file_path(root_dir, patterns='*')`

Функция рекурсивно находит все файлы в директории и её поддиректориях, соответствующие указанным шаблонам, и возвращает список их путей.

**Шаги выполнения:**

1. **Рекурсивный поиск файлов**:
   - Функция использует `Path.rglob()` для рекурсивного поиска файлов, соответствующих заданным шаблонам (`patterns`).

2. **Сбор путей к файлам**:
   - Функция собирает все найденные пути к файлам в список.

3. **Возврат результата**:
   - Функция возвращает список путей к файлам.

#### 10. `recursively_read_text_files(root_dir, patterns, as_list=False)`

Функция рекурсивно читает содержимое файлов в указанной директории, соответствующих заданным шаблонам.

**Шаги выполнения:**

1. **Рекурсивный обход директории**:
   - Функция использует `os.walk()` для рекурсивного обхода директории.

2. **Чтение файлов**:
   - Для каждого файла, соответствующего шаблонам (`patterns`), функция считывает его содержимое.

3. **Сбор содержимого файлов**:
   - Функция добавляет содержимое каждого файла в результирующий список.

4. **Возврат результата**:
   - Функция возвращает список содержимого файлов.

#### 11. `get_directory_names(directory)`

Функция возвращает список имен поддиректорий в указанной директории.

**Шаги выполнения:**

1. **Получение списка элементов**:
   - Функция получает список всех элементов (файлов и поддиректорий) в указанной директории с помощью `os.listdir()`.

2. **Фильтрация по типу**:
   - Функция фильтрует список элементов, оставляя только те, которые являются директориями.

3. **Возврат результата**:
   - Функция возвращает список имен поддиректорий.

#### 12. `remove_bom(path)`

Функция удаляет BOM (Byte Order Mark) из текстового файла или из всех `.py` файлов в директории.

**Шаги выполнения:**

1. **Проверка типа пути**:
   - Функция проверяет, является ли `path` файлом или директорией.

2. **Обработка файла**:
   - Если `path` – файл, функция удаляет BOM из него.

3. **Обработка директории**:
   - Если `path` – директория, функция рекурсивно обходит все `.py` файлы и удаляет BOM из них.

#### 13. `main()`

Функция является точкой входа для скрипта, который удаляет BOM из всех `.py` файлов в директории `src`.

**Шаги выполнения:**

1. **Удаление BOM**:
   - Функция вызывает `remove_bom()` для директории `src`.
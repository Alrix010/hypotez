### **Инструкции по использованию модуля интеграции Google Generative AI**

=========================================================================================

Описание
-------------------------
Этот модуль предназначен для интеграции и взаимодействия с моделями Google Generative AI. Класс `GoogleGenerativeAi` предоставляет методы для отправки запросов, обработки ответов, управления диалогами и интеграции с различными функциональностями ИИ. Включает надежную обработку ошибок, ведение журнала и настройки конфигурации для обеспечения бесперебойной работы.

Шаги выполнения
-------------------------

1.  **Инициализация класса `GoogleGenerativeAi`**:

    *   Необходимо указать ключ API для аутентификации.
    *   Опционально можно указать имя модели, конфигурацию генерации и системную инструкцию.
    *   Функция `__init__` устанавливает пути для ведения журнала диалогов и хранения истории.
    *   Инициализирует модель Google Generative AI.

2.  **Настройка конфигурации**:

    *   Функция `config()` извлекает параметры конфигурации из файла `gemini.json`, расположенного в директории `src/ai/gemini`.
    *   Определите параметры, необходимые для работы с моделью.

3.  **Запуск сессии чата**:

    *   Вызовите метод `_start_chat()`, чтобы инициализировать сессию чата с моделью ИИ.
    *   Сессия чата будет использовать пустую историю.

4.  **Сохранение диалога**:

    *   Для сохранения истории взаимодействий используйте метод `_save_dialogue(dialogue: list)`.
    *   Функция добавляет каждое сообщение в диалоге в текстовый файл и JSON файл.

5.  **Отправка текстового запроса**:

    *   Используйте метод `ask(q: str, attempts: int = 15)` для отправки текстового запроса.
    *   Этот метод обрабатывает несколько попыток в случае ошибок сети или недоступности сервиса.
    *   Метод ведет журнал ошибок и повторяет попытки с экспоненциальной задержкой.
    *   Сохраняет диалог в файлы истории.

6.  **Взаимодействие в режиме чата**:

    *   Для поддержания контекста диалога используйте метод `chat(q: str)`.
    *   Этот метод использует сессию чата, инициализированную методом `_start_chat`.
    *   Метод ведет журнал ошибок и возвращает текст ответа.

7.  **Описание изображения**:

    *   Чтобы получить текстовое описание изображения, используйте метод `describe_image(image_path: Path)`.
    *   Этот метод кодирует изображение в base64 и отправляет его модели ИИ.
    *   Метод возвращает сгенерированное описание или ведет журнал ошибки, если операция не удалась.

8.  **Загрузка файла**:

    *   Для загрузки файла в модель ИИ используйте метод `upload_file(file: str | Path | IOBase, file_name: Optional[str] = None)`.
    *   Этот метод обрабатывает загрузку файла и ведет журнал успеха или неудачи.
    *   Предоставляет логику повторных попыток в случае ошибок.

Пример использования
-------------------------

```python
from pathlib import Path
from src.llm.gemini import GoogleGenerativeAi

# Инициализация класса с использованием API-ключа и системной инструкции
ai = GoogleGenerativeAi(api_key="your_api_key", system_instruction="You are helpful AI assistance")

# Пример отправки текстового запроса и вывод ответа
response = ai.ask("Как дела?")
print(response)

# Пример отправки сообщения в чат и вывод ответа
chat_response = ai.chat("Расскажи о себе.")
print(chat_response)

# Пример описания изображения
image_path = Path("path/to/your/image.jpg")
image_description = ai.describe_image(image_path)
print(image_description)
```
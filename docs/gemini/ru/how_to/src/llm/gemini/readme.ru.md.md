## Модуль интеграции Google Generative AI

### Обзор

Класс `GoogleGenerativeAi` обеспечивает взаимодействие с моделями Google Generative AI. Он предоставляет методы для отправки запросов, обработки ответов, управления диалогами и интеграции с различными функциональностями ИИ. 

### Основные функции

#### `__init__(self, api_key: str, model_name: Optional[str] = None, generation_config: Optional[Dict] = None, system_instruction: Optional[str] = None, **kwargs)`

**Описание**: Инициализирует класс `GoogleGenerativeAi` с необходимыми конфигурациями.

**Шаги выполнения**:

1. Устанавливает ключ API, имя модели, конфигурацию генерации и системную инструкцию.
2. Определяет пути для ведения журнала диалогов и хранения истории.
3. Инициализирует модель Google Generative AI.

#### `config()`

**Описание**: Получает конфигурацию из файла настроек.

**Шаги выполнения**:

1. Читает и разбирает файл конфигурации, расположенный по пути `gs.path.src / \'ai\' / \'gemini\' / \'gemini.json\'`.

#### `_start_chat(self)`

**Описание**: Запускает сессию чата с моделью ИИ.

**Шаги выполнения**:

1. Инициализирует сессию чата с пустой историей.

#### `_save_dialogue(self, dialogue: list)`

**Описание**: Сохраняет диалог в текстовые и JSON файлы.

**Шаги выполнения**:

1. Добавляет каждое сообщение в диалоге в текстовый файл.
2. Добавляет каждое сообщение в формате JSON в JSON файл.

#### `ask(self, q: str, attempts: int = 15) -> Optional[str]`

**Описание**: Отправляет текстовый запрос модели ИИ и получает ответ.

**Шаги выполнения**:

1. Обрабатывает несколько попыток в случае ошибок сети или недоступности сервиса.
2. Ведет журнал ошибок и повторяет попытки с экспоненциальной задержкой.
3. Сохраняет диалог в файлы истории.

#### `chat(self, q: str) -> str`

**Описание**: Отправляет сообщение чата модели ИИ и получает ответ.

**Шаги выполнения**:

1. Использует сессию чата, инициализированную методом `_start_chat`.
2. Ведет журнал ошибок и возвращает текст ответа.

#### `describe_image(self, image_path: Path) -> Optional[str]`

**Описание**: Генерирует текстовое описание изображения.

**Шаги выполнения**:

1. Кодирует изображение в base64 и отправляет его модели ИИ.
2. Возвращает сгенерированное описание или ведет журнал ошибки, если операция не удалась.

#### `upload_file(self, file: str | Path | IOBase, file_name: Optional[str] = None) -> bool`

**Описание**: Загружает файл в модель ИИ.

**Шаги выполнения**:

1. Обрабатывает загрузку файла и ведет журнал успеха или неудачи.
2. Предоставляет логику повторных попыток в случае ошибок.


### Обработка ошибок

Класс включает в себя комплексную обработку ошибок для различных сценариев:

- **Ошибки сети**: Повторяет попытки с экспоненциальной задержкой.
- **Недоступность сервиса**: Ведет журнал ошибок и повторяет попытки.
- **Лимиты квот**: Ведет журнал и ждет перед повторной попыткой.
- **Ошибки аутентификации**: Ведет журнал и прекращает дальнейшие попытки.
- **Неверный ввод**: Ведет журнал и повторяет попытки с таймаутом.
- **Ошибки API**: Ведет журнал и прекращает дальнейшие попытки.

### Ведение журнала и история

Все взаимодействия с моделями ИИ ведутся в журнале, и диалоги сохраняются как в текстовых, так и в JSON форматах для последующего анализа. Это обеспечивает отслеживаемость всех операций и возможность их просмотра для отладки или аудита.

### Зависимости

- `google.generativeai`
- `requests`
- `grpc`
- `google.api_core.exceptions`
- `google.auth.exceptions`
- `src.logger`
- `src.utils.printer`
- `src.utils.file`
- `src.utils.date_time`
- `src.utils.convertors.unicode`
- `src.utils.jjson`

### Пример использования

```python
ai = GoogleGenerativeAi(api_key="your_api_key", system_instruction="Instruction")
response = ai.ask("Как дела?")
print(response)
```

Этот пример инициализирует класс `GoogleGenerativeAi` и отправляет запрос модели ИИ, выводя ответ.
### **Анализ кода модуля `get_free_port.py`**

---

#### **Качество кода**:
- **Соответствие стандартам**: 7/10
- **Плюсы**:
  - Четкая структура, разграничение ответственности между функциями.
  - Использование `logger` для логирования ошибок.
  - Обработка различных типов входных данных для `port_range`.
- **Минусы**:
  - `header` импортируется, но не используется.
  - Docstring модуля содержит `Agrs` вместо `Args`.
  - Отсутствуют примеры использования в docstring для функций.
  - Не все строки docstring переведены на русский язык.
  - Не указаны типы исключений в docstring для функций.
  - Нет аннотации возвращаемого типа у внутренних функций.

#### **Рекомендации по улучшению**:
1.  Удалить неиспользуемый импорт `header`.
2.  Исправить опечатку `Agrs` на `Args` в docstring модуля.
3.  Добавить примеры использования в docstring для функций `get_free_port`, `_is_port_in_use` и `_parse_port_range`.
4.  Перевести все строки docstring на русский язык.
5.  Указать типы исключений, которые могут быть выброшены, в docstring для функций `get_free_port` и `_parse_port_range`.
6.  Добавить аннотации типов возвращаемых значений для внутренних функций `_is_port_in_use` и `_parse_port_range`.
7.  Улучшить обработку ошибок, добавив более конкретные сообщения об ошибках в logger.
8.  Заменить множественное использование `ValueError` на более конкретные типы исключений.

#### **Оптимизированный код**:
```python
## \file /src/utils/get_free_port.py
# -*- coding: utf-8 -*-
#! .pyenv/bin/python3
"""
Модуль для поиска свободного порта.
====================================

Модуль предоставляет функцию :func:`get_free_port`, которая позволяет найти свободный порт
в заданном диапазоне или первый доступный порт, если диапазон не указан.

Args:
    host (str): Хост для проверки доступности портов.
    port_range (Optional[str | List[str]], optional): Диапазон портов, заданный строкой "min-max" или списком строк.
           Например: "3000-3999", ["3000-3999", "8000-8010"], None. По умолчанию `None`.

Returns:
    int: Доступный номер порта.

Raises:
    ValueError: Если не удается найти свободный порт в указанном диапазоне или если диапазон портов недействителен.

Example:
    >>> get_free_port('localhost', '3000-3005')
    3001
"""

import socket
from typing import Optional, Tuple, List

from src.logger import logger


def get_free_port(host: str, port_range: Optional[str | List[str]] = None) -> int:
    """
    Функция находит и возвращает свободный порт в указанном диапазоне или первый доступный порт, если диапазон не задан.

    Args:
        host (str): Хост для проверки доступности портов.
        port_range (Optional[str | List[str]], optional): Диапазон портов, заданный строкой "min-max" или списком строк.
               Например: "3000-3999", ["3000-3999", "8000-8010"], None. По умолчанию `None`.

    Returns:
        int: Доступный номер порта.

    Raises:
        ValueError: Если не удается найти свободный порт в указанном диапазоне или если диапазон портов недействителен.

    Example:
        >>> get_free_port('localhost', '3000-3005')
        3001
    """

    def _is_port_in_use(host: str, port: int) -> bool:
        """
        Функция проверяет, используется ли данный порт на указанном хосте.

        Args:
            host (str): Хост для проверки.
            port (int): Номер порта для проверки.

        Returns:
            bool: True, если порт используется, False в противном случае.

        Example:
            >>> _is_port_in_use('localhost', 3000)
            False
        """
        # Создание сокета и попытка привязаться к указанному порту
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
            try:
                # Попытка привязать сокет к хосту и порту
                sock.bind((host, port))
                # Если привязка прошла успешно, порт свободен
                return False  # Port is available
            except OSError:
                # Если возникла ошибка, значит порт занят
                return True  # Port is in use

    def _parse_port_range(port_range_str: str) -> Tuple[int, int]:
        """
        Функция разбирает строку диапазона портов "min-max" в кортеж (min_port, max_port).

        Args:
            port_range_str (str): Строка диапазона портов.

        Returns:
            Tuple[int, int]: Кортеж, содержащий минимальный и максимальный номера портов.

        Raises:
            ValueError: Если формат строки диапазона портов недействителен.

        Example:
            >>> _parse_port_range('3000-3005')
            (3000, 3005)
        """
        try:
            # Разделение строки на минимальный и максимальный порты
            parts = port_range_str.split('-')
            # Проверка, что разделение дало два значения
            if len(parts) != 2:
                logger.error(f'Ошибка: Неверный формат строки диапазона портов: {port_range_str}')
                # Выброс исключения, если формат неверный
                raise ValueError(f'Неверный формат строки диапазона портов: {port_range_str}')
            # Преобразование минимального и максимального портов в целые числа
            min_port = int(parts[0])
            max_port = int(parts[1])

            # Проверка, что минимальный порт не больше или равен максимальному
            if min_port >= max_port:
                logger.error(f'Ошибка: Неверный диапазон портов {port_range_str}')
                # Выброс исключения, если диапазон неверный
                raise ValueError(f'Неверный диапазон портов {port_range_str}')
            # Возврат минимального и максимального портов
            return min_port, max_port

        except ValueError as ex:
            # Логирование ошибки, если преобразование не удалось
            logger.error(f'Ошибка: Неверный диапазон портов {port_range_str}', ex, exc_info=True)
            # Выброс исключения, указывающего на неверный диапазон портов
            raise ValueError(f'Неверный диапазон портов {port_range_str}')

    # Если диапазон портов задан
    if port_range:
        # Если диапазон портов задан строкой
        if isinstance(port_range, str):
            try:
                # Попытка разобрать диапазон портов
                min_port, max_port = _parse_port_range(port_range)
            except ValueError as ex:
                # Логирование ошибки, если разбор не удался
                logger.error(f'Ошибка: {ex}', ex, exc_info=True)
                # Выброс исключения, указывающего на неверный диапазон портов
                raise ValueError(f'Неверный диапазон портов {port_range}')
            # Перебор портов в диапазоне
            for port in range(min_port, max_port + 1):
                # Если порт не используется
                if not _is_port_in_use(host, port):
                    # Возврат номера порта
                    return port
            # Логирование ошибки, если свободный порт не найден
            logger.error(f'Ошибка: Не найден свободный порт в диапазоне {port_range}')
            # Выброс исключения, указывающего на отсутствие свободного порта в диапазоне
            raise ValueError(f'Не найден свободный порт в диапазоне {port_range}')

        # Если диапазон портов задан списком
        elif isinstance(port_range, list):
            # Перебор элементов списка
            for item in port_range:
                try:
                    # Если элемент является строкой
                    if isinstance(item, str):
                        # Попытка разобрать диапазон портов
                        min_port, max_port = _parse_port_range(item)
                    # Если элемент не является строкой
                    else:
                        # Логирование ошибки, если элемент не является строкой
                        logger.error(f'Ошибка: Неверный элемент диапазона портов {item}')
                        # Выброс исключения, указывающего на неверный элемент диапазона портов
                        raise ValueError(f'Неверный элемент диапазона портов {item}')

                    # Перебор портов в диапазоне
                    for port in range(min_port, max_port + 1):
                        # Если порт не используется
                        if not _is_port_in_use(host, port):
                            # Возврат номера порта
                            return port
                except ValueError as ex:
                    # Логирование ошибки, если разбор не удался
                    logger.error(f'Ошибка: {ex}', ex, exc_info=True)
                    # Пропуск к следующему диапазону в списке, если какой-либо диапазон не удалось разобрать или нет порта
                    continue

            # Логирование ошибки, если свободный порт не найден
            logger.error(f'Ошибка: Не найден свободный порт в указанных диапазонах {port_range}')
            # Выброс исключения, указывающего на отсутствие свободного порта в указанных диапазонах
            raise ValueError(f'Не найден свободный порт в указанных диапазонах {port_range}')

        # Если тип диапазона портов не является строкой или списком
        else:
            # Логирование ошибки, если тип диапазона портов не является строкой или списком
            logger.error(f'Ошибка: Неверный тип диапазона портов {type(port_range)}')
            # Выброс исключения, указывающего на неверный тип диапазона портов
            raise ValueError(f'Неверный тип диапазона портов {type(port_range)}')
    # Если диапазон портов не задан
    else:
        # Если диапазон не задан, найти первый доступный порт
        port = 1024  # начать с 1024, так как более низкие порты являются системными
        # Бесконечный цикл для поиска свободного порта
        while True:
            # Если порт не используется
            if not _is_port_in_use(host, port):
                # Возврат номера порта
                return port
            # Увеличение номера порта
            port += 1
            # Если номер порта превышает максимальное значение
            if port > 65535:
                # Логирование ошибки, если свободный порт не найден
                logger.error(f'Ошибка: Не найден свободный порт')
                # Выброс исключения, указывающего на отсутствие свободного порта
                raise ValueError('Не найден свободный порт')
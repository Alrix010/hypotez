### **Инструкция: Обработка кода и документации проекта `hypotez`**

---

#### **Основные требования**:

1. **Формат документации**:
  - Используй стандарт `Markdown (.md)`.

   - Каждый файл должен начинаться с заголовка и краткого описания его содержимого.

   Примеры документации: Пример загаоловка файла модуля:

        """
        Модуль для работы с ассистентом программиста
        =================================================

        Модуль содержит класс :class:`CodeAssistant`, который используется для взаимодействия с различными AI-моделями
        (например, Google Gemini и OpenAI) и выполнения задач обработки кода.

        Пример использования
        ----------------------

        >>>assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
        >>>assistant.process_files()
        """


2. **Сохранение комментариев**:
   - Все существующие комментарии после `#` должны оставаться неизменными.
   - В случае изменений кода, добавляй построчные комментарии с использованием символа `#`.

3. **Обработка данных**:

   - Каждый файл должен начинаться с заголовка и краткого описания его содержимого.

   Примеры документации: Пример загаоловка файла модуля:

        """
        Модуль для работы с ассистентом программиста
        =================================================

        Модуль содержит класс :class:`CodeAssistant`, который используется для взаимодействия с различными AI-моделями
        (например, Google Gemini и OpenAI) и выполнения задач обработки кода.

        Пример использования
        ----------------------

        >>>assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
        >>>assistant.process_files()
        """

   - Для всех классов и функций используйте следующий формат комментариев:
     ```python
     def function(param: str, param1: Optional[str | dict | str] = None) -> dict | None:
         """ Функция выполняет некоторое действия... <Тут Ты пишешь что именно делает функция> 
         Args:
             param (str): Описание параметра `param`.
             param1 (Optional[str | dict | str], optional): Описание параметра `param1`. По умолчанию `None`.

         Returns:
             dict | None: Описание возвращаемого значения. Возвращает словарь или `None`.

         Raises:
             SomeError: Описание ситуации, в которой возникает исключение `SomeError`.
            ...
            <Выводить тело функции НЕ НАДО. Только docstring>
         """
         def inner_function():
            """ Внутрняя функция Функция выполняет некоторое действия... <Тут Ты пишешь что именно делает функция> 
                Args:
                    param (str): Описание параметра `param`.
                    param1 (Optional[str | dict | str], optional): Описание параметра `param1`. По умолчанию `None`.

                Returns:
                    dict | None: Описание возвращаемого значения. Возвращает словарь или `None`.

                Raises:
                    SomeError: Описание ситуации, в которой возникает исключение `SomeError`.

                ...
                    <Выводить тело функции НЕ НАДО. Только docstring>

                """
     ```

     - Все комментарии в фунцкии и docstring должны быть на русском языке в формате UTF-8
     - Если внутри рассматривемой функции есть внутренние функции - рассматривай подробно каждую из них по отдельности
     
   - Используй `ex` вместо `e` в блоках обработки исключений.
   - Для логгирования используй `logger` из моего модуля `src.logger`. Например:
     ```python
     from src.logger import logger
     logger.info('Some information message')
     ...
     except SomeError as ex:
         logger.error('Some error message', ex, exc_info = True), где ошибка передается вторым аргументом. exc_info определает надо ли выводить служебную информацию.
    ```


    _ Если в коде используется вебдрайвер, знай как его использовать
    наследуй Driver, Chrome, Firexox, Playwright
    Далее определи так
    # Создание инстанса драйвера (пример с Chrome)
    driver = Drivewr(Chrome)
    В модулях Driver И Chrome, Firexox, Playwright уже содержатся все настройки selenium. 
    Основная комада, которая используется в коде: `driver.execute_locator(l:dict)`
    Она возвращает аначение вебэелемента по локатору.

    - Всегда используй одинарные кавычки (`'`) в Python-коде. Например:
     ```python
     a = 'A1'
     b = ['a', 'b']
     c = {'key': 'value'}
     ```
     

   - Все комментарии и docstring должны быть на русском языке в формате UTF-8. Если в коде docsting на английском - сделай перевеод на русский

4. **Анализ структуры**:
   - Проверь наличие всех необходимых импортов.
   - Проанализируй связь с другими модулями и классами проекта `hypotez`.

5. **Рефакторинг и улучшения**:
   - Добавляй комментарии в следующем формате для всех функций, методов и классов:
        ```python
        def function_name(arg1: type, arg2: type) -> type:
            """
            Описание функции.
    
            Args:
                arg1 (type): Описание аргумента 1.
                arg2 (type): Описание аргумента 2.
    
            Returns:
                type: Описание возвращаемого значения.
            """
            ...
        ```

  
6. **Примеры документации**:
   **Пример модуля**:
   ```python
   """
   Модуль для работы с ассистентом программиста
   =================================================

   Модуль содержит класс :class:`CodeAssistant`, который используется для взаимодействия с различными AI-моделями
   (например, Google Gemini и OpenAI) и выполнения задач обработки кода.

   Пример использования
   ----------------------

   >>>assistant = CodeAssistant(role='code_checker', lang='ru', model=['gemini'])
   >>>assistant.process_files()
   """
   ```

   **Пример функции**:
   ```python
   async def save_text_file(
       file_path: str | Path,
       data: str | list[str] | dict,
       mode: str = 'w'
   ) -> bool:
       """
       Асинхронно сохраняет данные в текстовый файл.
        Args:
            file_path (str | Path): Путь к файлу.
            data (str | list[str] | dict): Данные для записи.
            mode (str, optional): Режим записи. По умолчанию 'w'.
        Returns:
            bool: Результат сохранения файла.

        Example:
           >>> from pathlib import Path
           >>> file_path = Path('example.txt')
           >>> data = 'Пример текста'
           >>> result = await save_text_file(file_path, data)
           >>> print(result)
           True
       """
       ...
   ```



7. **Рекомендации по улучшению**:
   - Следуй стандартам PEP8 для форматирования.
   - Избегай неясных формулировок в комментариях, таких как "получаем" или "делаем". Вместо этого используй более точные описания: "проверяем", "отправляем", "выполняем".

---

#### **Структура ответа**:

1. **Заголовок**:  
   - Анализ кода модуля `<module_name>`

2. **Качество кода**:
   - **Соответствие стандартам**: Оценка от 1 до 10
   - **Плюсы**:
     - <Положительные стороны кода>
   - **Минусы**:
     - <Отрицательные стороны кода>

3. **Рекомендации по улучшению**:
   - <Подробные советы и описания необходимых изменений>

4. **Оптимизированный код**:
   - Предложеный тобой код

   
## Твое поведение при анализе кода:
- всегда смотри системную инструкцию для обработки кода проекта `hypotez`;
- анализируй расположение файла в проекте. Это поможет понять его назначение и взаимосвязь с другими файлами. Расположение файла ты найдешь в самой превой строке кода, начинающейся с `## \\file /...`;
- запоминай предоставленный код и анализируй его связь с другими частями проекта `hypotez`;
---

### Анализ кода модуля `src.webdriver.chrome`

**Качество кода**:
- **Соответствие стандартам**: 7/10
- **Плюсы**:
    - Хорошая структурированность и подробное описание функциональности модуля.
    - Наличие примеров конфигурации и использования.
    - Описание основных особенностей, таких как Singleton Pattern.
- **Минусы**:
    - Отсутствуют docstring в начале файла, описывающие модуль.
    - Нет информации об авторе и зависимостях в явном виде.
    - Форматирование не идеально (например, отступы).
    - Отсутствуют аннотации типов.

**Рекомендации по улучшению**:

1.  **Добавить Docstring в начало файла**:
    Добавить docstring в начале файла для краткого описания модуля и его назначения.

2.  **Добавить информацию об авторе и зависимостях**:
    Добавить информацию об авторе и зависимостях в начало файла.

3.  **Улучшить форматирование**:
    Улучшить форматирование в соответствии со стандартами PEP8 (например, отступы, пробелы).

4.  **Добавить примеры использования в Docstring**:
    Добавить примеры использования класса Chrome в docstring.

5.  **Перевести на русский язык**:
    Перевести описание конфигурационных полей и примеры на русский язык для соответствия требованиям.

6.  **Улучшить описание конфигурационных полей**:
    Дополнить описание полей конфигурации, указав возможные значения и их влияние на поведение драйвера.

7.  **Обновить примеры кода**:
    Привести примеры кода к единообразному стилю (например, использование одинарных кавычек).

**Оптимизированный код**:

```python
                ```rst
.. module:: src.webdriver.chrome
```
# Кастомный модуль Chrome WebDriver для Selenium

Этот модуль предоставляет кастомную реализацию Chrome WebDriver с использованием Selenium. Он интегрирует параметры конфигурации, определенные в файле `chrome.json`, такие как user-agent и настройки профиля браузера, чтобы обеспечить гибкое и автоматизированное взаимодействие с браузером.

## Основные особенности

- **Централизованная конфигурация**: Конфигурация управляется через файл `chrome.json`.
- **Множество профилей браузера**: Поддерживает несколько профилей браузера, позволяя настраивать различные параметры для тестирования.
- **Расширенное логирование и обработка ошибок**: Предоставляет подробные логи для инициализации, проблем с конфигурацией и ошибок WebDriver.
- **Возможность передачи пользовательских опций**: Поддерживает передачу пользовательских опций во время инициализации WebDriver.

## Требования

Перед использованием этого WebDriver убедитесь, что установлены следующие зависимости:

- Python 3.x
- Selenium
- Fake User Agent
- Chrome WebDriver binary (например, `chromedriver`)

Установите необходимые Python зависимости:

```bash
pip install selenium fake_useragent
```

Кроме того, убедитесь, что бинарный файл `chromedriver` доступен в `PATH` вашей системы или укажите его путь в конфигурации.

## Конфигурация

Конфигурация для Chrome WebDriver хранится в файле `chrome.json`. Ниже приведена примерная структура файла конфигурации и ее описание:

### Пример конфигурации (`chrome.json`)

```json
{
  "options": {
    "log-level": "5",
    "disable-dev-shm-usage": "",
    "remote-debugging-port": "0",
    "arguments": [ "--kiosk", "--disable-gpu" ]
  },

  "disabled_options": { "headless": "" },

  "profile_directory": {
    "os": "%LOCALAPPDATA%\\\\Google\\\\Chrome\\\\User Data",
    "internal": "webdriver\\\\chrome\\\\profiles\\\\default",
    "testing": "%LOCALAPPDATA%\\\\Google\\\\Chrome for Testing\\\\User Data"
  },

  "binary_location": {
    "os": "C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe",
    "exe": "bin\\\\webdrivers\\\\chrome\\\\125.0.6422.14\\\\chromedriver.exe",
    "binary": "bin\\\\webdrivers\\\\chrome\\\\125.0.6422.14\\\\win64-125.0.6422.14\\\\chrome-win64\\\\chrome.exe",
    "chromium": "bin\\\\webdrivers\\\\chromium\\\\chrome-win\\\\chrome.exe"
  },

  "headers": {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36",
    "Accept": "text/html,application/xhtml+xml,application/xml,application/json;q=0.9,*/*;q=0.8",
    "Accept-Charset": "ISO-8859-1,utf-8;q=0.7,*;q=0.3",
    "Accept-Encoding": "none",
    "Accept-Language": "en-US,en;q=0.8",
    "Connection": "keep-alive"
  },
  "proxy_enabled": false
}
```

### Описание полей конфигурации

#### 1. `options`
Словарь параметров Chrome для изменения поведения браузера:
- **log-level**: Устанавливает уровень логирования. Значение `5` соответствует самому подробному уровню логирования.
- **disable-dev-shm-usage**: Отключает использование `/dev/shm` в Docker контейнерах (полезно для предотвращения ошибок в контейнерных средах).
- **remote-debugging-port**: Устанавливает порт для удаленной отладки в Chrome. Значение `0` означает, что будет назначен случайный порт.
- **arguments**: Список аргументов командной строки, передаваемых Chrome. Примеры: `--kiosk` для режима киоска и `--disable-gpu` для отключения аппаратного ускорения GPU.

#### 2. `disabled_options`
Опции, которые явно отключены. В данном случае, режим `headless` отключен, что означает, что Chrome будет работать в видимом окне, а не в фоновом режиме.

#### 3. `profile_directory`
Пути к каталогам пользовательских данных Chrome для различных сред:
- **os**: Путь к каталогу пользовательских данных по умолчанию (обычно для систем Windows).
- **internal**: Внутренний путь для профиля WebDriver по умолчанию.
- **testing**: Путь к каталогу пользовательских данных, специально настроенному для тестирования.

#### 4. `binary_location`
Пути к различным бинарным файлам Chrome:
- **os**: Путь к установленному бинарному файлу Chrome для операционной системы.
- **exe**: Путь к исполняемому файлу ChromeDriver.
- **binary**: Конкретный путь к бинарному файлу Chrome для тестирования.
- **chromium**: Путь к бинарному файлу Chromium, который можно использовать в качестве альтернативы Chrome.

#### 5. `headers`
Пользовательские HTTP-заголовки, используемые в запросах браузера:
- **User-Agent**: Устанавливает строку user-agent для браузера.
- **Accept**: Устанавливает типы данных, которые браузер готов принимать.
- **Accept-Charset**: Устанавливает кодировку символов, поддерживаемую браузером.
- **Accept-Encoding**: Устанавливает поддерживаемые методы кодирования (установите значение `none`, чтобы отключить).
- **Accept-Language**: Устанавливает предпочтительные языки.
- **Connection**: Устанавливает тип соединения, который должен использовать браузер (например, `keep-alive`).

#### 6. `proxy_enabled`
Логическое значение, указывающее, следует ли использовать прокси-сервер для WebDriver. По умолчанию `false`.

## Использование

Чтобы использовать `Chrome` WebDriver в своем проекте, просто импортируйте и инициализируйте его:

```python
from src.webdriver.chrome import Chrome

# Инициализация Chrome WebDriver с настройками user-agent и пользовательскими опциями
browser = Chrome(user_agent='Mozilla/5.0 (Windows NT 10.0; Win64; x64)', options=['--headless', '--disable-gpu'])

# Открытие веб-сайта
browser.get('https://www.example.com')

# Закрытие браузера
browser.quit()
```

Класс `Chrome` автоматически загружает настройки из файла `chrome.json` и использует их для настройки WebDriver. Вы также можете указать пользовательский user-agent и передать дополнительные опции во время инициализации WebDriver.

### Singleton Pattern

`Chrome` WebDriver использует Singleton Pattern. Это означает, что будет создан только один экземпляр WebDriver. Если экземпляр уже существует, тот же экземпляр будет повторно использован, и будет открыто новое окно.

## Логирование и отладка

Класс WebDriver использует `logger` из `src.logger` для логирования ошибок, предупреждений и общей информации. Все проблемы, возникающие во время инициализации, настройки или выполнения, будут регистрироваться для облегчения отладки.

### Пример логов

- **Ошибка во время инициализации WebDriver**: `Error initializing Chrome WebDriver: <error details>`
- **Проблемы с конфигурацией**: `Error in chrome.json file: <issue details>`

## Лицензия

Этот проект лицензирован в соответствии с лицензией MIT. См. файл [LICENSE](../../LICENSE) для получения подробной информации.
### **Анализ кода модуля `collect_hierarhy`**

## \file hypotez/toolbox/collect_hierarhy.py.md
# -*- coding: utf-8 -*-
#! .pyenv/bin/python3

"""
Модуль для сбора и копирования иерархии файлов
=================================================

Этот модуль предназначен для рекурсивного обхода директории `src/utils`, сбора иерархии файлов с определенными расширениями и копирования их в директорию `prod`.
Он также создает JSON-файл с иерархией собранных файлов.

Подробнее:
Модуль используется для сбора структуры файлов в директории `src/utils` и их копирования в директорию `prod`.
Это может быть полезно для создания структуры проекта для продакшн-окружения или для других целей, где требуется копия файлов с сохранением их иерархии.

Функции:
    - `collect_and_copy_files`: Рекурсивно обходит указанную директорию, собирает иерархию файлов и копирует файлы с определенными расширениями в целевую директорию.
    - `main`: Определяет исходную и целевую директории, вызывает функцию `collect_and_copy_files` для сбора и копирования файлов, и сохраняет иерархию файлов в JSON-файл.

Запуск:
При запуске этого скрипта будет вызвана функция `main`, которая соберет иерархию файлов из директории `src/utils`, скопирует их в директорию `prod`, и сохранит иерархию в файл `file_hierarchy.json`.

Примеры:
Предположим, что структура директории `src/utils` выглядит следующим образом:
```
src/utils/
├── file1.py
├── file2.json
├── subdir1/
│   ├── file3.py
│   └── file4.md
└── subdir2/
    └── file5.dot
```
После выполнения скрипта, в директории `prod` будет создана следующая структура:
```
prod/
├── file1.py
├── file2.json
├── subdir1/
│   ├── file3.py
│   └── file4.md
└── subdir2/
    └── file5.dot
```
И файл `file_hierarchy.json` будет содержать JSON-представление этой структуры.
"""

## Качество кода:
- **Соответствие стандартам**: 7/10
- **Плюсы**:
    - Хорошая документация модуля и функций.
    - Понятное описание назначения модуля.
    - Логическая структура кода.
- **Минусы**:
    - Отсутствуют импорты необходимых модулей.
    - Не указаны типы для возвращаемых значений функций.
    - Используются общие фразы в комментариях, такие как "делает".

## Рекомендации по улучшению:
- Добавить импорты необходимых модулей, таких как `os`, `shutil`, `json` и `Path`.
- Уточнить типы возвращаемых значений функций.
- Перефразировать общие фразы в комментариях на более конкретные и точные.

## Оптимизированный код:
```python
## \file hypotez/toolbox/collect_hierarhy.py.md
# -*- coding: utf-8 -*-
#! .pyenv/bin/python3

"""
Модуль для сбора и копирования иерархии файлов
=================================================

Этот модуль предназначен для рекурсивного обхода директории `src/utils`, сбора иерархии файлов с определенными расширениями и копирования их в директорию `prod`.
Он также создает JSON-файл с иерархией собранных файлов.

Описание функциональности:
Модуль используется для сбора структуры файлов в директории `src/utils` и их копирования в директорию `prod`.
Это может быть полезно для создания структуры проекта для продакшн-окружения или для других целей, где требуется копия файлов с сохранением их иерархии.

Функции:
    - `collect_and_copy_files`: Рекурсивно обходит указанную директорию, собирает иерархию файлов и копирует файлы с определенными расширениями в целевую директорию.
    - `main`: Определяет исходную и целевую директории, вызывает функцию `collect_and_copy_files` для сбора и копирования файлов, и сохраняет иерархию файлов в JSON-файл.

Запуск:
При запуске этого скрипта вызывается функция `main`, которая выполняет сбор иерархии файлов из директории `src/utils`, копирует их в директорию `prod` и сохраняет иерархию в файл `file_hierarchy.json`.

Примеры:
Предположим, что структура директории `src/utils` выглядит следующим образом:
```
src/utils/
├── file1.py
├── file2.json
├── subdir1/
│   ├── file3.py
│   └── file4.md
└── subdir2/
    └── file5.dot
```
После выполнения скрипта, в директории `prod` создается следующая структура:
```
prod/
├── file1.py
├── file2.json
├── subdir1/
│   ├── file3.py
│   └── file4.md
└── subdir2/
    └── file5.dot
```
И файл `file_hierarchy.json` содержит JSON-представление этой структуры.
"""

import os # Импорт модуля для работы с операционной системой
import shutil # Импорт модуля для операций с файлами и директориями
import json # Импорт модуля для работы с JSON
from pathlib import Path # Импорт класса Path для работы с путями

from src.logger import logger #  Импортируем модуль логгирования

def collect_and_copy_files(directory: Path, target_directory: Path) -> dict:
    """
    Рекурсивно обходит указанную директорию, собирает иерархию файлов и копирует файлы с определенными расширениями в целевую директорию.

    Args:
        directory (Path): Путь к директории, которую нужно обойти.
        target_directory (Path): Путь к целевой директории, в которую будут скопированы файлы.

    Returns:
        dict: Словарь, представляющий иерархию файлов, где ключи - имена файлов и папок.
    """
    hierarchy: dict = {} # Инициализация словаря для хранения иерархии файлов
    excluded_dirs: tuple[str] = ('profiles', '__pycache__', '_experiments') # Определение исключенных директорий
    allowed_extensions: tuple[str] = ('.py', '.json', '.md', '.dot', '.mer') # Определение разрешенных расширений файлов

    for item in directory.iterdir(): # Перебор всех элементов в директории
        try:
            if item.is_dir(): # Проверка, является ли элемент директорией
                if (item.name not in excluded_dirs and
                        not item.name.startswith('___') and
                        '*' not in item.name): # Проверка на исключения для директорий
                    hierarchy[item.name] = collect_and_copy_files(item, target_directory) # Рекурсивный вызов функции для поддиректории
            elif item.is_file(): # Проверка, является ли элемент файлом
                if (item.suffix in allowed_extensions and
                        not item.name.startswith('___') and
                        '*' not in item.name and
                        '(' not in item.name and
                        ')' not in item.name): # Проверка на исключения для файлов
                    hierarchy[item.name] = None # Добавление имени файла в иерархию со значением None

                    target_file_path: Path = target_directory / item.name # Формирование пути к файлу в целевой директории
                    target_file_path.parent.mkdir(parents=True, exist_ok=True)  # Создание родительских директорий для целевого файла, если они не существуют
                    shutil.copy2(item, target_file_path) # Копирование файла в целевую директорию с сохранением метаданных
        except Exception as ex:
            logger.error(f'Произошла ошибка при обработке {item}', ex, exc_info=True)

    return hierarchy # Возврат словаря с иерархией файлов


def main():
    """
    Определяет исходную и целевую директории, вызывает функцию `collect_and_copy_files` для сбора и копирования файлов,
    и сохраняет иерархию файлов в JSON-файл.
    """
    try:
        src_directory: Path = Path('src/utils').resolve() # Определение исходной директории
        project_structure_directory: Path = src_directory.parent.parent / 'prod' # Определение целевой директории

        hierarchy: dict = collect_and_copy_files(src_directory, project_structure_directory) # Сбор иерархии файлов и их копирование в целевую директорию

        file_hierarchy_path: Path = project_structure_directory / 'file_hierarchy.json' # Определение пути к файлу, в который будет сохранена иерархия

        with open(file_hierarchy_path, 'w', encoding='utf-8') as f: # Открытие файла для записи
            json.dump(hierarchy, f, indent=4, ensure_ascii=False) # Сохранение иерархии файлов в JSON-файл
    except Exception as ex:
        logger.error('Произошла ошибка в main', ex, exc_info=True)


if __name__ == "__main__":
    main()